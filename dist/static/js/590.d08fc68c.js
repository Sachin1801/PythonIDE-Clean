(self["webpackChunkvm_web_ide"]=self["webpackChunkvm_web_ide"]||[]).push([[590],{44317:function(e,t,i){(function(e){e(i(15237))})(function(e){e.defineOption("showTrailingSpace",!1,function(t,i,o){o==e.Init&&(o=!1),o&&!i?t.removeOverlay("trailingspace"):!o&&i&&t.addOverlay({token:function(e){for(var t=e.string.length,i=t;i&&/\s/.test(e.string.charAt(i-1));--i);return i>e.pos?(e.pos=i,null):(e.pos=t,"trailingspace")},name:"trailingspace"})})})},64590:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return vl}});var o=i(20641),s=i(53751),n=i(90033);const a={class:"login-modal"},l={class:"login-header"},r={class:"login-body"},d={class:"form-group"},c=["disabled"],h={class:"form-group"},p=["disabled"],u={key:0,class:"error-message"},m=["disabled"],f={key:0},g={key:1};function v(e,t,i,v,y,w){const k=(0,o.g2)("X");return i.visible?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"login-modal-overlay",onClick:t[6]||(t[6]=(0,s.D$)((...e)=>w.close&&w.close(...e),["self"]))},[(0,o.Lk)("div",a,[(0,o.Lk)("div",l,[t[7]||(t[7]=(0,o.Lk)("h3",null,"Sign In to Python IDE",-1)),(0,o.Lk)("div",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>w.close&&w.close(...e))},[(0,o.bF)(k,{size:20})])]),(0,o.Lk)("div",r,[(0,o.Lk)("form",{onSubmit:t[5]||(t[5]=(0,s.D$)((...e)=>w.handleLogin&&w.handleLogin(...e),["prevent"]))},[(0,o.Lk)("div",d,[t[8]||(t[8]=(0,o.Lk)("label",{for:"username"},"Username (Net ID)",-1)),(0,o.bo)((0,o.Lk)("input",{id:"username","onUpdate:modelValue":t[1]||(t[1]=e=>y.username=e),type:"text",placeholder:"Enter your net id",required:"",disabled:y.loading,onInput:t[2]||(t[2]=(...e)=>w.clearError&&w.clearError(...e))},null,40,c),[[s.Jo,y.username]])]),(0,o.Lk)("div",h,[t[9]||(t[9]=(0,o.Lk)("label",{for:"password"},"Password",-1)),(0,o.bo)((0,o.Lk)("input",{id:"password","onUpdate:modelValue":t[3]||(t[3]=e=>y.password=e),type:"password",placeholder:"Enter your password",required:"",disabled:y.loading,onInput:t[4]||(t[4]=(...e)=>w.clearError&&w.clearError(...e))},null,40,p),[[s.Jo,y.password]])]),y.error?((0,o.uX)(),(0,o.CE)("div",u,(0,n.v_)(y.error),1)):(0,o.Q3)("",!0),(0,o.Lk)("button",{type:"submit",class:"login-btn",disabled:y.loading},[y.loading?((0,o.uX)(),(0,o.CE)("span",f,"Signing in...")):((0,o.uX)(),(0,o.CE)("span",g,"Sign In"))],8,m)],32)])])])):(0,o.Q3)("",!0)}var y=i(6494),w=i(96763),k={name:"LoginModal",components:{X:y.A},props:{visible:{type:Boolean,default:!1}},data(){return{username:"",password:"",loading:!1,error:"",isFirstLogin:!1}},watch:{username(e){e&&e.match(/^[a-z]{2}\d{4}$/)?this.isFirstLogin=!0:this.isFirstLogin=!1}},methods:{async handleLogin(){this.loading=!0,this.error="";try{const e="/api/login",t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.username,password:this.password})}),i=await t.json();i.success?(localStorage.setItem("session_id",i.session_id),localStorage.setItem("username",i.username),localStorage.setItem("role",i.role),localStorage.setItem("full_name",i.full_name),this.$emit("login-success",{username:i.username,role:i.role,full_name:i.full_name,session_id:i.session_id}),this.close(),window.location.reload()):this.error=i.error||"Invalid username or password"}catch(Sa){w.error("Login error:",Sa),this.error="Connection error. Please try again."}finally{this.loading=!1}},clearError(){this.error=""},close(){this.username="",this.password="",this.error="",this.loading=!1,this.$emit("close")},async validateSession(e){try{const t="/api/validate-session",i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:e})}),o=await i.json();o.success||(localStorage.removeItem("session_id"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("full_name"))}catch(Sa){w.error("Session validation error:",Sa)}}},mounted(){const e=localStorage.getItem("session_id");e&&this.validateSession(e)}},b=i(66262);const I=(0,b.A)(k,[["render",v],["__scopeId","data-v-f34a53b2"]]);var S=I,P=i(5012),C=i(42496),L=i(64481),F=i(28643);const E={class:"file-browser-content"},R={class:"current-path"},x={class:"path-value"},D={class:"file-tree-container"},$={class:"node-item"},T=["src"],j={class:"node-label"},N={key:0,class:"selected-file"},M={class:"selected-value"},_={key:1,class:"selected-file"},A={class:"selected-value"},W={class:"dialog-footer"};function O(e,t,i,s,a,l){const r=F.qk,d=L.S2,c=C.kZ;return(0,o.uX)(),(0,o.Wv)(c,{title:l.title,modelValue:l.visible,"onUpdate:modelValue":t[0]||(t[0]=e=>l.visible=e),width:"600px","close-on-click-modal":!1,onClose:l.handleClose,class:"file-browser-dialog custom-dialog"},{footer:(0,o.k6)(()=>[(0,o.Lk)("div",W,[(0,o.bF)(d,{onClick:l.handleClose},{default:(0,o.k6)(()=>t[4]||(t[4]=[(0,o.eW)("Cancel",-1)])),_:1,__:[4]},8,["onClick"]),(0,o.bF)(d,{type:"primary",onClick:l.handleConfirm,disabled:!l.canConfirm},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(l.confirmButtonText),1)]),_:1},8,["onClick","disabled"])])]),default:(0,o.k6)(()=>[(0,o.Lk)("div",E,[(0,o.Lk)("div",R,[t[1]||(t[1]=(0,o.Lk)("span",{class:"path-label"},"Current Path:",-1)),(0,o.Lk)("span",x,(0,n.v_)(a.currentPath||"/"),1)]),(0,o.Lk)("div",D,[(0,o.bF)(r,{data:l.treeData,props:a.treeProps,"node-key":"path","expand-on-click-node":!1,"default-expanded-keys":a.expandedKeys,"highlight-current":"",onNodeClick:l.handleNodeClick,onNodeExpand:l.handleNodeExpand,onNodeCollapse:l.handleNodeCollapse,ref:"fileTree"},{default:(0,o.k6)(({node:e,data:t})=>[(0,o.Lk)("span",$,[(0,o.Lk)("img",{src:l.getIconUrl(t),alt:"",class:"node-icon"},null,8,T),(0,o.Lk)("span",j,(0,n.v_)(e.label),1)])]),_:1},8,["data","props","default-expanded-keys","onNodeClick","onNodeExpand","onNodeCollapse"])]),"open"===i.mode?((0,o.uX)(),(0,o.CE)("div",N,[t[2]||(t[2]=(0,o.Lk)("span",{class:"selected-label"},"Selected File:",-1)),(0,o.Lk)("span",M,(0,n.v_)(a.selectedFile?a.selectedFile.label:"None"),1)])):(0,o.Q3)("",!0),"move"===i.mode?((0,o.uX)(),(0,o.CE)("div",_,[t[3]||(t[3]=(0,o.Lk)("span",{class:"selected-label"},"Move to:",-1)),(0,o.Lk)("span",A,(0,n.v_)(a.selectedFolder?a.selectedFolder.path:"/"),1)])):(0,o.Q3)("",!0)])]),_:1},8,["title","modelValue","onClose"])}i(44114),i(18111),i(22489),i(7588),i(61701);var U=i(53793),z=i(96763),V={name:"DialogFileBrowser",props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"open",validator:e=>["open","move"].includes(e)},fileToMove:{type:Object,default:null},currentUser:{type:Object,default:null}},data(){return{selectedFile:null,selectedFolder:null,currentPath:"/",expandedKeys:[],treeProps:{label:"label",children:"children"}}},computed:{visible:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},title(){return"open"===this.mode?"Open File":"Move File"},confirmButtonText(){return"open"===this.mode?"Open":"Move"},canConfirm(){return"open"===this.mode?null!==this.selectedFile:"move"===this.mode&&(null!==this.selectedFolder&&this.fileToMove&&this.selectedFolder.path!==this.getParentPath(this.fileToMove.path))},ideInfo(){return this.$store?.state?.ide?.ideInfo||{}},treeData(){let e;return e=this.ideInfo.multiRootData&&this.ideInfo.multiRootData.children.length>0?this.ideInfo.multiRootData.children:this.ideInfo.currProj.data?[this.ideInfo.currProj.data]:[],"move"===this.mode&&(e=this.filterOutFile(e),e=this.filterByPermissions(e)),e},isStudent(){return this.currentUser&&"student"===this.currentUser.role},studentDirectory(){return this.isStudent&&this.currentUser?.username?`Local/${this.currentUser.username}`:null}},methods:{getIconUrl(e){try{if("file"===e.type){const t=e.path.substring(e.path.lastIndexOf(".")+1);return i(80238)(`./${(0,U.ry)(t)}`)}if("dir"===e.type||"folder"===e.type){const t=this.expandedKeys.includes(e.path),o=t?(0,U.vT)(e.label):(0,U.lM)(e.label);return i(80238)(`./${o}`)}}catch(t){return"file"===e.type?i(77844):i(67734)}},handleNodeClick(e){if("open"===this.mode)"file"===e.type?(this.selectedFile=e,this.currentPath=e.path):this.expandedKeys.includes(e.path)?this.handleNodeCollapse(e):this.handleNodeExpand(e);else if("move"===this.mode&&("dir"===e.type||"folder"===e.type)){if(this.currentUser&&this.isStudent&&!this.canAccessPath(e.path))return void this.$message.warning("You can only move files within your personal directory");this.selectedFolder=e,this.currentPath=e.path}},handleNodeExpand(e){this.expandedKeys.includes(e.path)||this.expandedKeys.push(e.path)},handleNodeCollapse(e){const t=this.expandedKeys.indexOf(e.path);t>-1&&this.expandedKeys.splice(t,1)},handleConfirm(){if(z.log("[DialogFileBrowser] handleConfirm called:",{mode:this.mode,selectedFile:this.selectedFile,selectedFolder:this.selectedFolder,fileToMove:this.fileToMove}),"open"===this.mode&&this.selectedFile)z.log("[DialogFileBrowser] Opening file:",this.selectedFile.path),this.$emit("open-file",this.selectedFile.path),this.handleClose();else if("move"===this.mode&&this.selectedFolder&&this.fileToMove){const e=this.getFileName(this.fileToMove.path),t=this.selectedFolder.path.endsWith("/")?this.selectedFolder.path+e:this.selectedFolder.path+"/"+e;z.log("[DialogFileBrowser] Moving file - DETAILED DEBUG:",{mode:this.mode,oldPath:this.fileToMove.path,newPath:t,selectedFolderPath:this.selectedFolder.path,fileName:e,fileToMove:this.fileToMove,selectedFolder:this.selectedFolder,projectName:this.fileToMove.projectName||this.ideInfo.currProj?.data?.name}),this.$emit("move-file",{oldPath:this.fileToMove.path,newPath:t,projectName:this.fileToMove.projectName||this.ideInfo.currProj?.data?.name}),this.handleClose()}else z.log("[DialogFileBrowser] Cannot confirm - missing requirements:",{mode:this.mode,hasSelectedFile:!!this.selectedFile,hasSelectedFolder:!!this.selectedFolder,hasFileToMove:!!this.fileToMove,canConfirm:this.canConfirm})},handleClose(){this.selectedFile=null,this.selectedFolder=null,this.currentPath="/",this.expandedKeys=[],this.$emit("update:modelValue",!1)},getParentPath(e){const t=e.lastIndexOf("/");return t>0?e.substring(0,t):"/"},getFileName(e){const t=e.lastIndexOf("/");return t>=0?e.substring(t+1):e},filterOutFile(e){return this.fileToMove?e.map(e=>e.path===this.fileToMove.path?null:e.children&&e.children.length>0?{...e,children:this.filterOutFile(e.children).filter(Boolean)}:e).filter(Boolean):e},filterByPermissions(e){return this.isStudent?e.map(e=>this.canAccessPath(e.path)?e.children&&e.children.length>0?{...e,children:this.filterByPermissions(e.children)}:e:null).filter(Boolean):e},canAccessPath(e){return!this.isStudent||!(!e||!this.studentDirectory)&&(e===this.studentDirectory||e.startsWith(this.studentDirectory+"/"))}},watch:{visible(e){e&&(this.selectedFile=null,this.selectedFolder=null,this.currentPath="/",this.expandedKeys=[],this.$nextTick(()=>{this.treeData&&this.treeData.length>0&&this.treeData.forEach(e=>{"dir"!==e.type&&"folder"!==e.type||!e.path||this.expandedKeys.push(e.path)})}))}}};const B=(0,b.A)(V,[["render",O]]);var X=B;const H={class:"import-file-dialog"},K={class:"dialog-header"},G={class:"dialog-body"},Q={class:"directory-section"},q={class:"directory-nav"},J={key:0,class:"directory-tree"},Y=["onClick"],Z={class:"upload-section"},ee={class:"upload-icon"},te={key:0,class:"error-hint"},ie={key:0,class:"selected-files-section"},oe={class:"selected-files-list"},se={class:"file-info"},ne=["src"],ae={class:"file-details"},le={class:"file-name"},re={class:"file-size"},de=["onClick"],ce={key:1,class:"preview-section"},he={class:"import-preview"},pe={class:"destination-info"},ue={class:"destination-path"},me={class:"file-count"},fe={class:"dialog-footer"},ge=["disabled"];function ve(e,t,i,a,l,r){const d=(0,o.g2)("X"),c=(0,o.g2)("FolderOpen"),h=(0,o.g2)("ChevronDown"),p=(0,o.g2)("ChevronRight"),u=(0,o.g2)("Home"),m=(0,o.g2)("Folder"),f=(0,o.g2)("Upload");return(0,o.uX)(),(0,o.CE)("div",null,[t[14]||(t[14]=(0,o.Lk)("div",{class:"dialog-cover"},null,-1)),(0,o.Lk)("div",H,[(0,o.Lk)("div",K,[t[9]||(t[9]=(0,o.Lk)("h3",null,"Import Files",-1)),(0,o.Lk)("div",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>r.onCancel&&r.onCancel(...e))},[(0,o.bF)(d,{size:20})])]),(0,o.Lk)("div",G,[(0,o.Lk)("div",Q,[t[10]||(t[10]=(0,o.Lk)("label",null,"Select Destination Directory:",-1)),(0,o.Lk)("div",q,[(0,o.Lk)("div",{class:"current-path",onClick:t[1]||(t[1]=(...e)=>r.toggleDirectoryTree&&r.toggleDirectoryTree(...e))},[(0,o.bF)(c,{size:16}),(0,o.Lk)("span",null,(0,n.v_)(r.formatCurrentPath(l.currentPath)),1),l.showDirectoryTree?((0,o.uX)(),(0,o.Wv)(h,{key:0,size:16,class:"chevron"})):((0,o.uX)(),(0,o.Wv)(p,{key:1,size:16,class:"chevron"}))]),l.showDirectoryTree?((0,o.uX)(),(0,o.CE)("div",J,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.directories,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.path,class:(0,n.C4)(["directory-item",{selected:l.currentPath===e.path,"root-item":e.isRoot}]),style:(0,n.Tr)({paddingLeft:20*e.level+12+"px"}),onClick:t=>r.selectDirectory(e)},[e.isRoot?((0,o.uX)(),(0,o.Wv)(u,{key:0,size:14})):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.bF)(p,{size:14}),(0,o.bF)(m,{size:14})],64)),(0,o.Lk)("span",null,(0,n.v_)(e.displayName||e.name),1)],14,Y))),128))])):(0,o.Q3)("",!0)])]),(0,o.Lk)("div",Z,[t[12]||(t[12]=(0,o.Lk)("label",null,"Select Files to Import:",-1)),(0,o.Lk)("div",{class:(0,n.C4)(["file-drop-area",{"drag-over":l.dragOver}]),onDrop:t[3]||(t[3]=(...e)=>r.handleDrop&&r.handleDrop(...e)),onDragover:t[4]||(t[4]=(0,s.D$)(e=>l.dragOver=!0,["prevent"])),onDragleave:t[5]||(t[5]=(0,s.D$)(e=>l.dragOver=!1,["prevent"])),onClick:t[6]||(t[6]=(...e)=>r.triggerFileInput&&r.triggerFileInput(...e))},[(0,o.Lk)("input",{type:"file",ref:"fileInput",onChange:t[2]||(t[2]=(...e)=>r.handleFileSelect&&r.handleFileSelect(...e)),multiple:"",accept:".py,.txt,.csv,.pdf",style:{display:"none"}},null,544),(0,o.Lk)("div",ee,[(0,o.bF)(f,{size:48})]),t[11]||(t[11]=(0,o.Lk)("div",{class:"upload-text"},[(0,o.Lk)("div",{class:"main-text"},"Click to select files or drag and drop"),(0,o.Lk)("div",{class:"sub-text"},"Supported formats: .py, .txt, .csv, .pdf")],-1))],34),l.uploadError?((0,o.uX)(),(0,o.CE)("div",te,(0,n.v_)(l.uploadError),1)):(0,o.Q3)("",!0)]),l.selectedFiles.length>0?((0,o.uX)(),(0,o.CE)("div",ie,[(0,o.Lk)("label",null,"Selected Files ("+(0,n.v_)(l.selectedFiles.length)+"):",1),(0,o.Lk)("div",oe,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.selectedFiles,(e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:t,class:"file-item"},[(0,o.Lk)("div",se,[(0,o.Lk)("img",{src:r.getFileIcon(e.name),alt:"",class:"file-icon"},null,8,ne),(0,o.Lk)("div",ae,[(0,o.Lk)("div",le,(0,n.v_)(e.name),1),(0,o.Lk)("div",re,(0,n.v_)(r.formatFileSize(e.size)),1)])]),(0,o.Lk)("button",{class:"remove-btn",onClick:e=>r.removeFile(t),title:"Remove"},[(0,o.bF)(d,{size:16})],8,de)]))),128))])])):(0,o.Q3)("",!0),l.selectedFiles.length>0&&!l.uploadError?((0,o.uX)(),(0,o.CE)("div",ce,[t[13]||(t[13]=(0,o.Lk)("label",null,"Files will be imported to:",-1)),(0,o.Lk)("div",he,[(0,o.Lk)("div",pe,[(0,o.bF)(c,{size:20}),(0,o.Lk)("div",null,[(0,o.Lk)("div",ue,(0,n.v_)(r.formatCurrentPath(l.currentPath)),1),(0,o.Lk)("div",me,(0,n.v_)(l.selectedFiles.length)+" file(s) selected",1)])])])])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",fe,[(0,o.Lk)("button",{class:"btn-cancel",onClick:t[7]||(t[7]=(...e)=>r.onCancel&&r.onCancel(...e))},"Cancel"),(0,o.Lk)("button",{class:"btn-import",onClick:t[8]||(t[8]=(...e)=>r.onImport&&r.onImport(...e)),disabled:0===l.selectedFiles.length||l.uploading},(0,n.v_)(l.uploading?"Importing...":`Import ${l.selectedFiles.length} file(s)`),9,ge)])])])}i(13579);var ye=i(74829),we=i(27336),ke=i(77950),be=i(24758),Ie=i(75365),Se=i(51058),Pe=i(56660),Ce=i(16990),Le=i(96763),Fe={props:{modelValue:Boolean},data(){return{currentPath:"/",currentProject:null,directories:[],selectedFiles:[],uploadError:"",uploading:!1,showDirectoryTree:!1,dragOver:!1,supportedExtensions:[".py",".txt",".csv",".pdf"]}},computed:{ideInfo(){return this.$store.state.ide.ideInfo},currentUser(){const e=localStorage.getItem("session_id"),t=localStorage.getItem("username"),i=localStorage.getItem("role"),o=localStorage.getItem("full_name");return e&&t?{session_id:e,username:t,role:i,full_name:o}:null}},components:{X:y.A,FolderOpen:ye.A,Folder:we.A,ChevronRight:ke.A,ChevronDown:be.A,Upload:Ie.A,Home:Se.A},mounted(){this.loadDirectoryStructure()},methods:{loadDirectoryStructure(){if(this.ideInfo.multiRootData&&this.ideInfo.multiRootData.children.length>0?(this.directories=[],this.ideInfo.multiRootData.children.forEach(e=>{const t=this.buildDirectoryTree(e,0,e.label);this.directories=this.directories.concat(t)})):this.ideInfo.currProj&&this.ideInfo.currProj.data&&(this.directories=this.buildDirectoryTree(this.ideInfo.currProj.data,0,this.ideInfo.currProj.data.label)),this.ideInfo.nodeSelected){if("dir"===this.ideInfo.nodeSelected.type||"folder"===this.ideInfo.nodeSelected.type)this.currentPath=this.ideInfo.nodeSelected.path,this.currentProject=this.ideInfo.nodeSelected.projectName||this.ideInfo.currProj?.data?.name;else if("file"===this.ideInfo.nodeSelected.type){const e=this.ideInfo.nodeSelected.path.substring(0,this.ideInfo.nodeSelected.path.lastIndexOf("/"))||"/";this.currentPath=e,this.currentProject=this.ideInfo.nodeSelected.projectName||this.ideInfo.currProj?.data?.name}}else this.currentProject=this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name},buildDirectoryTree(e,t=0,i=null){let o=[];return 0===t&&o.push({name:i||e.label||"/",displayName:i||e.label||"/",path:e.path||"/",level:0,isRoot:!0,projectName:i||e.label,fullPath:i?`${i}${e.path}`:e.path}),e.children&&e.children.forEach(e=>{"dir"!==e.type&&"folder"!==e.type||(o.push({name:e.label,displayName:e.label,path:e.path,level:t+1,isRoot:!1,projectName:i||e.projectName,fullPath:i?`${i}${e.path}`:e.path}),e.children&&(o=o.concat(this.buildDirectoryTree(e,t+1,i))))}),o},selectDirectory(e){this.currentPath=e.path,this.currentProject=e.projectName,this.showDirectoryTree=!1},toggleDirectoryTree(){this.showDirectoryTree=!this.showDirectoryTree},formatCurrentPath(e){if(this.currentProject)return"/"===e?this.currentProject:e.startsWith(this.currentProject)?e:this.currentProject+e;if("/"===e&&this.ideInfo.currProj)return this.ideInfo.currProj.data?.label||this.ideInfo.currProj.config?.name;if(e.startsWith("/")&&this.ideInfo.currProj){const t=this.ideInfo.currProj.data?.label||this.ideInfo.currProj.config?.name;return e.includes(t)?e:t+e}return e},triggerFileInput(){this.$refs.fileInput.click()},handleFileSelect(e){const t=Array.from(e.target.files);this.processFiles(t)},handleDrop(e){e.preventDefault(),this.dragOver=!1;const t=Array.from(e.dataTransfer.files);this.processFiles(t)},processFiles(e){this.uploadError="";const t=[],i=[];e.forEach(e=>{const o="."+e.name.split(".").pop().toLowerCase();this.supportedExtensions.includes(o)?e.size<=10485760?t.push(e):i.push(`${e.name} (file too large, max 10MB)`):i.push(`${e.name} (unsupported format)`)}),i.length>0&&(this.uploadError=`Invalid files: ${i.join(", ")}`),t.forEach(e=>{const t=this.selectedFiles.some(t=>t.name===e.name&&t.size===e.size);t||this.selectedFiles.push(e)})},removeFile(e){this.selectedFiles.splice(e,1),0===this.selectedFiles.length&&(this.uploadError="")},formatFileSize(e){if(0===e)return"0 Bytes";const t=1024,i=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+i[o]},getFileIcon(e){const t=e.substring(e.lastIndexOf(".")+1);return i(80238)(`./${(0,U.ry)(t)}`)},async onImport(){if(0===this.selectedFiles.length)return;this.uploading=!0;const e=this.currentProject||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name;let t=this.currentPath;t&&e&&t.startsWith(e)&&(t=t.substring(e.length)||"/"),t&&!t.startsWith("/")&&(t="/"+t),Le.log("[DialogImportFile] Upload params:",{projectName:e,rawCurrentPath:this.currentPath,cleanedParentPath:t});try{const i=this.selectedFiles.map(async i=>{const o=new FormData;o.append("file",i),o.append("projectName",e),o.append("parentPath",t),o.append("filename",i.name);const s=await fetch("/api/upload-file",{method:"POST",body:o,headers:{"session-id":this.currentUser?.session_id}}),n=await s.json();if(!n.success)throw new Error(`Failed to upload ${i.name}: ${n.error}`);return n});await Promise.all(i),Ce.nk.success(`Successfully imported ${this.selectedFiles.length} file(s)`),this.$store.dispatch(`ide/${Pe.QQ}`,{projectName:e,callback:e=>{0===e.code&&(this.$store.commit("ide/handleProject",e.data),this.ideInfo.multiRootData&&this.$parent.loadAllDefaultProjects?.())}}),this.$emit("files-imported",{count:this.selectedFiles.length,destination:this.currentPath,projectName:e}),this.$emit("update:modelValue",!1)}catch(Sa){Le.error("[DialogImportFile] Error importing files:",Sa),Ce.nk.error("Failed to import files: "+Sa.message)}finally{this.uploading=!1}},onCancel(){this.$emit("update:modelValue",!1)}}};const Ee=(0,b.A)(Fe,[["render",ve],["__scopeId","data-v-576c5682"]]);var Re=Ee;const xe={class:"new-folder-dialog"},De={class:"dialog-header"},$e={class:"dialog-body"},Te={class:"directory-section"},je={class:"directory-nav"},Ne={key:0,class:"directory-tree"},Me=["onClick"],_e={key:1,class:"folder-spacer"},Ae={class:"foldername-section"},We={class:"foldername-input-wrapper"},Oe={class:"folder-type-icon"},Ue={key:0,class:"error-hint"},ze={key:1,class:"folder-hint"},Ve={key:0,class:"preview-section"},Be={class:"folder-preview"},Xe={class:"folder-info"},He={class:"folder-path"},Ke={class:"dialog-footer"},Ge=["disabled"];function Qe(e,t,i,a,l,r){const d=(0,o.g2)("X"),c=(0,o.g2)("FolderOpen"),h=(0,o.g2)("ChevronDown"),p=(0,o.g2)("ChevronRight"),u=(0,o.g2)("Home"),m=(0,o.g2)("Folder");return(0,o.uX)(),(0,o.CE)("div",null,[t[11]||(t[11]=(0,o.Lk)("div",{class:"dialog-cover"},null,-1)),(0,o.Lk)("div",xe,[(0,o.Lk)("div",De,[t[6]||(t[6]=(0,o.Lk)("h3",null,"New Folder",-1)),(0,o.Lk)("div",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>r.onCancel&&r.onCancel(...e))},[(0,o.bF)(d,{size:20})])]),(0,o.Lk)("div",$e,[(0,o.Lk)("div",Te,[t[7]||(t[7]=(0,o.Lk)("label",null,"Select Parent Directory:",-1)),(0,o.Lk)("div",je,[(0,o.Lk)("div",{class:"current-path",onClick:t[1]||(t[1]=(...e)=>r.toggleDirectoryTree&&r.toggleDirectoryTree(...e))},[(0,o.bF)(c,{size:16}),(0,o.Lk)("span",null,(0,n.v_)(r.formatCurrentPath(l.currentPath)),1),l.showDirectoryTree?((0,o.uX)(),(0,o.Wv)(h,{key:0,size:16,class:"chevron"})):((0,o.uX)(),(0,o.Wv)(p,{key:1,size:16,class:"chevron"}))]),l.showDirectoryTree?((0,o.uX)(),(0,o.CE)("div",Ne,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.visibleDirectories,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.path,class:(0,n.C4)(["directory-item",{selected:l.currentPath===e.path,"root-item":e.isRoot,collapsible:e.hasChildren,collapsed:r.isCollapsed(e.path)}]),style:(0,n.Tr)({paddingLeft:20*e.level+12+"px"}),onClick:t=>r.selectDirectory(e)},[e.hasChildren?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[r.isCollapsed(e.path)?((0,o.uX)(),(0,o.Wv)(p,{key:1,size:14,class:"folder-chevron",onClick:(0,s.D$)(t=>r.toggleCollapse(e),["stop"])},null,8,["onClick"])):((0,o.uX)(),(0,o.Wv)(h,{key:0,size:14,class:"folder-chevron",onClick:(0,s.D$)(t=>r.toggleCollapse(e),["stop"])},null,8,["onClick"]))],64)):((0,o.uX)(),(0,o.CE)("span",_e)),e.isRoot?((0,o.uX)(),(0,o.Wv)(u,{key:2,size:14})):((0,o.uX)(),(0,o.Wv)(m,{key:3,size:14})),(0,o.Lk)("span",null,(0,n.v_)(e.displayName||e.name),1)],14,Me))),128))])):(0,o.Q3)("",!0)])]),(0,o.Lk)("div",Ae,[t[8]||(t[8]=(0,o.Lk)("label",null,"Folder Name:",-1)),(0,o.Lk)("div",We,[(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>l.folderName=e),onInput:t[3]||(t[3]=(...e)=>r.validateFolderName&&r.validateFolderName(...e)),placeholder:"Enter folder name",class:"foldername-input",ref:"folderNameInput"},null,544),[[s.Jo,l.folderName]]),(0,o.Lk)("div",Oe,[(0,o.bF)(m,{size:20})])]),l.folderNameError?((0,o.uX)(),(0,o.CE)("div",Ue,(0,n.v_)(l.folderNameError),1)):((0,o.uX)(),(0,o.CE)("div",ze," Folder names should not contain special characters "))]),l.folderName&&!l.folderNameError?((0,o.uX)(),(0,o.CE)("div",Ve,[t[10]||(t[10]=(0,o.Lk)("label",null,"Folder will be created at:",-1)),(0,o.Lk)("div",Be,[(0,o.Lk)("div",Xe,[(0,o.bF)(m,{size:20}),(0,o.Lk)("div",null,[(0,o.Lk)("div",He,(0,n.v_)(r.getFullFolderPath()),1),t[9]||(t[9]=(0,o.Lk)("div",{class:"folder-type"},"Directory",-1))])])])])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",Ke,[(0,o.Lk)("button",{class:"btn-cancel",onClick:t[4]||(t[4]=(...e)=>r.onCancel&&r.onCancel(...e))},"Cancel"),(0,o.Lk)("button",{class:"btn-create",onClick:t[5]||(t[5]=(...e)=>r.onCreate&&r.onCreate(...e)),disabled:!l.folderName||!!l.folderNameError||l.creating},(0,n.v_)(l.creating?"Creating...":"Create Folder"),9,Ge)])])])}i(20116),i(17642),i(58004),i(33853),i(45876),i(32475),i(15024),i(31698);var qe=i(96763),Je={props:{modelValue:Boolean},data(){return{currentPath:"/",currentProject:null,directories:[],folderName:"",folderNameError:"",creating:!1,showDirectoryTree:!1,collapsedFolders:new Set}},components:{X:y.A,FolderOpen:ye.A,Folder:we.A,ChevronRight:ke.A,ChevronDown:be.A,Home:Se.A},mounted(){this.loadDirectoryStructure(),this.$nextTick(()=>{this.$refs.folderNameInput?.focus()})},methods:{isDirectoryVisibleToStudent(e){if(!this.currentUser||"student"!==this.currentUser.role)return!0;const t=`Local/${this.currentUser.username}`;return"/"===e||e.startsWith(t)},loadDirectoryStructure(){if(this.ideInfo.multiRootData&&this.ideInfo.multiRootData.children.length>0?(this.directories=[],this.ideInfo.multiRootData.children.forEach(e=>{const t=this.buildDirectoryTree(e,0,e.label);this.directories=this.directories.concat(t)})):this.ideInfo.currProj&&this.ideInfo.currProj.data&&(this.directories=this.buildDirectoryTree(this.ideInfo.currProj.data,0,this.ideInfo.currProj.data.label)),this.ideInfo.nodeSelected){if("dir"===this.ideInfo.nodeSelected.type||"folder"===this.ideInfo.nodeSelected.type)this.currentPath=this.ideInfo.nodeSelected.path,this.currentProject=this.ideInfo.nodeSelected.projectName||this.ideInfo.currProj?.data?.name;else if("file"===this.ideInfo.nodeSelected.type){const e=this.ideInfo.nodeSelected.path.substring(0,this.ideInfo.nodeSelected.path.lastIndexOf("/"))||"/";this.currentPath=e,this.currentProject=this.ideInfo.nodeSelected.projectName||this.ideInfo.currProj?.data?.name}}else this.currentProject=this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name;if(this.currentUser&&"student"===this.currentUser.role&&"/"===this.currentPath){const e=`Local/${this.currentUser.username}`,t=this.directories.find(t=>t.path===e);t&&(this.currentPath=e)}},buildDirectoryTree(e,t=0,i=null,o=""){let s=[];if(0===t){const t=e.children&&e.children.some(e=>("dir"===e.type||"folder"===e.type)&&this.isDirectoryVisibleToStudent(e.path));s.push({name:i||e.label||"/",displayName:i||e.label||"/",path:e.path||"/",level:0,isRoot:!0,hasChildren:t,parentPath:"",projectName:i||e.label,fullPath:i?`${i}${e.path}`:e.path})}return e.children&&e.children.forEach(n=>{if(("dir"===n.type||"folder"===n.type)&&this.isDirectoryVisibleToStudent(n.path)){const a=n.children&&n.children.some(e=>("dir"===e.type||"folder"===e.type)&&this.isDirectoryVisibleToStudent(e.path)),l=0===t?e.path||"/":o;s.push({name:n.label,displayName:n.label,path:n.path,level:t+1,isRoot:!1,hasChildren:a,parentPath:l,projectName:i||n.projectName,fullPath:i?`${i}${n.path}`:n.path}),n.children&&(s=s.concat(this.buildDirectoryTree(n,t+1,i,n.path)))}}),s},selectDirectory(e){this.currentPath=e.path,this.currentProject=e.projectName,this.showDirectoryTree=!1},toggleDirectoryTree(){this.showDirectoryTree=!this.showDirectoryTree},toggleCollapse(e){e.hasChildren&&(this.collapsedFolders.has(e.path)?this.collapsedFolders.delete(e.path):this.collapsedFolders.add(e.path),this.$forceUpdate())},isCollapsed(e){return this.collapsedFolders.has(e)},isDirectoryVisible(e){if(0===e.level||e.isRoot)return!0;let t=e.parentPath;while(t&&"/"!==t){if(this.collapsedFolders.has(t))return!1;const e=this.directories.find(e=>e.path===t);t=e?e.parentPath:null}return!0},formatCurrentPath(e){if(e&&"/"!==e){const t=["Local","Lecture Notes"];for(let i of t)if(e.startsWith(i))return e}if(this.currentProject)return"/"===e?this.currentProject:e.startsWith(this.currentProject)?e:this.currentProject+e;if("/"===e&&this.ideInfo.currProj)return this.ideInfo.currProj.data?.label||this.ideInfo.currProj.config?.name;if(e.startsWith("/")&&this.ideInfo.currProj){const t=this.ideInfo.currProj.data?.label||this.ideInfo.currProj.config?.name;return e.includes(t)?e:t+e}return e},validateFolderName(){if(this.folderNameError="",!this.folderName)return;if(/[<>:"|?*\\\/]/.test(this.folderName))return void(this.folderNameError="Folder name contains invalid characters");const e=["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"],t=this.folderName.toUpperCase();e.includes(t)?this.folderNameError="This is a reserved folder name":this.folderName.startsWith(".")||this.folderName.endsWith(".")?this.folderNameError="Folder name cannot start or end with a dot":this.folderName.length>255&&(this.folderNameError="Folder name is too long")},getFullFolderPath(){const e=this.folderName||"new_folder",t="/"===this.currentPath?`/${e}`:`${this.currentPath}/${e}`;return this.formatCurrentPath(t)},async onCreate(){if(this.folderName&&!this.folderNameError){this.creating=!0;try{const e=this.folderName,t=this.currentPath,i=this.currentProject||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name;qe.log("[DialogNewFolder] Creating folder:",{folderName:e,parentPath:t,projectName:i}),await new Promise((o,s)=>{this.$store.dispatch(`ide/${Pe.p_}`,{projectName:i,parentPath:t,folderName:e,callback:n=>{if(qe.log("[DialogNewFolder] Create folder response:",n),0===n.code){Ce.nk.success(`Folder "${e}" created successfully`),this.$store.dispatch(`ide/${Pe.QQ}`,{projectName:i,callback:e=>{0===e.code&&(this.$store.commit("ide/handleProject",e.data),this.ideInfo.multiRootData&&this.$parent.loadAllDefaultProjects?.())}});const s="/"===t?`/${e}`:`${t}/${e}`;this.$emit("folder-created",{path:s,projectName:i}),this.$emit("update:modelValue",!1),o()}else{const e=n.message||n.msg||"Failed to create folder";Ce.nk.error(e),s(new Error(e))}}})})}catch(Sa){qe.error("[DialogNewFolder] Error creating folder:",Sa),Ce.nk.error("Failed to create folder: "+Sa.message)}finally{this.creating=!1}}},onCancel(){this.$emit("update:modelValue",!1)}},computed:{ideInfo(){return this.$store.state.ide.ideInfo},currentUser(){const e=localStorage.getItem("session_id"),t=localStorage.getItem("username"),i=localStorage.getItem("role"),o=localStorage.getItem("full_name");return e&&t?{session_id:e,username:t,role:i,full_name:o}:null},visibleDirectories(){return this.directories.filter(e=>this.isDirectoryVisible(e))}}};const Ye=(0,b.A)(Je,[["render",Qe],["__scopeId","data-v-7dd2b954"]]);var Ze=Ye;const et={class:"new-file-dialog"},tt={class:"dialog-header"},it={class:"dialog-body"},ot={class:"directory-section"},st={class:"directory-nav"},nt={key:0,class:"directory-tree"},at=["onClick"],lt={class:"filename-section"},rt={class:"filename-input-wrapper"},dt={key:0,class:"file-type-icon"},ct={key:0,class:"error-hint"},ht={key:1,class:"file-types-hint"},pt={key:0,class:"preview-section"},ut={class:"file-preview"},mt={class:"file-info"},ft={class:"file-path"},gt={class:"file-type"},vt={class:"dialog-footer"},yt=["disabled"];function wt(e,t,i,a,l,r){const d=(0,o.g2)("X"),c=(0,o.g2)("FolderOpen"),h=(0,o.g2)("ChevronDown"),p=(0,o.g2)("ChevronRight"),u=(0,o.g2)("Home"),m=(0,o.g2)("Folder"),f=(0,o.g2)("FileText");return(0,o.uX)(),(0,o.CE)("div",null,[t[10]||(t[10]=(0,o.Lk)("div",{class:"dialog-cover"},null,-1)),(0,o.Lk)("div",et,[(0,o.Lk)("div",tt,[t[6]||(t[6]=(0,o.Lk)("h3",null,"New File",-1)),(0,o.Lk)("div",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>r.onCancel&&r.onCancel(...e))},[(0,o.bF)(d,{size:20})])]),(0,o.Lk)("div",it,[(0,o.Lk)("div",ot,[t[7]||(t[7]=(0,o.Lk)("label",null,"Select Directory:",-1)),(0,o.Lk)("div",st,[(0,o.Lk)("div",{class:"current-path",onClick:t[1]||(t[1]=(...e)=>r.toggleDirectoryTree&&r.toggleDirectoryTree(...e))},[(0,o.bF)(c,{size:16}),(0,o.Lk)("span",null,(0,n.v_)(r.formatCurrentPath(l.currentPath)),1),l.showDirectoryTree?((0,o.uX)(),(0,o.Wv)(h,{key:0,size:16,class:"chevron"})):((0,o.uX)(),(0,o.Wv)(p,{key:1,size:16,class:"chevron"}))]),l.showDirectoryTree?((0,o.uX)(),(0,o.CE)("div",nt,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.directories,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.path,class:(0,n.C4)(["directory-item",{selected:l.currentPath===e.path,"root-item":e.isRoot}]),style:(0,n.Tr)({paddingLeft:20*e.level+12+"px"}),onClick:t=>r.selectDirectory(e)},[e.isRoot?((0,o.uX)(),(0,o.Wv)(u,{key:0,size:14})):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.bF)(p,{size:14}),(0,o.bF)(m,{size:14})],64)),(0,o.Lk)("span",null,(0,n.v_)(e.displayName||e.name),1)],14,at))),128))])):(0,o.Q3)("",!0)])]),(0,o.Lk)("div",lt,[t[8]||(t[8]=(0,o.Lk)("label",null,"File Name:",-1)),(0,o.Lk)("div",rt,[(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>l.fileName=e),onInput:t[3]||(t[3]=(...e)=>r.validateFileName&&r.validateFileName(...e)),placeholder:"Enter file name (e.g., script.py)",class:"filename-input",ref:"fileNameInput"},null,544),[[s.Jo,l.fileName]]),r.fileExtension?((0,o.uX)(),(0,o.CE)("div",dt,[(0,o.bF)(f,{size:20})])):(0,o.Q3)("",!0)]),l.fileNameError?((0,o.uX)(),(0,o.CE)("div",ct,(0,n.v_)(l.fileNameError),1)):((0,o.uX)(),(0,o.CE)("div",ht," Common extensions: .py, .txt, .csv, .json, .md, .html, .css, .js "))]),l.fileName&&!l.fileNameError?((0,o.uX)(),(0,o.CE)("div",pt,[t[9]||(t[9]=(0,o.Lk)("label",null,"File will be created at:",-1)),(0,o.Lk)("div",ut,[(0,o.Lk)("div",mt,[(0,o.bF)(f,{size:20}),(0,o.Lk)("div",null,[(0,o.Lk)("div",ft,(0,n.v_)(r.getFullFilePath()),1),(0,o.Lk)("div",gt,(0,n.v_)(r.getFileTypeDescription()),1)])])])])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",vt,[(0,o.Lk)("button",{class:"btn-cancel",onClick:t[4]||(t[4]=(...e)=>r.onCancel&&r.onCancel(...e))},"Cancel"),(0,o.Lk)("button",{class:"btn-create",onClick:t[5]||(t[5]=(...e)=>r.onCreate&&r.onCreate(...e)),disabled:!l.fileName||!!l.fileNameError&&!l.fileNameError.includes("already exists")||l.creating},(0,n.v_)(l.creating?"Creating...":"Create File"),9,yt)])])])}var kt=i(79992),bt=i(38880),It=i(96763),St={props:{modelValue:Boolean},data(){return{currentPath:"/",currentProject:null,directories:[],fileName:"",fileNameError:"",creating:!1,showDirectoryTree:!1}},computed:{ideInfo(){return this.$store.state.ide.ideInfo},currentUser(){const e=localStorage.getItem("session_id"),t=localStorage.getItem("username"),i=localStorage.getItem("role"),o=localStorage.getItem("full_name");return e&&t?{session_id:e,username:t,role:i,full_name:o}:null},fileExtension(){if(!this.fileName)return"";const e=this.fileName.lastIndexOf(".");return e>0?this.fileName.substring(e):""}},components:{X:y.A,FolderOpen:ye.A,Folder:we.A,ChevronRight:ke.A,ChevronDown:be.A,FileText:kt.A,Home:Se.A},mounted(){this.loadDirectoryStructure(),this.$nextTick(()=>{this.$refs.fileNameInput?.focus()})},methods:{isDirectoryVisibleToStudent(e){if(!this.currentUser||"student"!==this.currentUser.role)return!0;const t=`Local/${this.currentUser.username}`;return"/"===e||e.startsWith(t)},loadDirectoryStructure(){if(this.ideInfo.multiRootData&&this.ideInfo.multiRootData.children.length>0?(this.directories=[],this.ideInfo.multiRootData.children.forEach(e=>{const t=this.buildDirectoryTree(e,0,e.label);this.directories=this.directories.concat(t)})):this.ideInfo.currProj&&this.ideInfo.currProj.data&&(this.directories=this.buildDirectoryTree(this.ideInfo.currProj.data,0,this.ideInfo.currProj.data.label)),this.ideInfo.nodeSelected){if("dir"===this.ideInfo.nodeSelected.type||"folder"===this.ideInfo.nodeSelected.type)this.currentPath=this.ideInfo.nodeSelected.path,this.currentProject=this.ideInfo.nodeSelected.projectName||this.ideInfo.currProj?.data?.name;else if("file"===this.ideInfo.nodeSelected.type){const e=this.ideInfo.nodeSelected.path.substring(0,this.ideInfo.nodeSelected.path.lastIndexOf("/"))||"/";this.currentPath=e,this.currentProject=this.ideInfo.nodeSelected.projectName||this.ideInfo.currProj?.data?.name}}else this.currentProject=this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name;if(this.currentUser&&"student"===this.currentUser.role&&"/"===this.currentPath){const e=`Local/${this.currentUser.username}`,t=this.directories.find(t=>t.path===e);t&&(this.currentPath=e)}},buildDirectoryTree(e,t=0,i=null){let o=[];return 0===t&&o.push({name:i||e.label||"/",displayName:i||e.label||"/",path:e.path||"/",level:0,isRoot:!0,projectName:i||e.label,fullPath:i?`${i}${e.path}`:e.path}),e.children&&e.children.forEach(e=>{"dir"!==e.type&&"folder"!==e.type||this.isDirectoryVisibleToStudent(e.path)&&(o.push({name:e.label,displayName:e.label,path:e.path,level:t+1,isRoot:!1,projectName:i||e.projectName,fullPath:i?`${i}${e.path}`:e.path}),e.children&&(o=o.concat(this.buildDirectoryTree(e,t+1,i))))}),o},selectDirectory(e){this.currentPath=e.path,this.currentProject=e.projectName,this.showDirectoryTree=!1},toggleDirectoryTree(){this.showDirectoryTree=!this.showDirectoryTree},formatCurrentPath(e){if(e&&"/"!==e){const t=["Local","Lecture Notes"];for(let i of t)if(e.startsWith(i))return e}if(this.currentProject)return"/"===e?this.currentProject:e.startsWith(this.currentProject)?e:this.currentProject+e;if("/"===e&&this.ideInfo.currProj)return this.ideInfo.currProj.data?.label||this.ideInfo.currProj.config?.name;if(e.startsWith("/")&&this.ideInfo.currProj){const t=this.ideInfo.currProj.data?.label||this.ideInfo.currProj.config?.name;return e.includes(t)?e:t+e}return e},validateFileName(){if(this.fileNameError="",!this.fileName)return;if(/[<>:"|?*\\]/.test(this.fileName))return void(this.fileNameError="File name contains invalid characters");const e=["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"],t=this.fileName.split(".")[0].toUpperCase();if(e.includes(t))return void(this.fileNameError="This is a reserved file name");if(this.fileName.startsWith(".")||this.fileName.endsWith("."))return void(this.fileNameError="File name cannot start or end with a dot");const i=this.currentProject||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name,o=this.checkFileExists(this.fileName,this.currentPath,i);o?this.fileNameError="A file with this name already exists (keep a unique file name)":this.fileExtension||(this.fileNameError="Consider adding a file extension (e.g., .py, .txt)")},getFullFilePath(){const e=this.fileName||"new_file",t="/"===this.currentPath?`/${e}`:`${this.currentPath}/${e}`;return this.formatCurrentPath(t)},getFileTypeDescription(){const e=this.fileExtension.toLowerCase(),t={".py":"Python Script",".txt":"Text File",".csv":"CSV Data File",".json":"JSON Data File",".md":"Markdown Document",".html":"HTML Document",".css":"CSS Stylesheet",".js":"JavaScript File",".xml":"XML Document",".yaml":"YAML Configuration",".yml":"YAML Configuration",".ini":"Configuration File",".log":"Log File"};return t[e]||"File"},checkFileExists(e,t,i){const o=(e,t,i)=>{if(!e||!e.children)return null;if(e.path===t)return e.children.find(e=>"file"===e.type&&(e.label===i||e.name===i));for(let s of e.children){const e=o(s,t,i);if(e)return e}return null};if(this.ideInfo.multiRootData&&this.ideInfo.multiRootData.children.length>0){for(let s of this.ideInfo.multiRootData.children)if(s.name===i||s.label===i)return o(s,t,e)}else if(this.ideInfo.currProj&&this.ideInfo.currProj.data)return o(this.ideInfo.currProj.data,t,e);return null},async onCreate(){if(!this.fileName||this.fileNameError)return;const e=this.fileName,t=this.currentPath,i=this.currentProject||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name,o=this.checkFileExists(e,t,i);if(o)try{await bt.s.confirm(`A file named "${e}" already exists in this directory. Creating this file will replace the existing file.`,"File Already Exists",{confirmButtonText:"Replace File",cancelButtonText:"Cancel",type:"warning",confirmButtonClass:"el-button--danger"})}catch{return}this.creating=!0;try{It.log("[DialogNewFile] Creating file:",{fileName:e,parentPath:t,projectName:i,replaceExisting:!!o});let s="";const n=this.fileExtension.toLowerCase();".py"===n?s="":".json"===n&&(s="{}"),await new Promise((o,n)=>{this.$store.dispatch(`ide/${Pe.Zd}`,{projectName:i,parentPath:t,fileName:e,callback:a=>{if(It.log("[DialogNewFile] Create file response:",a),0===a.code){if(Ce.nk.success(`File "${e}" created successfully`),s){const n="/"===t?`/${e}`:`${t}/${e}`;this.$store.dispatch(`ide/${Pe._L}`,{projectName:i,filePath:n,fileData:s,callback:e=>{It.log("[DialogNewFile] Write file response:",e),o()}})}else o();this.$store.dispatch(`ide/${Pe.QQ}`,{projectName:i,callback:e=>{0===e.code&&(this.$store.commit("ide/handleProject",e.data),this.ideInfo.multiRootData&&this.$parent.loadAllDefaultProjects?.())}});const n="/"===t?`/${e}`:`${t}/${e}`;this.$emit("file-created",{path:n,projectName:i}),this.$emit("update:modelValue",!1)}else{const e=a.message||"Failed to create file";Ce.nk.error(e),n(new Error(e))}}})})}catch(Sa){It.error("[DialogNewFile] Error creating file:",Sa),Ce.nk.error("Failed to create file: "+Sa.message)}finally{this.creating=!1}},onCancel(){this.$emit("update:modelValue",!1)}}};const Pt=(0,b.A)(St,[["render",wt],["__scopeId","data-v-b4052db6"]]);var Ct=Pt,Lt=i(22542),Ft=i(7093),Et=i(22164),Rt=i(94411),xt=i(16309),Dt=i(42258),$t=i(60472),Tt=i(91030);const jt={key:0,class:"fullscreen-preview"},Nt={class:"preview-header"},Mt={class:"preview-header-left"},_t={class:"preview-title"},At={class:"preview-header-right"},Wt={class:"preview-content"},Ot={key:2,class:"unsupported-preview"};function Ut(e,t,i,s,a,l){const r=xt.A,d=Dt.A;return l.isActive?((0,o.uX)(),(0,o.CE)("div",jt,[(0,o.Lk)("div",Nt,[(0,o.Lk)("div",Mt,[(0,o.Lk)("span",_t,(0,n.v_)(l.fileName),1)]),(0,o.Lk)("div",At,[(0,o.Lk)("button",{class:"preview-action-btn",onClick:t[0]||(t[0]=(...e)=>l.openInRightPanel&&l.openInRightPanel(...e)),title:"Open in Right Panel"},t[2]||(t[2]=[(0,o.Lk)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,o.Lk)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),(0,o.Lk)("path",{d:"M15 3v18"})],-1)])),(0,o.Lk)("button",{class:"preview-close-btn",onClick:t[1]||(t[1]=(...e)=>l.close&&l.close(...e)),title:"Close Preview"},t[3]||(t[3]=[(0,o.Lk)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,o.Lk)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,o.Lk)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)]))])]),(0,o.Lk)("div",Wt,[l.isCsvFile?((0,o.uX)(),(0,o.Wv)(r,{key:0,content:l.content},null,8,["content"])):l.isMediaFile?((0,o.uX)(),(0,o.Wv)(d,{key:1,codeItem:l.mediaCodeItem,codeItemIndex:0},null,8,["codeItem"])):((0,o.uX)(),(0,o.CE)("div",Ot,t[4]||(t[4]=[(0,o.Lk)("p",null,"Preview not supported for this file type",-1)])))])])):(0,o.Q3)("",!0)}var zt={name:"FullscreenPreview",components:{CsvViewer:xt.A,MediaViewer:Dt.A},computed:{ideInfo(){return this.$store.state.ide.ideInfo},isActive(){return this.ideInfo.fullscreenPreview.active},file(){return this.ideInfo.fullscreenPreview.file},content(){return this.ideInfo.fullscreenPreview.content},fileName(){return this.file?.name||""},filePath(){return this.file?.path||""},isCsvFile(){return this.filePath.toLowerCase().endsWith(".csv")},isMediaFile(){const e=[".png",".jpg",".jpeg",".gif",".bmp",".svg",".webp",".pdf"],t=this.filePath.toLowerCase();return e.some(e=>t.endsWith(e))},mediaCodeItem(){return this.file?{name:this.file.name,path:this.file.path,projectName:this.file.projectName,content:this.content,preloaded:!0}:null}},methods:{close(){this.$store.commit("ide/closeFullscreenPreview")},openInRightPanel(){this.$store.commit("ide/closeFullscreenPreview"),this.file&&this.$emit("open-in-right-panel",this.file.path)}},mounted(){this.handleEsc=e=>{"Escape"===e.key&&this.isActive&&this.close()},document.addEventListener("keydown",this.handleEsc)},beforeUnmount(){document.removeEventListener("keydown",this.handleEsc)}};const Vt=(0,b.A)(zt,[["render",Ut],["__scopeId","data-v-3c263865"]]);var Bt=Vt,Xt=i(46664);const Ht={class:"modal-header"},Kt={class:"modal-body"},Gt={class:"input-group"},Qt={key:0,class:"input-group"},qt={class:"options-group"},Jt={class:"checkbox-label"},Yt={class:"checkbox-label"},Zt={class:"checkbox-label"},ei={key:1,class:"search-info"},ti={class:"modal-footer"},ii={class:"button-group"},oi=["disabled"],si=["disabled"],ni=["disabled"],ai=["disabled"];function li(e,t,i,a,l,r){const d=(0,o.g2)("X"),c=(0,o.g2)("ChevronUp"),h=(0,o.g2)("ChevronDown");return(0,o.uX)(),(0,o.Wv)(s.eB,{name:"modal-fade"},{default:(0,o.k6)(()=>[i.modelValue?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"find-replace-overlay",onClick:t[16]||(t[16]=(0,s.D$)((...e)=>r.close&&r.close(...e),["self"]))},[(0,o.Lk)("div",{class:"find-replace-modal",onClick:t[15]||(t[15]=(0,s.D$)(()=>{},["stop"]))},[(0,o.Lk)("div",Ht,[(0,o.Lk)("h3",null,(0,n.v_)(r.isReplaceMode?"Find and Replace":"Find"),1),(0,o.Lk)("button",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>r.close&&r.close(...e)),title:"Close (Esc)"},[(0,o.bF)(d,{size:18})])]),(0,o.Lk)("div",Kt,[(0,o.Lk)("div",Gt,[t[17]||(t[17]=(0,o.Lk)("label",null,"Find:",-1)),(0,o.bo)((0,o.Lk)("input",{ref:"findInput","onUpdate:modelValue":t[1]||(t[1]=e=>l.findText=e),type:"text",class:"modal-input",placeholder:"Enter text to find...",onKeydown:[t[2]||(t[2]=(0,s.jR)((...e)=>r.findNext&&r.findNext(...e),["enter"])),t[3]||(t[3]=(0,s.jR)((...e)=>r.close&&r.close(...e),["escape"]))]},null,544),[[s.Jo,l.findText]])]),r.isReplaceMode?((0,o.uX)(),(0,o.CE)("div",Qt,[t[18]||(t[18]=(0,o.Lk)("label",null,"Replace with:",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>l.replaceText=e),type:"text",class:"modal-input",placeholder:"Enter replacement text...",onKeydown:[t[5]||(t[5]=(0,s.jR)((...e)=>r.replace&&r.replace(...e),["enter"])),t[6]||(t[6]=(0,s.jR)((...e)=>r.close&&r.close(...e),["escape"]))]},null,544),[[s.Jo,l.replaceText]])])):(0,o.Q3)("",!0),(0,o.Lk)("div",qt,[(0,o.Lk)("label",Jt,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=e=>l.caseSensitive=e)},null,512),[[s.lH,l.caseSensitive]]),t[19]||(t[19]=(0,o.Lk)("span",null,"Case sensitive",-1))]),(0,o.Lk)("label",Yt,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=e=>l.wholeWord=e)},null,512),[[s.lH,l.wholeWord]]),t[20]||(t[20]=(0,o.Lk)("span",null,"Whole word",-1))]),(0,o.Lk)("label",Zt,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=e=>l.useRegex=e)},null,512),[[s.lH,l.useRegex]]),t[21]||(t[21]=(0,o.Lk)("span",null,"Regular expression",-1))])]),l.searchInfo?((0,o.uX)(),(0,o.CE)("div",ei,(0,n.v_)(l.searchInfo),1)):(0,o.Q3)("",!0)]),(0,o.Lk)("div",ti,[(0,o.Lk)("div",ii,[(0,o.Lk)("button",{class:"action-btn",onClick:t[10]||(t[10]=(...e)=>r.findPrevious&&r.findPrevious(...e)),disabled:!l.findText},[(0,o.bF)(c,{size:16}),t[22]||(t[22]=(0,o.eW)(" Find Previous ",-1))],8,oi),(0,o.Lk)("button",{class:"action-btn primary",onClick:t[11]||(t[11]=(...e)=>r.findNext&&r.findNext(...e)),disabled:!l.findText},[(0,o.bF)(h,{size:16}),t[23]||(t[23]=(0,o.eW)(" Find Next ",-1))],8,si),r.isReplaceMode?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.Lk)("button",{class:"action-btn",onClick:t[12]||(t[12]=(...e)=>r.replace&&r.replace(...e)),disabled:!l.findText}," Replace ",8,ni),(0,o.Lk)("button",{class:"action-btn",onClick:t[13]||(t[13]=(...e)=>r.replaceAll&&r.replaceAll(...e)),disabled:!l.findText}," Replace All ",8,ai)],64)):(0,o.Q3)("",!0),(0,o.Lk)("button",{class:"action-btn",onClick:t[14]||(t[14]=(...e)=>r.close&&r.close(...e))}," Close ")])])])])):(0,o.Q3)("",!0)]),_:1})}var ri=i(53957);
/**
 * @license lucide-vue-next v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const di=(0,ri.A)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);var ci={name:"FindReplaceModal",components:{X:y.A,ChevronUp:di,ChevronDown:be.A},props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"find",validator:e=>["find","replace"].includes(e)}},data(){return{findText:"",replaceText:"",caseSensitive:!1,wholeWord:!1,useRegex:!1,searchInfo:"",currentMatch:0,totalMatches:0,searchCursor:null}},computed:{isReplaceMode(){return"replace"===this.mode},activeEditor(){const e=document.querySelector(".editor-content .code-editor-flex .CodeMirror");return e&&e.CodeMirror?e.CodeMirror:null}},watch:{modelValue(e){e?this.$nextTick(()=>{this.$refs.findInput?.focus(),this.initializeSearch()}):this.clearSearch()},findText(){this.findText?this.updateSearchInfo():(this.searchInfo="",this.clearSearch())}},methods:{initializeSearch(){if(this.activeEditor){const e=this.activeEditor.getSelection();e&&(this.findText=e)}},clearSearch(){this.activeEditor&&this.activeEditor.operation(()=>{const e=this.activeEditor.getAllMarks();e.forEach(e=>{"CodeMirror-search-match"===e.className&&e.clear()})}),this.searchCursor=null,this.currentMatch=0,this.totalMatches=0,this.searchInfo=""},getSearchQuery(){let e=this.findText;this.useRegex||(e=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")),this.wholeWord&&(e="\\b"+e+"\\b");try{return new RegExp(e,this.caseSensitive?"g":"gi")}catch(t){return this.findText}},findNext(){if(!this.findText||!this.activeEditor)return;const e=this.getSearchQuery(),t=this.activeEditor.getSearchCursor(e,this.activeEditor.getCursor(),!this.caseSensitive);if(t.findNext())this.activeEditor.setSelection(t.from(),t.to()),this.activeEditor.scrollIntoView(t.from(),50),this.highlightMatch(t);else{const t=this.activeEditor.getSearchCursor(e,{line:0,ch:0},!this.caseSensitive);t.findNext()?(this.activeEditor.setSelection(t.from(),t.to()),this.activeEditor.scrollIntoView(t.from(),50),this.highlightMatch(t),this.searchInfo="Wrapped to beginning"):this.searchInfo="No matches found"}this.updateSearchInfo()},findPrevious(){if(!this.findText||!this.activeEditor)return;const e=this.getSearchQuery(),t=this.activeEditor.getSearchCursor(e,this.activeEditor.getCursor("from"),!this.caseSensitive);if(t.findPrevious())this.activeEditor.setSelection(t.from(),t.to()),this.activeEditor.scrollIntoView(t.from(),50),this.highlightMatch(t);else{const t=this.activeEditor.lastLine(),i=this.activeEditor.getLine(t).length,o=this.activeEditor.getSearchCursor(e,{line:t,ch:i},!this.caseSensitive);o.findPrevious()?(this.activeEditor.setSelection(o.from(),o.to()),this.activeEditor.scrollIntoView(o.from(),50),this.highlightMatch(o),this.searchInfo="Wrapped to end"):this.searchInfo="No matches found"}this.updateSearchInfo()},replace(){if(!this.findText||!this.activeEditor)return;const e=this.activeEditor.getSelection(),t=this.getSearchQuery();e&&("string"===typeof t&&e===t||t instanceof RegExp&&t.test(e))?(this.activeEditor.replaceSelection(this.replaceText),this.findNext()):this.findNext()},replaceAll(){if(!this.findText||!this.activeEditor)return;const e=this.getSearchQuery(),t=this.activeEditor.getSearchCursor(e,{line:0,ch:0},!this.caseSensitive);let i=0;this.activeEditor.operation(()=>{while(t.findNext())t.replace(this.replaceText),i++}),this.searchInfo=`Replaced ${i} occurrence${1!==i?"s":""}`},highlightMatch(e){},updateSearchInfo(){if(!this.findText||!this.activeEditor)return void(this.searchInfo="");const e=this.getSearchQuery(),t=this.activeEditor.getSearchCursor(e,{line:0,ch:0},!this.caseSensitive);let i=0;while(t.findNext())i++;this.searchInfo=0===i?"No matches found":1===i?"1 match found":`${i} matches found`},close(){this.clearSearch(),this.$emit("update:modelValue",!1)},handleKeydown(e){"Escape"===e.key?this.close():("F3"===e.key||e.ctrlKey&&"g"===e.key)&&(e.preventDefault(),e.shiftKey?this.findPrevious():this.findNext())}},mounted(){document.addEventListener("keydown",this.handleKeydown)},beforeUnmount(){document.removeEventListener("keydown",this.handleKeydown),this.clearSearch()}};const hi=(0,b.A)(ci,[["render",li],["__scopeId","data-v-28db288f"]]);var pi=hi;const ui={class:"modal-container"},mi={class:"modal-header"};function fi(e,t,i,n,a,l){const r=(0,o.g2)("X");return(0,o.uX)(),(0,o.Wv)(s.eB,{name:"modal-fade"},{default:(0,o.k6)(()=>[i.modelValue?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"modal-overlay",onClick:t[1]||(t[1]=(0,s.D$)((...e)=>l.close&&l.close(...e),["self"]))},[(0,o.Lk)("div",ui,[(0,o.Lk)("div",mi,[t[2]||(t[2]=(0,o.Lk)("h2",null,"Keyboard Shortcuts (Universal for Mac/Windows/Linux)",-1)),(0,o.Lk)("button",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>l.close&&l.close(...e))},[(0,o.bF)(r,{size:20})])]),t[3]||(t[3]=(0,o.Lk)("div",{class:"modal-body"},[(0,o.Lk)("div",{class:"shortcut-section"},[(0,o.Lk)("h3",null,"File Operations"),(0,o.Lk)("div",{class:"shortcut-list"},[(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"New File"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+Alt+N")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Open File"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+O")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Save"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+S")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Save As"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+Shift+S")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Move"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+Shift+M")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Download"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+D")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Delete File"),(0,o.Lk)("span",{class:"shortcut-keys"},"Delete")])])]),(0,o.Lk)("div",{class:"shortcut-section"},[(0,o.Lk)("h3",null,"Edit Operations"),(0,o.Lk)("div",{class:"shortcut-list"},[(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Undo"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+Z")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Redo"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+Y")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Cut"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+X")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Copy"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+C")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Paste"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+V")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Find"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+F")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Replace"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+H")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Select All"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+A")])])]),(0,o.Lk)("div",{class:"shortcut-section"},[(0,o.Lk)("h3",null,"Run Operations"),(0,o.Lk)("div",{class:"shortcut-list"},[(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Run Script"),(0,o.Lk)("span",{class:"shortcut-keys"},"F5")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Stop Script"),(0,o.Lk)("span",{class:"shortcut-keys"},"Shift+F5")])])]),(0,o.Lk)("div",{class:"shortcut-section"},[(0,o.Lk)("h3",null,"View Operations"),(0,o.Lk)("div",{class:"shortcut-list"},[(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Toggle Console"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+`")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Toggle Preview Panel"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+Shift+P")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Toggle Sidebar"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+B")])])]),(0,o.Lk)("div",{class:"shortcut-section"},[(0,o.Lk)("h3",null,"General"),(0,o.Lk)("div",{class:"shortcut-list"},[(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Show Keyboard Shortcuts"),(0,o.Lk)("span",{class:"shortcut-keys"},"F1")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Settings"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+,")])])])],-1))])])):(0,o.Q3)("",!0)]),_:1})}var gi={name:"KeyboardShortcutsModal",props:{modelValue:{type:Boolean,default:!1}},components:{X:y.A},methods:{close(){this.$emit("update:modelValue",!1)}},mounted(){this.handleEsc=e=>{"Escape"===e.key&&this.modelValue&&this.close()},document.addEventListener("keydown",this.handleEsc)},beforeUnmount(){document.removeEventListener("keydown",this.handleEsc)}};const vi=(0,b.A)(gi,[["render",fi],["__scopeId","data-v-0c22faa3"]]);var yi=vi,wi=i(3549);const ki={class:"profile-modal"},bi={class:"dialog-header"},Ii={class:"dialog-body"},Si={class:"tab-navigation"},Pi=["onClick"],Ci={class:"tab-content"},Li={key:0,class:"profile-section"},Fi={class:"user-info"},Ei={class:"info-row"},Ri={class:"info-row"},xi={class:"info-row"},Di={class:"info-row"},$i={class:"session-id"},Ti={class:"dialog-footer"};function ji(e,t,i,a,l,r){const d=(0,o.g2)("X"),c=(0,o.g2)("LogOut");return r.visible?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"profile-modal-overlay",onClick:t[3]||(t[3]=(0,s.D$)((...e)=>r.handleClose&&r.handleClose(...e),["self"]))},[(0,o.Lk)("div",ki,[(0,o.Lk)("div",bi,[(0,o.Lk)("h3",null,(0,n.v_)(i.currentUser?`${i.currentUser.full_name||i.currentUser.username}`:"User Profile"),1),(0,o.Lk)("div",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>r.handleClose&&r.handleClose(...e))},[(0,o.bF)(d,{size:20})])]),(0,o.Lk)("div",Ii,[(0,o.Lk)("div",Si,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.tabs,e=>((0,o.uX)(),(0,o.CE)("button",{key:e.id,onClick:t=>l.activeTab=e.id,class:(0,n.C4)(["tab-btn",{active:l.activeTab===e.id}])},[((0,o.uX)(),(0,o.Wv)((0,o.$y)(e.icon),{size:16})),(0,o.eW)(" "+(0,n.v_)(e.label),1)],10,Pi))),128))]),(0,o.Lk)("div",Ci,["profile"===l.activeTab?((0,o.uX)(),(0,o.CE)("div",Li,[(0,o.Lk)("div",Fi,[(0,o.Lk)("div",Ei,[t[4]||(t[4]=(0,o.Lk)("label",null,"Username:",-1)),(0,o.Lk)("span",null,(0,n.v_)(i.currentUser?.username),1)]),(0,o.Lk)("div",Ri,[t[5]||(t[5]=(0,o.Lk)("label",null,"Full Name:",-1)),(0,o.Lk)("span",null,(0,n.v_)(i.currentUser?.full_name||"Not set"),1)]),(0,o.Lk)("div",xi,[t[6]||(t[6]=(0,o.Lk)("label",null,"Role:",-1)),(0,o.Lk)("span",{class:(0,n.C4)(["role-badge",i.currentUser?.role])},(0,n.v_)("professor"===i.currentUser?.role?"Professor":"Student"),3)]),(0,o.Lk)("div",Di,[t[7]||(t[7]=(0,o.Lk)("label",null,"Session:",-1)),(0,o.Lk)("span",$i,(0,n.v_)(l.sessionId?.substring(0,20))+"...",1)])])])):(0,o.Q3)("",!0)])]),(0,o.Lk)("div",Ti,["profile"===l.activeTab?((0,o.uX)(),(0,o.CE)("button",{key:0,class:"btn-danger",onClick:t[1]||(t[1]=(...e)=>r.handleLogout&&r.handleLogout(...e))},[(0,o.bF)(c,{size:16}),t[8]||(t[8]=(0,o.eW)(" Logout ",-1))])):(0,o.Q3)("",!0),(0,o.Lk)("button",{class:"btn-secondary",onClick:t[2]||(t[2]=(...e)=>r.handleClose&&r.handleClose(...e))},"Close")])])])):(0,o.Q3)("",!0)}
/**
 * @license lucide-vue-next v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const Ni=(0,ri.A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Mi=(0,ri.A)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),_i=(0,ri.A)("circle-question-mark",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Ai=(0,ri.A)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]),Wi=(0,ri.A)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]),Oi=(0,ri.A)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]);var Ui=i(96763),zi={name:"UserProfileModal",props:{modelValue:{type:Boolean,default:!1},currentUser:{type:Object,default:null}},emits:["update:modelValue","logout","password-changed"],components:{User:Ni,Lock:Mi,HelpCircle:_i,LogOut:Ai,Mail:Wi,MessageSquare:Oi,X:y.A},data(){return{activeTab:"profile",loading:!1,passwordVerified:!1,sessionId:localStorage.getItem("session_id"),tabs:[{id:"profile",label:"Profile",icon:"User"}],passwordForm:{currentPassword:"",newPassword:"",confirmPassword:""},forgotForm:{currentPassword:"",newPassword:"",confirmPassword:""}}},computed:{visible:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},methods:{handleClose(){this.visible=!1,this.resetAllForms()},async handleLogout(){try{const e=await fetch("/api/logout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:this.sessionId})}),t=await e.json();t.success?(localStorage.removeItem("session_id"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("full_name"),Ce.nk.success("Logged out successfully"),this.handleClose(),this.$emit("logout"),setTimeout(()=>{window.location.reload()},1e3)):Ce.nk.error("Logout failed. Please try again.")}catch(Sa){Ui.error("Logout error:",Sa),Ce.nk.error("Network error during logout")}},async changePassword(){if(this.passwordForm.currentPassword)if(!this.passwordForm.newPassword||this.passwordForm.newPassword.length<6)Ce.nk.warning("New password must be at least 6 characters");else if(this.passwordForm.newPassword===this.passwordForm.confirmPassword){this.loading=!0;try{const e=await fetch("/api/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:this.sessionId,old_password:this.passwordForm.currentPassword,new_password:this.passwordForm.newPassword})}),t=await e.json();t.success?(Ce.nk.success("Password changed successfully!"),this.$emit("password-changed"),this.resetPasswordForm(),this.activeTab="profile"):Ce.nk.error(t.error||"Failed to change password")}catch(Sa){Ce.nk.error("Network error. Please try again.")}finally{this.loading=!1}}else Ce.nk.warning("Passwords do not match");else Ce.nk.warning("Please enter your current password")},async verifyCurrentPassword(){if(this.forgotForm.currentPassword){this.loading=!0;try{const e=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.currentUser.username,password:this.forgotForm.currentPassword})}),t=await e.json();t.success?(this.passwordVerified=!0,Ce.nk.success("Password verified! Now enter your new password.")):Ce.nk.error("Incorrect password. Please try again.")}catch(Sa){Ce.nk.error("Network error. Please try again.")}finally{this.loading=!1}}else Ce.nk.warning("Please enter your current password")},async resetPasswordWithVerification(){if(this.passwordVerified)if(!this.forgotForm.newPassword||this.forgotForm.newPassword.length<6)Ce.nk.warning("New password must be at least 6 characters");else if(this.forgotForm.newPassword===this.forgotForm.confirmPassword){this.loading=!0;try{const e=await fetch("/api/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:this.sessionId,old_password:this.forgotForm.currentPassword,new_password:this.forgotForm.newPassword})}),t=await e.json();t.success?(Ce.nk.success("Password reset successfully!"),this.$emit("password-changed"),this.resetForgotForm(),this.activeTab="profile"):Ce.nk.error(t.error||"Failed to reset password")}catch(Sa){Ce.nk.error("Network error. Please try again.")}finally{this.loading=!1}}else Ce.nk.warning("Passwords do not match");else Ce.nk.warning("Please verify your current password first")},resetPasswordForm(){this.passwordForm={currentPassword:"",newPassword:"",confirmPassword:""}},resetForgotForm(){this.forgotForm={currentPassword:"",newPassword:"",confirmPassword:""},this.passwordVerified=!1},resetAllForms(){this.resetPasswordForm(),this.resetForgotForm(),this.activeTab="profile"}}};const Vi=(0,b.A)(zi,[["render",ji],["__scopeId","data-v-056021ea"]]);var Bi=Vi;const Xi={class:"two-header-container"},Hi={class:"header-first"},Ki={class:"nav-menu"},Gi={class:"nav__items-left"},Qi={class:"nav__item"},qi=["aria-expanded"],Ji={class:"nav__dropdown-item"},Yi={class:"nav__dropdown-item"},Zi={class:"nav__dropdown-item"},eo=["disabled"],to={class:"nav__dropdown-item"},io={class:"nav__dropdown-item"},oo=["disabled"],so={class:"nav__dropdown-item"},no=["disabled"],ao={class:"nav__dropdown-item"},lo={class:"nav__item"},ro=["aria-expanded"],co={class:"nav__dropdown-item"},ho={class:"nav__dropdown-item"},po={class:"nav__dropdown-item"},uo={class:"nav__dropdown-item"},mo={class:"nav__dropdown-item"},fo={class:"nav__dropdown-item"},go={class:"nav__dropdown-item"},vo={class:"nav__dropdown-item"},yo={class:"nav__item"},wo=["aria-expanded"],ko={class:"nav__dropdown-item"},bo={class:"nav__dropdown-item"},Io={class:"nav__dropdown-item"},So={class:"nav__item"},Po=["aria-expanded"],Co={class:"nav__dropdown-item"},Lo={class:"nav__dropdown-item"},Fo={class:"nav__dropdown-item"},Eo={class:"nav__item"},Ro=["aria-expanded"],xo={class:"nav__dropdown-item"},Do={class:"header-right-section"},$o={class:"header-second"},To={class:"header-second-center-container"},jo={class:"header-second-right"};function No(e,t,i,a,l,r){const d=(0,o.g2)("UserCircle"),c=(0,o.g2)("Play"),h=(0,o.g2)("Square"),p=(0,o.g2)("Save"),u=(0,o.g2)("Settings"),m=Bi;return(0,o.uX)(),(0,o.CE)("div",Xi,[(0,o.Lk)("div",Hi,[(0,o.Lk)("nav",Ki,[(0,o.Lk)("ul",Gi,[(0,o.Lk)("li",Qi,[(0,o.Lk)("button",{class:"nav__item-button",onClick:t[0]||(t[0]=(0,s.D$)(e=>r.toggleDropdown("file"),["stop"])),"aria-haspopup":"menu","aria-expanded":"file"===l.activeDropdown},t[39]||(t[39]=[(0,o.Lk)("span",{class:"nav__item-header"},"File",-1),(0,o.Lk)("svg",{class:"nav__item-triangle",width:"9",height:"6",viewBox:"0 0 9 6",xmlns:"http://www.w3.org/2000/svg"},[(0,o.Lk)("polygon",{points:"4.5 6 9 0 0 0",fill:"currentColor"})],-1)]),8,qi),(0,o.bo)((0,o.Lk)("ul",{class:"nav__dropdown",onClick:t[8]||(t[8]=(0,s.D$)(()=>{},["stop"]))},[(0,o.Lk)("li",Ji,[(0,o.Lk)("button",{onClick:t[1]||(t[1]=e=>r.newFile())},t[40]||(t[40]=[(0,o.Lk)("span",null,"New File",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+Alt+N",-1)]))]),(0,o.Lk)("li",Yi,[(0,o.Lk)("button",{onClick:t[2]||(t[2]=e=>r.openFile())},t[41]||(t[41]=[(0,o.Lk)("span",null,"Open File",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+O",-1)]))]),(0,o.Lk)("li",Zi,[(0,o.Lk)("button",{onClick:t[3]||(t[3]=e=>r.duplicateFile()),disabled:!r.hasSelectedFile},t[42]||(t[42]=[(0,o.Lk)("span",null,"Duplicate (Make a copy)",-1)]),8,eo)]),(0,o.Lk)("li",to,[(0,o.Lk)("button",{onClick:t[4]||(t[4]=e=>r.saveFile())},t[43]||(t[43]=[(0,o.Lk)("span",null,"Save",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+S",-1)]))]),(0,o.Lk)("li",io,[(0,o.Lk)("button",{onClick:t[5]||(t[5]=e=>r.saveAsFile()),disabled:!r.canSaveAsFile},t[44]||(t[44]=[(0,o.Lk)("span",null,"Save As",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+Shift+S",-1)]),8,oo)]),(0,o.Lk)("li",so,[(0,o.Lk)("button",{onClick:t[6]||(t[6]=e=>r.moveFile()),disabled:!r.hasSelectedFile},t[45]||(t[45]=[(0,o.Lk)("span",null,"Move",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+Shift+M",-1)]),8,no)]),(0,o.Lk)("li",ao,[(0,o.Lk)("button",{onClick:t[7]||(t[7]=e=>r.downloadFile())},t[46]||(t[46]=[(0,o.Lk)("span",null,"Download",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+D",-1)]))])],512),[[s.aG,"file"===l.activeDropdown]])]),(0,o.Lk)("li",lo,[(0,o.Lk)("button",{class:"nav__item-button",onClick:t[9]||(t[9]=(0,s.D$)(e=>r.toggleDropdown("edit"),["stop"])),"aria-haspopup":"menu","aria-expanded":"edit"===l.activeDropdown},t[47]||(t[47]=[(0,o.Lk)("span",{class:"nav__item-header"},"Edit",-1),(0,o.Lk)("svg",{class:"nav__item-triangle",width:"9",height:"6",viewBox:"0 0 9 6",xmlns:"http://www.w3.org/2000/svg"},[(0,o.Lk)("polygon",{points:"4.5 6 9 0 0 0",fill:"currentColor"})],-1)]),8,ro),(0,o.bo)((0,o.Lk)("ul",{class:"nav__dropdown",onClick:t[18]||(t[18]=(0,s.D$)(()=>{},["stop"]))},[(0,o.Lk)("li",co,[(0,o.Lk)("button",{onClick:t[10]||(t[10]=e=>r.undo())},t[48]||(t[48]=[(0,o.Lk)("span",null,"Undo",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+Z",-1)]))]),(0,o.Lk)("li",ho,[(0,o.Lk)("button",{onClick:t[11]||(t[11]=e=>r.redo())},t[49]||(t[49]=[(0,o.Lk)("span",null,"Redo",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+Y",-1)]))]),t[56]||(t[56]=(0,o.Lk)("li",{class:"nav__dropdown-divider"},null,-1)),(0,o.Lk)("li",po,[(0,o.Lk)("button",{onClick:t[12]||(t[12]=e=>r.cut())},t[50]||(t[50]=[(0,o.Lk)("span",null,"Cut",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+X",-1)]))]),(0,o.Lk)("li",uo,[(0,o.Lk)("button",{onClick:t[13]||(t[13]=e=>r.copy())},t[51]||(t[51]=[(0,o.Lk)("span",null,"Copy",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+C",-1)]))]),(0,o.Lk)("li",mo,[(0,o.Lk)("button",{onClick:t[14]||(t[14]=e=>r.paste())},t[52]||(t[52]=[(0,o.Lk)("span",null,"Paste",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+V",-1)]))]),t[57]||(t[57]=(0,o.Lk)("li",{class:"nav__dropdown-divider"},null,-1)),(0,o.Lk)("li",fo,[(0,o.Lk)("button",{onClick:t[15]||(t[15]=e=>r.find())},t[53]||(t[53]=[(0,o.Lk)("span",null,"Find",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+F",-1)]))]),(0,o.Lk)("li",go,[(0,o.Lk)("button",{onClick:t[16]||(t[16]=e=>r.replace())},t[54]||(t[54]=[(0,o.Lk)("span",null,"Replace",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+H",-1)]))]),t[58]||(t[58]=(0,o.Lk)("li",{class:"nav__dropdown-divider"},null,-1)),(0,o.Lk)("li",vo,[(0,o.Lk)("button",{onClick:t[17]||(t[17]=e=>r.comment())},t[55]||(t[55]=[(0,o.Lk)("span",null,"Comment",-1)]))])],512),[[s.aG,"edit"===l.activeDropdown]])]),(0,o.Lk)("li",yo,[(0,o.Lk)("button",{class:"nav__item-button",onClick:t[19]||(t[19]=(0,s.D$)(e=>r.toggleDropdown("run"),["stop"])),"aria-haspopup":"menu","aria-expanded":"run"===l.activeDropdown},t[59]||(t[59]=[(0,o.Lk)("span",{class:"nav__item-header"},"Run",-1),(0,o.Lk)("svg",{class:"nav__item-triangle",width:"9",height:"6",viewBox:"0 0 9 6",xmlns:"http://www.w3.org/2000/svg"},[(0,o.Lk)("polygon",{points:"4.5 6 9 0 0 0",fill:"currentColor"})],-1)]),8,wo),(0,o.bo)((0,o.Lk)("ul",{class:"nav__dropdown",onClick:t[23]||(t[23]=(0,s.D$)(()=>{},["stop"]))},[(0,o.Lk)("li",ko,[(0,o.Lk)("button",{onClick:t[20]||(t[20]=e=>r.runScript())},t[60]||(t[60]=[(0,o.Lk)("span",null,"Run Script",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"F5",-1)]))]),(0,o.Lk)("li",bo,[(0,o.Lk)("button",{onClick:t[21]||(t[21]=e=>r.stopScript())},t[61]||(t[61]=[(0,o.Lk)("span",null,"Stop",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Shift+F5",-1)]))]),(0,o.Lk)("li",Io,[(0,o.Lk)("button",{onClick:t[22]||(t[22]=e=>r.clearConsole())},t[62]||(t[62]=[(0,o.Lk)("span",null,"Clear Console",-1)]))])],512),[[s.aG,"run"===l.activeDropdown]])]),(0,o.Lk)("li",So,[(0,o.Lk)("button",{class:"nav__item-button",onClick:t[24]||(t[24]=(0,s.D$)(e=>r.toggleDropdown("view"),["stop"])),"aria-haspopup":"menu","aria-expanded":"view"===l.activeDropdown},t[63]||(t[63]=[(0,o.Lk)("span",{class:"nav__item-header"},"View",-1),(0,o.Lk)("svg",{class:"nav__item-triangle",width:"9",height:"6",viewBox:"0 0 9 6",xmlns:"http://www.w3.org/2000/svg"},[(0,o.Lk)("polygon",{points:"4.5 6 9 0 0 0",fill:"currentColor"})],-1)]),8,Po),(0,o.bo)((0,o.Lk)("ul",{class:"nav__dropdown",onClick:t[28]||(t[28]=(0,s.D$)(()=>{},["stop"]))},[(0,o.Lk)("li",Co,[(0,o.Lk)("button",{onClick:t[25]||(t[25]=e=>r.toggleConsole())},[(0,o.Lk)("span",null,(0,n.v_)(l.consoleVisible?"Hide REPL":"Show REPL"),1),t[64]||(t[64]=(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+`",-1))])]),(0,o.Lk)("li",Lo,[(0,o.Lk)("button",{onClick:t[26]||(t[26]=e=>r.togglePreviewPanel())},[(0,o.Lk)("span",null,(0,n.v_)(l.previewPanelVisible?"Hide Right Panel":"Show Right Panel"),1),t[65]||(t[65]=(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+Shift+P",-1))])]),(0,o.Lk)("li",Fo,[(0,o.Lk)("button",{onClick:t[27]||(t[27]=e=>r.toggleSidebar())},[(0,o.Lk)("span",null,(0,n.v_)(l.sidebarVisible?"Hide Sidebar":"Show Sidebar"),1),t[66]||(t[66]=(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+B",-1))])])],512),[[s.aG,"view"===l.activeDropdown]])]),(0,o.Lk)("li",Eo,[(0,o.Lk)("button",{class:"nav__item-button",onClick:t[29]||(t[29]=(0,s.D$)(e=>r.toggleDropdown("help"),["stop"])),"aria-haspopup":"menu","aria-expanded":"help"===l.activeDropdown},t[67]||(t[67]=[(0,o.Lk)("span",{class:"nav__item-header"},"Help",-1),(0,o.Lk)("svg",{class:"nav__item-triangle",width:"9",height:"6",viewBox:"0 0 9 6",xmlns:"http://www.w3.org/2000/svg"},[(0,o.Lk)("polygon",{points:"4.5 6 9 0 0 0",fill:"currentColor"})],-1)]),8,Ro),(0,o.bo)((0,o.Lk)("ul",{class:"nav__dropdown",onClick:t[31]||(t[31]=(0,s.D$)(()=>{},["stop"]))},[(0,o.Lk)("li",xo,[(0,o.Lk)("button",{onClick:t[30]||(t[30]=e=>r.showKeyboardShortcuts())},t[68]||(t[68]=[(0,o.Lk)("span",null,"Keyboard Shortcuts",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"F1",-1)]))])],512),[[s.aG,"help"===l.activeDropdown]])])])]),(0,o.Lk)("div",Do,[i.currentUser?((0,o.uX)(),(0,o.CE)("button",{key:1,class:"user-btn",onClick:t[33]||(t[33]=e=>l.showUserProfile=!0)},[(0,o.bF)(d,{size:18}),(0,o.Lk)("span",null,(0,n.v_)(i.currentUser.username),1)])):((0,o.uX)(),(0,o.CE)("button",{key:0,class:"sign-in-btn",onClick:t[32]||(t[32]=(...e)=>r.handleSignIn&&r.handleSignIn(...e))},[(0,o.bF)(d,{size:18}),t[69]||(t[69]=(0,o.Lk)("span",null,"Sign In",-1))]))])]),(0,o.Lk)("div",$o,[(0,o.Lk)("div",To,[i.hasRunProgram?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",{key:0,class:"icon-btn run-btn",onClick:t[34]||(t[34]=e=>r.runScript()),title:"Run (F5)"},[(0,o.bF)(c,{size:20})])),i.hasRunProgram?((0,o.uX)(),(0,o.CE)("div",{key:1,class:"icon-btn stop-btn",onClick:t[35]||(t[35]=e=>r.stopScript()),title:"Stop (Shift+F5)"},[(0,o.bF)(h,{size:20})])):(0,o.Q3)("",!0),(0,o.Lk)("div",{class:"icon-btn save-btn",onClick:t[36]||(t[36]=e=>r.saveFile()),title:"Save (Ctrl+S)"},[(0,o.bF)(p,{size:20})])]),(0,o.Lk)("div",jo,[(0,o.Lk)("div",{class:"icon-btn settings-btn",onClick:t[37]||(t[37]=e=>r.openSettings()),title:"Settings"},[(0,o.bF)(u,{size:20})])])]),(0,o.bF)(m,{modelValue:l.showUserProfile,"onUpdate:modelValue":t[38]||(t[38]=e=>l.showUserProfile=e),"current-user":i.currentUser,onLogout:r.handleLogout,onPasswordChanged:r.handlePasswordChanged},null,8,["modelValue","current-user","onLogout","onPasswordChanged"])])}var Mo=i(47478),_o=i(58263),Ao=i(39037);
/**
 * @license lucide-vue-next v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const Wo=(0,ri.A)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),Oo=(0,ri.A)("circle-user",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]),Uo=(0,ri.A)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var zo=i(96763),Vo={props:{consoleLimit:Boolean,hasRunProgram:Boolean,currentUser:{type:Object,default:null}},data(){return{isRun:!0,activeDropdown:null,consoleVisible:!0,previewPanelVisible:!1,sidebarVisible:!0,showUserProfile:!1}},computed:{ideInfo(){return this.$store?.state?.ide?.ideInfo||{}},isPythonFile(){return this.ideInfo.currProj&&this.ideInfo.currProj.pathSelected&&this.ideInfo.codeItems&&this.ideInfo.codeItems.length>0&&this.ideInfo.currProj.pathSelected.endsWith(".py")},hasSelectedFile(){const e=this.ideInfo.nodeSelected&&"file"===this.ideInfo.nodeSelected.type;return zo.log(" [DEBUG] hasSelectedFile computed:",{nodeSelected:this.ideInfo.nodeSelected,nodeType:this.ideInfo.nodeSelected?.type,result:e}),e},canDeleteFile(){const e=this.ideInfo.nodeSelected;return e&&"file"===e.type},deleteButtonTitle(){return this.ideInfo.nodeSelected?"file"!==this.ideInfo.nodeSelected.type?"Can only delete files":`Delete ${this.ideInfo.nodeSelected.label||this.ideInfo.nodeSelected.name}`:"Select a file to delete"},canSaveAsFile(){const e=this.hasSelectedFile,t=this.ideInfo.codeSelected&&this.ideInfo.codeSelected.fileName,i=e||t;return zo.log(" [DEBUG] canSaveAsFile computed:",{hasSelectedFile:e,nodeSelected:this.ideInfo.nodeSelected,hasCodeSelected:t,codeSelected:this.ideInfo.codeSelected,result:i}),i}},components:{Upload:Ie.A,Play:Mo.A,Square:_o.A,Settings:Ao.A,Trash2:Wo,UserCircle:Oo,Save:Uo,UserProfileModal:Bi},mounted(){const e=localStorage.getItem("theme")||"dark";document.documentElement.setAttribute("data-theme",e),document.addEventListener("click",this.closeDropdowns),zo.log(" TwoHeaderMenu - Adding keyboard shortcut listener"),document.addEventListener("keydown",this.handleKeyboardShortcuts)},beforeUnmount(){document.removeEventListener("click",this.closeDropdowns),document.removeEventListener("keydown",this.handleKeyboardShortcuts)},methods:{toggleDropdown(e){this.activeDropdown=this.activeDropdown===e?null:e},closeDropdowns(){this.activeDropdown=null},handleKeyboardShortcuts(e){if(e.ctrlKey&&!e.shiftKey&&"s"===e.key)return e.preventDefault(),e.stopPropagation(),void this.saveFile();if(e.ctrlKey&&e.shiftKey&&"S"===e.key)return zo.log(" [DEBUG] Ctrl+Shift+S keyboard shortcut triggered"),zo.log(" [DEBUG] canSaveAsFile:",this.canSaveAsFile),e.preventDefault(),e.stopPropagation(),void(this.canSaveAsFile?(zo.log(" [DEBUG] Calling saveAsFile() from keyboard shortcut"),this.saveAsFile()):zo.log(" [DEBUG] Cannot save as - no file available"));if(e.ctrlKey&&e.altKey&&!e.shiftKey&&"n"===e.key)return e.preventDefault(),e.stopPropagation(),void this.newFile();if(e.ctrlKey&&!e.shiftKey&&"o"===e.key)return e.preventDefault(),e.stopPropagation(),void this.openFile();if(e.ctrlKey&&!e.shiftKey&&"d"===e.key)return e.preventDefault(),e.stopPropagation(),void this.downloadFile();if(e.ctrlKey&&e.shiftKey&&"M"===e.key)return e.preventDefault(),e.stopPropagation(),void(this.hasSelectedFile&&this.moveFile());if(e.ctrlKey&&!e.shiftKey&&"z"===e.key)return e.preventDefault(),e.stopPropagation(),void this.undo();if(e.ctrlKey&&!e.shiftKey&&"y"===e.key)return e.preventDefault(),e.stopPropagation(),void this.redo();if(e.ctrlKey&&!e.shiftKey&&"x"===e.key){const t=document.activeElement,i=t&&t.classList.contains("repl-input");if(i)return;return e.preventDefault(),e.stopPropagation(),void this.cut()}if(e.ctrlKey&&!e.shiftKey&&"c"===e.key){const t=document.activeElement,i=t&&t.classList.contains("repl-input");if(i)return;return e.preventDefault(),e.stopPropagation(),void this.copy()}if(e.ctrlKey&&!e.shiftKey&&"v"===e.key){const t=document.activeElement,i=t&&t.classList.contains("repl-input");if(i)return;return e.preventDefault(),e.stopPropagation(),void this.paste()}return e.ctrlKey&&!e.shiftKey&&"f"===e.key?(e.preventDefault(),e.stopPropagation(),void this.find()):e.ctrlKey&&!e.shiftKey&&"h"===e.key?(e.preventDefault(),e.stopPropagation(),void this.replace()):e.ctrlKey&&"/"===e.key?(e.preventDefault(),e.stopPropagation(),void this.comment()):"F5"!==e.key||e.shiftKey?e.shiftKey&&"F5"===e.key?(e.preventDefault(),e.stopPropagation(),void(this.hasRunProgram&&this.stopScript())):e.ctrlKey&&"`"===e.key?(e.preventDefault(),e.stopPropagation(),void this.toggleConsole()):e.ctrlKey&&e.shiftKey&&"P"===e.key?(e.preventDefault(),e.stopPropagation(),void this.togglePreviewPanel()):e.ctrlKey&&!e.shiftKey&&"b"===e.key?(e.preventDefault(),e.stopPropagation(),void this.toggleSidebar()):"F1"===e.key?(e.preventDefault(),e.stopPropagation(),void this.showKeyboardShortcuts()):e.ctrlKey&&","===e.key?(e.preventDefault(),e.stopPropagation(),void this.openSettings()):void 0:(e.preventDefault(),e.stopPropagation(),void(this.isPythonFile&&!this.consoleLimit&&this.runScript()))},newFile(){if(this.closeDropdowns(),!this.ideInfo.nodeSelected||"dir"!==this.ideInfo.nodeSelected.type&&"folder"!==this.ideInfo.nodeSelected.type){const e=this.ideInfo.currProj?.data;e&&this.$store.commit("ide/setNodeSelected",e)}this.$emit("set-text-dialog",{type:"create-file",title:"New File",tips:"Enter file name:",text:"untitled.py"})},saveFile(){this.closeDropdowns(),this.ideInfo.codeSelected&&(this.$store.dispatch("ide/saveFile",{codeItem:this.ideInfo.codeSelected,isAutoSave:!1}),Ce.nk.success("File saved"))},downloadFile(){if(this.closeDropdowns(),this.ideInfo.nodeSelected&&"file"===this.ideInfo.nodeSelected.type){const e=this.ideInfo.nodeSelected,t={fileName:e.label||e.name,filePath:e.path,projectName:e.projectName||this.ideInfo.currProj?.data?.name};this.$emit("download-file",t)}else this.ideInfo.codeSelected?this.$emit("download-file",this.ideInfo.codeSelected):Ce.nk.warning("Please select a file to download")},runScript(){this.closeDropdowns(),this.$emit("run-item")},stopScript(){this.closeDropdowns();for(let e=0;e<this.ideInfo.consoleItems.length;e++)!0===this.ideInfo.consoleItems[e].run&&this.$store.commit("ide/setConsoleItemRun",{index:e,value:!1});this.$emit("stop-item",null)},clearConsole(){this.$emit("clear-console")},deleteSelectedFile(){if(!this.canDeleteFile)return void Ce.nk.warning("Please select a file to delete");const e=this.ideInfo.nodeSelected,t=e.label||e.name;bt.s.confirm(`Are you sure you want to delete "${t}"?`,"Confirm Delete",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then(()=>{this.$emit("delete-selected-file",{path:e.path,type:e.type,projectName:e.projectName||this.ideInfo.currProj?.data?.name})}).catch(()=>{})},openSettings(){this.$emit("open-settings")},handleSignIn(){this.$emit("sign-in")},openFile(){this.closeDropdowns(),this.$emit("open-file-browser")},duplicateFile(){if(zo.log(" [DEBUG] duplicateFile() called from TwoHeaderMenu"),this.closeDropdowns(),!this.hasSelectedFile)return zo.log(" [DEBUG] No file selected for duplication"),void Ce.nk.warning("Please select a file to duplicate");const e=this.ideInfo.nodeSelected,t=e.label||e.name,i=t.includes(".")?t.substring(t.lastIndexOf(".")):"",o=t.includes(".")?t.substring(0,t.lastIndexOf(".")):t,s=`${o}_copy${i}`;zo.log(" [DEBUG] Emitting duplicate-file event:",{originalPath:e.path,newName:s,projectName:e.projectName||this.ideInfo.currProj?.data?.name}),this.$emit("duplicate-file",{originalPath:e.path,newName:s,projectName:e.projectName||this.ideInfo.currProj?.data?.name})},saveAsFile(){if(zo.log(" [DEBUG] saveAsFile() called"),zo.log(" [DEBUG] hasSelectedFile:",this.hasSelectedFile),zo.log(" [DEBUG] nodeSelected:",this.ideInfo.nodeSelected),zo.log(" [DEBUG] codeSelected:",this.ideInfo.codeSelected),zo.log(" [DEBUG] canSaveAsFile:",this.canSaveAsFile),this.closeDropdowns(),this.hasSelectedFile){const e=this.ideInfo.nodeSelected,t={fileName:e.label||e.name,filePath:e.path,projectName:e.projectName||this.ideInfo.currProj?.data?.name};return zo.log(" [DEBUG] Converted tree file to fileInfo:",t),zo.log(" [DEBUG] Original selectedFile:",e),void this.$emit("save-as-file",t)}if(this.ideInfo.codeSelected)return zo.log(" [DEBUG] Emitting save-as-file for editor file:",this.ideInfo.codeSelected),void this.$emit("save-as-file",this.ideInfo.codeSelected);zo.log(" [DEBUG] No file available for save as"),Ce.nk.warning("Please select a file to save")},moveFile(){this.closeDropdowns(),this.hasSelectedFile?this.$emit("open-move-dialog",this.ideInfo.nodeSelected):Ce.nk.warning("Please select a file to move")},deleteFile(){if(this.closeDropdowns(),!this.hasSelectedFile)return void Ce.nk.warning("Please select a file to delete");const e=this.ideInfo.nodeSelected,t=e.label||e.name;bt.s.confirm(`Are you sure you want to delete "${t}"?`,"Confirm Delete",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then(()=>{this.$emit("delete-file",{path:e.path,type:e.type,projectName:e.projectName||this.ideInfo.currProj?.data?.name})}).catch(()=>{})},undo(){this.closeDropdowns(),this.$emit("undo")},redo(){this.closeDropdowns(),this.$emit("redo")},cut(){this.closeDropdowns(),this.$emit("cut")},copy(){this.closeDropdowns(),this.$emit("copy")},paste(){this.closeDropdowns(),this.$emit("paste")},find(){this.closeDropdowns(),this.$emit("find")},replace(){this.closeDropdowns(),this.$emit("replace")},comment(){this.closeDropdowns(),this.$emit("comment")},toggleConsole(){this.closeDropdowns(),this.consoleVisible=!this.consoleVisible,this.$emit("toggle-console",this.consoleVisible)},togglePreviewPanel(){this.closeDropdowns(),this.previewPanelVisible=!this.previewPanelVisible,this.$emit("toggle-preview-panel",this.previewPanelVisible)},toggleSidebar(){this.closeDropdowns(),this.sidebarVisible=!this.sidebarVisible,this.$emit("toggle-sidebar",this.sidebarVisible)},showKeyboardShortcuts(){this.closeDropdowns(),this.$emit("show-keyboard-shortcuts")},handleLogout(){localStorage.removeItem("session_id"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("full_name"),this.$emit("logout"),Ce.nk.success("Logged out successfully"),setTimeout(()=>{window.location.reload()},1e3)},handlePasswordChanged(){Ce.nk.success("Password changed successfully!")}}};const Bo=(0,b.A)(Vo,[["render",No],["__scopeId","data-v-3cb207bd"]]);var Xo=Bo;const Ho={class:"main-wrapper ide-wrapper ide-container"},Ko={id:"total-frame",class:"total-frame"},Go={id:"left-sidebar",class:"left-sidebar"},Qo={id:"center-frame",class:"center-frame"},qo={class:"editor-section"},Jo={class:"editor-tab-bar"},Yo={class:"editor-content"},Zo={class:"console-section"},es={class:"console-header"},ts={class:"console-header-left"},is={class:"console-title"},os={class:"console-header-center"},ss={key:0,class:"console-header-right"},ns=["title"],as={class:"console-body"},ls={class:"console-output-area",ref:"consoleOutputArea"},rs={key:0,class:"console-text"},ds={key:1,class:"console-error"},cs={key:2,class:"console-input-prompt"},hs={key:3,class:"console-system"},ps={key:4,class:"console-repl-prompt"},us=["innerHTML"],ms={key:6,class:"console-repl-entry"},fs={key:0,class:"console-repl-prompt"},gs=["innerHTML"],vs={key:1,class:"console-repl-line"},ys={class:"console-repl-prompt"},ws=["innerHTML"],ks={key:7,class:"console-text"},bs={key:0,class:"console-input-area"},Is={class:"input-prompt"},Ss={class:"input-field-container"},Ps=["rows"],Cs={key:1,class:"repl-section"},Ls={class:"repl-prompt"},Fs={class:"prompt-symbol"},Es=["rows"],Rs={id:"right-sidebar",class:"right-sidebar"},xs={class:"right-sidebar-placeholder"},Ds={class:"preview-tabs"},$s={class:"preview-tab-list"},Ts=["onClick"],js={class:"tab-icon"},Ns={class:"tab-title"},Ms=["onClick"],_s={class:"preview-content"},As={key:0,class:"output-panel"},Ws={class:"output-content"},Os={key:1,class:"media-preview-panel"},Us={key:2,class:"data-preview-panel"},zs={key:0,class:"right-panel-controls"},Vs=["title"],Bs={class:"tab-count"},Xs={key:7,class:"repl-modal"},Hs={class:"repl-modal-content"},Ks={class:"repl-modal-header"},Gs={class:"repl-modal-body"};function Qs(e,t,i,a,l,r){const d=Xo,c=wi.A,h=yi,p=pi,u=Xt.A,m=(0,o.g2)("pane"),f=Bt,g=Tt.A,v=$t.A,y=(0,o.g2)("ChevronUp"),w=(0,o.g2)("ChevronDown"),k=(0,o.g2)("Minimize2"),b=(0,o.g2)("splitpanes"),I=Dt.A,C=xt.A,L=(0,o.g2)("ChevronLeft"),F=(0,o.g2)("ChevronRight"),E=Rt.A,R=Et.A,x=Ft.A,D=Lt.A,$=Ct,T=Ze,j=Re,N=X,M=P.A,_=S;return(0,o.uX)(),(0,o.CE)("div",Ho,[(0,o.bF)(d,{class:"two-header-menu",consoleLimit:r.consoleLimit,hasRunProgram:r.hasRunProgram,currentUser:r.currentUser,onSetTextDialog:r.setTextDialog,onSetDelDialog:r.setDelDialog,onSetProjsDialog:r.setProjsDialog,onRunItem:r.runPathSelected,onStopItem:r.stop,onClearConsole:r.clearConsole,onSignIn:r.handleSignIn,onOpenUploadDialog:t[0]||(t[0]=e=>l.showUploadDialog=!0),onDownloadFile:r.downloadFile,onOpenSettings:t[1]||(t[1]=e=>l.showSettingsModal=!0),onOpenFileBrowser:r.openFileBrowser,onDuplicateFile:r.duplicateFile,onSaveAsFile:r.saveAsFile,onOpenMoveDialog:r.openMoveDialog,onDeleteFile:r.deleteFileFromMenu,onDeleteSelectedFile:r.deleteSelectedFile,onUndo:r.handleUndo,onRedo:r.handleRedo,onCut:r.handleCut,onCopy:r.handleCopy,onPaste:r.handlePaste,onFind:r.handleFind,onReplace:r.handleReplace,onComment:r.handleComment,onToggleConsole:r.toggleConsole,onTogglePreviewPanel:r.togglePreviewPanel,onToggleSidebar:r.toggleLeftSidebar,onShowKeyboardShortcuts:t[2]||(t[2]=e=>l.showKeyboardShortcutsModal=!l.showKeyboardShortcutsModal)},null,8,["consoleLimit","hasRunProgram","currentUser","onSetTextDialog","onSetDelDialog","onSetProjsDialog","onRunItem","onStopItem","onClearConsole","onSignIn","onDownloadFile","onOpenFileBrowser","onDuplicateFile","onSaveAsFile","onOpenMoveDialog","onDeleteFile","onDeleteSelectedFile","onUndo","onRedo","onCut","onCopy","onPaste","onFind","onReplace","onComment","onToggleConsole","onTogglePreviewPanel","onToggleSidebar"]),(0,o.bF)(c,{modelValue:l.showSettingsModal,"onUpdate:modelValue":t[3]||(t[3]=e=>l.showSettingsModal=e),onUpdateFontSize:r.updateFontSize,onUpdateLineNumbers:r.updateLineNumbers,onUpdateWordWrap:r.updateWordWrap,onUpdateAutoSave:r.updateAutoSave,onUpdateAutoSaveInterval:r.updateAutoSaveInterval,onUpdateAutoSaveNotifications:r.updateAutoSaveNotifications},null,8,["modelValue","onUpdateFontSize","onUpdateLineNumbers","onUpdateWordWrap","onUpdateAutoSave","onUpdateAutoSaveInterval","onUpdateAutoSaveNotifications"]),(0,o.bF)(h,{modelValue:l.showKeyboardShortcutsModal,"onUpdate:modelValue":t[4]||(t[4]=e=>l.showKeyboardShortcutsModal=e)},null,8,["modelValue"]),(0,o.bF)(p,{modelValue:l.showFindReplaceModal,"onUpdate:modelValue":t[5]||(t[5]=e=>l.showFindReplaceModal=e),mode:l.findReplaceMode},null,8,["modelValue","mode"]),(0,o.Lk)("div",Ko,[(0,o.bF)(b,{class:(0,n.C4)(["default-theme","main-splitpanes",{"has-right-content":l.previewTabs.length>0}])},{default:(0,o.k6)(()=>[(0,o.bF)(m,{size:r.leftSidebarSize,"min-size":r.leftSidebarMinSize,"max-size":r.leftSidebarMaxSize},{default:(0,o.k6)(()=>[(0,o.bo)((0,o.Lk)("div",Go,[(0,o.bF)(u,{currentUser:r.currentUser,onGetItem:r.getFile,onGetItemRightPanel:r.getFileForRightPanel,onContextMenu:l.showContextMenu,onRenameItem:r.handleRenameItem,onDeleteItem:r.handleDeleteItem,onDownloadItem:r.handleDownloadItem,onNewFile:r.handleNewFileFromTree,onNewFolder:r.handleNewFolderFromTree,onImportFile:r.handleImportFileFromTree},null,8,["currentUser","onGetItem","onGetItemRightPanel","onContextMenu","onRenameItem","onDeleteItem","onDownloadItem","onNewFile","onNewFolder","onImportFile"])],512),[[s.aG,l.leftSidebarVisible&&l.windowWidth>900]])]),_:1},8,["size","min-size","max-size"]),(0,o.bF)(m,{size:r.centerSize,"min-size":30},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Qo,[(0,o.bF)(f,{onOpenInRightPanel:r.getFileForRightPanel},null,8,["onOpenInRightPanel"]),(0,o.bF)(b,{horizontal:"",class:"default-theme"},{default:(0,o.k6)(()=>[(0,o.bF)(m,{size:r.editorPaneSize,"min-size":5,"max-size":95},{default:(0,o.k6)(()=>[(0,o.Lk)("div",qo,[(0,o.Lk)("div",Jo,[r.ideInfo.codeItems.length>0?((0,o.uX)(),(0,o.Wv)(g,{key:0,onSelectItem:r.selectFile,onCloseItem:r.closeFile,onToggleSidebar:r.toggleLeftSidebar},null,8,["onSelectItem","onCloseItem","onToggleSidebar"])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",Yo,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.ideInfo.codeItems,(e,t)=>((0,o.uX)(),(0,o.CE)(o.FK,{key:`${e.projectName||"default"}:${e.path}`},[r.isSelectedFile(e)?((0,o.uX)(),(0,o.Wv)(v,{key:0,codeItem:e,codeItemIndex:t,consoleLimit:r.consoleLimit,wordWrap:l.wordWrap,onRunItem:r.runPathSelected,onUpdateItem:r.updateItem},null,8,["codeItem","codeItemIndex","consoleLimit","wordWrap","onRunItem","onUpdateItem"])):(0,o.Q3)("",!0)],64))),128))])])]),_:1},8,["size"]),(0,o.bF)(m,{size:r.consolePaneSize,"min-size":5,"max-size":95},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Zo,[(0,o.Lk)("div",es,[(0,o.Lk)("div",ts,[(0,o.Lk)("span",is,(0,n.v_)((l.isReplMode,"Console")),1)]),(0,o.Lk)("div",os,["collapsed"===l.consoleMode?((0,o.uX)(),(0,o.CE)("button",{key:0,class:"console-expand-arrow",onClick:t[6]||(t[6]=(...e)=>r.handleConsoleUpArrow&&r.handleConsoleUpArrow(...e)),title:"Open console"},[(0,o.bF)(y,{size:16})])):(0,o.Q3)("",!0),"normal"===l.consoleMode?((0,o.uX)(),(0,o.CE)("button",{key:1,class:"console-expand-arrow",onClick:t[7]||(t[7]=(...e)=>r.handleConsoleUpArrow&&r.handleConsoleUpArrow(...e)),title:"Maximize console"},[(0,o.bF)(y,{size:16})])):(0,o.Q3)("",!0),"normal"===l.consoleMode?((0,o.uX)(),(0,o.CE)("button",{key:2,class:"console-expand-arrow",onClick:t[8]||(t[8]=(...e)=>r.handleConsoleDownArrow&&r.handleConsoleDownArrow(...e)),title:"Collapse console"},[(0,o.bF)(w,{size:16})])):(0,o.Q3)("",!0),"maximized"===l.consoleMode?((0,o.uX)(),(0,o.CE)("button",{key:3,class:"console-expand-arrow",onClick:t[9]||(t[9]=(...e)=>r.handleConsoleRestore&&r.handleConsoleRestore(...e)),title:"Restore console"},[(0,o.bF)(k,{size:16})])):(0,o.Q3)("",!0),"maximized"===l.consoleMode?((0,o.uX)(),(0,o.CE)("button",{key:4,class:"console-expand-arrow",onClick:t[10]||(t[10]=(...e)=>r.handleConsoleDownArrow&&r.handleConsoleDownArrow(...e)),title:"Collapse console"},[(0,o.bF)(w,{size:16})])):(0,o.Q3)("",!0)]),l.consoleExpanded?((0,o.uX)(),(0,o.CE)("div",ss,[(0,o.Lk)("button",{class:(0,n.C4)(["console-action-btn",{active:l.isReplMode}]),onClick:t[11]||(t[11]=(0,s.D$)((...e)=>r.toggleReplMode&&r.toggleReplMode(...e),["stop"])),title:l.isReplMode?"Exit REPL Mode":"Start Python REPL"},[(0,o.Lk)("span",null,(0,n.v_)(l.isReplMode?"Exit REPL":"REPL"),1)],10,ns),(0,o.Lk)("button",{class:"console-action-btn",onClick:t[12]||(t[12]=(0,s.D$)((...e)=>r.clearConsole&&r.clearConsole(...e),["stop"])),title:"Clear Console"},t[29]||(t[29]=[(0,o.Lk)("span",null,"Clear",-1)]))])):(0,o.Q3)("",!0)]),(0,o.bo)((0,o.Lk)("div",as,[(0,o.Lk)("div",ls,[r.ideInfo.consoleSelected&&r.ideInfo.consoleSelected.resultList?((0,o.uX)(!0),(0,o.CE)(o.FK,{key:0},(0,o.pI)(r.ideInfo.consoleSelected.resultList,(e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:t,class:"console-line"},["output"!==e.type&&"text"!==e.type||r.isPromptOutput(e)?"error"===e.type?((0,o.uX)(),(0,o.CE)("pre",ds,(0,n.v_)(e.text||e.content||e),1)):"input"===e.type||"input-prompt"===e.type?((0,o.uX)(),(0,o.CE)("div",cs,[(0,o.Lk)("span",null,(0,n.v_)(e.text||e.content||e),1)])):"system"===e.type?((0,o.uX)(),(0,o.CE)("pre",hs,(0,n.v_)(e.text||e.content||e),1)):"repl-prompt"===e.type?((0,o.uX)(),(0,o.CE)("span",ps,(0,n.v_)(e.text||">>> "),1)):"user-input"===e.type?((0,o.uX)(),(0,o.CE)("pre",{key:5,class:"console-user-input",innerHTML:r.highlightPythonCode(e.text||e.content||e)},null,8,us)):"repl-input"===e.type?((0,o.uX)(),(0,o.CE)("div",ms,[r.isMultilineCode(e.content||e.text||e)?((0,o.uX)(!0),(0,o.CE)(o.FK,{key:0},(0,o.pI)(r.splitCodeLines(e.content||e.text||e),(t,i)=>((0,o.uX)(),(0,o.CE)("div",{key:"line-"+i,class:"console-repl-line"},[0===i?((0,o.uX)(),(0,o.CE)("span",fs,(0,n.v_)(e.prompt||">>> "),1)):(0,o.Q3)("",!0),(0,o.Lk)("pre",{class:(0,n.C4)(["console-repl-input",{"no-prompt":i>0}]),innerHTML:r.highlightPythonCode(t)},null,10,gs)]))),128)):((0,o.uX)(),(0,o.CE)("div",vs,[(0,o.Lk)("span",ys,(0,n.v_)(e.prompt||">>> "),1),(0,o.Lk)("pre",{class:"console-repl-input",innerHTML:r.highlightPythonCode(e.content||e.text||e)},null,8,ws)]))])):((0,o.uX)(),(0,o.CE)("pre",ks,(0,n.v_)("object"===typeof e?e.text||e.content||JSON.stringify(e):e),1)):((0,o.uX)(),(0,o.CE)("pre",rs,(0,n.v_)(e.text||e.content||e),1))]))),128)):(0,o.Q3)("",!0)],512),r.ideInfo.consoleSelected&&r.ideInfo.consoleSelected.waitingForInput?((0,o.uX)(),(0,o.CE)("div",bs,[(0,o.Lk)("div",Is,[t[30]||(t[30]=(0,o.Lk)("span",{class:"prompt-icon"},"",-1)),(0,o.Lk)("span",null,(0,n.v_)(r.ideInfo.consoleSelected.inputPrompt||"Enter input:"),1)]),(0,o.Lk)("div",Ss,[(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":t[13]||(t[13]=e=>l.programInput=e),onKeydown:t[14]||(t[14]=(...e)=>r.handleProgramInputKeydown&&r.handleProgramInputKeydown(...e)),ref:"programInputField",class:"program-input-field",placeholder:"Type your input and press Enter...",rows:l.programInputRows,autofocus:""},null,40,Ps),[[s.Jo,l.programInput]]),(0,o.Lk)("button",{onClick:t[15]||(t[15]=(...e)=>r.sendProgramInput&&r.sendProgramInput(...e)),class:"input-submit-btn"},"Send")])])):(0,o.Q3)("",!0),l.isReplMode||r.ideInfo.consoleSelected&&r.ideInfo.consoleSelected.waitingForReplInput?((0,o.uX)(),(0,o.CE)("div",Cs,[(0,o.Lk)("div",Ls,[(0,o.Lk)("span",Fs,(0,n.v_)(l.replPrompt||">>> "),1),(0,o.bo)((0,o.Lk)("textarea",{class:"repl-input",placeholder:"Enter Python code...","onUpdate:modelValue":t[16]||(t[16]=e=>l.replInput=e),onKeydown:t[17]||(t[17]=(...e)=>r.handleReplKeydown&&r.handleReplKeydown(...e)),ref:"replInputField",rows:l.replInputRows},"                ",40,Es),[[s.Jo,l.replInput]])])])):(0,o.Q3)("",!0)],512),[[s.aG,l.consoleExpanded]])])]),_:1},8,["size"])]),_:1})])]),_:1},8,["size"]),(0,o.bF)(m,{size:r.rightSidebarSize,"min-size":r.rightSidebarMinSize,"max-size":r.rightSidebarMaxSize,"push-other-panes":!1},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Rs,[(0,o.bo)((0,o.Lk)("div",xs,null,512),[[s.aG,!l.rightSidebarVisible||0===l.previewTabs.length]]),(0,o.bo)((0,o.Lk)("div",Ds,[(0,o.Lk)("div",$s,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.previewTabs,e=>((0,o.uX)(),(0,o.CE)("button",{key:e.id,class:(0,n.C4)(["preview-tab",{active:l.selectedPreviewTab===e.id}]),onClick:t=>r.selectPreviewTab(e.id)},[(0,o.Lk)("span",js,(0,n.v_)(r.getTabIcon(e.type)),1),(0,o.Lk)("span",Ns,(0,n.v_)(e.title),1),(0,o.Lk)("span",{class:"tab-close",onClick:(0,s.D$)(t=>r.closePreviewTab(e.id),["stop"])},"",8,Ms)],10,Ts))),128))])],512),[[s.aG,l.rightSidebarVisible&&l.previewTabs.length>0]]),(0,o.bo)((0,o.Lk)("div",_s,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.previewTabs,e=>(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"preview-panel"},["output"===e.type?((0,o.uX)(),(0,o.CE)("div",As,[(0,o.Lk)("div",Ws,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.content,(e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:t,class:(0,n.C4)(["output-line",e.type])},[(0,o.Lk)("pre",null,(0,n.v_)(e.text),1)],2))),128))])])):"image"===e.type||"pdf"===e.type?((0,o.uX)(),(0,o.CE)("div",Os,[(0,o.bF)(I,{codeItem:r.getMediaCodeItem(e),codeItemIndex:0},null,8,["codeItem"])])):"data"===e.type?((0,o.uX)(),(0,o.CE)("div",Us,[(0,o.bF)(C,{content:e.content},null,8,["content"])])):(0,o.Q3)("",!0)],512)),[[s.aG,l.selectedPreviewTab===e.id]])),128))],512),[[s.aG,l.rightSidebarVisible&&l.previewTabs.length>0]])])]),_:1},8,["size","min-size","max-size"])]),_:1},8,["class"]),"closed"!==l.rightPanelMode&&l.previewTabs.length>0?((0,o.uX)(),(0,o.CE)("div",zs,["normal"===l.rightPanelMode?((0,o.uX)(),(0,o.CE)("button",{key:0,class:"control-arrow left-arrow",onClick:t[18]||(t[18]=(...e)=>r.handleLeftArrowClick&&r.handleLeftArrowClick(...e)),title:"Expand preview to full width"},[(0,o.bF)(L,{size:16})])):(0,o.Q3)("",!0),(0,o.Lk)("button",{class:"control-arrow right-arrow",onClick:t[19]||(t[19]=(...e)=>r.handleRightArrowClick&&r.handleRightArrowClick(...e)),title:"expanded"===l.rightPanelMode?"Restore to normal size":"Collapse preview panel"},[(0,o.bF)(F,{size:16})],8,Vs)])):(0,o.Q3)("",!0),"closed"===l.rightPanelMode&&l.previewTabs.length>0?((0,o.uX)(),(0,o.CE)("div",{key:1,class:"show-preview-btn",onClick:t[20]||(t[20]=(...e)=>r.restoreRightPanel&&r.restoreRightPanel(...e)),title:"Show Preview Panel"},[(0,o.Lk)("span",Bs,(0,n.v_)(l.previewTabs.length),1),t[31]||(t[31]=(0,o.Lk)("span",null,"",-1))])):(0,o.Q3)("",!0)]),l.showProjsDialog?((0,o.uX)(),(0,o.Wv)(E,{key:0,onOnCancel:r.onCloseProjsDialog,onOnSelect:r.onSelectProj,onOnDelete:r.onDeleteProj,onSetTextDialog:r.setTextDialog},null,8,["onOnCancel","onOnSelect","onOnDelete","onSetTextDialog"])):(0,o.Q3)("",!0),l.showFileDialog?((0,o.uX)(),(0,o.Wv)(R,{key:1,title:l.dialogTitle,text:l.dialogText,tips:l.dialogTips,onCheckInput:r.inputIsLegal,onOnCancel:r.onCloseTextDialog,onOnCreate:r.onCreate},null,8,["title","text","tips","onCheckInput","onOnCancel","onOnCreate"])):(0,o.Q3)("",!0),l.showDeleteDialog?((0,o.uX)(),(0,o.Wv)(x,{key:2,title:l.dialogTitle,onOnCancel:r.onCancelDelete,onOnDelete:r.onDelete},null,8,["title","onOnCancel","onOnDelete"])):(0,o.Q3)("",!0),l.showUploadDialog?((0,o.uX)(),(0,o.Wv)(D,{key:3,modelValue:l.showUploadDialog,"onUpdate:modelValue":t[21]||(t[21]=e=>l.showUploadDialog=e),onRefreshTree:r.refreshProjectTree,onClose:t[22]||(t[22]=e=>l.showUploadDialog=!1)},null,8,["modelValue","onRefreshTree"])):(0,o.Q3)("",!0),l.showNewFileDialog?((0,o.uX)(),(0,o.Wv)($,{key:4,modelValue:l.showNewFileDialog,"onUpdate:modelValue":t[23]||(t[23]=e=>l.showNewFileDialog=e),onFileCreated:r.handleFileCreated},null,8,["modelValue","onFileCreated"])):(0,o.Q3)("",!0),l.showNewFolderDialog?((0,o.uX)(),(0,o.Wv)(T,{key:5,modelValue:l.showNewFolderDialog,"onUpdate:modelValue":t[24]||(t[24]=e=>l.showNewFolderDialog=e),onFolderCreated:r.handleFolderCreated},null,8,["modelValue","onFolderCreated"])):(0,o.Q3)("",!0),l.showImportFileDialog?((0,o.uX)(),(0,o.Wv)(j,{key:6,modelValue:l.showImportFileDialog,"onUpdate:modelValue":t[25]||(t[25]=e=>l.showImportFileDialog=e),onFilesImported:r.handleFilesImported},null,8,["modelValue","onFilesImported"])):(0,o.Q3)("",!0),(0,o.bF)(N,{modelValue:l.showFileBrowserDialog,"onUpdate:modelValue":t[26]||(t[26]=e=>l.showFileBrowserDialog=e),mode:l.fileBrowserMode,fileToMove:l.fileToMove,currentUser:r.currentUser,onOpenFile:r.handleOpenFile,onMoveFile:r.handleMoveFile},null,8,["modelValue","mode","fileToMove","currentUser","onOpenFile","onMoveFile"]),l.showREPL?((0,o.uX)(),(0,o.CE)("div",Xs,[(0,o.Lk)("div",Hs,[(0,o.Lk)("div",Ks,[t[32]||(t[32]=(0,o.Lk)("h3",null,"Python REPL (Interactive Console)",-1)),(0,o.Lk)("button",{onClick:t[27]||(t[27]=(...e)=>r.closeREPL&&r.closeREPL(...e)),class:"repl-close-btn"},"")]),(0,o.Lk)("div",Gs,[(0,o.bF)(M)])])])):(0,o.Q3)("",!0),(0,o.bF)(_,{visible:l.showLoginModal,onClose:t[28]||(t[28]=e=>l.showLoginModal=!1),onLoginSuccess:r.handleLoginSuccess},null,8,["visible","onLoginSuccess"])])}i(16573),i(78100),i(77936),i(79577),i(41549),i(49797),i(49631),i(35623),i(64979),i(14603),i(47566),i(98721);var qs=i(99415),Js=i(33887);
/**
 * @license lucide-vue-next v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const Ys=(0,ri.A)("minimize-2",[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]]),Zs={class:"hybrid-console"},en={class:"console-output",ref:"consoleOutput"},tn={key:1,class:"output-text error-output"},on={key:2,class:"output-text system-message"},sn={key:3,class:"input-prompt-line"},nn={class:"prompt-text"},an={key:4,class:"user-input-line"},ln={class:"input-text"},rn={class:"repl-prompt"},dn={key:6,class:"repl-output"},cn={key:7,class:"figure-container"},hn=["src"],pn={class:"figure-controls"},un=["onClick"],mn=["onClick"],fn={key:0,class:"loading-indicator"},gn={key:0,class:"input-area"},vn={key:0,class:"input-prompt-display"},yn={class:"prompt-label"},wn={key:1,class:"repl-input-container"},kn={class:"repl-input-prefix"},bn={class:"repl-editor-wrapper"},In={key:2,class:"input-container"},Sn=["rows"],Pn=["disabled"],Cn={class:"input-hint"},Ln={key:0},Fn={key:1},En={class:"console-status"},Rn={class:"status-left"},xn={key:0,class:"status-item repl"},Dn={key:1,class:"status-item running"},$n={key:2,class:"status-item success"},Tn={key:3,class:"status-item error"},jn={key:4,class:"status-item idle"},Nn={class:"status-right"};function Mn(e,t,i,a,l,r){const d=(0,o.g2)("Codemirror");return(0,o.uX)(),(0,o.CE)("div",Zs,[(0,o.Lk)("div",en,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.outputLines,(e,i)=>((0,o.uX)(),(0,o.CE)("div",{key:i,class:"output-line"},["text"===e.type?((0,o.uX)(),(0,o.CE)("pre",{key:0,class:(0,n.C4)(["output-text",e.class])},(0,n.v_)(e.content),3)):"error"===e.type?((0,o.uX)(),(0,o.CE)("pre",tn,(0,n.v_)(e.content),1)):"system"===e.type?((0,o.uX)(),(0,o.CE)("pre",on,(0,n.v_)(e.content),1)):"input-prompt"===e.type?((0,o.uX)(),(0,o.CE)("div",sn,[t[8]||(t[8]=(0,o.Lk)("span",{class:"prompt-indicator"},"",-1)),(0,o.Lk)("span",nn,(0,n.v_)(e.content),1)])):"user-input"===e.type?((0,o.uX)(),(0,o.CE)("div",an,[t[9]||(t[9]=(0,o.Lk)("span",{class:"input-indicator"},"",-1)),(0,o.Lk)("span",ln,(0,n.v_)(e.content),1)])):"repl-input"===e.type?((0,o.uX)(),(0,o.CE)("div",{key:5,class:(0,n.C4)(["repl-line",{multiline:e.multiline}])},[(0,o.Lk)("span",rn,(0,n.v_)(e.prompt),1),(0,o.Lk)("pre",{class:(0,n.C4)(["repl-input-text",{"multiline-content":e.multiline}])},(0,n.v_)(e.content),3)],2)):"repl-output"===e.type?((0,o.uX)(),(0,o.CE)("pre",dn,(0,n.v_)(e.content),1)):"figure"===e.type?((0,o.uX)(),(0,o.CE)("div",cn,[(0,o.Lk)("img",{src:`data:image/png;base64,${e.data}`,alt:"Matplotlib Figure",class:"matplotlib-figure"},null,8,hn),(0,o.Lk)("div",pn,[(0,o.Lk)("button",{class:"figure-btn",onClick:t=>a.downloadFigure(e.data),title:"Download"},"  ",8,un),(0,o.Lk)("button",{class:"figure-btn",onClick:t=>a.openFigureInNewTab(e.data),title:"Open in new tab"},"  ",8,mn)])])):(0,o.Q3)("",!0)]))),128)),!i.isRunning||a.waitingForInput||a.isReplMode?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",fn,t[10]||(t[10]=[(0,o.Lk)("span",{class:"loading-dots"},"",-1),(0,o.Lk)("span",{class:"loading-text"},"Running...",-1)])))],512),a.waitingForInput||a.isReplMode?((0,o.uX)(),(0,o.CE)("div",gn,[a.waitingForInput&&!a.isReplMode?((0,o.uX)(),(0,o.CE)("div",vn,[t[11]||(t[11]=(0,o.Lk)("span",{class:"prompt-icon"},"",-1)),(0,o.Lk)("span",yn,(0,n.v_)(a.currentPrompt||"Waiting for input..."),1)])):(0,o.Q3)("",!0),a.isReplMode?((0,o.uX)(),(0,o.CE)("div",wn,[(0,o.Lk)("span",kn,(0,n.v_)(a.replPrompt),1),(0,o.Lk)("div",bn,[(0,o.bF)(d,{value:a.userInput,"onUpdate:value":t[0]||(t[0]=e=>a.userInput=e),options:a.replCodeMirrorOptions,onKeydown:a.handleKeyDown,ref:"replEditor",class:"repl-codemirror",placeholder:"Enter Python code..."},null,8,["value","options","onKeydown"])])])):((0,o.uX)(),(0,o.CE)("div",In,[t[12]||(t[12]=(0,o.Lk)("span",{class:"input-prefix"},"",-1)),(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>a.userInput=e),onKeydown:t[2]||(t[2]=(...e)=>a.handleKeyDown&&a.handleKeyDown(...e)),ref:"inputField",class:"user-input-field",placeholder:"Type your input and press Enter...",rows:a.inputRows,autofocus:""},null,40,Sn),[[s.Jo,a.userInput]]),(0,o.Lk)("button",{class:"input-btn primary",onClick:t[3]||(t[3]=(...e)=>a.sendInput&&a.sendInput(...e)),disabled:!a.userInput.trim(),title:"Submit (Enter)"},"  ",8,Pn),(0,o.Lk)("button",{class:"input-btn secondary",onClick:t[4]||(t[4]=(...e)=>a.cancelInput&&a.cancelInput(...e)),title:"Cancel (Escape)"},"  ")])),(0,o.Lk)("div",Cn,[a.isReplMode?((0,o.uX)(),(0,o.CE)("span",Ln,"Enter: Execute | Shift+Enter: New line | Up/Down: History")):((0,o.uX)(),(0,o.CE)("span",Fn,"Press Enter to submit  Escape to cancel"))])])):(0,o.Q3)("",!0),(0,o.Lk)("div",En,[(0,o.Lk)("div",Rn,[a.isReplMode?((0,o.uX)(),(0,o.CE)("span",xn,t[13]||(t[13]=[(0,o.Lk)("span",{class:"status-dot repl"},null,-1),(0,o.eW)(" REPL Mode ",-1)]))):i.isRunning?((0,o.uX)(),(0,o.CE)("span",Dn,[t[14]||(t[14]=(0,o.Lk)("span",{class:"status-dot"},null,-1)),(0,o.eW)(" Running "+(0,n.v_)(a.currentProgram),1)])):0===a.lastExitCode?((0,o.uX)(),(0,o.CE)("span",$n,t[15]||(t[15]=[(0,o.Lk)("span",{class:"status-dot"},null,-1),(0,o.eW)(" Ready ",-1)]))):null!==a.lastExitCode?((0,o.uX)(),(0,o.CE)("span",Tn,[t[16]||(t[16]=(0,o.Lk)("span",{class:"status-dot"},null,-1)),(0,o.eW)(" Exit code: "+(0,n.v_)(a.lastExitCode),1)])):((0,o.uX)(),(0,o.CE)("span",jn,t[17]||(t[17]=[(0,o.Lk)("span",{class:"status-dot"},null,-1),(0,o.eW)(" Idle ",-1)])))]),(0,o.Lk)("div",Nn,[(0,o.Lk)("button",{class:"status-btn",onClick:t[5]||(t[5]=(...e)=>a.clearConsole&&a.clearConsole(...e)),title:"Clear console"},""),(0,o.Lk)("button",{class:"status-btn",onClick:t[6]||(t[6]=(...e)=>a.exportOutput&&a.exportOutput(...e)),title:"Export output"},""),i.isRunning||a.isReplMode?((0,o.uX)(),(0,o.CE)("button",{key:0,class:"status-btn danger",onClick:t[7]||(t[7]=(...e)=>a.stopProgram&&a.stopProgram(...e)),title:"Stop"},"")):(0,o.Q3)("",!0)])])])}var _n=i(50953),An=i(42453),Wn=i(15237),On=i.n(Wn),Un=(i(74806),i(50436),i(97923),i(55218),i(44317),i(57829),{name:"HybridConsole",components:{Codemirror:An.Ay},props:{item:{type:Object,required:!0},isRunning:{type:Boolean,default:!1}},emits:["run-item","stop-item","send-input"],setup(e,{emit:t}){const i=(0,_n.KR)([]),s=(0,_n.KR)(!1),n=(0,_n.KR)(""),a=(0,_n.KR)(""),l=(0,_n.KR)(null),r=(0,_n.KR)(""),d=(0,_n.KR)(!1),c=(0,_n.KR)(">>> "),h=(0,_n.KR)([]),p=(0,_n.KR)(-1),u=(0,_n.KR)(1),m=(0,_n.KR)(null),f=(0,_n.KR)(null),g=(0,_n.KR)(null),v=(0,_n.KR)({mode:{name:"python",version:3,singleLineStringErrors:!1},theme:"repl-theme",lineNumbers:!1,smartIndent:!0,indentUnit:4,tabSize:4,indentWithTabs:!1,matchBrackets:!0,autoCloseBrackets:!0,styleActiveLine:!1,lineWrapping:!0,showCursorWhenSelecting:!0,viewportMargin:1/0,scrollbarStyle:null,autofocus:!0,extraKeys:{Enter:e=>{const t=e.getCursor(),i=e.getLine(t.line),o=e.getValue().trim(),s=i.trim().endsWith(":")||i.trim().endsWith("\\")||/^\s+/.test(i)||o.split("\n").some((e,i)=>i<t.line&&e.trim().endsWith(":"));if(s||t.line<e.lastLine()){const t=i.match(/^\s*/)[0],o=i.trim().endsWith(":")?"    ":"";e.replaceSelection("\n"+t+o)}else o?L():e.replaceSelection("\n")},"Shift-Enter":e=>{const t=e.getCursor(),i=e.getLine(t.line),o=i.match(/^\s*/)[0];e.replaceSelection("\n"+o)},Up:e=>{0!==e.getCursor().line||e.getSelection()?On().commands.goLineUp(e):F("up")},Down:e=>{e.getCursor().line!==e.lastLine()||e.getSelection()?On().commands.goLineDown(e):F("down")},Tab:e=>{e.getSelection()?e.indentSelection("add"):e.replaceSelection(Array(e.getOption("indentUnit")+1).join(" "))},"Shift-Tab":e=>{e.indentSelection("subtract")}}}),y=(0,o.EW)(()=>{if(!a.value)return 1;const e=a.value.split("\n").length;return Math.min(Math.max(e,1),10)});(0,o.wB)(a,()=>{u.value=y.value});const w=(e,t="text",s="")=>{i.value.push({type:t,content:e,class:s,timestamp:Date.now()}),(0,o.dY)(()=>{$()})},k=(e,t,s="repl-input")=>{const n=t.includes("\n")&&""!==t.trim()||t.trim().match(/^(def|class|if|for|while|with|try|except|finally)\s/)&&t.trim().endsWith(":");i.value.push({type:s,prompt:e,content:t,timestamp:Date.now(),multiline:n}),(0,o.dY)(()=>{$()})},b=e=>{i.value.push({type:"figure",data:e,timestamp:Date.now()}),(0,o.dY)(()=>{$()})},I=e=>{const t=e||"Program waiting for input:";n.value=t,s.value=!0,w(e||"Program waiting for input:","input-prompt"),(0,o.dY)(()=>{f.value&&f.value.focus()})},S=()=>{d.value=!0,s.value=!1,c.value=">>> ",a.value="",p.value=-1,(0,o.dY)(()=>{setTimeout(()=>{g.value?.cminstance?(g.value.cminstance.refresh(),g.value.cminstance.focus()):f.value&&f.value.focus()},100)})},P=()=>{d.value=!1,c.value=">>> ",a.value="",h.value=[],p.value=-1},C=e=>{d.value?"Enter"!==e.key||e.shiftKey?"Enter"===e.key&&e.shiftKey?c.value="... ":"ArrowUp"===e.key?(e.preventDefault(),F("up")):"ArrowDown"===e.key&&(e.preventDefault(),F("down")):(e.preventDefault(),L()):"Enter"!==e.key||e.shiftKey?"Escape"===e.key&&(e.preventDefault(),R()):(e.preventDefault(),E())},L=()=>{const i=d.value&&g.value?.cminstance?.getValue()||a.value;if(!i.trim())return k(c.value,"","repl-input"),void(c.value=">>> ");i.trim()&&(h.value.push(i),p.value=h.value.length),k(c.value,i,"repl-input"),t("send-input",{programId:e.item.id,input:i,isRepl:!0}),d.value&&g.value?.cminstance&&(g.value.cminstance.setValue(""),(0,o.dY)(()=>{g.value.cminstance.refresh(),g.value.cminstance.focus()})),a.value="",c.value=">>> ",u.value=1},F=e=>{if(0!==h.value.length)if("up"===e){p.value>0?p.value--:-1!==p.value&&p.value!==h.value.length||(p.value=h.value.length-1);const e=h.value[p.value]||"";if(d.value&&g.value?.cminstance){g.value.cminstance.setValue(e);const t=g.value.cminstance.getDoc(),i=t.lastLine(),o=t.getLine(i).length;t.setCursor(i,o)}else a.value=e}else if("down"===e)if(p.value<h.value.length-1){p.value++;const e=h.value[p.value]||"";if(d.value&&g.value?.cminstance){g.value.cminstance.setValue(e);const t=g.value.cminstance.getDoc(),i=t.lastLine(),o=t.getLine(i).length;t.setCursor(i,o)}else a.value=e}else p.value=h.value.length,d.value&&g.value?.cminstance?g.value.cminstance.setValue(""):a.value=""},E=()=>{if(!a.value.trim()&&!s.value)return;const i=a.value;w(i,"user-input"),a.value="",s.value=!1,n.value="",u.value=1,t("send-input",{programId:e.item.id,input:i,isRepl:!1})},R=()=>{a.value="",s.value=!1,n.value="",u.value=1,t("send-input",{programId:e.item.id,input:"",isRepl:!1})},x=()=>{i.value=[],l.value=null,d.value||(h.value=[],p.value=-1),Ce.nk.success("Console cleared")},D=()=>{d.value&&P(),t("stop-item",e.item.id)},$=()=>{m.value&&(m.value.scrollTop=m.value.scrollHeight)},T=e=>{const t=document.createElement("a");t.href=`data:image/png;base64,${e}`,t.download=`figure_${Date.now()}.png`,t.click()},j=e=>{const t=`data:image/png;base64,${e}`;window.open(t,"_blank")},N=()=>{const e=i.value.map(e=>"text"===e.type||"error"===e.type||"system"===e.type?e.content:"input-prompt"===e.type?`Prompt: ${e.content}`:"user-input"===e.type?`> ${e.content}`:"repl-input"===e.type?`${e.prompt}${e.content}`:"repl-output"===e.type?e.content:"").join("\n"),t=new Blob([e],{type:"text/plain"}),o=URL.createObjectURL(t),s=document.createElement("a");s.href=o,s.download=`console_output_${Date.now()}.txt`,s.click(),URL.revokeObjectURL(o),Ce.nk.success("Output exported")},M=e=>{0===e.code?e.data&&void 0!==e.data.stdout&&w(e.data.stdout,"text"):1===e.code?e.data&&e.data.stdout&&w(e.data.stdout,"error"):2e3===e.code?e.data&&void 0!==e.data.prompt&&I(e.data.prompt):3e3===e.code?e.data&&e.data.figure&&b(e.data.figure):4e3===e.code?e.data&&e.data.error&&(l.value=1):5e3===e.code&&e.data&&"repl"===e.data.mode&&S()};return(0,o.wB)(()=>e.item.resultList,e=>{if(e&&e.length>0){const t=e[e.length-1];M(t)}},{deep:!0}),(0,o.wB)(()=>e.item.run,t=>{t?(r.value=e.item.name||"program",l.value=null):d.value&&P()}),{outputLines:i,waitingForInput:s,currentPrompt:n,userInput:a,lastExitCode:l,currentProgram:r,isReplMode:d,replPrompt:c,inputRows:u,consoleOutput:m,inputField:f,replEditor:g,replCodeMirrorOptions:v,executeReplCommand:L,handleKeyDown:C,sendInput:E,cancelInput:R,clearConsole:x,stopProgram:D,exportOutput:N,downloadFigure:T,openFigureInNewTab:j}}});const zn=(0,b.A)(Un,[["render",Mn],["__scopeId","data-v-51b3f28c"]]);var Vn=zn,Bn=i(45572),Xn=i(22532),Hn=i(14188);function Kn(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}var Gn=Kn,Qn=i(66318);function qn(e,t,i){var o=-1,s=e.length;t<0&&(t=-t>s?0:s+t),i=i>s?s:i,i<0&&(i+=s),s=t>i?0:i-t>>>0,t>>>=0;var n=Array(s);while(++o<s)n[o]=e[o+t];return n}var Jn=qn;function Yn(e,t){return t.length<2?e:(0,Qn.A)(e,Jn(t,0,-1))}var Zn=Yn,ea=i(30901);function ta(e,t){return t=(0,Hn.A)(t,e),e=Zn(e,t),null==e||delete e[(0,ea.A)(Gn(t))]}var ia=ta,oa=i(22031),sa=i(34963);function na(e){return(0,sa.A)(e)?void 0:e}var aa=na,la=i(9036),ra=i(83973),da=1,ca=2,ha=4,pa=(0,la.A)(function(e,t){var i={};if(null==e)return i;var o=!1;t=(0,Bn.A)(t,function(t){return t=(0,Hn.A)(t,e),o||(o=t.length>1),t}),(0,oa.A)(e,(0,ra.A)(e),i),o&&(i=(0,Xn.A)(i,da|ca|ha,aa));var s=t.length;while(s--)ia(i,t[s]);return i}),ua=pa,ma=i(91361),fa=i(48548);const ga=Symbol("tabsRootContextKey");var va=i(97786),ya=i(50819),wa=i(51254);const ka=(0,ya.b_)({tabs:{type:(0,ya.jq)(Array),default:()=>(0,wa.f)([])},tabRefs:{type:(0,ya.jq)(Object),default:()=>(0,wa.f)({})}});var ba=i(78396),Ia=i(69527),Sa=i(41651),Pa=i(65980),Ca=i(2154);const La="ElTabBar",Fa=(0,o.pM)({name:La}),Ea=(0,o.pM)({...Fa,props:ka,setup(e,{expose:t}){const i=e,s=(0,o.WQ)(ga);s||(0,Sa.$)(La,"<el-tabs><el-tab-bar /></el-tabs>");const a=(0,Pa.DU)("tabs"),l=(0,_n.KR)(),r=(0,_n.KR)(),d=()=>{let e=0,t=0;const o=["top","bottom"].includes(s.props.tabPosition)?"width":"height",n="width"===o?"x":"y",a="x"===n?"left":"top";return i.tabs.every(s=>{if((0,Ca.b0)(s.paneName))return!1;const n=i.tabRefs[s.paneName];if(!n)return!1;if(!s.active)return!0;e=n[`offset${(0,Ia.ZH)(a)}`],t=n[`client${(0,Ia.ZH)(o)}`];const l=window.getComputedStyle(n);return"width"===o&&(t-=Number.parseFloat(l.paddingLeft)+Number.parseFloat(l.paddingRight),e+=Number.parseFloat(l.paddingLeft)),!1}),{[o]:`${t}px`,transform:`translate${(0,Ia.ZH)(n)}(${e}px)`}},c=()=>r.value=d(),h=[],p=()=>{h.forEach(e=>e.stop()),h.length=0,Object.values(i.tabRefs).forEach(e=>{h.push((0,va.wYm)(e,c))})};(0,o.wB)(()=>i.tabs,async()=>{await(0,o.dY)(),c(),p()},{immediate:!0});const u=(0,va.wYm)(l,()=>c());return(0,o.xo)(()=>{h.forEach(e=>e.stop()),h.length=0,u.stop()}),t({ref:l,update:c}),(e,t)=>((0,o.uX)(),(0,o.CE)("div",{ref_key:"barRef",ref:l,class:(0,n.C4)([(0,_n.R1)(a).e("active-bar"),(0,_n.R1)(a).is((0,_n.R1)(s).props.tabPosition)]),style:(0,n.Tr)(r.value)},null,6))}});var Ra=(0,ba.A)(Ea,[["__file","tab-bar.vue"]]),xa=i(53344);const Da=(0,ya.b_)({panes:{type:(0,ya.jq)(Array),default:()=>(0,wa.f)([])},currentName:{type:[String,Number],default:""},editable:Boolean,type:{type:String,values:["card","border-card",""],default:""},stretch:Boolean}),$a={tabClick:(e,t,i)=>i instanceof Event,tabRemove:(e,t)=>t instanceof Event},Ta="ElTabNav",ja=(0,o.pM)({name:Ta,props:Da,emits:$a,setup(e,{expose:t,emit:i}){const s=(0,o.WQ)(ga);s||(0,Sa.$)(Ta,"<el-tabs><tab-nav /></el-tabs>");const n=(0,Pa.DU)("tabs"),a=(0,va.fho)(),l=(0,va.esz)(),r=(0,_n.KR)(),d=(0,_n.KR)(),c=(0,_n.KR)(),h=(0,_n.KR)({}),p=(0,_n.KR)(),u=(0,_n.KR)(!1),m=(0,_n.KR)(0),f=(0,_n.KR)(!1),g=(0,_n.KR)(!0),v=(0,_n.IJ)(),y=(0,o.EW)(()=>["top","bottom"].includes(s.props.tabPosition)?"width":"height"),w=(0,o.EW)(()=>{const e="width"===y.value?"X":"Y";return{transform:`translate${e}(-${m.value}px)`}}),k=()=>{if(!r.value)return;const e=r.value[`offset${(0,Ia.ZH)(y.value)}`],t=m.value;if(!t)return;const i=t>e?t-e:0;m.value=i},b=()=>{if(!r.value||!d.value)return;const e=d.value[`offset${(0,Ia.ZH)(y.value)}`],t=r.value[`offset${(0,Ia.ZH)(y.value)}`],i=m.value;if(e-i<=t)return;const o=e-i>2*t?i+t:e-t;m.value=o},I=async()=>{const t=d.value;if(!u.value||!c.value||!r.value||!t)return;await(0,o.dY)();const i=h.value[e.currentName];if(!i)return;const n=r.value,a=["top","bottom"].includes(s.props.tabPosition),l=i.getBoundingClientRect(),p=n.getBoundingClientRect(),f=a?t.offsetWidth-p.width:t.offsetHeight-p.height,g=m.value;let v=g;a?(l.left<p.left&&(v=g-(p.left-l.left)),l.right>p.right&&(v=g+l.right-p.right)):(l.top<p.top&&(v=g-(p.top-l.top)),l.bottom>p.bottom&&(v=g+(l.bottom-p.bottom))),v=Math.max(v,0),m.value=Math.min(v,f)},S=()=>{var t;if(!d.value||!r.value)return;e.stretch&&(null==(t=p.value)||t.update());const i=d.value[`offset${(0,Ia.ZH)(y.value)}`],o=r.value[`offset${(0,Ia.ZH)(y.value)}`],s=m.value;o<i?(u.value=u.value||{},u.value.prev=s,u.value.next=s+o<i,i-s<o&&(m.value=i-o)):(u.value=!1,s>0&&(m.value=0))},P=e=>{let t=0;switch(e.code){case xa.R.left:case xa.R.up:t=-1;break;case xa.R.right:case xa.R.down:t=1;break;default:return}const i=Array.from(e.currentTarget.querySelectorAll("[role=tab]:not(.is-disabled)")),o=i.indexOf(e.target);let s=o+t;s<0?s=i.length-1:s>=i.length&&(s=0),i[s].focus({preventScroll:!0}),i[s].click(),C()},C=()=>{g.value&&(f.value=!0)},L=()=>f.value=!1,F=(e,t)=>{h.value[t]=e},E=async()=>{await(0,o.dY)();const t=h.value[e.currentName];null==t||t.focus({preventScroll:!0})};return(0,o.wB)(a,e=>{"hidden"===e?g.value=!1:"visible"===e&&setTimeout(()=>g.value=!0,50)}),(0,o.wB)(l,e=>{e?setTimeout(()=>g.value=!0,50):g.value=!1}),(0,va.wYm)(c,S),(0,o.sV)(()=>setTimeout(()=>I(),0)),(0,o.$u)(()=>S()),t({scrollToActiveTab:I,removeFocus:L,focusActiveTab:E,tabListRef:d,tabBarRef:p,scheduleRender:()=>(0,_n.mu)(v)}),()=>{const t=u.value?[(0,o.bF)("span",{class:[n.e("nav-prev"),n.is("disabled",!u.value.prev)],onClick:k},[(0,o.bF)(ma.tk,null,{default:()=>[(0,o.bF)(fa.nkM,null,null)]})]),(0,o.bF)("span",{class:[n.e("nav-next"),n.is("disabled",!u.value.next)],onClick:b},[(0,o.bF)(ma.tk,null,{default:()=>[(0,o.bF)(fa.Qpb,null,null)]})])]:null,a=e.panes.map((t,a)=>{var l,r,d,c;const h=t.uid,p=t.props.disabled,u=null!=(r=null!=(l=t.props.name)?l:t.index)?r:`${a}`,m=!p&&(t.isClosable||e.editable);t.index=`${a}`;const g=m?(0,o.bF)(ma.tk,{class:"is-icon-close",onClick:e=>i("tabRemove",t,e)},{default:()=>[(0,o.bF)(fa.bm,null,null)]}):null,v=(null==(c=(d=t.slots).label)?void 0:c.call(d))||t.props.label,y=!p&&t.active?0:-1;return(0,o.bF)("div",{ref:e=>F(e,u),class:[n.e("item"),n.is(s.props.tabPosition),n.is("active",t.active),n.is("disabled",p),n.is("closable",m),n.is("focus",f.value)],id:`tab-${u}`,key:`tab-${h}`,"aria-controls":`pane-${u}`,role:"tab","aria-selected":t.active,tabindex:y,onFocus:()=>C(),onBlur:()=>L(),onClick:e=>{L(),i("tabClick",t,u,e)},onKeydown:e=>{!m||e.code!==xa.R.delete&&e.code!==xa.R.backspace||i("tabRemove",t,e)}},[v,g])});return v.value,(0,o.bF)("div",{ref:c,class:[n.e("nav-wrap"),n.is("scrollable",!!u.value),n.is(s.props.tabPosition)]},[t,(0,o.bF)("div",{class:n.e("nav-scroll"),ref:r},[e.panes.length>0?(0,o.bF)("div",{class:[n.e("nav"),n.is(s.props.tabPosition),n.is("stretch",e.stretch&&["top","bottom"].includes(s.props.tabPosition))],ref:d,style:w.value,role:"tablist",onKeydown:P},[e.type?null:(0,o.bF)(Ra,{ref:p,tabs:[...e.panes],tabRefs:h.value},null),a]):null])])}}});var Na=i(31069),Ma=i(51338);const _a=(e,t,i)=>{const s=(0,Ma.CW)(e.subTree).filter(e=>{var i;return(0,o.vv)(e)&&(null==(i=e.type)?void 0:i.name)===t&&!!e.component}),n=s.map(e=>e.component.uid);return n.map(e=>i[e]).filter(e=>!!e)},Aa=(e,t)=>{const i=(0,_n.IJ)({}),s=(0,_n.IJ)([]),n=new WeakMap,a=e=>{i.value[e.uid]=e,(0,_n.mu)(i),(0,o.sV)(()=>{const t=e.getVnode().el,o=t.parentNode;if(!n.has(o)){n.set(o,[]);const e=o.insertBefore.bind(o);o.insertBefore=(t,s)=>{const a=n.get(o).some(e=>t===e||s===e);return a&&(0,_n.mu)(i),e(t,s)}}n.get(o).push(t)})},l=e=>{delete i.value[e.uid],(0,_n.mu)(i);const t=e.getVnode().el,o=t.parentNode,s=n.get(o),a=s.indexOf(t);s.splice(a,1)},r=()=>{s.value=_a(e,t,i.value)},d=e=>e.render(),c=(0,o.pM)({setup(e,{slots:t}){return()=>(r(),t.default?(0,o.h)(d,{render:t.default}):null)}});return{children:s,addChild:a,removeChild:l,ChildrenSorter:c}},Wa=(0,ya.b_)({type:{type:String,values:["card","border-card",""],default:""},closable:Boolean,addable:Boolean,modelValue:{type:[String,Number]},editable:Boolean,tabPosition:{type:String,values:["top","right","bottom","left"],default:"top"},beforeLeave:{type:(0,ya.jq)(Function),default:()=>!0},stretch:Boolean}),Oa=e=>(0,n.Kg)(e)||(0,Ca.Et)(e),Ua={[Na.l4]:e=>Oa(e),tabClick:(e,t)=>t instanceof Event,tabChange:e=>Oa(e),edit:(e,t)=>["remove","add"].includes(t),tabRemove:e=>Oa(e),tabAdd:()=>!0},za=(0,o.pM)({name:"ElTabs",props:Wa,emits:Ua,setup(e,{emit:t,slots:i,expose:s}){var n;const a=(0,Pa.DU)("tabs"),l=(0,o.EW)(()=>["left","right"].includes(e.tabPosition)),{children:r,addChild:d,removeChild:c,ChildrenSorter:h}=Aa((0,o.nI)(),"ElTabPane"),p=(0,_n.KR)(),u=(0,_n.KR)(null!=(n=e.modelValue)?n:"0"),m=async(i,o=!1)=>{var s,n,a,l;if(u.value!==i&&!(0,Ca.b0)(i))try{let d;if(e.beforeLeave){const t=e.beforeLeave(i,u.value);d=t instanceof Promise?await t:t}else d=!0;if(!1!==d){const e=null==(s=r.value.find(e=>e.paneName===u.value))?void 0:s.isFocusInsidePane();u.value=i,o&&(t(Na.l4,i),t("tabChange",i)),null==(a=null==(n=p.value)?void 0:n.removeFocus)||a.call(n),e&&(null==(l=p.value)||l.focusActiveTab())}}catch(d){}},f=(e,i,o)=>{e.props.disabled||(t("tabClick",e,o),m(i,!0))},g=(e,i)=>{e.props.disabled||(0,Ca.b0)(e.props.name)||(i.stopPropagation(),t("edit",e.props.name,"remove"),t("tabRemove",e.props.name))},v=()=>{t("edit",void 0,"add"),t("tabAdd")},y=t=>{const i=t.el.firstChild,o=["bottom","right"].includes(e.tabPosition)?t.children[0].el:t.children[1].el;i!==o&&i.before(o)};return(0,o.wB)(()=>e.modelValue,e=>m(e)),(0,o.wB)(u,async()=>{var e;await(0,o.dY)(),null==(e=p.value)||e.scrollToActiveTab()}),(0,o.Gt)(ga,{props:e,currentName:u,registerPane:d,unregisterPane:c,nav$:p}),s({currentName:u,get tabNavRef(){return ua(p.value,["scheduleRender"])}}),()=>{const t=i["add-icon"],s=e.editable||e.addable?(0,o.bF)("div",{class:[a.e("new-tab"),l.value&&a.e("new-tab-vertical")],tabindex:"0",onClick:v,onKeydown:e=>{[xa.R.enter,xa.R.numpadEnter].includes(e.code)&&v()}},[t?(0,o.RG)(i,"add-icon"):(0,o.bF)(ma.tk,{class:a.is("icon-plus")},{default:()=>[(0,o.bF)(fa.FWt,null,null)]})]):null,n=()=>(0,o.bF)(ja,{ref:p,currentName:u.value,editable:e.editable,type:e.type,panes:r.value,stretch:e.stretch,onTabClick:f,onTabRemove:g},null),d=(0,o.bF)("div",{class:[a.e("header"),l.value&&a.e("header-vertical"),a.is(e.tabPosition)]},[(0,o.bF)(h,null,{default:n,$stable:!0}),s]),c=(0,o.bF)("div",{class:a.e("content")},[(0,o.RG)(i,"default")]);return(0,o.bF)("div",{class:[a.b(),a.m(e.tabPosition),{[a.m("card")]:"card"===e.type,[a.m("border-card")]:"border-card"===e.type}],onVnodeMounted:y,onVnodeUpdated:y},[c,d])}}});var Va=za,Ba=i(52307);const Xa=(0,ya.b_)({label:{type:String,default:""},name:{type:[String,Number]},closable:Boolean,disabled:Boolean,lazy:Boolean}),Ha="ElTabPane",Ka=(0,o.pM)({name:Ha}),Ga=(0,o.pM)({...Ka,props:Xa,setup(e){const t=e,i=(0,o.nI)(),a=(0,o.Ht)(),l=(0,o.WQ)(ga);l||(0,Sa.$)(Ha,"usage: <el-tabs><el-tab-pane /></el-tabs/>");const r=(0,Pa.DU)("tab-pane"),d=(0,_n.KR)(),c=(0,_n.KR)(),h=(0,o.EW)(()=>t.closable||l.props.closable),p=(0,Ba.uA)(()=>{var e;return l.currentName.value===(null!=(e=t.name)?e:c.value)}),u=(0,_n.KR)(p.value),m=(0,o.EW)(()=>{var e;return null!=(e=t.name)?e:c.value}),f=(0,Ba.uA)(()=>!t.lazy||u.value||p.value),g=()=>{var e;return null==(e=d.value)?void 0:e.contains(document.activeElement)};(0,o.wB)(p,e=>{e&&(u.value=!0)});const v=(0,_n.Kh)({uid:i.uid,getVnode:()=>i.vnode,slots:a,props:t,paneName:m,active:p,index:c,isClosable:h,isFocusInsidePane:g});return l.registerPane(v),(0,o.xo)(()=>{l.unregisterPane(v)}),(0,o.Ic)(()=>{var e;a.label&&(null==(e=l.nav$.value)||e.scheduleRender())}),(e,t)=>(0,_n.R1)(f)?(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",{key:0,id:`pane-${(0,_n.R1)(m)}`,ref_key:"paneRef",ref:d,class:(0,n.C4)((0,_n.R1)(r).b()),role:"tabpanel","aria-hidden":!(0,_n.R1)(p),"aria-labelledby":`tab-${(0,_n.R1)(m)}`},[(0,o.RG)(e.$slots,"default")],10,["id","aria-hidden","aria-labelledby"])),[[s.aG,(0,_n.R1)(p)]]):(0,o.Q3)("v-if",!0)}});var Qa=(0,ba.A)(Ga,[["__file","tab-pane.vue"]]),qa=i(64769);const Ja=(0,qa.GU)(Va,{TabPane:Qa}),Ya=(0,qa.WM)(Qa),Za={class:"noselected console-tabs"},el=["src"],tl={class:"node-label"};function il(e,t,i,s,a,l){const r=Ya,d=Ja;return(0,o.uX)(),(0,o.CE)("div",Za,[(0,o.bF)(d,{modelValue:l.pathSelected,"onUpdate:modelValue":t[0]||(t[0]=e=>l.pathSelected=e),type:"card",closable:"",onTabRemove:l.removeTab,onTabClick:l.selectTab},{default:(0,o.k6)(()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.consoleItems,e=>((0,o.uX)(),(0,o.Wv)(r,{key:e.path+"-|-"+e.id,label:e.name,name:e.path+"-|-"+e.id},{label:(0,o.k6)(()=>[(0,o.Lk)("img",{src:l.getIconUrl(e.path),alt:"",class:"node-icon"},null,8,el),(0,o.Lk)("span",tl,(0,n.v_)(l.getItemPath(e)),1)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue","onTabRemove","onTabClick"])])}var ol={data(){return{}},mounted(){},methods:{getItemPath(e){return this.ideInfo.consoleSelected.path!==e.path||this.ideInfo.consoleSelected.id!==e.id||"Terminal"===this.ideInfo.consoleSelected.name&&"Terminal"===this.ideInfo.consoleSelected.path?e.name:"/"+this.ideInfo.currProj.data.name+e.path},getIconUrl(e){return i(80238)(`./${(0,U.ry)(e.substring(e.lastIndexOf(".")+1))}`)},getItem(e){if(!e)return;const t=e.split("-|-");t[1]=Number(t[1]);for(let i=0;i<this.ideInfo.consoleItems.length;i++)if(this.ideInfo.consoleItems[i].path===t[0]&&this.ideInfo.consoleItems[i].id===t[1])return this.ideInfo.consoleItems[i];return""},selectTab(e){},removeTab(e){const t=this.getItem(e);t&&this.$emit("close-item",t)}},watch:{},computed:{ideInfo(){return this.$store.state.ide.ideInfo},consoleItems(){return this.ideInfo.consoleItems},pathSelected:{get(){return this.ideInfo.consoleSelected.path+"-|-"+this.ideInfo.consoleSelected.id},set(e){const t=this.getItem(e);t&&this.$emit("select-item",t)}}},components:{}};const sl=(0,b.A)(ol,[["render",il],["__scopeId","data-v-109efd1e"]]);var nl=sl,al=i(96763);class ll{constructor(){this.isActive=!1,this.lastActivity=Date.now(),this.renewalInProgress=!1,this.activityThreshold=3e4,this.renewalCheckInterval=6e4,this.renewalTimer=null,this.activityEvents=["keydown","keyup","keypress","mousedown","mouseup","mousemove","click","scroll","wheel","touchstart","touchmove","touchend"],this.init()}init(){this.hasValidSession()&&this.startTracking()}hasValidSession(){const e=localStorage.getItem("session_id"),t=localStorage.getItem("username");return!(!e||!t)}startTracking(){this.isActive=!0,this.setupActivityListeners(),this.startRenewalChecker(),al.log(" [SessionManager] Started activity tracking and renewal system")}stopTracking(){this.isActive=!1,this.removeActivityListeners(),this.stopRenewalChecker(),al.log(" [SessionManager] Stopped activity tracking")}setupActivityListeners(){this.activityHandler=this.onActivity.bind(this),this.activityEvents.forEach(e=>{document.addEventListener(e,this.activityHandler,!0)}),this.listenForIDEActivity()}removeActivityListeners(){this.activityEvents.forEach(e=>{document.removeEventListener(e,this.activityHandler,!0)})}listenForIDEActivity(){document.addEventListener("ide:file-save",this.activityHandler),document.addEventListener("ide:code-run",this.activityHandler),document.addEventListener("ide:file-open",this.activityHandler),document.addEventListener("ide:console-input",this.activityHandler)}onActivity(){this.isActive&&(this.lastActivity=Date.now(),!this.renewalInProgress&&this.shouldCheckRenewal()&&this.checkAndRenewSession())}shouldCheckRenewal(){const e=Date.now()-(this.lastRenewalAttempt||0);return e>this.activityThreshold}startRenewalChecker(){this.renewalTimer=setInterval(()=>{this.isActive&&this.hasRecentActivity()&&this.checkAndRenewSession()},this.renewalCheckInterval)}stopRenewalChecker(){this.renewalTimer&&(clearInterval(this.renewalTimer),this.renewalTimer=null)}hasRecentActivity(){const e=Date.now()-this.lastActivity;return e<this.activityThreshold}async checkAndRenewSession(){if(!this.renewalInProgress&&this.hasValidSession())try{this.renewalInProgress=!0,this.lastRenewalAttempt=Date.now();const e=localStorage.getItem("session_id");al.log(" [SessionManager] Renewing session due to activity...");const t=await fetch("/api/renew-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:e})}),i=await t.json();i.success?(localStorage.setItem("session_expires_at",i.expires_at),al.log(" [SessionManager] Session renewed until:",new Date(i.expires_at).toLocaleString())):(al.warn(" [SessionManager] Session renewal failed:",i.error),this.handleRenewalFailure(i.error))}catch(Sa){al.error(" [SessionManager] Session renewal error:",Sa),this.handleRenewalFailure(Sa.message)}finally{this.renewalInProgress=!1}}handleRenewalFailure(e){(e.includes("Invalid session")||e.includes("expired"))&&(al.log(" [SessionManager] Session expired, will need re-authentication"),localStorage.removeItem("session_id"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("full_name"),localStorage.removeItem("session_expires_at"),this.stopTracking())}async renewSession(){return await this.checkAndRenewSession()}getSessionInfo(){if(!this.hasValidSession())return null;const e=localStorage.getItem("session_expires_at"),t=new Date,i=e?new Date(e):null;return{username:localStorage.getItem("username"),role:localStorage.getItem("role"),expiresAt:i,timeLeft:i?i-t:null,isNearExpiry:!!i&&i-t<72e5}}static emitIDEActivity(e,t={}){const i=new CustomEvent(`ide:${e}`,{detail:t});document.dispatchEvent(i)}}const rl=new ll;var dl=rl;"undefined"!==typeof window&&(window.sessionManager=rl);var cl=i(96763);const hl={data(){return{replMode:"auto",pyodideNamespace:null,pyodideInitialized:!1}},methods:{async startDualModeReplSession(){this.replSessionId=Date.now().toString(),cl.log(" [REPL] Starting dual-mode REPL session:",this.replSessionId),cl.log(" [REPL] Current state:",{wsInfo:this.wsInfo,wsConnected:this.wsInfo?.connected,wsReadyState:this.wsInfo?.rws?.readyState,replMode:this.replMode,pyodideReady:this.pyodideReady,pyodideInitialized:this.pyodideInitialized}),this.ensureReplConsole();const e=this.wsInfo&&this.wsInfo.connected,t="backend"===this.replMode||"auto"===this.replMode&&e;cl.log(" [REPL] Mode detection:",{backendAvailable:e,preferBackend:t,replMode:this.replMode}),t&&e?(cl.log(" [REPL] Using backend mode"),await this.startBackendRepl()):(cl.log(" [REPL] Using Pyodide browser mode"),await this.startPyodideRepl())},async startBackendRepl(){cl.log(" [REPL] Starting backend REPL...");try{const e={cmd:"start_python_repl",id:this.replSessionId,data:{projectName:this.ideInfo.currProj?.data?.name||"repl"}};if(cl.log(" [REPL] Sending start message:",e),cl.log(" [REPL] WebSocket state:",{rws:this.wsInfo.rws,readyState:this.wsInfo.rws?.readyState,OPEN:WebSocket.OPEN}),!this.wsInfo.rws||this.wsInfo.rws.readyState!==WebSocket.OPEN)throw new Error(`WebSocket not connected: readyState=${this.wsInfo.rws?.readyState}`);this.wsInfo.rws.send(JSON.stringify(e)),cl.log(" [REPL] Start message sent successfully")}catch(Sa){cl.error(" [REPL] Backend REPL failed:",Sa),this.addReplOutput("Backend connection lost. Reconnecting...","system"),setTimeout(async()=>{this.wsInfo?.rws?.readyState===WebSocket.OPEN?(cl.log(" [REPL] Retrying backend REPL after reconnection"),await this.startBackendRepl()):(cl.log(" [REPL] Backend still unavailable, switching to browser mode"),this.addReplOutput("Backend unavailable, switching to browser mode...","error"),await this.startPyodideRepl())},2e3)}},async startPyodideRepl(){cl.log(" [REPL] Starting Pyodide REPL, current state:",{pyodideReady:this.pyodideReady,pyodideInitialized:this.pyodideInitialized}),this.pyodideReady||(cl.log(" [REPL] Pyodide not ready, initializing..."),await this.initializePyodideForRepl()),this.pyodideReady?cl.log(" [REPL] Pyodide ready for use"):(cl.log(" [REPL] Failed to initialize Pyodide"),this.addReplOutput("Failed to initialize browser Python","error"),this.isReplMode=!1)},async initializePyodideForRepl(){if(cl.log(" [REPL] initializePyodideForRepl called, state:",{pyodideLoading:this.pyodideLoading,pyodideReady:this.pyodideReady,loadPyodideAvailable:typeof window.loadPyodide}),this.pyodideLoading||this.pyodideReady)cl.log(" [REPL] Pyodide already loading or ready, skipping");else{this.pyodideLoading=!0;try{if("function"!==typeof window.loadPyodide)throw new Error("Pyodide not available. Please check internet connection.");cl.log(" [REPL] Loading Pyodide from CDN..."),this.pyodide=await window.loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.24.1/full/"}),this.pyodideNamespace=this.pyodide.globals.get("dict")(),await this.pyodide.runPythonAsync("\n          import sys\n          import io\n          import builtins\n          \n          # Store the version\n          python_version = sys.version\n          \n          # Setup for REPL\n          _ = None\n        "),this.pyodideReady=!0,this.pyodideLoading=!1,this.pyodideInitialized=!0,cl.log(" [REPL] Pyodide REPL ready!",{pyodide:this.pyodide,namespace:this.pyodideNamespace})}catch(Sa){cl.error(" [REPL] Pyodide initialization failed:",Sa),this.pyodideLoading=!1,this.pyodideReady=!1,this.addReplOutput(`Error: ${Sa.message}`,"error")}}},async executeReplCommandDualMode(e){if(cl.log(" [REPL] executeReplCommandDualMode called with:",e),!e.trim())return cl.log(" [REPL] Empty command, handling continuation mode"),void(this.replContinuationMode&&(this.replContinuationMode=!1,this.replPrompt=">>> "));this.replHistory[this.replHistory.length-1]!==e&&this.replHistory.push(e),this.replHistoryIndex=-1,this.replInput="",this.replInputRows=1,this.ideInfo.consoleSelected&&this.ideInfo.consoleSelected.id&&this.$store.commit("ide/addConsoleOutput",{id:this.ideInfo.consoleSelected.id,type:"repl-input",text:e,prompt:this.replPrompt});const t=this.wsInfo?.connected&&this.replSessionId&&"pyodide"!==this.replMode;cl.log(" [REPL] Execution mode check:",{wsConnected:this.wsInfo?.connected,replSessionId:this.replSessionId,replMode:this.replMode,useBackend:t,pyodideReady:this.pyodideReady}),t?(cl.log(" [REPL] Executing via backend"),await this.executeBackendCommand(e)):this.pyodideReady?(cl.log(" [REPL] Executing via Pyodide"),await this.executePyodideCommand(e)):(cl.log(" [REPL] No environment ready, initializing Pyodide..."),await this.startPyodideRepl(),this.pyodideReady?await this.executePyodideCommand(e):this.addReplOutput("No Python environment available","error"))},async executeBackendCommand(e){cl.log(" [REPL] executeBackendCommand called with:",e);try{const t={cmd:"send_program_input",id:Date.now().toString(),data:{program_id:this.replSessionId,input:e}};if(cl.log(" [REPL] Sending command message:",t),!this.wsInfo.rws||this.wsInfo.rws.readyState!==WebSocket.OPEN)throw new Error(`WebSocket disconnected: readyState=${this.wsInfo.rws?.readyState}`);this.wsInfo.rws.send(JSON.stringify(t)),cl.log(" [REPL] Command sent to backend")}catch(Sa){cl.error(" [REPL] Backend execution failed:",Sa),this.addReplOutput("Backend connection lost. Please restart REPL if needed.","system"),cl.log(" [REPL] Keeping backend mode, user can manually restart if needed")}},async executePyodideCommand(e){if(this.pyodideReady&&this.pyodide){try{await this.pyodide.runPythonAsync("\n          import sys\n          from io import StringIO\n          _stdout = StringIO()\n          _stderr = StringIO()\n          _old_stdout = sys.stdout\n          _old_stderr = sys.stderr\n          sys.stdout = _stdout\n          sys.stderr = _stderr\n        ");let i=null,o=null;try{i=await this.pyodide.runPythonAsync(e,{globals:this.pyodideNamespace}),void 0!==i&&null!==i&&await this.pyodide.runPythonAsync("_ = _result",{globals:{...this.pyodideNamespace.toJs(),_result:i}})}catch(Sa){o=Sa}const s=await this.pyodide.runPythonAsync("\n          sys.stdout = _old_stdout\n          sys.stderr = _old_stderr\n          stdout_val = _stdout.getvalue()\n          stderr_val = _stderr.getvalue()\n          _stdout.close()\n          _stderr.close()\n          (stdout_val, stderr_val)\n        ");if(s[0]&&this.addReplOutput(s[0],"output"),s[1]&&this.addReplOutput(s[1],"error"),o)this.addReplOutput(String(o),"error");else if(void 0!==i&&null!==i){const e=this.pyodide.globals.get("None");if(i!==e)try{const e=await this.pyodide.runPythonAsync("repr(_last_val)",{globals:{...this.pyodideNamespace.toJs(),_last_val:i}});e&&"None"!==e&&this.addReplOutput(e,"output")}catch(t){const e=String(i);e&&"[object Object]"!==e&&this.addReplOutput(e,"output")}}this.replContinuationMode=!1,this.replPrompt=">>> "}catch(Sa){cl.error("Pyodide execution error:",Sa),this.addReplOutput(`Error: ${Sa.message}`,"error")}this.$nextTick(()=>{this.$refs.consoleOutputArea&&(this.$refs.consoleOutputArea.scrollTop=this.$refs.consoleOutputArea.scrollHeight)})}else this.addReplOutput("Browser Python not ready","error")},handleBackendReplResponse(e){if(cl.log(" [REPL] Backend response received:",{code:e?.code,hasData:!!e?.data,dataKeys:e?.data?Object.keys(e.data):[],fullMessage:e}),e){if(0===e.code||"0"===e.code){if(e.data){if(e.data.stdout){const t=e.data.stdout,i=t.match(/^(>>>|\.\.\.)\s*$/)||t.match(/^(>>>|\.\.\.)\s*\n*$/)||">>>"===t.trim()||"..."===t.trim()||""===t.trim()||">>> "===t||"... "===t||t.match(/^\s*>>>\s*$/)||t.match(/^\s*\.\.\.\s*$/)||t.match(/^>>>\s*\n*$/)||t.match(/^\.\.\.\s*\n*$/);i||""===t.trim()||this.addReplOutput(t,"output")}e.data.stderr&&this.addReplOutput(e.data.stderr,"error")}}else 2e3===e.code?"repl_prompt"===e.data?.type?(this.replPrompt=">>> ",this.replContinuationMode=!1):e.data?.stdout&&this.addReplOutput(e.data.stdout,"output"):1111===e.code&&(this.addReplOutput("Backend session ended","system"),this.replSessionId=null,this.addReplOutput("Switching to browser mode...","system"),this.startPyodideRepl());this.$nextTick(()=>{this.$refs.consoleOutputArea&&(this.$refs.consoleOutputArea.scrollTop=this.$refs.consoleOutputArea.scrollHeight)})}else cl.log(" [REPL] Empty message received")},async stopDualModeReplSession(){if(this.replSessionId&&this.wsInfo?.rws?.readyState===WebSocket.OPEN){const e={cmd:"stop_python_program",id:Date.now().toString(),data:{program_id:this.replSessionId}};this.wsInfo.rws.send(JSON.stringify(e))}this.replSessionId=null,this.isReplMode=!1,this.replPrompt=">>> ",this.replContinuationMode=!1,this.pyodideNamespace&&(this.pyodideNamespace=this.pyodide?.globals.get("dict")())}}};var pl=hl,ul=i(96763);const ml=i(57975);var fl={data(){return{showDeleteDialog:!1,showFileDialog:!1,showProjsDialog:!1,showUploadDialog:!1,showNewFileDialog:!1,showNewFolderDialog:!1,showImportFileDialog:!1,showFileBrowserDialog:!1,showLoginModal:!1,fileBrowserMode:"open",fileToMove:null,showSettingsModal:!1,showKeyboardShortcutsModal:!1,showFindReplaceModal:!1,findReplaceMode:"find",showREPL:!1,isReplMode:!1,replSessionId:null,showCover:!0,showContextMenu:!1,contextMenuPosition:{x:0,y:0},contextMenuTarget:null,windowWidth:window.innerWidth,leftSidebarVisible:!0,dialogType:"",dialogTitle:"",dialogTips:"",dialogText:"",leftSidebarWidth:250,rightSidebarWidth:400,rightSidebarVisible:!1,consoleHeight:200,consoleExpanded:!0,consoleMaximized:!1,previousConsoleHeight:200,rightPanelExpanded:!1,previousRightWidth:400,rightPanelMode:"closed",consoleMode:"collapsed",consolePreviousMode:"normal",wasConsoleOpenBeforeRightExpand:!1,fileConsoleStates:{},activeFilePath:null,rightPanelState:"normal",rightPanelNormalWidth:400,previousConsoleState:{expanded:!0,height:200},editorHeight:"calc(100% - 235px)",minEditorWidth:500,isResizingLeft:!1,isResizingRight:!1,isResizingConsole:!1,startX:0,startY:0,startWidth:0,startHeight:0,resizeWarning:!1,programInput:"",programInputRows:1,wordWrap:!0,replInput:"",replHistory:[],replHistoryIndex:-1,replPrompt:">>> ",replInputRows:1,replContinuationMode:!1,previewTabs:[],selectedPreviewTab:null,previewTabCounter:0,terminalOutput:[],terminalSessionActive:!1,pyodide:null,pyodideLoading:!1,pyodideReady:!1,replMode:"auto",pyodideNamespace:null,pyodideInitialized:!1,wsMessageHandler:null}},mixins:[pl],components:{Splitpanes:qs.S,Pane:qs.Z,TwoHeaderMenu:Xo,CodeTabs:Tt.A,HybridConsole:Vn,ConsoleTabs:nl,ProjTree:Xt.A,IdeEditor:$t.A,LoginModal:S,PythonREPL:P.A,DialogProjs:Rt.A,DialogText:Et.A,DialogDelete:Ft.A,DialogUpload:Lt.A,DialogNewFile:Ct,DialogNewFolder:Ze,DialogImportFile:Re,DialogFileBrowser:X,CsvViewer:xt.A,MediaViewer:Dt.A,SettingsModal:wi.A,KeyboardShortcutsModal:yi,FindReplaceModal:pi,FullscreenPreview:Bt,ChevronLeft:Js.A,ChevronRight:ke.A,ChevronUp:di,ChevronDown:be.A,Minimize2:Ys},created(){},mounted(){this.throttledHandleResizeLeft=this.throttle(this.handleResizeLeft,16),this.throttledHandleResizeRight=this.throttle(this.handleResizeRight,16),this.throttledHandleResizeConsole=this.throttle(this.handleResizeConsole,16),this.initializeAutoSave();const e=localStorage.getItem("session_id"),t=localStorage.getItem("username");if(!e||!t)return ul.log(" [VmIde] No session found, auto-opening login modal..."),void(this.showLoginModal=!0);ul.log(" [VmIde] Found existing session for:",t),ul.log(" [VmIde] Starting session manager for auto-renewal..."),dl.startTracking();try{ul.log(" [VmIde] Initializing WebSocket with authentication..."),this.wsInfo&&this.wsInfo.rws?ul.log(" [VmIde] WebSocket already initialized"):(this.$store.dispatch("websocket/init",{}),ul.log(" [VmIde] WebSocket initialization dispatched"))}catch(Sa){ul.error(" [VmIde] Error initializing WebSocket:",Sa)}this.rightPanelMode="closed",this.consoleMode="collapsed",this.$nextTick(()=>{setTimeout(()=>{try{this.setupWebSocketHandler()}catch(Sa){ul.error("Error in setupWebSocketHandler:",Sa)}},500)}),this.loadLayoutPreferences(),window.addEventListener("resize",this.validateLayout);const i=this;if(e&&t){const e=setInterval(()=>{ul.log(" [VmIde] WebSocket check:",{connected:i.wsInfo.connected,wsInfo:i.wsInfo}),i.wsInfo.connected&&(ul.log(" [VmIde] WebSocket connected, listing projects..."),this.$store.dispatch(`ide/${Pe.qB}`,{callback:t=>{ul.log(" [VmIde] Project list response:",t),clearInterval(e),0==t.code?(ul.log(" [VmIde] Projects found:",t.data),this.$store.commit("ide/handleProjects",t.data),i.loadAllDefaultProjects()):ul.error(" [VmIde] Failed to list projects:",t)}}))},1e3)}window.addEventListener("resize",this.resize),this.$nextTick(()=>{this.applyInitialEditorSettings()})},beforeUnmount(){window.removeEventListener("resize",this.validateLayout),window.removeEventListener("resize",this.resize),this.wsMessageHandler&&(this.wsMessageHandler=null),this.previewTabs.forEach(e=>{"pdf"===e.type&&e.content&&e.content.startsWith("blob:")&&URL.revokeObjectURL(e.content)})},computed:{wsInfo(){return this.$store.getters["websocket/wsInfo"]()},ideInfo(){return this.$store.state.ide.ideInfo},currentUser(){const e=this.$store.state.ide.currentUser;if(e)return e;const t=localStorage.getItem("session_id"),i=localStorage.getItem("username"),o=localStorage.getItem("role"),s=localStorage.getItem("full_name");return t&&i?{session_id:t,username:i,role:o,full_name:s}:null},isMarkdown(){return!!this.ideInfo.codeSelected.path&&this.ideInfo.codeSelected.path.endsWith(".md")},isMediaFile(){if(this.ideInfo.codeSelected.path){const e=[".png",".jpg",".jpeg",".gif",".bmp",".svg",".webp",".pdf"],t=this.ideInfo.codeSelected.path.toLowerCase();return e.some(e=>t.endsWith(e))}return!1},consoleLimit(){let e=0;for(let t=0;t<this.ideInfo.consoleItems.length;t++)!0!==this.ideInfo.consoleItems[t].run||"Terminal"===this.ideInfo.consoleItems[t].name&&"Terminal"===this.ideInfo.consoleItems[t].path||(e+=1);return e>=3},hasRunProgram(){return this.ideInfo.consoleItems.some(e=>e.run)},showConsole(){const e=0!==this.ideInfo.consoleItems.length;return e},leftSidebarSize(){if(this.windowWidth<=900)return 0;let e=20;if(this.windowWidth<=1400&&this.windowWidth>1200){const t=Math.min(250,.2*this.windowWidth);e=t/this.windowWidth*100}else this.windowWidth<=1200&&(e=180/this.windowWidth*100);return this.leftSidebarVisible?e:.1},leftSidebarMinSize(){return this.windowWidth<=900?0:.1},leftSidebarMaxSize(){return this.windowWidth<=900?0:this.windowWidth<=1400&&this.windowWidth>1200?30:40},rightSidebarSize(){if(this.windowWidth<=900)return 0;if(this.windowWidth<=1200)return 0;if(0===this.previewTabs.length)return 0;if("closed"===this.rightPanelMode)return 0;if("expanded"===this.rightPanelMode){const e=this.leftSidebarVisible?20:0;return 100-e-10}return 30},rightSidebarMinSize(){return this.windowWidth<=1200?0:.1},rightSidebarMaxSize(){return this.windowWidth<=900||this.windowWidth<=1200?0:50},centerSize(){if(this.windowWidth<=900)return 100;if(this.windowWidth<=1200){const e=this.leftSidebarVisible?this.windowWidth<=1200?180/this.windowWidth*100:20:0;return 100-e}const e=this.leftSidebarVisible?this.leftSidebarSize:0,t=this.rightSidebarSize;return 0===t?100-e:Math.max(30,100-e-t)},editorPaneSize(){return"maximized"===this.consoleMode?5:"collapsed"===this.consoleMode?95:70},consolePaneSize(){return"maximized"===this.consoleMode?95:"collapsed"===this.consoleMode?5:30}},watch:{"previewTabs.length":function(e,t){0===e&&t>0&&(this.rightPanelMode="closed",this.rightSidebarVisible=!1)},"ideInfo.codeSelected":function(e,t){e&&t&&e.path&&t.path&&e.path!==t.path?this.handleTabChange(e,t):e&&!t&&(this.activeFilePath=e.path,this.loadFileConsoleState(e.path))},"ideInfo.consoleSelected.waitingForInput":function(e){e&&this.$nextTick(()=>{this.$refs.programInputField&&this.$refs.programInputField.focus()})},consoleExpanded(e){e&&this.$nextTick(()=>{this.$refs.consoleOutputArea&&(this.$refs.consoleOutputArea.scrollTop=this.$refs.consoleOutputArea.scrollHeight)})}},methods:{throttle(e,t){let i=0,o=null;const s=this;return function(...n){const a=Date.now();a-i>=t?(e.apply(s,n),i=a):o||(o=requestAnimationFrame(()=>{e.apply(s,n),i=Date.now(),o=null}))}},toggleLeftSidebar(e){this.leftSidebarVisible=e},applyInitialEditorSettings(){const e=localStorage.getItem("fontSize");e&&this.updateFontSize(e);const t=localStorage.getItem("showLineNumbers");null!==t&&this.updateLineNumbers("true"===t)},updateFontSize(e){const t=parseInt(e)+"px",i=document.querySelectorAll(".CodeMirror");i.forEach(e=>{e.CodeMirror&&(e.style.fontSize=t,e.CodeMirror.refresh())});const o=document.getElementById("codemirror-font-size")||document.createElement("style");o.id="codemirror-font-size",o.innerHTML=`.CodeMirror { font-size: ${t} !important; } .CodeMirror pre { font-size: ${t} !important; }`,document.getElementById("codemirror-font-size")||document.head.appendChild(o),localStorage.setItem("fontSize",e),window.dispatchEvent(new CustomEvent("fontSizeChanged"))},updateLineNumbers(e){const t=document.querySelectorAll(".CodeMirror");t.forEach(t=>{t.CodeMirror&&t.CodeMirror.setOption("lineNumbers",e)}),localStorage.setItem("editorLineNumbers",e),this.$store.commit("ide/setEditorOption",{option:"lineNumbers",value:e})},updateWordWrap(e){this.wordWrap=e,this.$store.commit("ide/setEditorOption",{option:"lineWrapping",value:e})},updateAutoSave(e){this.$store.commit("ide/setAutoSave",e),e?this.startAutoSave():this.stopAutoSave()},updateAutoSaveInterval(e){this.$store.commit("ide/setAutoSaveInterval",e),this.$store.state.ide.ideInfo.autoSave&&(this.stopAutoSave(),this.startAutoSave())},updateAutoSaveNotifications(e){this.$store.commit("ide/setAutoSaveNotifications",e)},initializeAutoSave(){const e=localStorage.getItem("autoSave"),t=localStorage.getItem("autoSaveInterval"),i=localStorage.getItem("autoSaveNotifications");if(null!==e){const t="true"===e;this.$store.commit("ide/setAutoSave",t),t&&(ul.log("[AUTO-SAVE] Auto-save is enabled in settings, starting timer"),this.startAutoSave())}t&&this.$store.commit("ide/setAutoSaveInterval",parseInt(t)),null!==i&&this.$store.commit("ide/setAutoSaveNotifications","true"===i),ul.log("[AUTO-SAVE] Initialized auto-save settings:",{enabled:this.$store.state.ide.ideInfo.autoSave,interval:this.$store.state.ide.ideInfo.autoSaveInterval,notifications:this.$store.state.ide.ideInfo.autoSaveNotifications})},startAutoSave(){this.autoSaveTimer&&clearInterval(this.autoSaveTimer);const e=this.$store.state.ide.ideInfo.autoSaveInterval||60;ul.log(`[AUTO-SAVE] Starting auto-save timer with ${e}s interval`),this.autoSaveTimer=setInterval(()=>{this.saveAllFiles()},1e3*e)},stopAutoSave(){this.autoSaveTimer&&(clearInterval(this.autoSaveTimer),this.autoSaveTimer=null,ul.log("[AUTO-SAVE] Auto-save timer stopped"))},saveAllFiles(){const e=this.ideInfo.codeItems.filter(e=>e.content);if(0===e.length)return void ul.log("[AUTO-SAVE] No files to auto-save");ul.log(`[AUTO-SAVE] Auto-saving ${e.length} files`);let t=0;e.forEach(i=>{dl.constructor.emitIDEActivity("file-save",{filename:i.fileName}),this.$store.dispatch("ide/saveFile",{codeItem:i,isAutoSave:!0}).then(()=>{t++,t===e.length&&this.$store.state.ide.ideInfo.autoSaveNotifications&&(0,Ce.nk)({message:`Auto-saved ${t} file${t>1?"s":""}`,type:"info",duration:2e3,showClose:!1})}).catch(e=>{ul.error(`[AUTO-SAVE] Failed to auto-save ${i.path}:`,e)})})},toggleConsoleExpand(){this.consoleExpanded=!this.consoleExpanded,this.updateEditorHeight(),localStorage.setItem("console-expanded",this.consoleExpanded)},updateEditorHeight(){if(this.consoleExpanded){const e=window.innerHeight-300,t=Math.min(this.consoleHeight,e);this.editorHeight=`calc(100% - ${t+35}px)`}else this.editorHeight="calc(100% - 35px)"},clearConsole(){const e=this.ideInfo.consoleSelected;e&&e.resultList&&this.$store.commit("ide/clearConsoleOutput",e.id),this.programInput="",this.programInputRows=1},toggleWordWrap(){this.wordWrap=!this.wordWrap,localStorage.setItem("word-wrap",this.wordWrap)},openREPL(){this.toggleReplMode()},closeREPL(){this.showREPL=!1},async toggleReplMode(){this.isReplMode?(this.replSessionId&&await this.stopReplSession(),this.isReplMode=!1,this.replPrompt=">>> ",this.replInput="",this.replInputRows=1):(this.isReplMode=!0,this.clearConsole(),this.consoleExpanded||(this.consoleExpanded=!0),await this.startReplSession(),this.$nextTick(()=>{this.$refs.replInputField&&this.$refs.replInputField.focus()}))},async startReplSession(){this.ideInfo.consoleSelected&&this.addReplOutput("Type Python code and press Enter to execute","system"),await this.startDualModeReplSession()},async stopReplSession(){await this.stopDualModeReplSession()},getPythonVersion(){return"3.x"},setupWebSocketHandler(){try{if(!this.wsInfo||!this.wsInfo.rws)return ul.log("WebSocket not ready, retrying..."),void setTimeout(()=>this.setupWebSocketHandler(),500);const e=e=>{try{const t=JSON.parse(e.data);ul.log(" [VmIde] ALL WebSocket msg:",{id:t.id,cmd_id:t.cmd_id,code:t.code,cmd:t.cmd,programId:t.data?.program_id,ourSessionId:this.replSessionId,fullMsg:t});const i=t.id===this.replSessionId||t.cmd_id===this.replSessionId||t.data&&t.data.program_id===this.replSessionId||this.isReplMode&&this.replSessionId&&(0===t.code||2e3===t.code||1111===t.code)&&t.data&&(t.data.stdout||t.data.stderr||t.data.program_id);if(ul.log(` Match check: id=${t.id===this.replSessionId}, cmd_id=${t.cmd_id===this.replSessionId}, prog_id=${t.data?.program_id===this.replSessionId}, isReplMode=${this.isReplMode}, code=${t.code}`),i)return ul.log(" REPL message matched - routing to REPL handler only!"),void this.handleReplResponse(t)}catch(t){}};this.$store.commit("websocket/addEventListener",{wsKey:"default",type:"message",listener:e}),this.wsMessageHandler=e,ul.log("WebSocket handler for REPL set up successfully")}catch(Sa){ul.error("Error setting up WebSocket handler:",Sa)}},handleReplMessage(e){ul.log("Handling REPL message:",e),this.handleReplResponse(e)},handleReplResponse(e){if(ul.log(" [REPL] Processing REPL response:",e),ul.log(" [REPL] Response code:",e?.code,"Data keys:",e?.data?Object.keys(e.data):"no data"),e){if(0===e.code||"0"===e.code){if(e.data){if(e.data.stdout){const t=e.data.stdout;ul.log(" [REPL] Processing stdout:",JSON.stringify(t)),t.match(/^(>>>|\.\.\.)\s*$/)||""===t.trim()?""===t.trim()&&this.addReplOutput("","output"):this.addReplOutput(t,"output")}e.data.stderr&&this.addReplOutput(e.data.stderr,"error"),e.data.output&&this.addReplOutput(e.data.output,"output")}}else if(2e3===e.code)ul.log("Input request received:",e.data),e.data&&e.data.prompt&&this.addReplOutput(e.data.prompt,"output");else if(5e3===e.code)ul.log("Entering REPL mode after script execution"),this.isReplMode=!0;else if(1111===e.code||"python_ended"===e.cmd)this.addReplOutput("\nREPL session ended","system"),this.isReplMode=!1,this.replSessionId=null,this.replPrompt=">>> ";else if(-1===e.code||e.error){const t=e.error||e.data?.error||"Unknown error";this.addReplOutput("Error: "+t,"error")}this.$nextTick(()=>{this.$refs.consoleOutputArea&&(this.$refs.consoleOutputArea.scrollTop=this.$refs.consoleOutputArea.scrollHeight)})}},toggleRightSidebar(){(this.previewTabs.length>0||this.rightSidebarVisible)&&(this.rightSidebarVisible=!this.rightSidebarVisible,localStorage.setItem("right-sidebar-visible",this.rightSidebarVisible))},expandRightPanel(){if(!this.rightPanelExpanded){this.previousRightWidth=this.rightSidebarWidth;const e=window.innerWidth,t=this.leftSidebarVisible?this.leftSidebarWidth:0;this.rightSidebarWidth=e-t-10,this.rightPanelExpanded=!0,this.consoleExpanded&&(this.consoleExpanded=!1,this.consoleMaximized=!1,this.updateEditorHeight())}},collapseRightPanel(){this.rightPanelExpanded?(this.rightSidebarWidth=this.previousRightWidth,this.rightPanelExpanded=!1,this.previousConsoleHeight>0&&(this.consoleExpanded=!0,this.updateEditorHeight())):this.rightSidebarWidth=300},handleLeftArrowClick(){"normal"===this.rightPanelMode&&(this.wasConsoleOpenBeforeRightExpand="collapsed"!==this.consoleMode,this.consoleMode="collapsed",this.consoleExpanded=!1,this.consoleMaximized=!1,this.rightPanelMode="expanded",this.rightSidebarVisible=!0,this.saveLayoutPreferences())},handleRightArrowClick(){"expanded"===this.rightPanelMode?(this.rightPanelMode="normal",this.wasConsoleOpenBeforeRightExpand&&(this.consoleMode="normal",this.consoleExpanded=!0)):"normal"===this.rightPanelMode&&(this.rightPanelMode="closed",this.rightSidebarVisible=!1),this.saveLayoutPreferences()},expandRightPanelToFull(){"normal"===this.rightPanelState&&(this.rightPanelNormalWidth=this.rightSidebarWidth),this.previousConsoleState.expanded=this.consoleExpanded,this.previousConsoleState.height=this.consoleHeight,this.consoleExpanded=!1,this.consoleMaximized=!1;const e=window.innerWidth,t=this.leftSidebarVisible?this.leftSidebarWidth:0;this.rightSidebarWidth=e-t-10,this.rightPanelState="expanded",this.rightPanelExpanded=!0,this.rightSidebarVisible=!0,this.updateEditorHeight(),this.saveLayoutPreferences()},collapseRightPanelCompletely(){"normal"===this.rightPanelState&&(this.rightPanelNormalWidth=this.rightSidebarWidth),this.rightSidebarVisible=!1,this.rightPanelState="collapsed",this.rightPanelExpanded=!1,this.saveLayoutPreferences()},restoreRightPanelToNormal(){this.rightSidebarWidth=this.rightPanelNormalWidth||400,this.rightSidebarVisible=!0,this.rightPanelState="normal",this.rightPanelExpanded=!1,this.previousConsoleState.expanded&&(this.consoleExpanded=!0,this.consoleHeight=this.previousConsoleState.height||200),this.updateEditorHeight(),this.saveLayoutPreferences()},restoreRightPanel(){this.rightPanelMode="normal",this.rightSidebarVisible=!0,this.saveLayoutPreferences()},handleConsoleUpArrow(){"collapsed"===this.consoleMode?(this.consoleMode="normal",this.consoleExpanded=!0,this.consoleMaximized=!1,this.updateEditorHeight()):"normal"===this.consoleMode&&(this.consolePreviousMode="normal",this.consoleMode="maximized",this.consoleMaximized=!0,this.consoleExpanded=!0,this.updateEditorHeight())},handleConsoleDownArrow(){"normal"!==this.consoleMode&&"maximized"!==this.consoleMode||(this.consoleMode="collapsed",this.consoleExpanded=!1,this.consoleMaximized=!1,this.updateEditorHeight())},handleConsoleRestore(){"maximized"===this.consoleMode&&(this.consoleMode=this.consolePreviousMode||"normal",this.consoleMaximized=!1,this.consoleExpanded="normal"===this.consoleMode,this.updateEditorHeight())},handleTabChange(e,t){this.isReplMode&&this.replSessionId&&(ul.log(" [VmIde] File switched - stopping REPL session"),this.stopReplSession()),t&&t.path&&this.activeFilePath&&this.saveFileConsoleState(this.activeFilePath),e&&e.path&&(this.activeFilePath=e.path,this.loadFileConsoleState(e.path))},saveFileConsoleState(e){if(!e||!e.endsWith(".py"))return;const t=this.ideInfo.consoleItems.find(t=>t.path===e);this.fileConsoleStates[e]={mode:this.consoleMode,expanded:this.consoleExpanded,maximized:this.consoleMaximized,consoleId:t?t.id:null,hasOutput:t&&t.resultList&&t.resultList.length>0}},loadFileConsoleState(e){if(!e||!e.endsWith(".py"))return this.consoleMode="collapsed",this.consoleExpanded=!1,void(this.consoleMaximized=!1);const t=this.fileConsoleStates[e];if(t){if(this.consoleMode=t.mode||"collapsed",this.consoleExpanded=t.expanded||!1,this.consoleMaximized=t.maximized||!1,t.consoleId&&this.ideInfo.consoleItems){const e=this.ideInfo.consoleItems.find(e=>e.id===t.consoleId);e&&this.$nextTick(()=>{this.$store.commit("ide/setConsoleSelected",e)})}}else this.consoleMode="collapsed",this.consoleExpanded=!1,this.consoleMaximized=!1;this.$nextTick(()=>{this.updateEditorHeight()})},getOrCreateFileConsole(e){if(!e||"string"!==typeof e)return ul.error("getOrCreateFileConsole: Invalid file path provided:",e),null;let t=this.ideInfo.consoleItems.find(t=>t.path===e);if(!t){const i=e.split("/").pop(),o={id:this.ideInfo.consoleId,path:e,name:i,run:!1,resultList:[],waitingForInput:!1,inputPrompt:""};this.$store.commit("ide/addConsoleItem",o),this.$store.commit("ide/setConsoleId",this.ideInfo.consoleId+1),t=this.ideInfo.consoleItems.find(e=>e.id===o.id)}return t},expandConsole(){this.consoleMaximized||(this.consoleMaximized=!0,this.consoleExpanded=!0)},restoreConsole(){this.consoleMaximized&&(this.consoleMaximized=!1,this.consoleExpanded=!0)},collapseConsole(){this.consoleExpanded=!1,this.consoleMaximized=!1},selectPreviewTab(e){this.selectedPreviewTab=e},closePreviewTab(e){const t=this.previewTabs.findIndex(t=>t.id===e);if(t>-1){const i=this.previewTabs[t];"pdf"===i.type&&i.content&&i.content.startsWith("blob:")&&URL.revokeObjectURL(i.content),this.previewTabs.splice(t,1),this.selectedPreviewTab===e&&(this.selectedPreviewTab=this.previewTabs.length>0?this.previewTabs[0].id:null),0===this.previewTabs.length&&(this.rightSidebarVisible=!1,this.rightPanelMode="closed")}},addPreviewTab(e,t,i,o,s){ul.log("[addPreviewTab] Adding tab:",{type:e,title:t,filePath:o,projectName:s,hasContent:!!i});const n=this.previewTabs.find(e=>e.filePath===o&&e.projectName===s);if(n)this.selectedPreviewTab=n.id,n.content!==i&&("pdf"===n.type&&n.content&&n.content.startsWith("blob:")&&URL.revokeObjectURL(n.content),n.content=i);else{const n=`${e}-${++this.previewTabCounter}`;this.previewTabs.push({id:n,type:e,title:t,content:i,filePath:o,projectName:s}),this.selectedPreviewTab=n}"closed"!==this.rightPanelMode&&this.rightSidebarVisible||(this.rightPanelMode="normal",this.rightSidebarVisible=!0,this.$nextTick(()=>{this.rightSidebarVisible||(this.rightSidebarVisible=!0)}))},getTabIcon(e){const t={output:"",image:"",pdf:"",data:""};return t[e]||""},handleThemeChange(e){ul.log("Theme changed to:",e)},downloadFile(e){if(!e||!e.fileName)return ul.error("[downloadFile] Invalid fileInfo:",e),void Ce.nk.error("Cannot download: invalid file information");const t=[".png",".jpg",".jpeg",".gif",".bmp",".svg",".pdf",".zip",".tar",".gz"],i=t.some(t=>e.fileName.toLowerCase().endsWith(t));this.$store.dispatch(`ide/${Pe.Jh}`,{projectName:e.projectName,filePath:e.filePath,binary:i,callback:t=>{if(ul.log("[downloadFile] Response:",{code:t.code,hasData:!!t.data,dataKeys:t.data?Object.keys(t.data):[]}),0==t.code){let s,n=t.data?.content||t.data;if(i)try{if("object"===typeof n&&n.content&&(n=n.content),"string"!==typeof n)throw new Error("Binary content is not a string");n.includes(",")&&(n=n.split(",")[1]);const e=atob(n),t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);s=new Blob([t],{type:"application/octet-stream"})}catch(o){return ul.error("[downloadFile] Error decoding binary data:",o),void Ce.nk.error("Failed to decode file data: "+o.message)}else s=new Blob([n],{type:"text/plain"});const a=window.URL.createObjectURL(s),l=document.createElement("a");l.href=a,l.download=e.fileName,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(a),(0,Ce.nk)({type:"success",message:`Downloaded ${e.fileName}`,duration:2e3})}else(0,Ce.nk)({type:"error",message:`Failed to download ${e.fileName}`,duration:3e3})}})},handleFileCreated(e){ul.log("[handleFileCreated] File created:",e),e&&e.path&&e.projectName&&this.getFile(e.path,!0,e.projectName),this.refreshProjectTree()},handleFolderCreated(e){ul.log("[handleFolderCreated] Folder created:",e),this.refreshProjectTree()},handleFilesImported(e){ul.log("[handleFilesImported] Files imported:",e),this.refreshProjectTree()},refreshProjectTree(){this.refreshProjectTreeWithCallback(null)},refreshProjectTreeWithCallback(e){const t=this;if(t.ideInfo.multiRootData&&t.ideInfo.multiRootData.children.length>0){ul.log("[VmIde] Refreshing multi-root project tree");let i=0;const o=t.ideInfo.multiRootData.children.length;t.ideInfo.multiRootData.children.forEach(s=>{t.$store.dispatch(`ide/${Pe.QQ}`,{projectName:s.name,callback:n=>{0==n.code?(t.$store.commit("ide/handleProject",n.data),i++,i===o&&(ul.log("[VmIde] All projects refreshed"),e&&e())):(ul.error("[VmIde] Failed to refresh project:",s.name,n),i++,i===o&&e&&e())}})})}else this.ideInfo.currProj&&this.ideInfo.currProj.data?(ul.log("[VmIde] Refreshing single project tree"),this.$store.dispatch(`ide/${Pe.QQ}`,{projectName:this.ideInfo.currProj.data.name,callback:i=>{0==i.code?(t.$store.commit("ide/handleProject",i.data),ul.log("[VmIde] Single project refreshed successfully")):ul.error("[VmIde] Failed to refresh project:",i),e&&e()}})):(ul.warn("[VmIde] No project to refresh"),e&&e())},inputIsLegal(e,t){this.dialogText=e;let i=this.checkStrIsLegal(this.dialogText,"create-file"===this.dialogType||"rename-file"===this.dialogType);return i&&("create-project"===this.dialogType||"rename-project"===this.dialogType?i=!this.isProjExist(this.dialogText):"create-file"!==this.dialogType&&"rename-file"!==this.dialogType&&"create-folder"!==this.dialogType&&"rename-folder"!==this.dialogType||(i=!this.isFileExist(this.dialogText,"create-file"===this.dialogType||"create-folder"===this.dialogType))),t(i),i},isProjExist(e){const t=this.ideInfo.projList.some(t=>t.name===e);return t&&(this.dialogTips="Project name already exists"),t},isSelectedFile(e){return this.ideInfo.codeSelected&&this.ideInfo.codeSelected.path===e.path&&this.ideInfo.codeSelected.projectName===e.projectName},getParentData(e){if(this.ideInfo.treeRef&&this.ideInfo.treeRef.currentNode&&this.ideInfo.treeRef.currentNode.parent)return this.ideInfo.treeRef.currentNode.parent.data;if(this.ideInfo.multiRootData&&this.ideInfo.multiRootData.children)for(let t of this.ideInfo.multiRootData.children){const i=this.findParentInTree(t,e);if(i)return i}return this.ideInfo.currProj&&this.ideInfo.currProj.data?this.findParentInTree(this.ideInfo.currProj.data,e):null},findParentInTree(e,t){if(!e||!e.children)return null;for(let i of e.children)if(i.path===t)return e;for(let i of e.children)if(t.startsWith(i.path+"/")||i.path===t){const e=this.findParentInTree(i,t);if(e)return e}return null},isFileExist(e,t){let i=!1;if(!this.ideInfo.nodeSelected)return!1;if(t)i=this.ideInfo.nodeSelected.children&&this.ideInfo.nodeSelected.children.some(t=>t.name===e);else{const t=this.getParentData(this.ideInfo.nodeSelected.path);t&&t.children&&(i=t.children.some(t=>t.name===e))}return i&&(this.dialogTips="File with the same name already exists"),i},checkStrIsLegal(e,t){this.dialogTips="";let i=t&&-1!==e.lastIndexOf(".")?e.substring(0,e.lastIndexOf(".")):e;if(!i)return this.dialogTips="Name cannot be empty",!1;if(i.length>15)return this.dialogTips="Name length cannot exceed 15 characters",!1;if(t&&e.endsWith("."))return this.dialogTips="Name can only contain letters, numbers and underscore _",!1;const o=/^[a-zA-Z0-9_]+$/.test(i);return o||(this.dialogTips="Name can only contain letters, numbers and underscore _"),o},listProjects(e){const t=this;this.$store.dispatch(`ide/${Pe.qB}`,{callback:i=>{0==i.code&&(t.$store.commit("ide/handleProjects",i.data),e&&t.getProject(e))}})},loadAllDefaultProjects(){ul.log(" [loadAllDefaultProjects] Starting to load default projects");const e=this,t=localStorage.getItem("username"),i=localStorage.getItem("role"),o=[];if("professor"===i){const e=["Local","Lecture Notes"];e.forEach(e=>{this.ideInfo.projList.some(t=>t.name===e)&&o.push(e)})}else{const e=this.ideInfo.projList.find(e=>e.name===`Local/${t}`);e&&o.push(e.name);const i=["Lecture Notes"];i.forEach(e=>{this.ideInfo.projList.some(t=>t.name===e)&&o.push(e)})}if(ul.log(" [loadAllDefaultProjects] Projects to load:",o),ul.log(" [loadAllDefaultProjects] Available projects:",this.ideInfo.projList),0===o.length)return void ul.warn(" [loadAllDefaultProjects] No projects to load");const s=[];let n=0;o.forEach(a=>{ul.log(` [loadAllDefaultProjects] Loading project: ${a}`),this.$store.dispatch(`ide/${Pe.QQ}`,{projectName:a,callback:l=>{if(ul.log(` [loadAllDefaultProjects] Response for ${a}:`,l),0==l.code){if(s.push(l.data),n++,n===o.length)if(ul.log(" [loadAllDefaultProjects] All projects loaded:",s),e.$store.commit("ide/handleMultipleProjects",s),"professor"===i){const t=s.find(e=>"Local"===e.name);t?e.$store.commit("ide/handleProject",t):s.length>0&&e.$store.commit("ide/handleProject",s[0])}else{const i=s.find(e=>e.name===`Local/${t}`);i?e.$store.commit("ide/handleProject",i):s.length>0&&e.$store.commit("ide/handleProject",s[0])}}else ul.error(` [loadAllDefaultProjects] Failed to load ${a}:`,l),n++}})})},getProject(e){const t=this;this.$store.dispatch(`ide/${Pe.QQ}`,{projectName:void 0===e?this.ideInfo.currProj.config.name:e,callback:e=>{if(0==e.code){t.$store.commit("ide/handleProject",e.data);for(var i=0;i<t.ideInfo.currProj.config.openList.length;i++)t.getFile(t.ideInfo.currProj.config.openList[i],!1,t.ideInfo.currProj.data.name)}}})},getFile(e,t,i,o=!1){const s=this;ul.log("[getFile] Called with:",{path:e,save:t,projectName:i,openInPanel:o});const n=i||this.ideInfo.nodeSelected&&this.ideInfo.nodeSelected.projectName||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name,a=[".png",".jpg",".jpeg",".gif",".bmp",".svg",".webp",".pdf"],l=[".csv"],r=a.some(t=>e.toLowerCase().endsWith(t)),d=l.some(t=>e.toLowerCase().endsWith(t));if(!r&&!d||o)if(r){const i=e.split("/").pop(),o=e.toLowerCase().split(".").pop(),a="pdf"===o?"pdf":"image";ul.log("[getFile] Adding media file tab:",{originalPath:e,fileName:i,fileExt:o,actualProjectName:n}),s.addPreviewTab(a,i,null,e,n),!1!==t&&s.$store.dispatch(`ide/${Pe.xv}`,{})}else if(d){const i=e.split("/").pop();this.$store.dispatch(`ide/${Pe.Jh}`,{projectName:n,filePath:e,callback:o=>{if(0===o.code&&o.data){const a=o.data.content||o.data;s.addPreviewTab("data",i,a,e,n),!1!==t&&s.$store.dispatch(`ide/${Pe.xv}`,{})}else ul.error("Failed to get CSV file:",e,o),(0,Ce.nk)({type:"error",message:`Failed to load ${i}`,duration:3e3})}})}else{this.ideInfo.fullscreenPreview&&this.ideInfo.fullscreenPreview.active&&this.$store.commit("ide/closeFullscreenPreview");let i=e;n&&e.startsWith(n+"/")&&(i=e.substring(n.length+1)),ul.log("[getFile] Getting file with relative path:",{originalPath:e,projectName:n,relativePath:i}),this.$store.dispatch(`ide/${Pe.Jh}`,{projectName:n,filePath:i,callback:i=>{0==i.code?(s.$store.commit("ide/handleGetFile",{filePath:e,data:i.data,save:t,isMedia:!1,projectName:s.ideInfo.currProj?.data?.name}),!1!==t&&s.$store.dispatch(`ide/${Pe.xv}`,{})):ul.error("Failed to get file:",e,i)}})}else this.openFullscreenPreview(e,n)},getFileForRightPanel(e,t){this.getFile(e,!1,t,!0)},getMediaCodeItem(e){const t=e.projectName||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name;return ul.log("[getMediaCodeItem] Creating media code item:",{tabTitle:e.title,tabFilePath:e.filePath,tabProjectName:e.projectName,actualProjectName:t,hasContent:!!e.content,contentType:e.content?e.content.startsWith("data:")?"data-url":e.content.startsWith("blob:")?"blob-url":"other":"none"}),e.content&&e.content.startsWith("data:")||e.content&&e.content.startsWith("blob:")?{name:e.title,path:e.filePath,projectName:t,content:e.content,preloaded:!0}:{name:e.title,path:e.filePath,projectName:t,preloaded:!1}},openFullscreenPreview(e,t){const i=this,o=e.split("/").pop(),s=e.toLowerCase().split(".").pop(),n=[".png",".jpg",".jpeg",".gif",".bmp",".svg",".webp",".pdf"],a=[".csv"],l=n.some(t=>e.toLowerCase().endsWith(t)),r=a.some(t=>e.toLowerCase().endsWith(t));l?this.$store.dispatch(`ide/${Pe.Jh}`,{projectName:t,filePath:e,binary:!0,callback:n=>{if(0===n.code&&n.data){let a=n.data.content||n.data;if(a&&a.length>0){const n={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",bmp:"image/bmp",svg:"image/svg+xml",webp:"image/webp",pdf:"application/pdf"},l=n[s]||"application/octet-stream",r=`data:${l};base64,${a}`,d={name:o,path:e,projectName:t,content:r,type:"pdf"===s?"pdf":"image"};i.$store.commit("ide/setFullscreenPreview",{file:d,content:r})}else i.$message.error(`Failed to load ${o}: No content received`)}else i.$message.error(`Failed to load ${o}`)}}):r&&this.$store.dispatch(`ide/${Pe.Jh}`,{projectName:t,filePath:e,callback:s=>{if(0===s.code&&s.data){const n=s.data.content||s.data,a={name:o,path:e,projectName:t,content:n,type:"csv"};i.$store.commit("ide/setFullscreenPreview",{file:a,content:n})}else i.$message.error(`Failed to load ${o}`)}})},setTextDialog(e){"create-file"!==e.type||"New File"!==e.title?(this.dialogType=e.type,this.dialogTitle=e.title,this.dialogText=e.text,this.dialogTips=e.tips,this.showFileDialog=!0,this.showProjsDialog=!1):this.showNewFileDialog=!0},handleRenameItem(e){ul.log("[handleRenameItem] Received rename request:",e);const{oldPath:t,newName:i,type:o,projectName:s}=e,n=s||this.ideInfo.currProj?.config?.name||this.ideInfo.currProj?.data?.name;ul.log("[handleRenameItem] Using project:",n),ul.log("[handleRenameItem] Data projectName:",s),ul.log("[handleRenameItem] Current project:",this.ideInfo.currProj?.data?.name),ul.log("[handleRenameItem] Renaming:",{oldPath:t,newName:i,type:o,actualProjectName:n}),"file"===o?this.renameFile(i,t,n):"dir"!==o&&"folder"!==o||this.renameFolder(i,t,n)},handleDeleteItem(e){const{path:t,type:i,projectName:o}=e;ul.log("[handleDeleteItem] Deleting:",i,"at path:",t,"in project:",o),"file"===i?this.deleteFile(t,o):"dir"!==i&&"folder"!==i||this.deleteFolder(t,o)},handleDownloadItem(e){if(ul.log("[handleDownloadItem] Download request:",e),!e||!e.path)return ul.error("[handleDownloadItem] Invalid data:",e),void Ce.nk.error("Cannot download: no file selected");const t=e.path.split("/").pop()||e.label||e.name||"download",i={fileName:t,filePath:e.path,projectName:e.projectName||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name};ul.log("[handleDownloadItem] Downloading:",i),this.downloadFile(i)},openFileBrowser(){this.fileBrowserMode="open",this.fileToMove=null,this.showFileBrowserDialog=!0},handleSignIn(){ul.log("handleSignIn called");const e=localStorage.getItem("session_id"),t=localStorage.getItem("username");e&&t?bt.s.confirm(`You are already logged in as ${t}. Do you want to sign out and login with a different account?`,"Already Logged In",{confirmButtonText:"Sign Out",cancelButtonText:"Cancel",type:"info"}).then(()=>{localStorage.removeItem("session_id"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("full_name"),window.location.reload()}).catch(()=>{}):(ul.log("Setting showLoginModal to true"),this.showLoginModal=!0,ul.log("showLoginModal is now:",this.showLoginModal),this.$nextTick(()=>{ul.log("After nextTick, showLoginModal:",this.showLoginModal),ul.log("Login modal element:",document.querySelector(".login-modal-overlay"))}))},handleLoginSuccess(e){ul.log("Login success received:",e),e?(ul.log(" [VmIde] Starting session manager after login..."),dl.startTracking(),Ce.nk.success(`Welcome, ${e.full_name||e.username}!`),setTimeout(()=>{window.location.reload()},500)):ul.error("No user data received in handleLoginSuccess")},reconnectWebSocket(){this.wsInfo&&this.wsInfo.rws&&this.wsInfo.rws.close(),setTimeout(()=>{this.$store.dispatch("websocket/init")},500)},handleNewFileFromTree(){const e=this.ideInfo.nodeSelected;if(!e||"dir"!==e.type&&"folder"!==e.type){const e=this.ideInfo.currProj?.data;e&&this.$store.commit("ide/setNodeSelected",e)}this.setTextDialog({type:"create-file",title:"New File",tips:"Enter file name:",text:"untitled.py"})},handleNewFolderFromTree(){const e=this.ideInfo.nodeSelected;if(!e||"dir"!==e.type&&"folder"!==e.type){const e=this.ideInfo.currProj?.data;e&&this.$store.commit("ide/setNodeSelected",e)}this.showNewFolderDialog=!0},handleImportFileFromTree(){const e=this.ideInfo.nodeSelected;if(!e||"dir"!==e.type&&"folder"!==e.type){const e=this.ideInfo.currProj?.data;e&&this.$store.commit("ide/setNodeSelected",e)}this.showImportFileDialog=!0},handleUndo(){const e=this.getActiveCodeMirrorInstance();e?e.undo():document.execCommand("undo")},handleRedo(){const e=this.getActiveCodeMirrorInstance();e?e.redo():document.execCommand("redo")},handleCut(){const e=this.getActiveCodeMirrorInstance();if(e&&e.somethingSelected()){const t=e.getSelection();navigator.clipboard.writeText(t),e.replaceSelection("")}else document.execCommand("cut")},handleCopy(){const e=this.getActiveCodeMirrorInstance();if(e&&e.somethingSelected()){const t=e.getSelection();navigator.clipboard.writeText(t)}else document.execCommand("copy")},handlePaste(){const e=this.getActiveCodeMirrorInstance();e?navigator.clipboard.readText().then(t=>{e.replaceSelection(t)}).catch(()=>{document.execCommand("paste")}):document.execCommand("paste")},handleFind(){this.findReplaceMode="find",this.showFindReplaceModal=!0},handleReplace(){this.findReplaceMode="replace",this.showFindReplaceModal=!0},handleComment(){const e=this.getActiveCodeMirrorInstance();if(e)try{const t=e.getCursor(),i=e.getLine(t.line);let o=t.ch;if(i.trim().startsWith("# ")){const s=i.replace(/^(\s*)# /,"$1");e.replaceRange(s,{line:t.line,ch:0},{line:t.line,ch:i.length}),o=Math.max(0,t.ch-2)}else if(i.trim().startsWith("#")){const s=i.replace(/^(\s*)#/,"$1");e.replaceRange(s,{line:t.line,ch:0},{line:t.line,ch:i.length}),o=Math.max(0,t.ch-1)}else if(""!==i.trim()){const s=i.match(/^(\s*)(.*)/),n=s[1]||"",a=s[2]||"",l=n+"# "+a;e.replaceRange(l,{line:t.line,ch:0},{line:t.line,ch:i.length}),o=t.ch+2}e.setCursor(t.line,o),e.focus(),e.refresh();const s=e.getValue();void 0!==this.ideInfo.codeSelectedIndex&&this.$store.commit("ide/setCodeItemContent",{index:this.ideInfo.codeSelectedIndex,content:s}),setTimeout(()=>{e.refresh()},10)}catch(Sa){ul.error("Comment toggle error:",Sa)}},getActiveCodeMirrorInstance(){const e=document.querySelector(".editor-content .code-editor-flex .CodeMirror");if(e&&e.CodeMirror)return e.CodeMirror;const t=document.querySelectorAll(".code-editor-container");for(let o=0;o<t.length;o++){const e=t[o];if(null!==e.offsetParent){const t=e.querySelector(".CodeMirror");if(t&&t.CodeMirror)return t.CodeMirror}}const i=document.querySelectorAll(".CodeMirror");for(let o=0;o<i.length;o++){const e=i[o];if(e.CodeMirror&&null!==e.offsetParent)return e.CodeMirror}return null},toggleConsole(e){e?(this.consoleMode="normal",this.consolePaneSize=30,this.ideInfo.consoleSelected&&this.ideInfo.consoleSelected.id||this.startEmptyRepl()):(this.consoleMode="collapsed",this.consolePaneSize=5)},startEmptyRepl(){const e={id:"empty-repl-"+Date.now(),name:"Python REPL",path:"REPL",resultList:[],run:!1,stop:!1,waitingForInput:!1,inputPrompt:""};this.$store.commit("ide/pushConsoleItem",e),this.$store.commit("ide/selectConsoleItem",e.id),this.sendMessage({cmd:"start_python_repl",cmd_id:e.id,data:{projectName:this.ideInfo.currProj?.data?.name||"Local"}}),this.$store.commit("ide/updateConsoleItem",{id:e.id,run:!0})},togglePreviewPanel(e){e&&0===this.previewTabs.length?this.$message.info("No files to preview. Open an image, PDF, or CSV file."):this.rightPanelMode=e?"normal":"closed"},handleOpenFile(e){this.getFile(e),this.showFileBrowserDialog=!1},async duplicateFile(e){const{originalPath:t,newName:i,projectName:o}=e,s=this;ul.log(" [DEBUG] duplicateFile called with:",{originalPath:t,newName:i,projectName:o});const n=t.lastIndexOf("/"),a=n>0?t.substring(0,n):"/",l=await this.generateUniqueFileName(i,a,o),r=a+"/"+l;ul.log(" [DEBUG] Generated unique filename:",l),ul.log(" [DEBUG] New file path will be:",r),this.$store.dispatch(`ide/${Pe.Jh}`,{projectName:o,filePath:t,callback:e=>{if(0==e.code){const t=e.data.content||e.data;ul.log(" [DEBUG] Original file content retrieved, length:",t?.length),s.$store.dispatch(`ide/${Pe.Zd}`,{projectName:o,parentPath:a,fileName:l,callback:e=>{0==e.code?(ul.log(" [DEBUG] File created successfully, now writing content"),s.$store.dispatch(`ide/${Pe._L}`,{projectName:o,filePath:r,fileData:t,complete:!0,callback:e=>{0==e.code?(ul.log(" [DEBUG] File duplicated successfully as:",l),Ce.nk.success(`File duplicated as ${l}`),s.refreshProjectTree()):(ul.error(" [DEBUG] Failed to write content to duplicate file:",e),Ce.nk.error("Failed to write content to duplicate file"))}})):(ul.error(" [DEBUG] Failed to create duplicate file:",e),Ce.nk.error("Failed to create duplicate file"))}})}else ul.error(" [DEBUG] Failed to read original file:",e),Ce.nk.error("Failed to read original file")}})},async generateUniqueFileName(e,t,i){const o=e.lastIndexOf("."),s=o>0?e.substring(o):"",n=o>0?e.substring(0,o):e;ul.log(" [DEBUG] generateUniqueFileName:",{proposedName:e,baseName:n,extension:s,parentPath:t});const a=await this.getExistingFilesInDirectory(t,i);if(ul.log(" [DEBUG] Existing files in directory:",a),!a.includes(e))return ul.log(" [DEBUG] Proposed name is already unique:",e),e;for(let d=1;d<1e3;d++){const e=1===d?`${n}_copy${s}`:`${n}_copy_${d}${s}`;if(!a.includes(e))return ul.log(" [DEBUG] Found unique name:",e),e}const l=Date.now(),r=`${n}_copy_${l}${s}`;return ul.log(" [DEBUG] Using timestamp fallback:",r),r},async getExistingFilesInDirectory(e,t){return new Promise(t=>{try{const i=this.ideInfo.currProj?.data;if(!i)return ul.log(" [DEBUG] No project data available"),void t([]);const o=(e,t)=>{try{if(!e||"object"!==typeof e)return null;if(e.path===t&&"dir"===e.type)return e;if(e.children&&Array.isArray(e.children))for(const i of e.children){if(!i||"object"!==typeof i)continue;const e=o(i,t);if(e)return e}return null}catch(i){return ul.warn(" [DEBUG] Error in findDirectory:",i),null}},s=o(i,e);if(ul.log(" [DEBUG] Found target directory:",s),s&&s.children&&Array.isArray(s.children)){const e=s.children.filter(e=>{try{return e&&"object"===typeof e&&"file"===e.type&&(e.label||e.name)}catch(t){return ul.warn(" [DEBUG] Invalid child node, skipping:",e,t),!1}}).map(e=>{try{return e.label||e.name||"unnamed"}catch(t){return ul.warn(" [DEBUG] Error extracting child name:",t),"unnamed"}}).filter(e=>e&&"unnamed"!==e);ul.log(" [DEBUG] Extracted filenames:",e),t(e)}else ul.log(" [DEBUG] Directory not found or has no children"),t([])}catch(Sa){ul.warn(" [DEBUG] Error in getExistingFilesInDirectory:",Sa),t([])}})},async saveAsFile(e){if(ul.log(" [DEBUG] VmIde.saveAsFile() called with:",e),!e||!e.fileName)return ul.log(" [DEBUG] Invalid fileInfo - no fileName"),void Ce.nk.error("No file selected to save");const t=this.ideInfo.codeItems.find(t=>t.filePath===e.filePath&&(t.projectName===e.projectName||!t.projectName&&!e.projectName));ul.log(" [DEBUG] Looking for codeItem with filePath:",e.filePath),ul.log(" [DEBUG] Available codeItems:",this.ideInfo.codeItems?.map(e=>({filePath:e.filePath,projectName:e.projectName}))),ul.log(" [DEBUG] Found codeItem:",!!t),t?(ul.log(" [DEBUG] Using editor content, calling performSaveAs"),await this.performSaveAs(e,t.content)):(ul.log(" [DEBUG] File not in editor, reading from server"),this.readFileForSaveAs(e))},readFileForSaveAs(e){ul.log(" [DEBUG] readFileForSaveAs called with:",e);const t=[".png",".jpg",".jpeg",".gif",".bmp",".svg",".pdf",".zip",".tar",".gz"],i=t.some(t=>e.fileName.toLowerCase().endsWith(t));ul.log(" [DEBUG] File is binary:",i),ul.log(" [DEBUG] Dispatching IDE_GET_FILE with:",{projectName:e.projectName,filePath:e.filePath,binary:i}),this.$store.dispatch(`ide/${Pe.Jh}`,{projectName:e.projectName,filePath:e.filePath,binary:i,callback:async t=>{if(ul.log(" [DEBUG] IDE_GET_FILE callback received:",{code:t.code,hasData:!!t.data}),0==t.code){let o=t.data?.content||t.data;if(i)return void Ce.nk.info("Binary files should be downloaded using the Download option instead.");"object"===typeof o&&o.content&&(o=o.content),await this.performSaveAs(e,o)}else Ce.nk.error("Failed to read file content")}})},async performSaveAs(e,t){ul.log(" [DEBUG] performSaveAs called with fileInfo:",e),ul.log(" [DEBUG] Content length:",t?.length);const i=e=>{const t=e.toLowerCase().split(".").pop(),i={py:"text/x-python",js:"text/javascript",html:"text/html",css:"text/css",json:"application/json",md:"text/markdown",txt:"text/plain",csv:"text/csv",xml:"text/xml"};return i[t]||"text/plain"},o=i(e.fileName),s="showSaveFilePicker"in window,n=window.isSecureContext;if(s&&n)try{const i=e.fileName.split(".").pop()||"txt",s={suggestedName:e.fileName,types:[{description:`${i.toUpperCase()} files`,accept:{[o]:["."+i]}}],excludeAcceptAllOption:!1},n=await window.showSaveFilePicker(s),a=await n.createWritable();if(t.length>1048576){const e=t.match(/.{1,65536}/g)||[];for(const t of e)await a.write(t)}else await a.write(t);return await a.close(),void Ce.nk.success(`File saved successfully as: ${n.name}`)}catch(Sa){if("AbortError"===Sa.name)return;"NotAllowedError"===Sa.name?Ce.nk.warning("File access permission denied. Using fallback download method."):ul.warn("File System Access API failed:",Sa)}else s&&!n&&ul.warn("File System Access API requires HTTPS. Using fallback method.");try{const i=new Blob([t],{type:o+";charset=utf-8"}),s=document.createElement("a"),n="download"in s;if(n){const t=window.URL.createObjectURL(i),o=document.createElement("a");if(o.href=t,o.download=e.fileName,o.style.display="none",o.setAttribute("target","_blank"),o.setAttribute("rel","noopener noreferrer"),document.body.appendChild(o),"function"===typeof o.click)o.click();else{const e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});o.dispatchEvent(e)}setTimeout(()=>{document.body.contains(o)&&document.body.removeChild(o),window.URL.revokeObjectURL(t)},150),Ce.nk.success("File downloaded to your default downloads folder")}else{const e=window.URL.createObjectURL(i),t=window.open(e,"_blank");if(!t)throw new Error("Popup blocked or browser not supported");Ce.nk.info("File opened in new window. Use browser's save function to download."),setTimeout(()=>{window.URL.revokeObjectURL(e)},1e3)}}catch(Sa){if(ul.error("Save As failed:",Sa),navigator.clipboard&&navigator.clipboard.writeText)try{await navigator.clipboard.writeText(t),Ce.nk.warning("Could not download file. Content copied to clipboard instead.")}catch(a){Ce.nk.error("Failed to save file. Please try using a modern browser.")}else Ce.nk.error("Failed to save file. Please try using a modern browser.")}},openMoveDialog(e){ul.log("[VmIde] openMoveDialog called with:",e);e.path||e.filePath;const t=(i,o)=>{if("file"===i.type&&i.name===e.name)return i;if(i.children)for(const e of i.children){const i=t(e,o);if(i)return i}return null};let i=e;if(this.ideInfo.multiRootData&&this.ideInfo.multiRootData.children.length>0)for(const o of this.ideInfo.multiRootData.children){const s=t(o,e.name);if(s){ul.log("[VmIde] Found fresh file data in tree:",s.path),i={...e,path:s.path,filePath:s.path};break}}else if(this.ideInfo.currProj&&this.ideInfo.currProj.data){const o=t(this.ideInfo.currProj.data,e.name);o&&(ul.log("[VmIde] Found fresh file data in single project:",o.path),i={...e,path:o.path,filePath:o.path})}this.fileBrowserMode="move",this.fileToMove=i,this.showFileBrowserDialog=!0,ul.log("[VmIde] Move dialog opened with fresh data, mode:",this.fileBrowserMode,"fileToMove:",this.fileToMove)},handleMoveFile(e){ul.log("[VmIde] handleMoveFile called with data:",e);const{oldPath:t,newPath:i,projectName:o}=e,s=this,n=(e,t)=>{if(!e||!t)return e;const i=t+"/";return e.startsWith(i)?e.substring(i.length):e},a=n(t,o),l=n(i,o);if(ul.log("[VmIde] Normalized paths:",{originalOldPath:t,normalizedOldPath:a,originalNewPath:i,normalizedNewPath:l,projectName:o}),a===l)return Ce.nk.warning("Source and destination paths are the same"),void(this.showFileBrowserDialog=!1);if(l.startsWith(a+"/"))return Ce.nk.error("Cannot move a file into its own subdirectory"),void(this.showFileBrowserDialog=!1);const r=!1===this.ideInfo.nodeSelected?.isLeaf,d=r?Pe.mr:Pe.GG;ul.log("[VmIde] Using move command:",d),this.$store.dispatch(`ide/${d}`,{wsKey:this.wsKey,projectName:o,oldPath:a,newPath:l,callback:e=>{if(ul.log("[VmIde] Move result:",e),0===e.code){if(Ce.nk.success((r?"Folder":"File")+" moved successfully"),s.ideInfo.nodeSelected&&s.ideInfo.nodeSelected.path===t){const e={...s.ideInfo.nodeSelected,path:i,filePath:i,fileName:i.substring(i.lastIndexOf("/")+1),name:i.substring(i.lastIndexOf("/")+1),label:i.substring(i.lastIndexOf("/")+1)};if(s.$store.commit("ide/setNodeSelected",e),!r&&s.ideInfo.openList.length>0){const e=s.ideInfo.openList.findIndex(e=>e.path===t);if(-1!==e){const o=[...s.ideInfo.openList];o[e]={...o[e],path:i,filePath:i,fileName:i.substring(i.lastIndexOf("/")+1),name:i.substring(i.lastIndexOf("/")+1),label:i.substring(i.lastIndexOf("/")+1)},s.$store.commit("ide/setOpenList",o),s.ideInfo.selectFilePath===t&&s.$store.commit("ide/setSelectFilePath",i)}}}s.refreshProjectTreeWithCallback(()=>{ul.log("[VmIde] Tree refresh completed after move"),s.showFileBrowserDialog=!1})}else ul.error("[VmIde] Move failed:",e),Ce.nk.error(e.msg||"Failed to move "+(r?"folder":"file")),s.showFileBrowserDialog=!1}})},deleteFileFromMenu(e){this.handleDeleteItem(e)},deleteSelectedFile(e){this.handleDeleteItem(e)},setDelDialog(e){this.dialogType="",this.dialogTitle=e.title,this.dialogText="",this.dialogTips="",this.showDeleteDialog=!0},setProjsDialog(e){this.dialogType="",this.dialogTitle="",this.dialogText="",this.dialogTips="",this.showProjsDialog=!0},onCloseTextDialog(){this.showFileDialog=!1,this.ideInfo.nodeSelected&&this.ideInfo.treeRef.setCurrentNode(this.ideInfo.nodeSelected),"create-project"===this.dialogType&&(this.showProjsDialog=!0)},onCloseProjsDialog(){this.showProjsDialog=!1,this.showFileDialog=!1,this.showDeleteDialog=!1,this.ideInfo.nodeSelected&&this.ideInfo.treeRef.setCurrentNode(this.ideInfo.nodeSelected)},onCancelDelete(){this.showDeleteDialog=!1,this.ideInfo.nodeSelected&&this.ideInfo.treeRef.setCurrentNode(this.ideInfo.nodeSelected)},deleteProject(e){const t=this;this.$store.dispatch(`ide/${Pe.DO}`,{projectName:e,callback:i=>{0==i.code&&t.$store.commit("ide/handleDelProject",e)}})},deleteFile(e,t){const i=this;ul.log("[deleteFile] Deleting file:",e,"from project:",t||this.ideInfo.currProj.config.name);const o=t||this.ideInfo.currProj.config.name||this.ideInfo.currProj.data?.name;this.$store.dispatch(`ide/${Pe.w7}`,{projectName:o,filePath:e,callback:t=>{if(ul.log("[deleteFile] Response:",t),0==t.code){const t=i.getParentData(e);t&&i.$store.commit("ide/handleDelFile",{parentData:t,filePath:e}),i.refreshProjectTree(),(0,Ce.nk)({type:"success",message:"File deleted successfully",duration:2e3})}else(0,Ce.nk)({type:"error",message:"Failed to delete file",duration:3e3})}})},deleteFolder(e,t){const i=this;ul.log("[deleteFolder] Deleting folder:",e,"from project:",t||this.ideInfo.currProj.config.name);const o=t||this.ideInfo.currProj.config.name||this.ideInfo.currProj.data?.name;this.$store.dispatch(`ide/${Pe.Ec}`,{projectName:o,folderPath:e,callback:t=>{if(ul.log("[deleteFolder] Response:",t),0==t.code){const t=i.getParentData(e);t&&i.$store.commit("ide/handleDelFolder",{parentData:t,folderPath:e}),i.refreshProjectTree(),(0,Ce.nk)({type:"success",message:"Folder deleted successfully",duration:2e3})}else(0,Ce.nk)({type:"error",message:"Failed to delete folder",duration:3e3})}})},createProject(e){const t=this;this.$store.dispatch(`ide/${Pe.KV}`,{projectName:e,callback:i=>{0==i.code&&t.listProjects(e)}})},createFile(e,t,i){const o=this;this.$store.dispatch(`ide/${Pe.Zd}`,{projectName:void 0===i?this.ideInfo.currProj.config.name:i,parentPath:void 0===t?this.ideInfo.nodeSelected.path:t,fileName:e,callback:t=>{if(0==t.code){const t=ml.join(o.ideInfo.nodeSelected.path,e);o.$store.commit("ide/addChildrenNode",{name:e,path:t,type:"file"}),o.$store.dispatch(`ide/${Pe.xv}`,{})}}})},createFolder(e,t,i){const o=this;this.$store.dispatch(`ide/${Pe.p_}`,{projectName:void 0===i?this.ideInfo.currProj.config.name:i,parentPath:void 0===t?this.ideInfo.nodeSelected.path:t,folderName:e,callback:t=>{if(0==t.code){const t=ml.join(o.ideInfo.nodeSelected.path,e);o.$store.commit("ide/addChildrenNode",{name:e,path:t,type:"dir"}),o.$store.dispatch(`ide/${Pe.xv}`,{})}}})},renameProject(e,t){const i=this;this.$store.dispatch(`ide/${Pe.sh}`,{oldName:void 0===t?this.ideInfo.currProj.config.name:t,newName:e,callback:t=>{0==t.code&&(i.$store.commit("ide/handleRename",e),i.$store.dispatch(`ide/${Pe.xv}`,{}))}})},renameFile(e,t,i){const o=this;let s=t;if(void 0===s){if(!this.ideInfo.nodeSelected||!this.ideInfo.nodeSelected.path)return ul.error("Cannot rename: no path provided and nodeSelected is null"),void Ce.nk.error("Cannot rename: no file selected");s=this.ideInfo.nodeSelected.path}ul.log("[renameFile] Starting rename:",{actualOldPath:s,newName:e,projectName:i});const n=i||this.ideInfo.currProj?.config?.name||this.ideInfo.currProj?.data?.name;ul.log("[renameFile] Using project name:",n),this.$store.dispatch(`ide/${Pe.Z0}`,{projectName:n,oldPath:s,fileName:e,callback:t=>{if(ul.log("[renameFile] Backend response:",t),0==t.code){const t=s.substring(0,s.lastIndexOf("/")+1)+e;ul.log("[renameFile] New path will be:",t);for(let i=0;i<o.ideInfo.codeItems.length;i++)if(o.ideInfo.codeItems[i].path===s){ul.log("[renameFile] Updating open tab from",s,"to",t),o.ideInfo.codeItems[i].path=t,o.ideInfo.codeItems[i].name=e;break}o.$store.dispatch(`ide/${Pe.QQ}`,{projectName:n,callback:e=>{0==e.code&&(o.$store.commit("ide/handleProject",e.data),o.$store.commit("ide/setPathSelected",t),o.ideInfo.multiRootData&&(ul.log("[renameFile] Refreshing all projects in multi-root mode"),o.loadAllDefaultProjects()),Ce.nk.success("File renamed successfully"))}})}else{ul.error("[renameFile] Rename failed:",t);const e=t.data?.message||t.message||"Unknown error";Ce.nk.error("Failed to rename file: "+e)}}})},renameFolder(e,t,i){const o=this;let s=t;if(void 0===s){if(!this.ideInfo.nodeSelected||!this.ideInfo.nodeSelected.path)return ul.error("Cannot rename folder: no path provided and nodeSelected is null"),void Ce.nk.error("Cannot rename folder: no folder selected");s=this.ideInfo.nodeSelected.path}ul.log("[renameFolder] Starting rename:",{actualOldPath:s,newName:e,projectName:i});const n=i||this.ideInfo.currProj?.config?.name||this.ideInfo.currProj?.data?.name;ul.log("[renameFolder] Using project name:",n),this.$store.dispatch(`ide/${Pe.Zz}`,{projectName:n,oldPath:s,folderName:e,callback:t=>{if(ul.log("[renameFolder] Backend response:",t),0==t.code){const t=s.substring(0,s.lastIndexOf("/")+1)+e;ul.log("[renameFolder] New path will be:",t);for(let e=0;e<o.ideInfo.codeItems.length;e++)if(o.ideInfo.codeItems[e].path.startsWith(s+"/")){const i=o.ideInfo.codeItems[e].path.substring(s.length),n=t+i;ul.log("[renameFolder] Updating open tab from",o.ideInfo.codeItems[e].path,"to",n),o.ideInfo.codeItems[e].path=n}o.$store.dispatch(`ide/${Pe.QQ}`,{projectName:n,callback:e=>{0==e.code&&(o.$store.commit("ide/handleProject",e.data),o.$store.commit("ide/setPathSelected",t),o.ideInfo.multiRootData&&(ul.log("[renameFolder] Refreshing all projects in multi-root mode"),o.loadAllDefaultProjects()),Ce.nk.success("Folder renamed successfully"))}})}else{ul.error("[renameFolder] Rename failed:",t);const e=t.data?.message||t.message||"Unknown error";Ce.nk.error("Failed to rename folder: "+e)}}})},onDelete(){this.showDeleteDialog=!1,this.ideInfo.nodeSelected&&this.ideInfo.nodeSelected.type&&("dir"===this.ideInfo.nodeSelected.type||"folder"===this.ideInfo.nodeSelected.type)?this.deleteFolder(this.ideInfo.nodeSelected.path):this.deleteFile(this.ideInfo.nodeSelected.path)},onCreate(){const e=this.dialogText;if("create-file"===this.dialogType)this.createFile(e);else if("rename-file"===this.dialogType)this.renameFile(e);else if("create-folder"===this.dialogType)this.createFolder(e);else if("rename-folder"===this.dialogType)this.renameFolder(e);else if("create-project"===this.dialogType)if(this.hasRunProgram){const t=this;bt.s.confirm("Stop all running programs and create new project?","Warning",{confirmButtonText:"Stop and Create",cancelButtonText:"Cancel",type:"warning"}).then(()=>{t.stopAll(),t.$store.commit("ide/setConsoleItems",[]),t.createProject(e)}).catch(()=>{ul.log("canceled create project")})}else this.$store.commit("ide/setConsoleItems",[]),this.createProject(e);else"rename-project"===this.dialogType&&this.renameProject(e);this.showProjsDialog=!1,this.showFileDialog=!1,this.showDeleteDialog=!1},onDeleteProj(e){const t=this;bt.s.confirm("Delete this project?","Confirm",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then(()=>{t.deleteProject(e),(0,Ce.nk)({type:"success",message:"Deleted successfully"})}).catch(()=>{(0,Ce.nk)({type:"info",message:"Cancelled"})})},onSelectProj(e){this.hasRunProgram?bt.s.confirm("Stop all running programs and switch project?","Warning",{confirmButtonText:"Stop and Switch",cancelButtonText:"Cancel",type:"warning"}).then(()=>{this.stopAll(),this.$store.commit("ide/setConsoleItems",[]),this.getProject(e),this.showProjsDialog=!1}).catch(()=>{this.showProjsDialog=!1}):(this.getProject(e),this.showProjsDialog=!1,this.$store.commit("ide/setConsoleItems",[]))},selectFile(e){const t=this.ideInfo.codeSelected,i=t&&t.path!==e.path;if(i&&t.path&&t.path.endsWith(".py")){const e=this.ideInfo.consoleItems.find(e=>e.path===t.path);e&&e.run&&!this.isReplMode&&(this.stop(e.id),e.waitingForInput&&this.$store.commit("ide/updateConsoleItem",{id:e.id,waitingForInput:!1,inputPrompt:""})),this.saveFileConsoleState(t.path)}if(dl.constructor.emitIDEActivity("file-open",{filename:e.fileName}),this.$store.commit("ide/setPathSelected",e.path),this.$store.commit("ide/setCodeSelected",e),this.activeFilePath=e.path,i&&e.path&&e.path.endsWith(".py")){let t=this.ideInfo.consoleItems.find(t=>t.path===e.path);t||(t={id:this.$store.state.ide.consoleId,name:e.name,path:e.path,resultList:[],run:!1,stop:!1,waitingForInput:!1,inputPrompt:""},this.$store.commit("ide/pushConsoleItem",t)),this.$store.commit("ide/setConsoleSelected",t),this.consoleMode="collapsed",this.consoleExpanded=!1,this.consoleMaximized=!1,this.$nextTick(()=>{this.updateEditorHeight()})}this.ideInfo.currProj.pathSelected&&this.ideInfo.treeRef&&(this.ideInfo.treeRef.setCurrentKey(this.ideInfo.currProj.pathSelected),this.$store.commit("ide/setNodeSelected",this.ideInfo.treeRef.getCurrentNode())),this.$store.dispatch(`ide/${Pe.xv}`,{})},closeFile(e){if(e.path&&e.path.endsWith(".py")){this.activeFilePath===e.path&&this.saveFileConsoleState(e.path);const t=this.ideInfo.consoleItems.filter(t=>t.path!==e.path);this.$store.commit("ide/setConsoleItems",t)}const t=[];for(let i=0;i<this.ideInfo.codeItems.length;i++)e.path!==this.ideInfo.codeItems[i].path?t.push(this.ideInfo.codeItems[i]):i>0?this.ideInfo.currProj.pathSelected===e.path&&(this.$store.commit("ide/setPathSelected",this.ideInfo.codeItems[i-1].path),this.$store.commit("ide/setCodeSelected",this.ideInfo.codeItems[i-1])):i<this.ideInfo.codeItems.length-1&&this.ideInfo.currProj.pathSelected===e.path&&(this.$store.commit("ide/setPathSelected",this.ideInfo.codeItems[i+1].path),this.$store.commit("ide/setCodeSelected",this.ideInfo.codeItems[i+1]));this.$store.commit("ide/setCodeItems",t),0===this.ideInfo.codeItems.length&&(this.$store.commit("ide/setPathSelected",null),this.$store.commit("ide/setCodeSelected",{})),this.$store.dispatch(`ide/${Pe.xv}`,{})},updateItem(e,t){for(let i=0;i<this.ideInfo.codeItems.length;i++)if(e===this.ideInfo.codeItems[i].path){this.$store.commit("ide/setCodeItemMirror",{index:i,codemirror:t});break}},selectConsole(e){this.$store.commit("ide/setConsoleSelected",e)},closeConsoleSafe(e){!0===e.run?bt.s.confirm("Stop this program and close terminal?","Warning",{confirmButtonText:"Stop and Close",cancelButtonText:"Cancel",type:"warning"}).then(()=>{this.stop(e.id),this.closeConsole(e)}).catch(()=>{ul.log("canceled close console")}):this.closeConsole(e)},closeConsole(e){const t=[];for(let i=0;i<this.ideInfo.consoleItems.length;i++)"Terminal"===e.name&&"Terminal"===e.path?e.id!==this.ideInfo.consoleItems[i].id?t.push(this.ideInfo.consoleItems[i]):i>0?this.$store.commit("ide/setConsoleSelected",this.ideInfo.consoleItems[i-1]):i<this.ideInfo.consoleItems.length-1&&this.$store.commit("ide/setConsoleSelected",this.ideInfo.consoleItems[i+1]):e.path!==this.ideInfo.consoleItems[i].path||e.id!==this.ideInfo.consoleItems[i].id?t.push(this.ideInfo.consoleItems[i]):i>0?this.$store.commit("ide/setConsoleSelected",this.ideInfo.consoleItems[i-1]):i<this.ideInfo.consoleItems.length-1&&this.$store.commit("ide/setConsoleSelected",this.ideInfo.consoleItems[i+1]);this.$store.commit("ide/setConsoleItems",t),0===this.ideInfo.consoleItems.length&&this.$store.commit("ide/setConsoleSelected",{}),this.resize()},getCurrentConsoleHeight(){return 400},resize(){this.windowWidth=window.innerWidth,this.$forceUpdate()},runPathSelected(){dl.constructor.emitIDEActivity("code-run");const e=this.ideInfo.currProj.pathSelected;if(!e||""===e||null===e)return void(0,Ce.nk)({type:"warning",message:"No script is open to run. Please open a Python file first.",duration:3e3});this.consoleExpanded||(this.consoleExpanded=!0,this.updateEditorHeight());const t=this.getOrCreateFileConsole(e);this.$store.commit("ide/resetConsoleItem",{consoleId:t.id,run:!1,stop:!1,resultList:[]}),this.$store.commit("ide/setConsoleSelected",t),this.$store.commit("ide/assignConsoleSelected",{id:this.ideInfo.consoleId}),this.saveFileConsoleState(e),"collapsed"===this.consoleMode&&(this.consoleMode="normal",this.consoleExpanded=!0,this.consoleMaximized=!1);const i=this.ideInfo.codeSelected?.projectName||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name,o=this.ideInfo.consoleId;this.replSessionId=o,ul.log(`[VmIde] Setting replSessionId to ${o} for Python program execution`),this.$store.dispatch(`ide/${Pe.j8}`,{msgId:o,projectName:i,filePath:this.ideInfo.currProj.pathSelected,callback:{limits:-1,callback:e=>{ul.log(" [VmIde] Script execution callback:",e);const t=e.id===this.replSessionId||e.cmd_id===this.replSessionId||e.data&&e.data.program_id===this.replSessionId||this.isReplMode&&this.replSessionId&&(0===e.code||2e3===e.code||5e3===e.code)&&e.data&&(e.data.stdout||e.data.stderr),i=null===e.data||void 0===e.data||2e3===e.code||4e3===e.code||5e3===e.code;ul.log(" [Script] Callback - isReplMessage:",t,"isProgramLifecycle:",i,"code:",e.code,"id:",e.id,"replSessionId:",this.replSessionId),!t||i?(ul.log(" [Script] Processing through handleRunResult"),this.$store.commit("ide/handleRunResult",e)):ul.log(" [Script] Skipping - will be handled by REPL"),5e3!==e.code||t||(ul.log(" [VmIde] Script completed, entering REPL mode"),this.isReplMode=!0)}}}),this.$store.commit("ide/setConsoleId",this.ideInfo.consoleId+1)},runConsoleSelected(){this.switchToOutputTab(),"collapsed"===this.consoleMode&&(this.consoleMode="normal",this.consoleExpanded=!0,this.consoleMaximized=!1);const e=this.ideInfo.consoleSelected?.projectName||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name,t=this.ideInfo.consoleSelected.id;this.replSessionId=t,ul.log(`[VmIde] Setting replSessionId to ${t} for Python program re-run`),this.$store.dispatch(`ide/${Pe.j8}`,{msgId:t,projectName:e,filePath:this.ideInfo.consoleSelected.path,callback:{limits:-1,callback:e=>{const t=e.id===this.replSessionId||e.cmd_id===this.replSessionId||e.data&&e.data.program_id===this.replSessionId||this.isReplMode&&this.replSessionId&&(0===e.code||2e3===e.code||5e3===e.code)&&e.data&&(e.data.stdout||e.data.stderr),i=null===e.data||void 0===e.data||2e3===e.code||4e3===e.code||5e3===e.code;ul.log(" [REPL] Callback - isReplMessage:",t,"isProgramLifecycle:",i,"code:",e.code,"id:",e.id,"replSessionId:",this.replSessionId),!t||i?(ul.log(" [REPL] Processing through handleRunResult"),this.$store.commit("ide/handleRunResult",e)):ul.log(" [REPL] Skipping - will be handled by WebSocket")}}})},stop(e){this.$store.dispatch(`ide/${Pe.aQ}`,{consoleId:e,callback:{limits:-1,callback:t=>{this.$store.commit("ide/handleStopResult",{consoleId:e,dict:t})}}})},stopAll(){for(let e=0;e<this.ideInfo.consoleItems.length;e++)!0===this.ideInfo.consoleItems[e].run&&this.stop(this.ideInfo.consoleItems[e].id);this.stop(null)},startResizeLeft(e){this.isResizingLeft=!0,this.startX=e.clientX,this.startWidth=this.leftSidebarWidth,document.addEventListener("mousemove",this.throttledHandleResizeLeft),document.addEventListener("mouseup",this.stopResizeLeft),e.preventDefault()},handleResizeLeft(e){if(!this.isResizingLeft)return;const t=e.clientX-this.startX,i=window.innerWidth,o=this.rightSidebarVisible?this.rightSidebarWidth:0,s=i-o-this.minEditorWidth-10;let n=this.startWidth+t;this.resizeWarning=n<160||n>s-10,n=Math.max(150,Math.min(Math.min(500,s),n)),this.leftSidebarWidth=n},stopResizeLeft(){this.isResizingLeft=!1,this.resizeWarning=!1,document.removeEventListener("mousemove",this.throttledHandleResizeLeft),document.removeEventListener("mouseup",this.stopResizeLeft),this.validateLayout(),this.saveLayoutPreferences()},startResizeRight(e){this.isResizingRight=!0,this.startX=e.clientX,this.startWidth=this.rightSidebarWidth,document.addEventListener("mousemove",this.throttledHandleResizeRight),document.addEventListener("mouseup",this.stopResizeRight),e.preventDefault()},handleResizeRight(e){if(!this.isResizingRight)return;const t=this.startX-e.clientX,i=window.innerWidth,o=i-this.leftSidebarWidth-this.minEditorWidth-10;let s=this.startWidth+t;this.resizeWarning=s<310||s>o-10,s=Math.max(300,Math.min(o,s)),this.rightSidebarWidth=s},stopResizeRight(){this.isResizingRight=!1,this.resizeWarning=!1,document.removeEventListener("mousemove",this.throttledHandleResizeRight),document.removeEventListener("mouseup",this.stopResizeRight),this.validateLayout(),this.saveLayoutPreferences()},startResizeConsole(e){this.isResizingConsole=!0,this.startY=e.clientY,this.startHeight=this.consoleHeight,document.addEventListener("mousemove",this.throttledHandleResizeConsole),document.addEventListener("mouseup",this.stopResizeConsole),e.preventDefault()},handleResizeConsole(e){if(!this.isResizingConsole)return;const t=this.startY-e.clientY,i=window.innerHeight,o=i-200;let s=this.startHeight+t;s=Math.max(100,Math.min(o,s)),this.consoleHeight=s,this.updateEditorHeight()},stopResizeConsole(){this.isResizingConsole=!1,document.removeEventListener("mousemove",this.throttledHandleResizeConsole),document.removeEventListener("mouseup",this.stopResizeConsole),this.updateEditorHeight(),this.saveLayoutPreferences()},saveLayoutPreferences(){const e={leftSidebarWidth:this.leftSidebarWidth,rightSidebarWidth:this.rightSidebarWidth,rightSidebarVisible:this.rightSidebarVisible,consoleHeight:this.consoleHeight,consoleExpanded:this.consoleExpanded,wordWrap:this.wordWrap,rightPanelMode:this.rightPanelMode,consoleMode:this.consoleMode,consolePreviousMode:this.consolePreviousMode,wasConsoleOpenBeforeRightExpand:this.wasConsoleOpenBeforeRightExpand};localStorage.setItem("ide-layout-preferences",JSON.stringify(e))},loadLayoutPreferences(){const e=localStorage.getItem("ide-layout-preferences");if(e)try{const t=JSON.parse(e);this.leftSidebarWidth=t.leftSidebarWidth||250,this.rightSidebarWidth=t.rightSidebarWidth||400,this.rightSidebarVisible=!0===t.rightSidebarVisible,this.consoleHeight=t.consoleHeight||200,this.consoleExpanded=!1!==t.consoleExpanded,this.wordWrap=!1!==t.wordWrap,this.rightPanelMode=t.rightPanelMode||"closed",this.consoleMode=t.consoleMode||"collapsed",this.consolePreviousMode=t.consolePreviousMode||"normal",this.wasConsoleOpenBeforeRightExpand=t.wasConsoleOpenBeforeRightExpand||!1,this.rightSidebarVisible="closed"!==this.rightPanelMode,this.consoleExpanded="collapsed"!==this.consoleMode,this.consoleMaximized="maximized"===this.consoleMode}catch(t){ul.warn("Failed to load layout preferences:",t)}this.validateLayout(),this.updateEditorHeight()},validateLayout(){const e=window.innerWidth;if(e<900)return;const t=this.leftSidebarWidth+(this.rightSidebarVisible?this.rightSidebarWidth:0),i=e-t-10;if(i<this.minEditorWidth){const t=this.minEditorWidth-i;if(this.rightSidebarVisible){const i=this.leftSidebarWidth/(this.leftSidebarWidth+this.rightSidebarWidth),o=1-i,s=Math.min(this.leftSidebarWidth-150,t*i),n=Math.min(this.rightSidebarWidth-300,t*o);this.leftSidebarWidth=Math.max(150,this.leftSidebarWidth-s),this.rightSidebarWidth=Math.max(300,this.rightSidebarWidth-n);const a=this.leftSidebarWidth+this.rightSidebarWidth;e-a-10<this.minEditorWidth&&(this.rightSidebarVisible=!1)}else this.leftSidebarWidth=Math.max(150,Math.min(this.leftSidebarWidth,e-this.minEditorWidth-10))}},handleProgramInputKeydown(e){if("Enter"===e.key)if(e.shiftKey){e.preventDefault();const t=e.target.selectionStart,i=e.target.selectionEnd,o=this.programInput;this.programInput=o.substring(0,t)+"\n"+o.substring(i),this.$nextTick(()=>{e.target.selectionStart=e.target.selectionEnd=t+1,this.updateProgramInputRows()})}else e.preventDefault(),this.sendProgramInput();else if("Tab"===e.key){e.preventDefault();const t=e.target.selectionStart,i=e.target.selectionEnd,o=this.programInput;this.programInput=o.substring(0,t)+"    "+o.substring(i),this.$nextTick(()=>{e.target.selectionStart=e.target.selectionEnd=t+4,this.updateProgramInputRows()})}this.$nextTick(()=>{this.updateProgramInputRows()})},updateProgramInputRows(){const e=7,t=this.programInput.split("\n").length;this.$refs.programInputField?(this.programInputRows=1,this.$nextTick(()=>{const t=this.$refs.programInputField,i=parseInt(window.getComputedStyle(t).lineHeight)||20,o=t.scrollHeight,s=Math.ceil(o/i);this.programInputRows=Math.min(e,Math.max(1,s))})):this.programInputRows=Math.min(e,Math.max(1,t))},sendProgramInput(){if(!this.programInput.trim())return;const e=this.programInput,t=this.ideInfo.consoleSelected.id;this.$store.commit("ide/addConsoleOutput",{id:t,type:"input",text:` ${e}`}),this.programInput="",this.programInputRows=1,this.$store.commit("ide/setConsoleWaiting",{id:t,waiting:!1,prompt:""}),this.$store.dispatch(`ide/${Pe.WP}`,{program_id:t,input:e,callback:{limits:-1,callback:e=>{ul.log("Input sent:",e)}}}),this.$nextTick(()=>{this.$refs.consoleOutputArea&&(this.$refs.consoleOutputArea.scrollTop=this.$refs.consoleOutputArea.scrollHeight)})},handleReplKeydown(e){if("Enter"===e.key)if(e.shiftKey){e.preventDefault();const t=e.target.selectionStart,i=e.target.selectionEnd,o=this.replInput;this.replInput=o.substring(0,t)+"\n"+o.substring(i),this.$nextTick(()=>{e.target.selectionStart=e.target.selectionEnd=t+1,this.updateReplRows()})}else{e.preventDefault();const t=e.target.selectionStart,i=this.replInput.substring(0,t),o=i.split("\n"),s=o[o.length-1],n=""===s.trim(),a=this.replInput.includes("\n");if(n&&a)this.executeReplCommand();else if(this.shouldContinueMultiline(this.replInput)){const t=e.target.selectionStart,i=e.target.selectionEnd,o=this.replInput;this.replInput=o.substring(0,t)+"\n"+o.substring(i),this.$nextTick(()=>{e.target.selectionStart=e.target.selectionEnd=t+1,this.updateReplRows()})}else this.executeReplCommand()}else if("Tab"===e.key){e.preventDefault();const t=e.target.selectionStart,i=e.target.selectionEnd,o=this.replInput;this.replInput=o.substring(0,t)+"    "+o.substring(i),this.$nextTick(()=>{e.target.selectionStart=e.target.selectionEnd=t+4,this.updateReplRows()})}else"ArrowUp"!==e.key||0!==e.target.selectionStart||this.replInput.includes("\n")?"ArrowDown"!==e.key||this.replInput.includes("\n")||(e.preventDefault(),this.navigateReplHistory("down")):(e.preventDefault(),this.navigateReplHistory("up"));this.$nextTick(()=>{this.updateReplRows()})},updateReplRows(){const e=7,t=this.replInput.split("\n").length;this.$refs.replInputField?(this.replInputRows=1,this.$nextTick(()=>{const t=this.$refs.replInputField,i=parseInt(window.getComputedStyle(t).lineHeight)||20,o=t.scrollHeight,s=Math.ceil(o/i);this.replInputRows=Math.min(e,Math.max(1,s))})):this.replInputRows=Math.min(e,Math.max(1,t))},async executeReplCommand(){let e=this.replInput;while(e.endsWith("\n\n"))e=e.slice(0,-1);if(!e||!e.trim())return this.replInput="",void(this.replInputRows=1);if(this.ideInfo.consoleSelected&&this.ideInfo.consoleSelected.waitingForReplInput){const t=this.ideInfo.consoleSelected.id;if(this.replInput="",this.replInputRows=1,this.$store.commit("ide/addConsoleOutput",{id:t,type:"user-input",text:`>>> ${e}`}),this.wsInfo&&this.wsInfo.rws&&this.wsInfo.rws.readyState===WebSocket.OPEN){const i={cmd:"send_program_input",id:t,data:{program_id:t,input:e}};this.wsInfo.rws.send(JSON.stringify(i)),this.$store.commit("ide/setConsoleWaitingForReplInput",{id:t,waiting:!1})}}else await this.executeReplCommandDualMode(e)},shouldContinueMultiline(e){if(!e||!e.trim())return!1;const t=e.split("\n"),i=t[t.length-1].trim();if(i.endsWith(":"))return!0;e.trim();let o=0,s=0;for(const n of t){if(""===n.trim())continue;const e=n.search(/\S/);if(-1===e)continue;const t=n.trim();t.match(/^(def|class|if|elif|else|for|while|with|try|except|finally)\b.*:/)?(o++,s=e):e<=s&&o>0&&!t.match(/^(elif|else|except|finally)\b/)&&(o=Math.max(0,o-1),s=e)}return o>0&&!i.match(/^(return|break|continue|pass|raise)\b/)},highlightPythonCode(e){if(!e||"string"!==typeof e)return e;if("undefined"!==typeof Prism&&Prism.languages&&Prism.languages.python)try{return Prism.highlight(e,Prism.languages.python,"python")}catch(Sa){return ul.warn("Prism.js highlighting failed:",Sa),this.simpleHighlight(e)}return this.simpleHighlight(e)},isPromptOutput(e){const t=e.text||e.content||e;return"string"===typeof t&&(t.match(/^\s*>>>\s*$/)||t.match(/^\s*\.\.\.\s*$/)||t.match(/^>>>\s*\n*$/)||t.match(/^\.\.\.\s*\n*$/)||">>>"===t.trim()||"..."===t.trim()||">>> "===t||"... "===t)},simpleHighlight(e){if(!e)return e;let t=this.escapeHtml(e);const i=["def","class","if","elif","else","try","except","finally","for","while","with","as","import","from","return","yield","lambda","pass","break","continue","raise","assert","del","and","or","not","in","is","None","True","False","async","await"],o=new RegExp(`\\b(${i.join("|")})\\b`,"g");t=t.replace(o,'<span class="python-keyword">$1</span>'),t=t.replace(/(["'])((?:\\.|(?!\1).)*?)\1/g,'<span class="python-string">$1$2$1</span>'),t=t.replace(/\b(\d+\.?\d*)\b/g,'<span class="python-number">$1</span>'),t=t.replace(/(#.*$)/gm,'<span class="python-comment">$1</span>');const s=["print","input","range","len","str","int","float","list","dict","set","tuple","type","sum","max","min","abs","round","sorted","reversed"],n=new RegExp(`\\b(${s.join("|")})\\b`,"g");return t=t.replace(n,'<span class="python-builtin">$1</span>'),t},escapeHtml(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,e=>t[e])},isMultilineCode(e){return!(!e||"string"!==typeof e)&&(e.includes("\n")&&""!==e.trim())},splitCodeLines(e){return e&&"string"===typeof e?e.split("\n"):[e||""]},ensureReplConsole(){if(ul.log(" [VmIde] ensureReplConsole called"),!this.ideInfo.consoleSelected||!this.ideInfo.consoleSelected.resultList){const e={id:"repl-console",name:"REPL",path:"REPL",resultList:[],run:!1,stop:!1,waitingForInput:!1,inputPrompt:""},t=this.ideInfo.consoleItems.find(e=>"repl-console"===e.id);t||this.$store.commit("ide/pushConsoleItem",e),this.$store.commit("ide/selectConsoleItem","repl-console")}},addReplOutput(e,t="output"){ul.log(` [VmIde] addReplOutput: [${t}] ${e}`),this.ideInfo.consoleSelected&&this.ideInfo.consoleSelected.id&&(this.$store.commit("ide/addConsoleOutput",{id:this.ideInfo.consoleSelected.id,type:t,text:e}),this.$nextTick(()=>{this.$refs.consoleOutputArea&&(this.$refs.consoleOutputArea.scrollTop=this.$refs.consoleOutputArea.scrollHeight)}))},navigateReplHistory(e){if(0!==this.replHistory.length){if("up"===e)-1===this.replHistoryIndex?this.replHistoryIndex=this.replHistory.length-1:this.replHistoryIndex>0&&this.replHistoryIndex--;else if("down"===e){if(-1===this.replHistoryIndex)return;if(!(this.replHistoryIndex<this.replHistory.length-1))return this.replHistoryIndex=-1,void(this.replInput="");this.replHistoryIndex++}this.replHistoryIndex>=0&&(this.replInput=this.replHistory[this.replHistoryIndex])}},async executeTerminalCommand(){if(!this.terminalInput.trim())return;const e=this.terminalInput.trim();if(this.terminalHistory[this.terminalHistory.length-1]!==e&&this.terminalHistory.push(e),this.terminalHistoryIndex=-1,this.addTerminalOutput("input",e),"clear"===e||"clear()"===e)return this.clearTerminal(),void(this.terminalInput="");if("help"===e||"help()"===e)return this.addTerminalOutput("output",this.getHelpText()),this.terminalInput="",void this.$nextTick(()=>{this.scrollTerminalToBottom(),this.focusTerminalInput()});const t=await this.ensurePyodideReady();if(!t)return this.addTerminalOutput("error","Python environment failed to initialize"),void(this.terminalInput="");try{ul.log("[Pyodide] Executing:",e);const t=this.pyodide.runPython(e);void 0!==t&&null!==t&&this.addTerminalOutput("output",String(t))}catch(Sa){ul.error("[Pyodide] Execution error:",Sa),this.addTerminalOutput("error",Sa.toString())}this.terminalInput="",this.$nextTick(()=>{this.scrollTerminalToBottom(),this.focusTerminalInput()})},addTerminalOutput(e,t){this.terminalOutput.push({type:e,content:t,timestamp:(new Date).toISOString()})},getHelpText(){return" Python Interactive Terminal (Powered by Pyodide)\n\nFeatures:\n Full Python 3.11 environment in your browser\n All variables and imports persist across commands\n NumPy, Pandas, Matplotlib support available\n Use Up/Down arrows for command history\n Type 'clear' to clear the terminal\n\nTry these examples:\n  >>> import math\n  >>> math.sqrt(16)\n  >>> x = [1, 2, 3, 4, 5]\n  >>> sum(x)\n\nAdvanced packages (install with micropip):\n  >>> import micropip\n  >>> await micropip.install(\"requests\")"},navigateHistory(e){if(0!==this.terminalHistory.length){if("up"===e)-1===this.terminalHistoryIndex?this.terminalHistoryIndex=this.terminalHistory.length-1:this.terminalHistoryIndex>0&&this.terminalHistoryIndex--;else if("down"===e){if(-1===this.terminalHistoryIndex)return;if(!(this.terminalHistoryIndex<this.terminalHistory.length-1))return this.terminalHistoryIndex=-1,void(this.terminalInput="");this.terminalHistoryIndex++}this.terminalHistoryIndex>=0&&(this.terminalInput=this.terminalHistory[this.terminalHistoryIndex])}},scrollTerminalToBottom(){this.$refs.terminalContent&&(this.$refs.terminalContent.scrollTop=this.$refs.terminalContent.scrollHeight)},focusTerminalInput(){this.$refs.terminalInputField&&this.$refs.terminalInputField.focus()},switchToOutputTab(){this.consoleModeTab="output"},switchToTerminalTab(){this.consoleModeTab="terminal",this.$nextTick(()=>{this.focusTerminalInput()})}}};const gl=(0,b.A)(fl,[["render",Qs],["__scopeId","data-v-59365a52"]]);var vl=gl}}]);