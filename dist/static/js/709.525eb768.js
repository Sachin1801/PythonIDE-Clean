(self["webpackChunkvm_web_ide"]=self["webpackChunkvm_web_ide"]||[]).push([[709],{4317:function(e,t,o){(function(e){e(o(5237))})(function(e){e.defineOption("showTrailingSpace",!1,function(t,o,i){i==e.Init&&(i=!1),i&&!o?t.removeOverlay("trailingspace"):!i&&o&&t.addOverlay({token:function(e){for(var t=e.string.length,o=t;o&&/\s/.test(e.string.charAt(o-1));--o);return o>e.pos?(e.pos=o,null):(e.pos=t,"trailingspace")},name:"trailingspace"})})})},9709:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return dh}});var i=o(641),s=o(3751),n=o(33);const a={class:"login-modal"},r={class:"login-header"},l={class:"login-body"},d={class:"form-group"},c=["disabled"],h={class:"form-group"},u=["disabled"],p={key:0,class:"error-message"},m=["disabled"],f={key:0},g={key:1};function v(e,t,o,v,y,w){const b=(0,i.g2)("X");return o.visible?((0,i.uX)(),(0,i.CE)("div",{key:0,class:"login-modal-overlay",onClick:t[6]||(t[6]=(0,s.D$)((...e)=>w.close&&w.close(...e),["self"]))},[(0,i.Lk)("div",a,[(0,i.Lk)("div",r,[t[7]||(t[7]=(0,i.Lk)("h3",null,"Sign In to Python IDE",-1)),(0,i.Lk)("div",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>w.close&&w.close(...e))},[(0,i.bF)(b,{size:20})])]),(0,i.Lk)("div",l,[(0,i.Lk)("form",{onSubmit:t[5]||(t[5]=(0,s.D$)((...e)=>w.handleLogin&&w.handleLogin(...e),["prevent"]))},[(0,i.Lk)("div",d,[t[8]||(t[8]=(0,i.Lk)("label",{for:"username"},"Username (Student ID)",-1)),(0,i.bo)((0,i.Lk)("input",{id:"username","onUpdate:modelValue":t[1]||(t[1]=e=>y.username=e),type:"text",placeholder:"e.g., sa9082",required:"",disabled:y.loading,onInput:t[2]||(t[2]=(...e)=>w.clearError&&w.clearError(...e))},null,40,c),[[s.Jo,y.username]])]),(0,i.Lk)("div",h,[t[9]||(t[9]=(0,i.Lk)("label",{for:"password"},"Password",-1)),(0,i.bo)((0,i.Lk)("input",{id:"password","onUpdate:modelValue":t[3]||(t[3]=e=>y.password=e),type:"password",placeholder:"Enter your password",required:"",disabled:y.loading,onInput:t[4]||(t[4]=(...e)=>w.clearError&&w.clearError(...e))},null,40,u),[[s.Jo,y.password]])]),y.error?((0,i.uX)(),(0,i.CE)("div",p,(0,n.v_)(y.error),1)):(0,i.Q3)("",!0),(0,i.Lk)("button",{type:"submit",class:"login-btn",disabled:y.loading},[y.loading?((0,i.uX)(),(0,i.CE)("span",f,"Signing in...")):((0,i.uX)(),(0,i.CE)("span",g,"Sign In"))],8,m)],32)])])])):(0,i.Q3)("",!0)}var y=o(6494),w=o(6763),b={name:"LoginModal",components:{X:y.A},props:{visible:{type:Boolean,default:!1}},data(){return{username:"",password:"",loading:!1,error:"",isFirstLogin:!1}},watch:{username(e){e&&e.match(/^[a-z]{2}\d{4}$/)?this.isFirstLogin=!0:this.isFirstLogin=!1}},methods:{async handleLogin(){this.loading=!0,this.error="";try{const e="/api/login",t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.username,password:this.password})}),o=await t.json();o.success?(localStorage.setItem("session_id",o.session_id),localStorage.setItem("username",o.username),localStorage.setItem("role",o.role),localStorage.setItem("full_name",o.full_name),this.$emit("login-success",{username:o.username,role:o.role,full_name:o.full_name,session_id:o.session_id}),this.close(),window.location.reload()):this.error=o.error||"Invalid username or password"}catch(bc){w.error("Login error:",bc),this.error="Connection error. Please try again."}finally{this.loading=!1}},clearError(){this.error=""},close(){this.username="",this.password="",this.error="",this.loading=!1,this.$emit("close")},async validateSession(e){try{const t="/api/validate-session",o=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:e})}),i=await o.json();i.success||(localStorage.removeItem("session_id"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("full_name"))}catch(bc){w.error("Session validation error:",bc)}}},mounted(){const e=localStorage.getItem("session_id");e&&this.validateSession(e)}},k=o(6262);const I=(0,k.A)(b,[["render",v],["__scopeId","data-v-aab38bba"]]);var P=I,S=o(5012),C=o(953),L=o(2273),F=o(8033),R=o(819);const E=(0,R.b_)({to:{type:(0,R.jq)([String,Object]),required:!0},disabled:Boolean});var x=o(8396);const D=(0,i.pM)({__name:"teleport",props:E,setup(e){return(e,t)=>e.disabled?(0,i.RG)(e.$slots,"default",{key:0}):((0,i.uX)(),(0,i.Wv)(i.Im,{key:1,to:e.to},[(0,i.RG)(e.$slots,"default")],8,["to"]))}});var j=(0,x.A)(D,[["__file","teleport.vue"]]),$=o(4769);const T=(0,$.GU)(j);var M=o(1361);const N=Symbol("dialogInjectionKey"),A="dialog-fade";var _=o(5343);const O=(0,R.b_)({center:Boolean,alignCenter:Boolean,closeIcon:{type:_.Ze},draggable:Boolean,overflow:Boolean,fullscreen:Boolean,headerClass:String,bodyClass:String,footerClass:String,showClose:{type:Boolean,default:!0},title:{type:String,default:""},ariaLevel:{type:String,default:"2"}}),W={close:()=>!0};var U=o(6940),z=o(180);const V=(...e)=>t=>{e.forEach(e=>{(0,n.Tn)(e)?e(t):e.value=t})};var B=o(2579);const X=(0,i.pM)({name:"ElDialogContent"}),H=(0,i.pM)({...X,props:O,emits:W,setup(e,{expose:t}){const o=e,{t:s}=(0,B.Ym)(),{Close:a}=_.H2,{dialogRef:r,headerRef:l,bodyId:d,ns:c,style:h}=(0,i.WQ)(N),{focusTrapRef:u}=(0,i.WQ)(U.r3),p=(0,i.EW)(()=>[c.b(),c.is("fullscreen",o.fullscreen),c.is("draggable",o.draggable),c.is("align-center",o.alignCenter),{[c.m("center")]:o.center}]),m=V(u,r),f=(0,i.EW)(()=>o.draggable),g=(0,i.EW)(()=>o.overflow),{resetPosition:v,updatePosition:y}=(0,z.P)(r,l,f,g);return t({resetPosition:v,updatePosition:y}),(e,t)=>((0,i.uX)(),(0,i.CE)("div",{ref:(0,C.R1)(m),class:(0,n.C4)((0,C.R1)(p)),style:(0,n.Tr)((0,C.R1)(h)),tabindex:"-1"},[(0,i.Lk)("header",{ref_key:"headerRef",ref:l,class:(0,n.C4)([(0,C.R1)(c).e("header"),e.headerClass,{"show-close":e.showClose}])},[(0,i.RG)(e.$slots,"header",{},()=>[(0,i.Lk)("span",{role:"heading","aria-level":e.ariaLevel,class:(0,n.C4)((0,C.R1)(c).e("title"))},(0,n.v_)(e.title),11,["aria-level"])]),e.showClose?((0,i.uX)(),(0,i.CE)("button",{key:0,"aria-label":(0,C.R1)(s)("el.dialog.close"),class:(0,n.C4)((0,C.R1)(c).e("headerbtn")),type:"button",onClick:t=>e.$emit("close")},[(0,i.bF)((0,C.R1)(M.tk),{class:(0,n.C4)((0,C.R1)(c).e("close"))},{default:(0,i.k6)(()=>[((0,i.uX)(),(0,i.Wv)((0,i.$y)(e.closeIcon||(0,C.R1)(a))))]),_:1},8,["class"])],10,["aria-label","onClick"])):(0,i.Q3)("v-if",!0)],2),(0,i.Lk)("div",{id:(0,C.R1)(d),class:(0,n.C4)([(0,C.R1)(c).e("body"),e.bodyClass])},[(0,i.RG)(e.$slots,"default")],10,["id"]),e.$slots.footer?((0,i.uX)(),(0,i.CE)("footer",{key:0,class:(0,n.C4)([(0,C.R1)(c).e("footer"),e.footerClass])},[(0,i.RG)(e.$slots,"footer")],2)):(0,i.Q3)("v-if",!0)],6))}});var K=(0,x.A)(H,[["__file","dialog-content.vue"]]),G=o(1069),Q=o(2154);const q=(0,R.b_)({...O,appendToBody:Boolean,appendTo:{type:E.to.type,default:"body"},beforeClose:{type:(0,R.jq)(Function)},destroyOnClose:Boolean,closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},modal:{type:Boolean,default:!0},modalPenetrable:Boolean,openDelay:{type:Number,default:0},closeDelay:{type:Number,default:0},top:{type:String},modelValue:Boolean,modalClass:String,headerClass:String,bodyClass:String,footerClass:String,width:{type:[String,Number]},zIndex:{type:Number},trapFocus:Boolean,headerAriaLevel:{type:String,default:"2"},transition:{type:(0,R.jq)([String,Object]),default:A}}),J={open:()=>!0,opened:()=>!0,close:()=>!0,closed:()=>!0,[G.l4]:e=>(0,Q.Lm)(e),openAutoFocus:()=>!0,closeAutoFocus:()=>!0};var Y=o(2307),Z=o(1236),ee=o(4656),te=o(7010),oe=o(8438),ie=o(5980),se=o(6031);const ne=(e,t)=>{var o;const s=(0,i.nI)(),a=s.emit,{nextZIndex:r}=(0,ee.YK)();let l="";const d=(0,te.Bi)(),c=(0,te.Bi)(),h=(0,C.KR)(!1),u=(0,C.KR)(!1),p=(0,C.KR)(!1),m=(0,C.KR)(null!=(o=e.zIndex)?o:r());let f,g;const v=(0,oe.H3)("namespace",ie.Lt),y=(0,i.EW)(()=>{const t={},o=`--${v.value}-dialog`;return e.fullscreen||(e.top&&(t[`${o}-margin-top`]=e.top),e.width&&(t[`${o}-width`]=(0,se._V)(e.width))),t}),w=(0,i.EW)(()=>e.alignCenter?{display:"flex"}:{}),b=(0,i.EW)(()=>{const t={name:e.transition,onAfterEnter:k,onBeforeLeave:P,onAfterLeave:I};if((0,n.Gv)(e.transition)){const t={...e.transition},o=(e,t)=>o=>{(0,n.cy)(e)?e.forEach(e=>{(0,n.Tn)(e)&&e(o)}):(0,n.Tn)(e)&&e(o),t()};return t.onAfterEnter=o(t.onAfterEnter,k),t.onBeforeLeave=o(t.onBeforeLeave,P),t.onAfterLeave=o(t.onAfterLeave,I),t.name||(t.name=A),t}return t});function k(){a("opened")}function I(){a("closed"),a(G.l4,!1),e.destroyOnClose&&(p.value=!1)}function P(){a("close")}function S(){null==g||g(),null==f||f(),e.openDelay&&e.openDelay>0?({stop:f}=(0,Y.TO)(()=>E(),e.openDelay)):E()}function L(){null==f||f(),null==g||g(),e.closeDelay&&e.closeDelay>0?({stop:g}=(0,Y.TO)(()=>x(),e.closeDelay)):x()}function F(){function t(e){e||(u.value=!0,h.value=!1)}e.beforeClose?e.beforeClose(t):L()}function R(){e.closeOnClickModal&&F()}function E(){Y.oc&&(h.value=!0)}function x(){h.value=!1}function D(){a("openAutoFocus")}function j(){a("closeAutoFocus")}function $(e){var t;"pointer"===(null==(t=e.detail)?void 0:t.focusReason)&&e.preventDefault()}function T(){e.closeOnPressEscape&&F()}return e.lockScroll&&(0,Z.t)(h),(0,i.wB)(()=>e.zIndex,()=>{var t;m.value=null!=(t=e.zIndex)?t:r()}),(0,i.wB)(()=>e.modelValue,o=>{var s;o?(u.value=!1,S(),p.value=!0,m.value=null!=(s=e.zIndex)?s:r(),(0,i.dY)(()=>{a("open"),t.value&&(t.value.parentElement.scrollTop=0,t.value.parentElement.scrollLeft=0,t.value.scrollTop=0)})):h.value&&L()}),(0,i.wB)(()=>e.fullscreen,e=>{t.value&&(e?(l=t.value.style.transform,t.value.style.transform=""):t.value.style.transform=l)}),(0,i.sV)(()=>{e.modelValue&&(h.value=!0,p.value=!0,S())}),{afterEnter:k,afterLeave:I,beforeLeave:P,handleClose:F,onModalClick:R,close:L,doClose:x,onOpenAutoFocus:D,onCloseAutoFocus:j,onCloseRequested:T,onFocusoutPrevented:$,titleId:d,bodyId:c,closed:u,style:y,overlayDialogStyle:w,rendered:p,visible:h,zIndex:m,transitionConfig:b}};var ae=o(9766),re=o(2757);const le=(0,i.pM)({name:"ElDialog",inheritAttrs:!1}),de=(0,i.pM)({...le,props:q,emits:J,setup(e,{expose:t}){const o=e,a=(0,i.Ht)();(0,ae.b)({scope:"el-dialog",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/dialog.html#slots"},(0,i.EW)(()=>!!a.title));const r=(0,ie.DU)("dialog"),l=(0,C.KR)(),d=(0,C.KR)(),c=(0,C.KR)(),{visible:h,titleId:u,bodyId:p,style:m,overlayDialogStyle:f,rendered:g,transitionConfig:v,zIndex:y,handleClose:w,onModalClick:b,onOpenAutoFocus:k,onCloseAutoFocus:I,onCloseRequested:P,onFocusoutPrevented:S}=ne(o,l);(0,i.Gt)(N,{dialogRef:l,headerRef:d,bodyId:p,ns:r,rendered:g,style:m});const R=(0,re.r)(b),E=(0,i.EW)(()=>o.draggable&&!o.fullscreen),x=(0,i.EW)(()=>o.modalPenetrable&&!o.modal&&!o.fullscreen),D=()=>{var e;null==(e=c.value)||e.resetPosition()};return t({visible:h,dialogContentRef:c,resetPosition:D,handleClose:w}),(e,t)=>((0,i.uX)(),(0,i.Wv)((0,C.R1)(T),{to:e.appendTo,disabled:"body"===e.appendTo&&!e.appendToBody},{default:(0,i.k6)(()=>[(0,i.bF)(s.eB,(0,i.v6)((0,C.R1)(v),{persisted:""}),{default:(0,i.k6)(()=>{var t;return[(0,i.bo)((0,i.bF)((0,C.R1)(L._q),{"custom-mask-event":"",mask:e.modal,"overlay-class":[null!=(t=e.modalClass)?t:"",`${(0,C.R1)(r).namespace.value}-modal-dialog`,(0,C.R1)(r).is("penetrable",(0,C.R1)(x))],"z-index":(0,C.R1)(y)},{default:(0,i.k6)(()=>[(0,i.Lk)("div",{role:"dialog","aria-modal":"true","aria-label":e.title||void 0,"aria-labelledby":e.title?void 0:(0,C.R1)(u),"aria-describedby":(0,C.R1)(p),class:(0,n.C4)(`${(0,C.R1)(r).namespace.value}-overlay-dialog`),style:(0,n.Tr)((0,C.R1)(f)),onClick:(0,C.R1)(R).onClick,onMousedown:(0,C.R1)(R).onMousedown,onMouseup:(0,C.R1)(R).onMouseup},[(0,i.bF)((0,C.R1)(F.A),{loop:"",trapped:(0,C.R1)(h),"focus-start-el":"container",onFocusAfterTrapped:(0,C.R1)(k),onFocusAfterReleased:(0,C.R1)(I),onFocusoutPrevented:(0,C.R1)(S),onReleaseRequested:(0,C.R1)(P)},{default:(0,i.k6)(()=>[(0,C.R1)(g)?((0,i.uX)(),(0,i.Wv)(K,(0,i.v6)({key:0,ref_key:"dialogContentRef",ref:c},e.$attrs,{center:e.center,"align-center":e.alignCenter,"close-icon":e.closeIcon,draggable:(0,C.R1)(E),overflow:e.overflow,fullscreen:e.fullscreen,"header-class":e.headerClass,"body-class":e.bodyClass,"footer-class":e.footerClass,"show-close":e.showClose,title:e.title,"aria-level":e.headerAriaLevel,onClose:(0,C.R1)(w)}),(0,i.eX)({header:(0,i.k6)(()=>[e.$slots.title?(0,i.RG)(e.$slots,"title",{key:1}):(0,i.RG)(e.$slots,"header",{key:0,close:(0,C.R1)(w),titleId:(0,C.R1)(u),titleClass:(0,C.R1)(r).e("title")})]),default:(0,i.k6)(()=>[(0,i.RG)(e.$slots,"default")]),_:2},[e.$slots.footer?{name:"footer",fn:(0,i.k6)(()=>[(0,i.RG)(e.$slots,"footer")])}:void 0]),1040,["center","align-center","close-icon","draggable","overflow","fullscreen","header-class","body-class","footer-class","show-close","title","aria-level","onClose"])):(0,i.Q3)("v-if",!0)]),_:3},8,["trapped","onFocusAfterTrapped","onFocusAfterReleased","onFocusoutPrevented","onReleaseRequested"])],46,["aria-label","aria-labelledby","aria-describedby","onClick","onMousedown","onMouseup"])]),_:3},8,["mask","overlay-class","z-index"]),[[s.aG,(0,C.R1)(h)]])]}),_:3},16)]),_:3},8,["to","disabled"]))}});var ce=(0,x.A)(de,[["__file","dialog.vue"]]);const he=(0,$.GU)(ce);var ue=o(4481),pe=o(5271);const me={class:"file-browser-content"},fe={class:"current-path"},ge={class:"path-value"},ve={class:"file-tree-container"},ye={class:"node-item"},we=["src"],be={class:"node-label"},ke={key:0,class:"selected-file"},Ie={class:"selected-value"},Pe={key:1,class:"selected-file"},Se={class:"selected-value"},Ce={class:"dialog-footer"};function Le(e,t,o,s,a,r){const l=pe.qk,d=ue.S2,c=he;return(0,i.uX)(),(0,i.Wv)(c,{title:r.title,modelValue:r.visible,"onUpdate:modelValue":t[0]||(t[0]=e=>r.visible=e),width:"600px","close-on-click-modal":!1,onClose:r.handleClose,class:"file-browser-dialog custom-dialog"},{footer:(0,i.k6)(()=>[(0,i.Lk)("div",Ce,[(0,i.bF)(d,{onClick:r.handleClose},{default:(0,i.k6)(()=>t[4]||(t[4]=[(0,i.eW)("Cancel",-1)])),_:1,__:[4]},8,["onClick"]),(0,i.bF)(d,{type:"primary",onClick:r.handleConfirm,disabled:!r.canConfirm},{default:(0,i.k6)(()=>[(0,i.eW)((0,n.v_)(r.confirmButtonText),1)]),_:1},8,["onClick","disabled"])])]),default:(0,i.k6)(()=>[(0,i.Lk)("div",me,[(0,i.Lk)("div",fe,[t[1]||(t[1]=(0,i.Lk)("span",{class:"path-label"},"Current Path:",-1)),(0,i.Lk)("span",ge,(0,n.v_)(a.currentPath||"/"),1)]),(0,i.Lk)("div",ve,[(0,i.bF)(l,{data:r.treeData,props:a.treeProps,"node-key":"path","expand-on-click-node":!1,"default-expanded-keys":a.expandedKeys,"highlight-current":"",onNodeClick:r.handleNodeClick,onNodeExpand:r.handleNodeExpand,onNodeCollapse:r.handleNodeCollapse,ref:"fileTree"},{default:(0,i.k6)(({node:e,data:t})=>[(0,i.Lk)("span",ye,[(0,i.Lk)("img",{src:r.getIconUrl(t),alt:"",class:"node-icon"},null,8,we),(0,i.Lk)("span",be,(0,n.v_)(e.label),1)])]),_:1},8,["data","props","default-expanded-keys","onNodeClick","onNodeExpand","onNodeCollapse"])]),"open"===o.mode?((0,i.uX)(),(0,i.CE)("div",ke,[t[2]||(t[2]=(0,i.Lk)("span",{class:"selected-label"},"Selected File:",-1)),(0,i.Lk)("span",Ie,(0,n.v_)(a.selectedFile?a.selectedFile.label:"None"),1)])):(0,i.Q3)("",!0),"move"===o.mode?((0,i.uX)(),(0,i.CE)("div",Pe,[t[3]||(t[3]=(0,i.Lk)("span",{class:"selected-label"},"Move to:",-1)),(0,i.Lk)("span",Se,(0,n.v_)(a.selectedFolder?a.selectedFolder.path:"/"),1)])):(0,i.Q3)("",!0)])]),_:1},8,["title","modelValue","onClose"])}o(4114),o(8111),o(2489),o(7588),o(1701);var Fe=o(3793),Re=o(6763),Ee={name:"DialogFileBrowser",props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"open",validator:e=>["open","move"].includes(e)},fileToMove:{type:Object,default:null},currentUser:{type:Object,default:null}},data(){return{selectedFile:null,selectedFolder:null,currentPath:"/",expandedKeys:[],treeProps:{label:"label",children:"children"}}},computed:{visible:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},title(){return"open"===this.mode?"Open File":"Move File"},confirmButtonText(){return"open"===this.mode?"Open":"Move"},canConfirm(){return"open"===this.mode?null!==this.selectedFile:"move"===this.mode&&(null!==this.selectedFolder&&this.fileToMove&&this.selectedFolder.path!==this.getParentPath(this.fileToMove.path))},ideInfo(){return this.$store?.state?.ide?.ideInfo||{}},treeData(){let e;return e=this.ideInfo.multiRootData&&this.ideInfo.multiRootData.children.length>0?this.ideInfo.multiRootData.children:this.ideInfo.currProj.data?[this.ideInfo.currProj.data]:[],"move"===this.mode&&(e=this.filterOutFile(e),e=this.filterByPermissions(e)),e},isStudent(){return this.currentUser&&"student"===this.currentUser.role},studentDirectory(){return this.isStudent&&this.currentUser?.username?`Local/${this.currentUser.username}`:null}},methods:{getIconUrl(e){try{if("file"===e.type){const t=e.path.substring(e.path.lastIndexOf(".")+1);return o(238)(`./${(0,Fe.ry)(t)}`)}if("dir"===e.type||"folder"===e.type){const t=this.expandedKeys.includes(e.path),i=t?(0,Fe.vT)(e.label):(0,Fe.lM)(e.label);return o(238)(`./${i}`)}}catch(t){return"file"===e.type?o(7844):o(7734)}},handleNodeClick(e){if("open"===this.mode)"file"===e.type?(this.selectedFile=e,this.currentPath=e.path):this.expandedKeys.includes(e.path)?this.handleNodeCollapse(e):this.handleNodeExpand(e);else if("move"===this.mode&&("dir"===e.type||"folder"===e.type)){if(this.currentUser&&this.isStudent&&!this.canAccessPath(e.path))return void this.$message.warning("You can only move files within your personal directory");this.selectedFolder=e,this.currentPath=e.path}},handleNodeExpand(e){this.expandedKeys.includes(e.path)||this.expandedKeys.push(e.path)},handleNodeCollapse(e){const t=this.expandedKeys.indexOf(e.path);t>-1&&this.expandedKeys.splice(t,1)},handleConfirm(){if(Re.log("[DialogFileBrowser] handleConfirm called:",{mode:this.mode,selectedFile:this.selectedFile,selectedFolder:this.selectedFolder,fileToMove:this.fileToMove}),"open"===this.mode&&this.selectedFile)Re.log("[DialogFileBrowser] Opening file:",this.selectedFile.path),this.$emit("open-file",this.selectedFile.path),this.handleClose();else if("move"===this.mode&&this.selectedFolder&&this.fileToMove){const e=this.getFileName(this.fileToMove.path),t=this.selectedFolder.path.endsWith("/")?this.selectedFolder.path+e:this.selectedFolder.path+"/"+e;Re.log("[DialogFileBrowser] Moving file - DETAILED DEBUG:",{mode:this.mode,oldPath:this.fileToMove.path,newPath:t,selectedFolderPath:this.selectedFolder.path,fileName:e,fileToMove:this.fileToMove,selectedFolder:this.selectedFolder,projectName:this.fileToMove.projectName||this.ideInfo.currProj?.data?.name}),this.$emit("move-file",{oldPath:this.fileToMove.path,newPath:t,projectName:this.fileToMove.projectName||this.ideInfo.currProj?.data?.name}),this.handleClose()}else Re.log("[DialogFileBrowser] Cannot confirm - missing requirements:",{mode:this.mode,hasSelectedFile:!!this.selectedFile,hasSelectedFolder:!!this.selectedFolder,hasFileToMove:!!this.fileToMove,canConfirm:this.canConfirm})},handleClose(){this.selectedFile=null,this.selectedFolder=null,this.currentPath="/",this.expandedKeys=[],this.$emit("update:modelValue",!1)},getParentPath(e){const t=e.lastIndexOf("/");return t>0?e.substring(0,t):"/"},getFileName(e){const t=e.lastIndexOf("/");return t>=0?e.substring(t+1):e},filterOutFile(e){return this.fileToMove?e.map(e=>e.path===this.fileToMove.path?null:e.children&&e.children.length>0?{...e,children:this.filterOutFile(e.children).filter(Boolean)}:e).filter(Boolean):e},filterByPermissions(e){return this.isStudent?e.map(e=>this.canAccessPath(e.path)?e.children&&e.children.length>0?{...e,children:this.filterByPermissions(e.children)}:e:null).filter(Boolean):e},canAccessPath(e){return!this.isStudent||!(!e||!this.studentDirectory)&&(e===this.studentDirectory||e.startsWith(this.studentDirectory+"/"))}},watch:{visible(e){e&&(this.selectedFile=null,this.selectedFolder=null,this.currentPath="/",this.expandedKeys=[],this.$nextTick(()=>{this.treeData&&this.treeData.length>0&&this.treeData.forEach(e=>{"dir"!==e.type&&"folder"!==e.type||!e.path||this.expandedKeys.push(e.path)})}))}}};const xe=(0,k.A)(Ee,[["render",Le]]);var De=xe;const je={class:"import-file-dialog"},$e={class:"dialog-header"},Te={class:"dialog-body"},Me={class:"directory-section"},Ne={class:"directory-nav"},Ae={key:0,class:"directory-tree"},_e=["onClick"],Oe={class:"upload-section"},We={class:"upload-icon"},Ue={key:0,class:"error-hint"},ze={key:0,class:"selected-files-section"},Ve={class:"selected-files-list"},Be={class:"file-info"},Xe=["src"],He={class:"file-details"},Ke={class:"file-name"},Ge={class:"file-size"},Qe=["onClick"],qe={key:1,class:"preview-section"},Je={class:"import-preview"},Ye={class:"destination-info"},Ze={class:"destination-path"},et={class:"file-count"},tt={class:"dialog-footer"},ot=["disabled"];function it(e,t,o,a,r,l){const d=(0,i.g2)("X"),c=(0,i.g2)("FolderOpen"),h=(0,i.g2)("ChevronDown"),u=(0,i.g2)("ChevronRight"),p=(0,i.g2)("Home"),m=(0,i.g2)("Folder"),f=(0,i.g2)("Upload");return(0,i.uX)(),(0,i.CE)("div",null,[t[14]||(t[14]=(0,i.Lk)("div",{class:"dialog-cover"},null,-1)),(0,i.Lk)("div",je,[(0,i.Lk)("div",$e,[t[9]||(t[9]=(0,i.Lk)("h3",null,"Import Files",-1)),(0,i.Lk)("div",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>l.onCancel&&l.onCancel(...e))},[(0,i.bF)(d,{size:20})])]),(0,i.Lk)("div",Te,[(0,i.Lk)("div",Me,[t[10]||(t[10]=(0,i.Lk)("label",null,"Select Destination Directory:",-1)),(0,i.Lk)("div",Ne,[(0,i.Lk)("div",{class:"current-path",onClick:t[1]||(t[1]=(...e)=>l.toggleDirectoryTree&&l.toggleDirectoryTree(...e))},[(0,i.bF)(c,{size:16}),(0,i.Lk)("span",null,(0,n.v_)(l.formatCurrentPath(r.currentPath)),1),r.showDirectoryTree?((0,i.uX)(),(0,i.Wv)(h,{key:0,size:16,class:"chevron"})):((0,i.uX)(),(0,i.Wv)(u,{key:1,size:16,class:"chevron"}))]),r.showDirectoryTree?((0,i.uX)(),(0,i.CE)("div",Ae,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.directories,e=>((0,i.uX)(),(0,i.CE)("div",{key:e.path,class:(0,n.C4)(["directory-item",{selected:r.currentPath===e.path,"root-item":e.isRoot}]),style:(0,n.Tr)({paddingLeft:20*e.level+12+"px"}),onClick:t=>l.selectDirectory(e)},[e.isRoot?((0,i.uX)(),(0,i.Wv)(p,{key:0,size:14})):((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[(0,i.bF)(u,{size:14}),(0,i.bF)(m,{size:14})],64)),(0,i.Lk)("span",null,(0,n.v_)(e.displayName||e.name),1)],14,_e))),128))])):(0,i.Q3)("",!0)])]),(0,i.Lk)("div",Oe,[t[12]||(t[12]=(0,i.Lk)("label",null,"Select Files to Import:",-1)),(0,i.Lk)("div",{class:(0,n.C4)(["file-drop-area",{"drag-over":r.dragOver}]),onDrop:t[3]||(t[3]=(...e)=>l.handleDrop&&l.handleDrop(...e)),onDragover:t[4]||(t[4]=(0,s.D$)(e=>r.dragOver=!0,["prevent"])),onDragleave:t[5]||(t[5]=(0,s.D$)(e=>r.dragOver=!1,["prevent"])),onClick:t[6]||(t[6]=(...e)=>l.triggerFileInput&&l.triggerFileInput(...e))},[(0,i.Lk)("input",{type:"file",ref:"fileInput",onChange:t[2]||(t[2]=(...e)=>l.handleFileSelect&&l.handleFileSelect(...e)),multiple:"",accept:".py,.txt,.csv,.pdf",style:{display:"none"}},null,544),(0,i.Lk)("div",We,[(0,i.bF)(f,{size:48})]),t[11]||(t[11]=(0,i.Lk)("div",{class:"upload-text"},[(0,i.Lk)("div",{class:"main-text"},"Click to select files or drag and drop"),(0,i.Lk)("div",{class:"sub-text"},"Supported formats: .py, .txt, .csv, .pdf")],-1))],34),r.uploadError?((0,i.uX)(),(0,i.CE)("div",Ue,(0,n.v_)(r.uploadError),1)):(0,i.Q3)("",!0)]),r.selectedFiles.length>0?((0,i.uX)(),(0,i.CE)("div",ze,[(0,i.Lk)("label",null,"Selected Files ("+(0,n.v_)(r.selectedFiles.length)+"):",1),(0,i.Lk)("div",Ve,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.selectedFiles,(e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t,class:"file-item"},[(0,i.Lk)("div",Be,[(0,i.Lk)("img",{src:l.getFileIcon(e.name),alt:"",class:"file-icon"},null,8,Xe),(0,i.Lk)("div",He,[(0,i.Lk)("div",Ke,(0,n.v_)(e.name),1),(0,i.Lk)("div",Ge,(0,n.v_)(l.formatFileSize(e.size)),1)])]),(0,i.Lk)("button",{class:"remove-btn",onClick:e=>l.removeFile(t),title:"Remove"},[(0,i.bF)(d,{size:16})],8,Qe)]))),128))])])):(0,i.Q3)("",!0),r.selectedFiles.length>0&&!r.uploadError?((0,i.uX)(),(0,i.CE)("div",qe,[t[13]||(t[13]=(0,i.Lk)("label",null,"Files will be imported to:",-1)),(0,i.Lk)("div",Je,[(0,i.Lk)("div",Ye,[(0,i.bF)(c,{size:20}),(0,i.Lk)("div",null,[(0,i.Lk)("div",Ze,(0,n.v_)(l.formatCurrentPath(r.currentPath)),1),(0,i.Lk)("div",et,(0,n.v_)(r.selectedFiles.length)+" file(s) selected",1)])])])])):(0,i.Q3)("",!0)]),(0,i.Lk)("div",tt,[(0,i.Lk)("button",{class:"btn-cancel",onClick:t[7]||(t[7]=(...e)=>l.onCancel&&l.onCancel(...e))},"Cancel"),(0,i.Lk)("button",{class:"btn-import",onClick:t[8]||(t[8]=(...e)=>l.onImport&&l.onImport(...e)),disabled:0===r.selectedFiles.length||r.uploading},(0,n.v_)(r.uploading?"Importing...":`Import ${r.selectedFiles.length} file(s)`),9,ot)])])])}o(3579);var st=o(4829),nt=o(7336),at=o(7950),rt=o(4758),lt=o(5365),dt=o(1058),ct=o(6660),ht=o(6990),ut=o(6763),pt={props:{modelValue:Boolean},data(){return{currentPath:"/",currentProject:null,directories:[],selectedFiles:[],uploadError:"",uploading:!1,showDirectoryTree:!1,dragOver:!1,supportedExtensions:[".py",".txt",".csv",".pdf"]}},computed:{ideInfo(){return this.$store.state.ide.ideInfo},currentUser(){const e=localStorage.getItem("session_id"),t=localStorage.getItem("username"),o=localStorage.getItem("role"),i=localStorage.getItem("full_name");return e&&t?{session_id:e,username:t,role:o,full_name:i}:null}},components:{X:y.A,FolderOpen:st.A,Folder:nt.A,ChevronRight:at.A,ChevronDown:rt.A,Upload:lt.A,Home:dt.A},mounted(){this.loadDirectoryStructure()},methods:{loadDirectoryStructure(){if(this.ideInfo.multiRootData&&this.ideInfo.multiRootData.children.length>0?(this.directories=[],this.ideInfo.multiRootData.children.forEach(e=>{const t=this.buildDirectoryTree(e,0,e.label);this.directories=this.directories.concat(t)})):this.ideInfo.currProj&&this.ideInfo.currProj.data&&(this.directories=this.buildDirectoryTree(this.ideInfo.currProj.data,0,this.ideInfo.currProj.data.label)),this.ideInfo.nodeSelected){if("dir"===this.ideInfo.nodeSelected.type||"folder"===this.ideInfo.nodeSelected.type)this.currentPath=this.ideInfo.nodeSelected.path,this.currentProject=this.ideInfo.nodeSelected.projectName||this.ideInfo.currProj?.data?.name;else if("file"===this.ideInfo.nodeSelected.type){const e=this.ideInfo.nodeSelected.path.substring(0,this.ideInfo.nodeSelected.path.lastIndexOf("/"))||"/";this.currentPath=e,this.currentProject=this.ideInfo.nodeSelected.projectName||this.ideInfo.currProj?.data?.name}}else this.currentProject=this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name},buildDirectoryTree(e,t=0,o=null){let i=[];return 0===t&&i.push({name:o||e.label||"/",displayName:o||e.label||"/",path:e.path||"/",level:0,isRoot:!0,projectName:o||e.label,fullPath:o?`${o}${e.path}`:e.path}),e.children&&e.children.forEach(e=>{"dir"!==e.type&&"folder"!==e.type||(i.push({name:e.label,displayName:e.label,path:e.path,level:t+1,isRoot:!1,projectName:o||e.projectName,fullPath:o?`${o}${e.path}`:e.path}),e.children&&(i=i.concat(this.buildDirectoryTree(e,t+1,o))))}),i},selectDirectory(e){this.currentPath=e.path,this.currentProject=e.projectName,this.showDirectoryTree=!1},toggleDirectoryTree(){this.showDirectoryTree=!this.showDirectoryTree},formatCurrentPath(e){if(this.currentProject)return"/"===e?this.currentProject:e.startsWith(this.currentProject)?e:this.currentProject+e;if("/"===e&&this.ideInfo.currProj)return this.ideInfo.currProj.data?.label||this.ideInfo.currProj.config?.name;if(e.startsWith("/")&&this.ideInfo.currProj){const t=this.ideInfo.currProj.data?.label||this.ideInfo.currProj.config?.name;return e.includes(t)?e:t+e}return e},triggerFileInput(){this.$refs.fileInput.click()},handleFileSelect(e){const t=Array.from(e.target.files);this.processFiles(t)},handleDrop(e){e.preventDefault(),this.dragOver=!1;const t=Array.from(e.dataTransfer.files);this.processFiles(t)},processFiles(e){this.uploadError="";const t=[],o=[];e.forEach(e=>{const i="."+e.name.split(".").pop().toLowerCase();this.supportedExtensions.includes(i)?e.size<=10485760?t.push(e):o.push(`${e.name} (file too large, max 10MB)`):o.push(`${e.name} (unsupported format)`)}),o.length>0&&(this.uploadError=`Invalid files: ${o.join(", ")}`),t.forEach(e=>{const t=this.selectedFiles.some(t=>t.name===e.name&&t.size===e.size);t||this.selectedFiles.push(e)})},removeFile(e){this.selectedFiles.splice(e,1),0===this.selectedFiles.length&&(this.uploadError="")},formatFileSize(e){if(0===e)return"0 Bytes";const t=1024,o=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,i)).toFixed(2))+" "+o[i]},getFileIcon(e){const t=e.substring(e.lastIndexOf(".")+1);return o(238)(`./${(0,Fe.ry)(t)}`)},async onImport(){if(0===this.selectedFiles.length)return;this.uploading=!0;const e=this.currentProject||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name;let t=this.currentPath;t&&e&&t.startsWith(e)&&(t=t.substring(e.length)||"/"),t&&!t.startsWith("/")&&(t="/"+t),ut.log("[DialogImportFile] Upload params:",{projectName:e,rawCurrentPath:this.currentPath,cleanedParentPath:t});try{const o=this.selectedFiles.map(async o=>{const i=new FormData;i.append("file",o),i.append("projectName",e),i.append("parentPath",t),i.append("filename",o.name);const s=await fetch("/api/upload-file",{method:"POST",body:i,headers:{"session-id":this.currentUser?.session_id}}),n=await s.json();if(!n.success)throw new Error(`Failed to upload ${o.name}: ${n.error}`);return n});await Promise.all(o),ht.nk.success(`Successfully imported ${this.selectedFiles.length} file(s)`),this.$store.dispatch(`ide/${ct.QQ}`,{projectName:e,callback:e=>{0===e.code&&(this.$store.commit("ide/handleProject",e.data),this.ideInfo.multiRootData&&this.$parent.loadAllDefaultProjects?.())}}),this.$emit("files-imported",{count:this.selectedFiles.length,destination:this.currentPath,projectName:e}),this.$emit("update:modelValue",!1)}catch(bc){ut.error("[DialogImportFile] Error importing files:",bc),ht.nk.error("Failed to import files: "+bc.message)}finally{this.uploading=!1}},onCancel(){this.$emit("update:modelValue",!1)}}};const mt=(0,k.A)(pt,[["render",it],["__scopeId","data-v-576c5682"]]);var ft=mt;const gt={class:"new-folder-dialog"},vt={class:"dialog-header"},yt={class:"dialog-body"},wt={class:"directory-section"},bt={class:"directory-nav"},kt={key:0,class:"directory-tree"},It=["onClick"],Pt={class:"foldername-section"},St={class:"foldername-input-wrapper"},Ct={class:"folder-type-icon"},Lt={key:0,class:"error-hint"},Ft={key:1,class:"folder-hint"},Rt={key:0,class:"preview-section"},Et={class:"folder-preview"},xt={class:"folder-info"},Dt={class:"folder-path"},jt={class:"dialog-footer"},$t=["disabled"];function Tt(e,t,o,a,r,l){const d=(0,i.g2)("X"),c=(0,i.g2)("FolderOpen"),h=(0,i.g2)("ChevronDown"),u=(0,i.g2)("ChevronRight"),p=(0,i.g2)("Home"),m=(0,i.g2)("Folder");return(0,i.uX)(),(0,i.CE)("div",null,[t[11]||(t[11]=(0,i.Lk)("div",{class:"dialog-cover"},null,-1)),(0,i.Lk)("div",gt,[(0,i.Lk)("div",vt,[t[6]||(t[6]=(0,i.Lk)("h3",null,"New Folder",-1)),(0,i.Lk)("div",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>l.onCancel&&l.onCancel(...e))},[(0,i.bF)(d,{size:20})])]),(0,i.Lk)("div",yt,[(0,i.Lk)("div",wt,[t[7]||(t[7]=(0,i.Lk)("label",null,"Select Parent Directory:",-1)),(0,i.Lk)("div",bt,[(0,i.Lk)("div",{class:"current-path",onClick:t[1]||(t[1]=(...e)=>l.toggleDirectoryTree&&l.toggleDirectoryTree(...e))},[(0,i.bF)(c,{size:16}),(0,i.Lk)("span",null,(0,n.v_)(l.formatCurrentPath(r.currentPath)),1),r.showDirectoryTree?((0,i.uX)(),(0,i.Wv)(h,{key:0,size:16,class:"chevron"})):((0,i.uX)(),(0,i.Wv)(u,{key:1,size:16,class:"chevron"}))]),r.showDirectoryTree?((0,i.uX)(),(0,i.CE)("div",kt,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.directories,e=>((0,i.uX)(),(0,i.CE)("div",{key:e.path,class:(0,n.C4)(["directory-item",{selected:r.currentPath===e.path,"root-item":e.isRoot}]),style:(0,n.Tr)({paddingLeft:20*e.level+12+"px"}),onClick:t=>l.selectDirectory(e)},[e.isRoot?((0,i.uX)(),(0,i.Wv)(p,{key:0,size:14})):((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[(0,i.bF)(u,{size:14}),(0,i.bF)(m,{size:14})],64)),(0,i.Lk)("span",null,(0,n.v_)(e.displayName||e.name),1)],14,It))),128))])):(0,i.Q3)("",!0)])]),(0,i.Lk)("div",Pt,[t[8]||(t[8]=(0,i.Lk)("label",null,"Folder Name:",-1)),(0,i.Lk)("div",St,[(0,i.bo)((0,i.Lk)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>r.folderName=e),onInput:t[3]||(t[3]=(...e)=>l.validateFolderName&&l.validateFolderName(...e)),placeholder:"Enter folder name",class:"foldername-input",ref:"folderNameInput"},null,544),[[s.Jo,r.folderName]]),(0,i.Lk)("div",Ct,[(0,i.bF)(m,{size:20})])]),r.folderNameError?((0,i.uX)(),(0,i.CE)("div",Lt,(0,n.v_)(r.folderNameError),1)):((0,i.uX)(),(0,i.CE)("div",Ft," Folder names should not contain special characters "))]),r.folderName&&!r.folderNameError?((0,i.uX)(),(0,i.CE)("div",Rt,[t[10]||(t[10]=(0,i.Lk)("label",null,"Folder will be created at:",-1)),(0,i.Lk)("div",Et,[(0,i.Lk)("div",xt,[(0,i.bF)(m,{size:20}),(0,i.Lk)("div",null,[(0,i.Lk)("div",Dt,(0,n.v_)(l.getFullFolderPath()),1),t[9]||(t[9]=(0,i.Lk)("div",{class:"folder-type"},"Directory",-1))])])])])):(0,i.Q3)("",!0)]),(0,i.Lk)("div",jt,[(0,i.Lk)("button",{class:"btn-cancel",onClick:t[4]||(t[4]=(...e)=>l.onCancel&&l.onCancel(...e))},"Cancel"),(0,i.Lk)("button",{class:"btn-create",onClick:t[5]||(t[5]=(...e)=>l.onCreate&&l.onCreate(...e)),disabled:!r.folderName||!!r.folderNameError||r.creating},(0,n.v_)(r.creating?"Creating...":"Create Folder"),9,$t)])])])}o(116);var Mt=o(6763),Nt={props:{modelValue:Boolean},data(){return{currentPath:"/",currentProject:null,directories:[],folderName:"",folderNameError:"",creating:!1,showDirectoryTree:!1}},components:{X:y.A,FolderOpen:st.A,Folder:nt.A,ChevronRight:at.A,ChevronDown:rt.A,Home:dt.A},mounted(){this.loadDirectoryStructure(),this.$nextTick(()=>{this.$refs.folderNameInput?.focus()})},methods:{isDirectoryVisibleToStudent(e){if(!this.currentUser||"student"!==this.currentUser.role)return!0;const t=`Local/${this.currentUser.username}`;return"/"===e||e.startsWith(t)},loadDirectoryStructure(){if(this.ideInfo.multiRootData&&this.ideInfo.multiRootData.children.length>0?(this.directories=[],this.ideInfo.multiRootData.children.forEach(e=>{const t=this.buildDirectoryTree(e,0,e.label);this.directories=this.directories.concat(t)})):this.ideInfo.currProj&&this.ideInfo.currProj.data&&(this.directories=this.buildDirectoryTree(this.ideInfo.currProj.data,0,this.ideInfo.currProj.data.label)),this.ideInfo.nodeSelected){if("dir"===this.ideInfo.nodeSelected.type||"folder"===this.ideInfo.nodeSelected.type)this.currentPath=this.ideInfo.nodeSelected.path,this.currentProject=this.ideInfo.nodeSelected.projectName||this.ideInfo.currProj?.data?.name;else if("file"===this.ideInfo.nodeSelected.type){const e=this.ideInfo.nodeSelected.path.substring(0,this.ideInfo.nodeSelected.path.lastIndexOf("/"))||"/";this.currentPath=e,this.currentProject=this.ideInfo.nodeSelected.projectName||this.ideInfo.currProj?.data?.name}}else this.currentProject=this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name;if(this.currentUser&&"student"===this.currentUser.role&&"/"===this.currentPath){const e=`Local/${this.currentUser.username}`,t=this.directories.find(t=>t.path===e);t&&(this.currentPath=e)}},buildDirectoryTree(e,t=0,o=null){let i=[];return 0===t&&i.push({name:o||e.label||"/",displayName:o||e.label||"/",path:e.path||"/",level:0,isRoot:!0,projectName:o||e.label,fullPath:o?`${o}${e.path}`:e.path}),e.children&&e.children.forEach(e=>{"dir"!==e.type&&"folder"!==e.type||this.isDirectoryVisibleToStudent(e.path)&&(i.push({name:e.label,displayName:e.label,path:e.path,level:t+1,isRoot:!1,projectName:o||e.projectName,fullPath:o?`${o}${e.path}`:e.path}),e.children&&(i=i.concat(this.buildDirectoryTree(e,t+1,o))))}),i},selectDirectory(e){this.currentPath=e.path,this.currentProject=e.projectName,this.showDirectoryTree=!1},toggleDirectoryTree(){this.showDirectoryTree=!this.showDirectoryTree},formatCurrentPath(e){if(e&&"/"!==e){const t=["Local","Lecture Notes"];for(let o of t)if(e.startsWith(o))return e}if(this.currentProject)return"/"===e?this.currentProject:e.startsWith(this.currentProject)?e:this.currentProject+e;if("/"===e&&this.ideInfo.currProj)return this.ideInfo.currProj.data?.label||this.ideInfo.currProj.config?.name;if(e.startsWith("/")&&this.ideInfo.currProj){const t=this.ideInfo.currProj.data?.label||this.ideInfo.currProj.config?.name;return e.includes(t)?e:t+e}return e},validateFolderName(){if(this.folderNameError="",!this.folderName)return;if(/[<>:"|?*\\\/]/.test(this.folderName))return void(this.folderNameError="Folder name contains invalid characters");const e=["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"],t=this.folderName.toUpperCase();e.includes(t)?this.folderNameError="This is a reserved folder name":this.folderName.startsWith(".")||this.folderName.endsWith(".")?this.folderNameError="Folder name cannot start or end with a dot":this.folderName.length>255&&(this.folderNameError="Folder name is too long")},getFullFolderPath(){const e=this.folderName||"new_folder",t="/"===this.currentPath?`/${e}`:`${this.currentPath}/${e}`;return this.formatCurrentPath(t)},async onCreate(){if(this.folderName&&!this.folderNameError){this.creating=!0;try{const e=this.folderName,t=this.currentPath,o=this.currentProject||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name;Mt.log("[DialogNewFolder] Creating folder:",{folderName:e,parentPath:t,projectName:o}),await new Promise((i,s)=>{this.$store.dispatch(`ide/${ct.p_}`,{projectName:o,parentPath:t,folderName:e,callback:n=>{if(Mt.log("[DialogNewFolder] Create folder response:",n),0===n.code){ht.nk.success(`Folder "${e}" created successfully`),this.$store.dispatch(`ide/${ct.QQ}`,{projectName:o,callback:e=>{0===e.code&&(this.$store.commit("ide/handleProject",e.data),this.ideInfo.multiRootData&&this.$parent.loadAllDefaultProjects?.())}});const s="/"===t?`/${e}`:`${t}/${e}`;this.$emit("folder-created",{path:s,projectName:o}),this.$emit("update:modelValue",!1),i()}else{const e=n.message||n.msg||"Failed to create folder";ht.nk.error(e),s(new Error(e))}}})})}catch(bc){Mt.error("[DialogNewFolder] Error creating folder:",bc),ht.nk.error("Failed to create folder: "+bc.message)}finally{this.creating=!1}}},onCancel(){this.$emit("update:modelValue",!1)}},computed:{ideInfo(){return this.$store.state.ide.ideInfo},currentUser(){const e=localStorage.getItem("session_id"),t=localStorage.getItem("username"),o=localStorage.getItem("role"),i=localStorage.getItem("full_name");return e&&t?{session_id:e,username:t,role:o,full_name:i}:null}}};const At=(0,k.A)(Nt,[["render",Tt],["__scopeId","data-v-1f71bd7a"]]);var _t=At;const Ot={class:"new-file-dialog"},Wt={class:"dialog-header"},Ut={class:"dialog-body"},zt={class:"directory-section"},Vt={class:"directory-nav"},Bt={key:0,class:"directory-tree"},Xt=["onClick"],Ht={class:"filename-section"},Kt={class:"filename-input-wrapper"},Gt={key:0,class:"file-type-icon"},Qt={key:0,class:"error-hint"},qt={key:1,class:"file-types-hint"},Jt={key:0,class:"preview-section"},Yt={class:"file-preview"},Zt={class:"file-info"},eo={class:"file-path"},to={class:"file-type"},oo={class:"dialog-footer"},io=["disabled"];function so(e,t,o,a,r,l){const d=(0,i.g2)("X"),c=(0,i.g2)("FolderOpen"),h=(0,i.g2)("ChevronDown"),u=(0,i.g2)("ChevronRight"),p=(0,i.g2)("Home"),m=(0,i.g2)("Folder"),f=(0,i.g2)("FileText");return(0,i.uX)(),(0,i.CE)("div",null,[t[10]||(t[10]=(0,i.Lk)("div",{class:"dialog-cover"},null,-1)),(0,i.Lk)("div",Ot,[(0,i.Lk)("div",Wt,[t[6]||(t[6]=(0,i.Lk)("h3",null,"New File",-1)),(0,i.Lk)("div",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>l.onCancel&&l.onCancel(...e))},[(0,i.bF)(d,{size:20})])]),(0,i.Lk)("div",Ut,[(0,i.Lk)("div",zt,[t[7]||(t[7]=(0,i.Lk)("label",null,"Select Directory:",-1)),(0,i.Lk)("div",Vt,[(0,i.Lk)("div",{class:"current-path",onClick:t[1]||(t[1]=(...e)=>l.toggleDirectoryTree&&l.toggleDirectoryTree(...e))},[(0,i.bF)(c,{size:16}),(0,i.Lk)("span",null,(0,n.v_)(l.formatCurrentPath(r.currentPath)),1),r.showDirectoryTree?((0,i.uX)(),(0,i.Wv)(h,{key:0,size:16,class:"chevron"})):((0,i.uX)(),(0,i.Wv)(u,{key:1,size:16,class:"chevron"}))]),r.showDirectoryTree?((0,i.uX)(),(0,i.CE)("div",Bt,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.directories,e=>((0,i.uX)(),(0,i.CE)("div",{key:e.path,class:(0,n.C4)(["directory-item",{selected:r.currentPath===e.path,"root-item":e.isRoot}]),style:(0,n.Tr)({paddingLeft:20*e.level+12+"px"}),onClick:t=>l.selectDirectory(e)},[e.isRoot?((0,i.uX)(),(0,i.Wv)(p,{key:0,size:14})):((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[(0,i.bF)(u,{size:14}),(0,i.bF)(m,{size:14})],64)),(0,i.Lk)("span",null,(0,n.v_)(e.displayName||e.name),1)],14,Xt))),128))])):(0,i.Q3)("",!0)])]),(0,i.Lk)("div",Ht,[t[8]||(t[8]=(0,i.Lk)("label",null,"File Name:",-1)),(0,i.Lk)("div",Kt,[(0,i.bo)((0,i.Lk)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>r.fileName=e),onInput:t[3]||(t[3]=(...e)=>l.validateFileName&&l.validateFileName(...e)),placeholder:"Enter file name (e.g., script.py)",class:"filename-input",ref:"fileNameInput"},null,544),[[s.Jo,r.fileName]]),l.fileExtension?((0,i.uX)(),(0,i.CE)("div",Gt,[(0,i.bF)(f,{size:20})])):(0,i.Q3)("",!0)]),r.fileNameError?((0,i.uX)(),(0,i.CE)("div",Qt,(0,n.v_)(r.fileNameError),1)):((0,i.uX)(),(0,i.CE)("div",qt," Common extensions: .py, .txt, .csv, .json, .md, .html, .css, .js "))]),r.fileName&&!r.fileNameError?((0,i.uX)(),(0,i.CE)("div",Jt,[t[9]||(t[9]=(0,i.Lk)("label",null,"File will be created at:",-1)),(0,i.Lk)("div",Yt,[(0,i.Lk)("div",Zt,[(0,i.bF)(f,{size:20}),(0,i.Lk)("div",null,[(0,i.Lk)("div",eo,(0,n.v_)(l.getFullFilePath()),1),(0,i.Lk)("div",to,(0,n.v_)(l.getFileTypeDescription()),1)])])])])):(0,i.Q3)("",!0)]),(0,i.Lk)("div",oo,[(0,i.Lk)("button",{class:"btn-cancel",onClick:t[4]||(t[4]=(...e)=>l.onCancel&&l.onCancel(...e))},"Cancel"),(0,i.Lk)("button",{class:"btn-create",onClick:t[5]||(t[5]=(...e)=>l.onCreate&&l.onCreate(...e)),disabled:!r.fileName||!!r.fileNameError&&!r.fileNameError.includes("already exists")||r.creating},(0,n.v_)(r.creating?"Creating...":"Create File"),9,io)])])])}var no=o(9992),ao=o(7956),ro=o(6763),lo={props:{modelValue:Boolean},data(){return{currentPath:"/",currentProject:null,directories:[],fileName:"",fileNameError:"",creating:!1,showDirectoryTree:!1}},computed:{ideInfo(){return this.$store.state.ide.ideInfo},currentUser(){const e=localStorage.getItem("session_id"),t=localStorage.getItem("username"),o=localStorage.getItem("role"),i=localStorage.getItem("full_name");return e&&t?{session_id:e,username:t,role:o,full_name:i}:null},fileExtension(){if(!this.fileName)return"";const e=this.fileName.lastIndexOf(".");return e>0?this.fileName.substring(e):""}},components:{X:y.A,FolderOpen:st.A,Folder:nt.A,ChevronRight:at.A,ChevronDown:rt.A,FileText:no.A,Home:dt.A},mounted(){this.loadDirectoryStructure(),this.$nextTick(()=>{this.$refs.fileNameInput?.focus()})},methods:{isDirectoryVisibleToStudent(e){if(!this.currentUser||"student"!==this.currentUser.role)return!0;const t=`Local/${this.currentUser.username}`;return"/"===e||e.startsWith(t)},loadDirectoryStructure(){if(this.ideInfo.multiRootData&&this.ideInfo.multiRootData.children.length>0?(this.directories=[],this.ideInfo.multiRootData.children.forEach(e=>{const t=this.buildDirectoryTree(e,0,e.label);this.directories=this.directories.concat(t)})):this.ideInfo.currProj&&this.ideInfo.currProj.data&&(this.directories=this.buildDirectoryTree(this.ideInfo.currProj.data,0,this.ideInfo.currProj.data.label)),this.ideInfo.nodeSelected){if("dir"===this.ideInfo.nodeSelected.type||"folder"===this.ideInfo.nodeSelected.type)this.currentPath=this.ideInfo.nodeSelected.path,this.currentProject=this.ideInfo.nodeSelected.projectName||this.ideInfo.currProj?.data?.name;else if("file"===this.ideInfo.nodeSelected.type){const e=this.ideInfo.nodeSelected.path.substring(0,this.ideInfo.nodeSelected.path.lastIndexOf("/"))||"/";this.currentPath=e,this.currentProject=this.ideInfo.nodeSelected.projectName||this.ideInfo.currProj?.data?.name}}else this.currentProject=this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name;if(this.currentUser&&"student"===this.currentUser.role&&"/"===this.currentPath){const e=`Local/${this.currentUser.username}`,t=this.directories.find(t=>t.path===e);t&&(this.currentPath=e)}},buildDirectoryTree(e,t=0,o=null){let i=[];return 0===t&&i.push({name:o||e.label||"/",displayName:o||e.label||"/",path:e.path||"/",level:0,isRoot:!0,projectName:o||e.label,fullPath:o?`${o}${e.path}`:e.path}),e.children&&e.children.forEach(e=>{"dir"!==e.type&&"folder"!==e.type||this.isDirectoryVisibleToStudent(e.path)&&(i.push({name:e.label,displayName:e.label,path:e.path,level:t+1,isRoot:!1,projectName:o||e.projectName,fullPath:o?`${o}${e.path}`:e.path}),e.children&&(i=i.concat(this.buildDirectoryTree(e,t+1,o))))}),i},selectDirectory(e){this.currentPath=e.path,this.currentProject=e.projectName,this.showDirectoryTree=!1},toggleDirectoryTree(){this.showDirectoryTree=!this.showDirectoryTree},formatCurrentPath(e){if(e&&"/"!==e){const t=["Local","Lecture Notes"];for(let o of t)if(e.startsWith(o))return e}if(this.currentProject)return"/"===e?this.currentProject:e.startsWith(this.currentProject)?e:this.currentProject+e;if("/"===e&&this.ideInfo.currProj)return this.ideInfo.currProj.data?.label||this.ideInfo.currProj.config?.name;if(e.startsWith("/")&&this.ideInfo.currProj){const t=this.ideInfo.currProj.data?.label||this.ideInfo.currProj.config?.name;return e.includes(t)?e:t+e}return e},validateFileName(){if(this.fileNameError="",!this.fileName)return;if(/[<>:"|?*\\]/.test(this.fileName))return void(this.fileNameError="File name contains invalid characters");const e=["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"],t=this.fileName.split(".")[0].toUpperCase();if(e.includes(t))return void(this.fileNameError="This is a reserved file name");if(this.fileName.startsWith(".")||this.fileName.endsWith("."))return void(this.fileNameError="File name cannot start or end with a dot");const o=this.currentProject||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name,i=this.checkFileExists(this.fileName,this.currentPath,o);i?this.fileNameError="A file with this name already exists (keep a unique file name)":this.fileExtension||(this.fileNameError="Consider adding a file extension (e.g., .py, .txt)")},getFullFilePath(){const e=this.fileName||"new_file",t="/"===this.currentPath?`/${e}`:`${this.currentPath}/${e}`;return this.formatCurrentPath(t)},getFileTypeDescription(){const e=this.fileExtension.toLowerCase(),t={".py":"Python Script",".txt":"Text File",".csv":"CSV Data File",".json":"JSON Data File",".md":"Markdown Document",".html":"HTML Document",".css":"CSS Stylesheet",".js":"JavaScript File",".xml":"XML Document",".yaml":"YAML Configuration",".yml":"YAML Configuration",".ini":"Configuration File",".log":"Log File"};return t[e]||"File"},checkFileExists(e,t,o){const i=(e,t,o)=>{if(!e||!e.children)return null;if(e.path===t)return e.children.find(e=>"file"===e.type&&(e.label===o||e.name===o));for(let s of e.children){const e=i(s,t,o);if(e)return e}return null};if(this.ideInfo.multiRootData&&this.ideInfo.multiRootData.children.length>0){for(let s of this.ideInfo.multiRootData.children)if(s.name===o||s.label===o)return i(s,t,e)}else if(this.ideInfo.currProj&&this.ideInfo.currProj.data)return i(this.ideInfo.currProj.data,t,e);return null},async onCreate(){if(!this.fileName||this.fileNameError)return;const e=this.fileName,t=this.currentPath,o=this.currentProject||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name,i=this.checkFileExists(e,t,o);if(i)try{await ao.s.confirm(`A file named "${e}" already exists in this directory. Creating this file will replace the existing file.`,"File Already Exists",{confirmButtonText:"Replace File",cancelButtonText:"Cancel",type:"warning",confirmButtonClass:"el-button--danger"})}catch{return}this.creating=!0;try{ro.log("[DialogNewFile] Creating file:",{fileName:e,parentPath:t,projectName:o,replaceExisting:!!i});let s="";const n=this.fileExtension.toLowerCase();".py"===n?s="":".json"===n&&(s="{}"),await new Promise((i,n)=>{this.$store.dispatch(`ide/${ct.Zd}`,{projectName:o,parentPath:t,fileName:e,callback:a=>{if(ro.log("[DialogNewFile] Create file response:",a),0===a.code){if(ht.nk.success(`File "${e}" created successfully`),s){const n="/"===t?`/${e}`:`${t}/${e}`;this.$store.dispatch(`ide/${ct._L}`,{projectName:o,filePath:n,fileData:s,callback:e=>{ro.log("[DialogNewFile] Write file response:",e),i()}})}else i();this.$store.dispatch(`ide/${ct.QQ}`,{projectName:o,callback:e=>{0===e.code&&(this.$store.commit("ide/handleProject",e.data),this.ideInfo.multiRootData&&this.$parent.loadAllDefaultProjects?.())}});const n="/"===t?`/${e}`:`${t}/${e}`;this.$emit("file-created",{path:n,projectName:o}),this.$emit("update:modelValue",!1)}else{const e=a.message||"Failed to create file";ht.nk.error(e),n(new Error(e))}}})})}catch(bc){ro.error("[DialogNewFile] Error creating file:",bc),ht.nk.error("Failed to create file: "+bc.message)}finally{this.creating=!1}},onCancel(){this.$emit("update:modelValue",!1)}}};const co=(0,k.A)(lo,[["render",so],["__scopeId","data-v-b4052db6"]]);var ho=co,uo=o(2542),po=o(7093),mo=o(2164),fo=o(4411),go=o(6309),vo=o(2258),yo=o(472),wo=o(1030);const bo={key:0,class:"fullscreen-preview"},ko={class:"preview-header"},Io={class:"preview-header-left"},Po={class:"preview-title"},So={class:"preview-header-right"},Co={class:"preview-content"},Lo={key:2,class:"unsupported-preview"};function Fo(e,t,o,s,a,r){const l=go.A,d=vo.A;return r.isActive?((0,i.uX)(),(0,i.CE)("div",bo,[(0,i.Lk)("div",ko,[(0,i.Lk)("div",Io,[(0,i.Lk)("span",Po,(0,n.v_)(r.fileName),1)]),(0,i.Lk)("div",So,[(0,i.Lk)("button",{class:"preview-action-btn",onClick:t[0]||(t[0]=(...e)=>r.openInRightPanel&&r.openInRightPanel(...e)),title:"Open in Right Panel"},t[2]||(t[2]=[(0,i.Lk)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,i.Lk)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),(0,i.Lk)("path",{d:"M15 3v18"})],-1)])),(0,i.Lk)("button",{class:"preview-close-btn",onClick:t[1]||(t[1]=(...e)=>r.close&&r.close(...e)),title:"Close Preview"},t[3]||(t[3]=[(0,i.Lk)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,i.Lk)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,i.Lk)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)]))])]),(0,i.Lk)("div",Co,[r.isCsvFile?((0,i.uX)(),(0,i.Wv)(l,{key:0,content:r.content},null,8,["content"])):r.isMediaFile?((0,i.uX)(),(0,i.Wv)(d,{key:1,codeItem:r.mediaCodeItem,codeItemIndex:0},null,8,["codeItem"])):((0,i.uX)(),(0,i.CE)("div",Lo,t[4]||(t[4]=[(0,i.Lk)("p",null,"Preview not supported for this file type",-1)])))])])):(0,i.Q3)("",!0)}var Ro={name:"FullscreenPreview",components:{CsvViewer:go.A,MediaViewer:vo.A},computed:{ideInfo(){return this.$store.state.ide.ideInfo},isActive(){return this.ideInfo.fullscreenPreview.active},file(){return this.ideInfo.fullscreenPreview.file},content(){return this.ideInfo.fullscreenPreview.content},fileName(){return this.file?.name||""},filePath(){return this.file?.path||""},isCsvFile(){return this.filePath.toLowerCase().endsWith(".csv")},isMediaFile(){const e=[".png",".jpg",".jpeg",".gif",".bmp",".svg",".webp",".pdf"],t=this.filePath.toLowerCase();return e.some(e=>t.endsWith(e))},mediaCodeItem(){return this.file?{name:this.file.name,path:this.file.path,projectName:this.file.projectName,content:this.content,preloaded:!0}:null}},methods:{close(){this.$store.commit("ide/closeFullscreenPreview")},openInRightPanel(){this.$store.commit("ide/closeFullscreenPreview"),this.file&&this.$emit("open-in-right-panel",this.file.path)}},mounted(){this.handleEsc=e=>{"Escape"===e.key&&this.isActive&&this.close()},document.addEventListener("keydown",this.handleEsc)},beforeUnmount(){document.removeEventListener("keydown",this.handleEsc)}};const Eo=(0,k.A)(Ro,[["render",Fo],["__scopeId","data-v-3c263865"]]);var xo=Eo,Do=o(5663);const jo={class:"modal-header"},$o={class:"modal-body"},To={class:"input-group"},Mo={key:0,class:"input-group"},No={class:"options-group"},Ao={class:"checkbox-label"},_o={class:"checkbox-label"},Oo={class:"checkbox-label"},Wo={key:1,class:"search-info"},Uo={class:"modal-footer"},zo={class:"button-group"},Vo=["disabled"],Bo=["disabled"],Xo=["disabled"],Ho=["disabled"];function Ko(e,t,o,a,r,l){const d=(0,i.g2)("X"),c=(0,i.g2)("ChevronUp"),h=(0,i.g2)("ChevronDown");return(0,i.uX)(),(0,i.Wv)(s.eB,{name:"modal-fade"},{default:(0,i.k6)(()=>[o.modelValue?((0,i.uX)(),(0,i.CE)("div",{key:0,class:"find-replace-overlay",onClick:t[16]||(t[16]=(0,s.D$)((...e)=>l.close&&l.close(...e),["self"]))},[(0,i.Lk)("div",{class:"find-replace-modal",onClick:t[15]||(t[15]=(0,s.D$)(()=>{},["stop"]))},[(0,i.Lk)("div",jo,[(0,i.Lk)("h3",null,(0,n.v_)(l.isReplaceMode?"Find and Replace":"Find"),1),(0,i.Lk)("button",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>l.close&&l.close(...e)),title:"Close (Esc)"},[(0,i.bF)(d,{size:18})])]),(0,i.Lk)("div",$o,[(0,i.Lk)("div",To,[t[17]||(t[17]=(0,i.Lk)("label",null,"Find:",-1)),(0,i.bo)((0,i.Lk)("input",{ref:"findInput","onUpdate:modelValue":t[1]||(t[1]=e=>r.findText=e),type:"text",class:"modal-input",placeholder:"Enter text to find...",onKeydown:[t[2]||(t[2]=(0,s.jR)((...e)=>l.findNext&&l.findNext(...e),["enter"])),t[3]||(t[3]=(0,s.jR)((...e)=>l.close&&l.close(...e),["escape"]))]},null,544),[[s.Jo,r.findText]])]),l.isReplaceMode?((0,i.uX)(),(0,i.CE)("div",Mo,[t[18]||(t[18]=(0,i.Lk)("label",null,"Replace with:",-1)),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>r.replaceText=e),type:"text",class:"modal-input",placeholder:"Enter replacement text...",onKeydown:[t[5]||(t[5]=(0,s.jR)((...e)=>l.replace&&l.replace(...e),["enter"])),t[6]||(t[6]=(0,s.jR)((...e)=>l.close&&l.close(...e),["escape"]))]},null,544),[[s.Jo,r.replaceText]])])):(0,i.Q3)("",!0),(0,i.Lk)("div",No,[(0,i.Lk)("label",Ao,[(0,i.bo)((0,i.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=e=>r.caseSensitive=e)},null,512),[[s.lH,r.caseSensitive]]),t[19]||(t[19]=(0,i.Lk)("span",null,"Case sensitive",-1))]),(0,i.Lk)("label",_o,[(0,i.bo)((0,i.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=e=>r.wholeWord=e)},null,512),[[s.lH,r.wholeWord]]),t[20]||(t[20]=(0,i.Lk)("span",null,"Whole word",-1))]),(0,i.Lk)("label",Oo,[(0,i.bo)((0,i.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=e=>r.useRegex=e)},null,512),[[s.lH,r.useRegex]]),t[21]||(t[21]=(0,i.Lk)("span",null,"Regular expression",-1))])]),r.searchInfo?((0,i.uX)(),(0,i.CE)("div",Wo,(0,n.v_)(r.searchInfo),1)):(0,i.Q3)("",!0)]),(0,i.Lk)("div",Uo,[(0,i.Lk)("div",zo,[(0,i.Lk)("button",{class:"action-btn",onClick:t[10]||(t[10]=(...e)=>l.findPrevious&&l.findPrevious(...e)),disabled:!r.findText},[(0,i.bF)(c,{size:16}),t[22]||(t[22]=(0,i.eW)(" Find Previous ",-1))],8,Vo),(0,i.Lk)("button",{class:"action-btn primary",onClick:t[11]||(t[11]=(...e)=>l.findNext&&l.findNext(...e)),disabled:!r.findText},[(0,i.bF)(h,{size:16}),t[23]||(t[23]=(0,i.eW)(" Find Next ",-1))],8,Bo),l.isReplaceMode?((0,i.uX)(),(0,i.CE)(i.FK,{key:0},[(0,i.Lk)("button",{class:"action-btn",onClick:t[12]||(t[12]=(...e)=>l.replace&&l.replace(...e)),disabled:!r.findText}," Replace ",8,Xo),(0,i.Lk)("button",{class:"action-btn",onClick:t[13]||(t[13]=(...e)=>l.replaceAll&&l.replaceAll(...e)),disabled:!r.findText}," Replace All ",8,Ho)],64)):(0,i.Q3)("",!0),(0,i.Lk)("button",{class:"action-btn",onClick:t[14]||(t[14]=(...e)=>l.close&&l.close(...e))}," Close ")])])])])):(0,i.Q3)("",!0)]),_:1})}var Go=o(3957);
/**
 * @license lucide-vue-next v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const Qo=(0,Go.A)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);var qo={name:"FindReplaceModal",components:{X:y.A,ChevronUp:Qo,ChevronDown:rt.A},props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"find",validator:e=>["find","replace"].includes(e)}},data(){return{findText:"",replaceText:"",caseSensitive:!1,wholeWord:!1,useRegex:!1,searchInfo:"",currentMatch:0,totalMatches:0,searchCursor:null}},computed:{isReplaceMode(){return"replace"===this.mode},activeEditor(){const e=document.querySelector(".editor-content .code-editor-flex .CodeMirror");return e&&e.CodeMirror?e.CodeMirror:null}},watch:{modelValue(e){e?this.$nextTick(()=>{this.$refs.findInput?.focus(),this.initializeSearch()}):this.clearSearch()},findText(){this.findText?this.updateSearchInfo():(this.searchInfo="",this.clearSearch())}},methods:{initializeSearch(){if(this.activeEditor){const e=this.activeEditor.getSelection();e&&(this.findText=e)}},clearSearch(){this.activeEditor&&this.activeEditor.operation(()=>{const e=this.activeEditor.getAllMarks();e.forEach(e=>{"CodeMirror-search-match"===e.className&&e.clear()})}),this.searchCursor=null,this.currentMatch=0,this.totalMatches=0,this.searchInfo=""},getSearchQuery(){let e=this.findText;this.useRegex||(e=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")),this.wholeWord&&(e="\\b"+e+"\\b");try{return new RegExp(e,this.caseSensitive?"g":"gi")}catch(t){return this.findText}},findNext(){if(!this.findText||!this.activeEditor)return;const e=this.getSearchQuery(),t=this.activeEditor.getSearchCursor(e,this.activeEditor.getCursor(),!this.caseSensitive);if(t.findNext())this.activeEditor.setSelection(t.from(),t.to()),this.activeEditor.scrollIntoView(t.from(),50),this.highlightMatch(t);else{const t=this.activeEditor.getSearchCursor(e,{line:0,ch:0},!this.caseSensitive);t.findNext()?(this.activeEditor.setSelection(t.from(),t.to()),this.activeEditor.scrollIntoView(t.from(),50),this.highlightMatch(t),this.searchInfo="Wrapped to beginning"):this.searchInfo="No matches found"}this.updateSearchInfo()},findPrevious(){if(!this.findText||!this.activeEditor)return;const e=this.getSearchQuery(),t=this.activeEditor.getSearchCursor(e,this.activeEditor.getCursor("from"),!this.caseSensitive);if(t.findPrevious())this.activeEditor.setSelection(t.from(),t.to()),this.activeEditor.scrollIntoView(t.from(),50),this.highlightMatch(t);else{const t=this.activeEditor.lastLine(),o=this.activeEditor.getLine(t).length,i=this.activeEditor.getSearchCursor(e,{line:t,ch:o},!this.caseSensitive);i.findPrevious()?(this.activeEditor.setSelection(i.from(),i.to()),this.activeEditor.scrollIntoView(i.from(),50),this.highlightMatch(i),this.searchInfo="Wrapped to end"):this.searchInfo="No matches found"}this.updateSearchInfo()},replace(){if(!this.findText||!this.activeEditor)return;const e=this.activeEditor.getSelection(),t=this.getSearchQuery();e&&("string"===typeof t&&e===t||t instanceof RegExp&&t.test(e))?(this.activeEditor.replaceSelection(this.replaceText),this.findNext()):this.findNext()},replaceAll(){if(!this.findText||!this.activeEditor)return;const e=this.getSearchQuery(),t=this.activeEditor.getSearchCursor(e,{line:0,ch:0},!this.caseSensitive);let o=0;this.activeEditor.operation(()=>{while(t.findNext())t.replace(this.replaceText),o++}),this.searchInfo=`Replaced ${o} occurrence${1!==o?"s":""}`},highlightMatch(e){},updateSearchInfo(){if(!this.findText||!this.activeEditor)return void(this.searchInfo="");const e=this.getSearchQuery(),t=this.activeEditor.getSearchCursor(e,{line:0,ch:0},!this.caseSensitive);let o=0;while(t.findNext())o++;this.searchInfo=0===o?"No matches found":1===o?"1 match found":`${o} matches found`},close(){this.clearSearch(),this.$emit("update:modelValue",!1)},handleKeydown(e){"Escape"===e.key?this.close():("F3"===e.key||e.ctrlKey&&"g"===e.key)&&(e.preventDefault(),e.shiftKey?this.findPrevious():this.findNext())}},mounted(){document.addEventListener("keydown",this.handleKeydown)},beforeUnmount(){document.removeEventListener("keydown",this.handleKeydown),this.clearSearch()}};const Jo=(0,k.A)(qo,[["render",Ko],["__scopeId","data-v-28db288f"]]);var Yo=Jo;const Zo={class:"modal-container"},ei={class:"modal-header"};function ti(e,t,o,n,a,r){const l=(0,i.g2)("X");return(0,i.uX)(),(0,i.Wv)(s.eB,{name:"modal-fade"},{default:(0,i.k6)(()=>[o.modelValue?((0,i.uX)(),(0,i.CE)("div",{key:0,class:"modal-overlay",onClick:t[1]||(t[1]=(0,s.D$)((...e)=>r.close&&r.close(...e),["self"]))},[(0,i.Lk)("div",Zo,[(0,i.Lk)("div",ei,[t[2]||(t[2]=(0,i.Lk)("h2",null,"Keyboard Shortcuts (Universal for Mac/Windows/Linux)",-1)),(0,i.Lk)("button",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>r.close&&r.close(...e))},[(0,i.bF)(l,{size:20})])]),t[3]||(t[3]=(0,i.Lk)("div",{class:"modal-body"},[(0,i.Lk)("div",{class:"shortcut-section"},[(0,i.Lk)("h3",null,"File Operations"),(0,i.Lk)("div",{class:"shortcut-list"},[(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"New File"),(0,i.Lk)("span",{class:"shortcut-keys"},"Ctrl+Alt+N")]),(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"Open File"),(0,i.Lk)("span",{class:"shortcut-keys"},"Ctrl+O")]),(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"Save"),(0,i.Lk)("span",{class:"shortcut-keys"},"Ctrl+S")]),(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"Save As"),(0,i.Lk)("span",{class:"shortcut-keys"},"Ctrl+Shift+S")]),(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"Move"),(0,i.Lk)("span",{class:"shortcut-keys"},"Ctrl+Shift+M")]),(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"Download"),(0,i.Lk)("span",{class:"shortcut-keys"},"Ctrl+D")]),(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"Delete File"),(0,i.Lk)("span",{class:"shortcut-keys"},"Delete")])])]),(0,i.Lk)("div",{class:"shortcut-section"},[(0,i.Lk)("h3",null,"Edit Operations"),(0,i.Lk)("div",{class:"shortcut-list"},[(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"Undo"),(0,i.Lk)("span",{class:"shortcut-keys"},"Ctrl+Z")]),(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"Redo"),(0,i.Lk)("span",{class:"shortcut-keys"},"Ctrl+Y")]),(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"Cut"),(0,i.Lk)("span",{class:"shortcut-keys"},"Ctrl+X")]),(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"Copy"),(0,i.Lk)("span",{class:"shortcut-keys"},"Ctrl+C")]),(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"Paste"),(0,i.Lk)("span",{class:"shortcut-keys"},"Ctrl+V")]),(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"Find"),(0,i.Lk)("span",{class:"shortcut-keys"},"Ctrl+F")]),(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"Replace"),(0,i.Lk)("span",{class:"shortcut-keys"},"Ctrl+H")]),(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"Comment/Uncomment"),(0,i.Lk)("span",{class:"shortcut-keys"},"Ctrl+/")]),(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"Select All"),(0,i.Lk)("span",{class:"shortcut-keys"},"Ctrl+A")])])]),(0,i.Lk)("div",{class:"shortcut-section"},[(0,i.Lk)("h3",null,"Run Operations"),(0,i.Lk)("div",{class:"shortcut-list"},[(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"Run Script"),(0,i.Lk)("span",{class:"shortcut-keys"},"F5")]),(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"Stop Script"),(0,i.Lk)("span",{class:"shortcut-keys"},"Shift+F5")])])]),(0,i.Lk)("div",{class:"shortcut-section"},[(0,i.Lk)("h3",null,"View Operations"),(0,i.Lk)("div",{class:"shortcut-list"},[(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"Toggle Console"),(0,i.Lk)("span",{class:"shortcut-keys"},"Ctrl+`")]),(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"Toggle Preview Panel"),(0,i.Lk)("span",{class:"shortcut-keys"},"Ctrl+Shift+P")]),(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"Toggle Sidebar"),(0,i.Lk)("span",{class:"shortcut-keys"},"Ctrl+B")])])]),(0,i.Lk)("div",{class:"shortcut-section"},[(0,i.Lk)("h3",null,"General"),(0,i.Lk)("div",{class:"shortcut-list"},[(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"Show Keyboard Shortcuts"),(0,i.Lk)("span",{class:"shortcut-keys"},"F1")]),(0,i.Lk)("div",{class:"shortcut-item"},[(0,i.Lk)("span",{class:"shortcut-action"},"Settings"),(0,i.Lk)("span",{class:"shortcut-keys"},"Ctrl+,")])])])],-1))])])):(0,i.Q3)("",!0)]),_:1})}var oi={name:"KeyboardShortcutsModal",props:{modelValue:{type:Boolean,default:!1}},components:{X:y.A},methods:{close(){this.$emit("update:modelValue",!1)}},mounted(){this.handleEsc=e=>{"Escape"===e.key&&this.modelValue&&this.close()},document.addEventListener("keydown",this.handleEsc)},beforeUnmount(){document.removeEventListener("keydown",this.handleEsc)}};const ii=(0,k.A)(oi,[["render",ti],["__scopeId","data-v-62d3d050"]]);var si=ii,ni=o(3549);const ai={class:"profile-modal"},ri={class:"dialog-header"},li={class:"dialog-body"},di={class:"tab-navigation"},ci=["onClick"],hi={class:"tab-content"},ui={key:0,class:"profile-section"},pi={class:"user-info"},mi={class:"info-row"},fi={class:"info-row"},gi={class:"info-row"},vi={class:"info-row"},yi={class:"session-id"},wi={key:1,class:"password-section"},bi={class:"form-group"},ki=["disabled"],Ii={class:"form-group"},Pi=["disabled"],Si={class:"form-group"},Ci=["disabled"],Li={class:"form-actions"},Fi=["disabled"],Ri={key:2,class:"forgot-section"},Ei={class:"form-group"},xi=["disabled"],Di={class:"form-group"},ji=["disabled"],$i={class:"form-group"},Ti=["disabled"],Mi={class:"form-actions"},Ni=["disabled"],Ai=["disabled"],_i={class:"admin-contact"},Oi={class:"contact-section"},Wi={class:"admin-info"},Ui={class:"contact-method"},zi={class:"contact-method"},Vi={class:"dialog-footer"};function Bi(e,t,o,a,r,l){const d=(0,i.g2)("X"),c=(0,i.g2)("Mail"),h=(0,i.g2)("MessageSquare"),u=(0,i.g2)("LogOut");return l.visible?((0,i.uX)(),(0,i.CE)("div",{key:0,class:"profile-modal-overlay",onClick:t[13]||(t[13]=(0,s.D$)((...e)=>l.handleClose&&l.handleClose(...e),["self"]))},[(0,i.Lk)("div",ai,[(0,i.Lk)("div",ri,[(0,i.Lk)("h3",null,(0,n.v_)(o.currentUser?`${o.currentUser.full_name||o.currentUser.username}`:"User Profile"),1),(0,i.Lk)("div",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>l.handleClose&&l.handleClose(...e))},[(0,i.bF)(d,{size:20})])]),(0,i.Lk)("div",li,[(0,i.Lk)("div",di,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.tabs,e=>((0,i.uX)(),(0,i.CE)("button",{key:e.id,onClick:t=>r.activeTab=e.id,class:(0,n.C4)(["tab-btn",{active:r.activeTab===e.id}])},[((0,i.uX)(),(0,i.Wv)((0,i.$y)(e.icon),{size:16})),(0,i.eW)(" "+(0,n.v_)(e.label),1)],10,ci))),128))]),(0,i.Lk)("div",hi,["profile"===r.activeTab?((0,i.uX)(),(0,i.CE)("div",ui,[(0,i.Lk)("div",pi,[(0,i.Lk)("div",mi,[t[14]||(t[14]=(0,i.Lk)("label",null,"Username:",-1)),(0,i.Lk)("span",null,(0,n.v_)(o.currentUser?.username),1)]),(0,i.Lk)("div",fi,[t[15]||(t[15]=(0,i.Lk)("label",null,"Full Name:",-1)),(0,i.Lk)("span",null,(0,n.v_)(o.currentUser?.full_name||"Not set"),1)]),(0,i.Lk)("div",gi,[t[16]||(t[16]=(0,i.Lk)("label",null,"Role:",-1)),(0,i.Lk)("span",{class:(0,n.C4)(["role-badge",o.currentUser?.role])},(0,n.v_)("professor"===o.currentUser?.role?"Professor":"Student"),3)]),(0,i.Lk)("div",vi,[t[17]||(t[17]=(0,i.Lk)("label",null,"Session:",-1)),(0,i.Lk)("span",yi,(0,n.v_)(r.sessionId?.substring(0,20))+"...",1)])])])):(0,i.Q3)("",!0),"change-password"===r.activeTab?((0,i.uX)(),(0,i.CE)("div",wi,[(0,i.Lk)("form",{onSubmit:t[5]||(t[5]=(0,s.D$)((...e)=>l.changePassword&&l.changePassword(...e),["prevent"]))},[(0,i.Lk)("div",bi,[t[18]||(t[18]=(0,i.Lk)("label",null,"Current Password",-1)),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>r.passwordForm.currentPassword=e),type:"password",placeholder:"Enter your current password",disabled:r.loading},null,8,ki),[[s.Jo,r.passwordForm.currentPassword]])]),(0,i.Lk)("div",Ii,[t[19]||(t[19]=(0,i.Lk)("label",null,"New Password",-1)),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>r.passwordForm.newPassword=e),type:"password",placeholder:"Enter new password (min 6 characters)",disabled:r.loading},null,8,Pi),[[s.Jo,r.passwordForm.newPassword]])]),(0,i.Lk)("div",Si,[t[20]||(t[20]=(0,i.Lk)("label",null,"Confirm New Password",-1)),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>r.passwordForm.confirmPassword=e),type:"password",placeholder:"Confirm new password",disabled:r.loading},null,8,Ci),[[s.Jo,r.passwordForm.confirmPassword]])]),(0,i.Lk)("div",Li,[(0,i.Lk)("button",{type:"submit",class:"btn-primary",disabled:r.loading},(0,n.v_)(r.loading?"Changing...":"Change Password"),9,Fi),(0,i.Lk)("button",{type:"button",class:"btn-secondary",onClick:t[4]||(t[4]=(...e)=>l.resetPasswordForm&&l.resetPasswordForm(...e))}," Reset ")])],32)])):(0,i.Q3)("",!0),"forgot-password"===r.activeTab?((0,i.uX)(),(0,i.CE)("div",Ri,[t[30]||(t[30]=(0,i.Lk)("div",{class:"forgot-info"},[(0,i.Lk)("p",null,"To reset your password, you need to verify your current password first."),(0,i.Lk)("p",null,"If you don't remember your current password, please contact the administrator.")],-1)),(0,i.Lk)("form",{onSubmit:t[10]||(t[10]=(0,s.D$)(e=>r.passwordVerified?l.resetPasswordWithVerification():l.verifyCurrentPassword(),["prevent"]))},[(0,i.Lk)("div",Ei,[t[21]||(t[21]=(0,i.Lk)("label",null,"Current Password",-1)),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>r.forgotForm.currentPassword=e),type:"password",placeholder:"Enter your current password to verify",disabled:r.loading},null,8,xi),[[s.Jo,r.forgotForm.currentPassword]])]),(0,i.Lk)("div",Di,[t[22]||(t[22]=(0,i.Lk)("label",null,"New Password",-1)),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>r.forgotForm.newPassword=e),type:"password",placeholder:"Enter new password (min 6 characters)",disabled:!r.passwordVerified||r.loading},null,8,ji),[[s.Jo,r.forgotForm.newPassword]])]),(0,i.Lk)("div",$i,[t[23]||(t[23]=(0,i.Lk)("label",null,"Confirm New Password",-1)),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>r.forgotForm.confirmPassword=e),type:"password",placeholder:"Confirm new password",disabled:!r.passwordVerified||r.loading},null,8,Ti),[[s.Jo,r.forgotForm.confirmPassword]])]),(0,i.Lk)("div",Mi,[r.passwordVerified?((0,i.uX)(),(0,i.CE)("button",{key:1,type:"submit",class:"btn-success",disabled:r.loading},(0,n.v_)(r.loading?"Resetting...":"Reset Password"),9,Ai)):((0,i.uX)(),(0,i.CE)("button",{key:0,type:"submit",class:"btn-primary",disabled:r.loading},(0,n.v_)(r.loading?"Verifying...":"Verify Password"),9,Ni)),(0,i.Lk)("button",{type:"button",class:"btn-secondary",onClick:t[9]||(t[9]=(...e)=>l.resetForgotForm&&l.resetForgotForm(...e))}," Clear ")])],32),(0,i.Lk)("div",_i,[t[29]||(t[29]=(0,i.Lk)("div",{class:"divider"},[(0,i.Lk)("span",null,"OR")],-1)),(0,i.Lk)("div",Oi,[t[26]||(t[26]=(0,i.Lk)("h4",null,"Contact Administrator",-1)),t[27]||(t[27]=(0,i.Lk)("p",null,"If you cannot remember your current password, please contact the admin:",-1)),(0,i.Lk)("div",Wi,[(0,i.Lk)("div",Ui,[(0,i.bF)(c,{size:16}),t[24]||(t[24]=(0,i.Lk)("span",{class:"admin-email"},"sa9082@nyu.edu",-1))]),(0,i.Lk)("div",zi,[(0,i.bF)(h,{size:16}),(0,i.Lk)("span",null,[t[25]||(t[25]=(0,i.eW)("Include your username: ",-1)),(0,i.Lk)("strong",null,(0,n.v_)(o.currentUser?.username),1)])])]),t[28]||(t[28]=(0,i.Lk)("p",{class:"contact-note"}," Please send an email from your Gmail account with your username and request for password reset. ",-1))])])])):(0,i.Q3)("",!0)])]),(0,i.Lk)("div",Vi,["profile"===r.activeTab?((0,i.uX)(),(0,i.CE)("button",{key:0,class:"btn-danger",onClick:t[11]||(t[11]=(...e)=>l.handleLogout&&l.handleLogout(...e))},[(0,i.bF)(u,{size:16}),t[31]||(t[31]=(0,i.eW)(" Logout ",-1))])):(0,i.Q3)("",!0),(0,i.Lk)("button",{class:"btn-secondary",onClick:t[12]||(t[12]=(...e)=>l.handleClose&&l.handleClose(...e))},"Close")])])])):(0,i.Q3)("",!0)}
/**
 * @license lucide-vue-next v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const Xi=(0,Go.A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Hi=(0,Go.A)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Ki=(0,Go.A)("circle-question-mark",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Gi=(0,Go.A)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]),Qi=(0,Go.A)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]),qi=(0,Go.A)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]);var Ji=o(6763),Yi={name:"UserProfileModal",props:{modelValue:{type:Boolean,default:!1},currentUser:{type:Object,default:null}},emits:["update:modelValue","logout","password-changed"],components:{User:Xi,Lock:Hi,HelpCircle:Ki,LogOut:Gi,Mail:Qi,MessageSquare:qi,X:y.A},data(){return{activeTab:"profile",loading:!1,passwordVerified:!1,sessionId:localStorage.getItem("session_id"),tabs:[{id:"profile",label:"Profile",icon:"User"},{id:"change-password",label:"Change Password",icon:"Lock"},{id:"forgot-password",label:"Forgot Password",icon:"HelpCircle"}],passwordForm:{currentPassword:"",newPassword:"",confirmPassword:""},forgotForm:{currentPassword:"",newPassword:"",confirmPassword:""}}},computed:{visible:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},methods:{handleClose(){this.visible=!1,this.resetAllForms()},async handleLogout(){try{const e=await fetch("/api/logout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:this.sessionId})}),t=await e.json();t.success?(localStorage.removeItem("session_id"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("full_name"),ht.nk.success("Logged out successfully"),this.handleClose(),this.$emit("logout"),setTimeout(()=>{window.location.reload()},1e3)):ht.nk.error("Logout failed. Please try again.")}catch(bc){Ji.error("Logout error:",bc),ht.nk.error("Network error during logout")}},async changePassword(){if(this.passwordForm.currentPassword)if(!this.passwordForm.newPassword||this.passwordForm.newPassword.length<6)ht.nk.warning("New password must be at least 6 characters");else if(this.passwordForm.newPassword===this.passwordForm.confirmPassword){this.loading=!0;try{const e=await fetch("/api/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:this.sessionId,old_password:this.passwordForm.currentPassword,new_password:this.passwordForm.newPassword})}),t=await e.json();t.success?(ht.nk.success("Password changed successfully!"),this.$emit("password-changed"),this.resetPasswordForm(),this.activeTab="profile"):ht.nk.error(t.error||"Failed to change password")}catch(bc){ht.nk.error("Network error. Please try again.")}finally{this.loading=!1}}else ht.nk.warning("Passwords do not match");else ht.nk.warning("Please enter your current password")},async verifyCurrentPassword(){if(this.forgotForm.currentPassword){this.loading=!0;try{const e=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.currentUser.username,password:this.forgotForm.currentPassword})}),t=await e.json();t.success?(this.passwordVerified=!0,ht.nk.success("Password verified! Now enter your new password.")):ht.nk.error("Incorrect password. Please try again.")}catch(bc){ht.nk.error("Network error. Please try again.")}finally{this.loading=!1}}else ht.nk.warning("Please enter your current password")},async resetPasswordWithVerification(){if(this.passwordVerified)if(!this.forgotForm.newPassword||this.forgotForm.newPassword.length<6)ht.nk.warning("New password must be at least 6 characters");else if(this.forgotForm.newPassword===this.forgotForm.confirmPassword){this.loading=!0;try{const e=await fetch("/api/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:this.sessionId,old_password:this.forgotForm.currentPassword,new_password:this.forgotForm.newPassword})}),t=await e.json();t.success?(ht.nk.success("Password reset successfully!"),this.$emit("password-changed"),this.resetForgotForm(),this.activeTab="profile"):ht.nk.error(t.error||"Failed to reset password")}catch(bc){ht.nk.error("Network error. Please try again.")}finally{this.loading=!1}}else ht.nk.warning("Passwords do not match");else ht.nk.warning("Please verify your current password first")},resetPasswordForm(){this.passwordForm={currentPassword:"",newPassword:"",confirmPassword:""}},resetForgotForm(){this.forgotForm={currentPassword:"",newPassword:"",confirmPassword:""},this.passwordVerified=!1},resetAllForms(){this.resetPasswordForm(),this.resetForgotForm(),this.activeTab="profile"}}};const Zi=(0,k.A)(Yi,[["render",Bi],["__scopeId","data-v-240fc189"]]);var es=Zi;const ts={class:"two-header-container"},os={class:"header-first"},is={class:"nav-menu"},ss={class:"nav__items-left"},ns={class:"nav__item"},as=["aria-expanded"],rs={class:"nav__dropdown-item"},ls={class:"nav__dropdown-item"},ds={class:"nav__dropdown-item"},cs=["disabled"],hs={class:"nav__dropdown-item"},us={class:"nav__dropdown-item"},ps=["disabled"],ms={class:"nav__dropdown-item"},fs=["disabled"],gs={class:"nav__dropdown-item"},vs={class:"nav__dropdown-item"},ys=["disabled"],ws={class:"nav__item"},bs=["aria-expanded"],ks={class:"nav__dropdown-item"},Is={class:"nav__dropdown-item"},Ps={class:"nav__dropdown-item"},Ss={class:"nav__dropdown-item"},Cs={class:"nav__dropdown-item"},Ls={class:"nav__dropdown-item"},Fs={class:"nav__dropdown-item"},Rs={class:"nav__dropdown-item"},Es={class:"nav__item"},xs=["aria-expanded"],Ds={class:"nav__dropdown-item"},js={class:"nav__dropdown-item"},$s={class:"nav__dropdown-item"},Ts={class:"nav__item"},Ms=["aria-expanded"],Ns={class:"nav__dropdown-item"},As={class:"nav__dropdown-item"},_s={class:"nav__dropdown-item"},Os={class:"nav__item"},Ws=["aria-expanded"],Us={class:"nav__dropdown-item"},zs={class:"header-right-section"},Vs={class:"header-second"},Bs={class:"header-second-center-container"},Xs=["title"],Hs={class:"header-second-right"};function Ks(e,t,o,a,r,l){const d=(0,i.g2)("UserCircle"),c=(0,i.g2)("Play"),h=(0,i.g2)("Square"),u=(0,i.g2)("Save"),p=(0,i.g2)("Trash2"),m=(0,i.g2)("Settings"),f=es;return(0,i.uX)(),(0,i.CE)("div",ts,[(0,i.Lk)("div",os,[(0,i.Lk)("nav",is,[(0,i.Lk)("ul",ss,[(0,i.Lk)("li",ns,[(0,i.Lk)("button",{class:"nav__item-button",onClick:t[0]||(t[0]=(0,s.D$)(e=>l.toggleDropdown("file"),["stop"])),"aria-haspopup":"menu","aria-expanded":"file"===r.activeDropdown},t[41]||(t[41]=[(0,i.Lk)("span",{class:"nav__item-header"},"File",-1),(0,i.Lk)("svg",{class:"nav__item-triangle",width:"9",height:"6",viewBox:"0 0 9 6",xmlns:"http://www.w3.org/2000/svg"},[(0,i.Lk)("polygon",{points:"4.5 6 9 0 0 0",fill:"currentColor"})],-1)]),8,as),(0,i.bo)((0,i.Lk)("ul",{class:"nav__dropdown",onClick:t[9]||(t[9]=(0,s.D$)(()=>{},["stop"]))},[(0,i.Lk)("li",rs,[(0,i.Lk)("button",{onClick:t[1]||(t[1]=e=>l.newFile())},t[42]||(t[42]=[(0,i.Lk)("span",null,"New File",-1),(0,i.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+Alt+N",-1)]))]),(0,i.Lk)("li",ls,[(0,i.Lk)("button",{onClick:t[2]||(t[2]=e=>l.openFile())},t[43]||(t[43]=[(0,i.Lk)("span",null,"Open File",-1),(0,i.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+O",-1)]))]),(0,i.Lk)("li",ds,[(0,i.Lk)("button",{onClick:t[3]||(t[3]=e=>l.duplicateFile()),disabled:!l.hasSelectedFile},t[44]||(t[44]=[(0,i.Lk)("span",null,"Duplicate (Make a copy)",-1)]),8,cs)]),(0,i.Lk)("li",hs,[(0,i.Lk)("button",{onClick:t[4]||(t[4]=e=>l.saveFile())},t[45]||(t[45]=[(0,i.Lk)("span",null,"Save",-1),(0,i.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+S",-1)]))]),(0,i.Lk)("li",us,[(0,i.Lk)("button",{onClick:t[5]||(t[5]=e=>l.saveAsFile()),disabled:!l.canSaveAsFile},t[46]||(t[46]=[(0,i.Lk)("span",null,"Save As",-1),(0,i.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+Shift+S",-1)]),8,ps)]),(0,i.Lk)("li",ms,[(0,i.Lk)("button",{onClick:t[6]||(t[6]=e=>l.moveFile()),disabled:!l.hasSelectedFile},t[47]||(t[47]=[(0,i.Lk)("span",null,"Move",-1),(0,i.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+Shift+M",-1)]),8,fs)]),(0,i.Lk)("li",gs,[(0,i.Lk)("button",{onClick:t[7]||(t[7]=e=>l.downloadFile())},t[48]||(t[48]=[(0,i.Lk)("span",null,"Download",-1),(0,i.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+D",-1)]))]),(0,i.Lk)("li",vs,[(0,i.Lk)("button",{onClick:t[8]||(t[8]=e=>l.deleteFile()),disabled:!l.hasSelectedFile,class:"delete-option"},t[49]||(t[49]=[(0,i.Lk)("span",null,"Delete File",-1),(0,i.Lk)("span",{class:"nav__keyboard-shortcut"},"Delete",-1)]),8,ys)])],512),[[s.aG,"file"===r.activeDropdown]])]),(0,i.Lk)("li",ws,[(0,i.Lk)("button",{class:"nav__item-button",onClick:t[10]||(t[10]=(0,s.D$)(e=>l.toggleDropdown("edit"),["stop"])),"aria-haspopup":"menu","aria-expanded":"edit"===r.activeDropdown},t[50]||(t[50]=[(0,i.Lk)("span",{class:"nav__item-header"},"Edit",-1),(0,i.Lk)("svg",{class:"nav__item-triangle",width:"9",height:"6",viewBox:"0 0 9 6",xmlns:"http://www.w3.org/2000/svg"},[(0,i.Lk)("polygon",{points:"4.5 6 9 0 0 0",fill:"currentColor"})],-1)]),8,bs),(0,i.bo)((0,i.Lk)("ul",{class:"nav__dropdown",onClick:t[19]||(t[19]=(0,s.D$)(()=>{},["stop"]))},[(0,i.Lk)("li",ks,[(0,i.Lk)("button",{onClick:t[11]||(t[11]=e=>l.undo())},t[51]||(t[51]=[(0,i.Lk)("span",null,"Undo",-1),(0,i.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+Z",-1)]))]),(0,i.Lk)("li",Is,[(0,i.Lk)("button",{onClick:t[12]||(t[12]=e=>l.redo())},t[52]||(t[52]=[(0,i.Lk)("span",null,"Redo",-1),(0,i.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+Y",-1)]))]),t[59]||(t[59]=(0,i.Lk)("li",{class:"nav__dropdown-divider"},null,-1)),(0,i.Lk)("li",Ps,[(0,i.Lk)("button",{onClick:t[13]||(t[13]=e=>l.cut())},t[53]||(t[53]=[(0,i.Lk)("span",null,"Cut",-1),(0,i.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+X",-1)]))]),(0,i.Lk)("li",Ss,[(0,i.Lk)("button",{onClick:t[14]||(t[14]=e=>l.copy())},t[54]||(t[54]=[(0,i.Lk)("span",null,"Copy",-1),(0,i.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+C",-1)]))]),(0,i.Lk)("li",Cs,[(0,i.Lk)("button",{onClick:t[15]||(t[15]=e=>l.paste())},t[55]||(t[55]=[(0,i.Lk)("span",null,"Paste",-1),(0,i.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+V",-1)]))]),t[60]||(t[60]=(0,i.Lk)("li",{class:"nav__dropdown-divider"},null,-1)),(0,i.Lk)("li",Ls,[(0,i.Lk)("button",{onClick:t[16]||(t[16]=e=>l.find())},t[56]||(t[56]=[(0,i.Lk)("span",null,"Find",-1),(0,i.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+F",-1)]))]),(0,i.Lk)("li",Fs,[(0,i.Lk)("button",{onClick:t[17]||(t[17]=e=>l.replace())},t[57]||(t[57]=[(0,i.Lk)("span",null,"Replace",-1),(0,i.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+H",-1)]))]),t[61]||(t[61]=(0,i.Lk)("li",{class:"nav__dropdown-divider"},null,-1)),(0,i.Lk)("li",Rs,[(0,i.Lk)("button",{onClick:t[18]||(t[18]=e=>l.comment())},t[58]||(t[58]=[(0,i.Lk)("span",null,"Comment",-1),(0,i.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+/",-1)]))])],512),[[s.aG,"edit"===r.activeDropdown]])]),(0,i.Lk)("li",Es,[(0,i.Lk)("button",{class:"nav__item-button",onClick:t[20]||(t[20]=(0,s.D$)(e=>l.toggleDropdown("run"),["stop"])),"aria-haspopup":"menu","aria-expanded":"run"===r.activeDropdown},t[62]||(t[62]=[(0,i.Lk)("span",{class:"nav__item-header"},"Run",-1),(0,i.Lk)("svg",{class:"nav__item-triangle",width:"9",height:"6",viewBox:"0 0 9 6",xmlns:"http://www.w3.org/2000/svg"},[(0,i.Lk)("polygon",{points:"4.5 6 9 0 0 0",fill:"currentColor"})],-1)]),8,xs),(0,i.bo)((0,i.Lk)("ul",{class:"nav__dropdown",onClick:t[24]||(t[24]=(0,s.D$)(()=>{},["stop"]))},[(0,i.Lk)("li",Ds,[(0,i.Lk)("button",{onClick:t[21]||(t[21]=e=>l.runScript())},t[63]||(t[63]=[(0,i.Lk)("span",null,"Run Script",-1),(0,i.Lk)("span",{class:"nav__keyboard-shortcut"},"F5",-1)]))]),(0,i.Lk)("li",js,[(0,i.Lk)("button",{onClick:t[22]||(t[22]=e=>l.stopScript())},t[64]||(t[64]=[(0,i.Lk)("span",null,"Stop",-1),(0,i.Lk)("span",{class:"nav__keyboard-shortcut"},"Shift+F5",-1)]))]),(0,i.Lk)("li",$s,[(0,i.Lk)("button",{onClick:t[23]||(t[23]=e=>l.clearConsole())},t[65]||(t[65]=[(0,i.Lk)("span",null,"Clear Console",-1)]))])],512),[[s.aG,"run"===r.activeDropdown]])]),(0,i.Lk)("li",Ts,[(0,i.Lk)("button",{class:"nav__item-button",onClick:t[25]||(t[25]=(0,s.D$)(e=>l.toggleDropdown("view"),["stop"])),"aria-haspopup":"menu","aria-expanded":"view"===r.activeDropdown},t[66]||(t[66]=[(0,i.Lk)("span",{class:"nav__item-header"},"View",-1),(0,i.Lk)("svg",{class:"nav__item-triangle",width:"9",height:"6",viewBox:"0 0 9 6",xmlns:"http://www.w3.org/2000/svg"},[(0,i.Lk)("polygon",{points:"4.5 6 9 0 0 0",fill:"currentColor"})],-1)]),8,Ms),(0,i.bo)((0,i.Lk)("ul",{class:"nav__dropdown",onClick:t[29]||(t[29]=(0,s.D$)(()=>{},["stop"]))},[(0,i.Lk)("li",Ns,[(0,i.Lk)("button",{onClick:t[26]||(t[26]=e=>l.toggleConsole())},[(0,i.Lk)("span",null,(0,n.v_)(r.consoleVisible?"Hide REPL":"Show REPL"),1),t[67]||(t[67]=(0,i.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+`",-1))])]),(0,i.Lk)("li",As,[(0,i.Lk)("button",{onClick:t[27]||(t[27]=e=>l.togglePreviewPanel())},[(0,i.Lk)("span",null,(0,n.v_)(r.previewPanelVisible?"Hide Right Panel":"Show Right Panel"),1),t[68]||(t[68]=(0,i.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+Shift+P",-1))])]),(0,i.Lk)("li",_s,[(0,i.Lk)("button",{onClick:t[28]||(t[28]=e=>l.toggleSidebar())},[(0,i.Lk)("span",null,(0,n.v_)(r.sidebarVisible?"Hide Sidebar":"Show Sidebar"),1),t[69]||(t[69]=(0,i.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+B",-1))])])],512),[[s.aG,"view"===r.activeDropdown]])]),(0,i.Lk)("li",Os,[(0,i.Lk)("button",{class:"nav__item-button",onClick:t[30]||(t[30]=(0,s.D$)(e=>l.toggleDropdown("help"),["stop"])),"aria-haspopup":"menu","aria-expanded":"help"===r.activeDropdown},t[70]||(t[70]=[(0,i.Lk)("span",{class:"nav__item-header"},"Help",-1),(0,i.Lk)("svg",{class:"nav__item-triangle",width:"9",height:"6",viewBox:"0 0 9 6",xmlns:"http://www.w3.org/2000/svg"},[(0,i.Lk)("polygon",{points:"4.5 6 9 0 0 0",fill:"currentColor"})],-1)]),8,Ws),(0,i.bo)((0,i.Lk)("ul",{class:"nav__dropdown",onClick:t[32]||(t[32]=(0,s.D$)(()=>{},["stop"]))},[(0,i.Lk)("li",Us,[(0,i.Lk)("button",{onClick:t[31]||(t[31]=e=>l.showKeyboardShortcuts())},t[71]||(t[71]=[(0,i.Lk)("span",null,"Keyboard Shortcuts",-1),(0,i.Lk)("span",{class:"nav__keyboard-shortcut"},"F1",-1)]))])],512),[[s.aG,"help"===r.activeDropdown]])])])]),(0,i.Lk)("div",zs,[o.currentUser?((0,i.uX)(),(0,i.CE)("button",{key:1,class:"user-btn",onClick:t[34]||(t[34]=e=>r.showUserProfile=!0)},[(0,i.bF)(d,{size:18}),(0,i.Lk)("span",null,(0,n.v_)(o.currentUser.username),1)])):((0,i.uX)(),(0,i.CE)("button",{key:0,class:"sign-in-btn",onClick:t[33]||(t[33]=(...e)=>l.handleSignIn&&l.handleSignIn(...e))},[(0,i.bF)(d,{size:18}),t[72]||(t[72]=(0,i.Lk)("span",null,"Sign In",-1))]))])]),(0,i.Lk)("div",Vs,[(0,i.Lk)("div",Bs,[o.hasRunProgram?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",{key:0,class:"icon-btn run-btn",onClick:t[35]||(t[35]=e=>l.runScript()),title:"Run (F5)"},[(0,i.bF)(c,{size:20})])),o.hasRunProgram?((0,i.uX)(),(0,i.CE)("div",{key:1,class:"icon-btn stop-btn",onClick:t[36]||(t[36]=e=>l.stopScript()),title:"Stop (Shift+F5)"},[(0,i.bF)(h,{size:20})])):(0,i.Q3)("",!0),(0,i.Lk)("div",{class:"icon-btn save-btn",onClick:t[37]||(t[37]=e=>l.saveFile()),title:"Save (Ctrl+S)"},[(0,i.bF)(u,{size:20})]),(0,i.Lk)("div",{class:(0,n.C4)(["icon-btn delete-btn",{disabled:!l.canDeleteFile}]),onClick:t[38]||(t[38]=e=>l.deleteSelectedFile()),title:l.deleteButtonTitle},[(0,i.bF)(p,{size:20})],10,Xs)]),(0,i.Lk)("div",Hs,[(0,i.Lk)("div",{class:"icon-btn settings-btn",onClick:t[39]||(t[39]=e=>l.openSettings()),title:"Settings"},[(0,i.bF)(m,{size:20})])])]),(0,i.bF)(f,{modelValue:r.showUserProfile,"onUpdate:modelValue":t[40]||(t[40]=e=>r.showUserProfile=e),"current-user":o.currentUser,onLogout:l.handleLogout,onPasswordChanged:l.handlePasswordChanged},null,8,["modelValue","current-user","onLogout","onPasswordChanged"])])}var Gs=o(7478),Qs=o(8263),qs=o(9037);
/**
 * @license lucide-vue-next v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const Js=(0,Go.A)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),Ys=(0,Go.A)("circle-user",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]),Zs=(0,Go.A)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var en=o(6763),tn={props:{consoleLimit:Boolean,hasRunProgram:Boolean,currentUser:{type:Object,default:null}},data(){return{isRun:!0,activeDropdown:null,consoleVisible:!0,previewPanelVisible:!1,sidebarVisible:!0,showUserProfile:!1}},computed:{ideInfo(){return this.$store?.state?.ide?.ideInfo||{}},isPythonFile(){return this.ideInfo.currProj&&this.ideInfo.currProj.pathSelected&&this.ideInfo.codeItems&&this.ideInfo.codeItems.length>0&&this.ideInfo.currProj.pathSelected.endsWith(".py")},hasSelectedFile(){const e=this.ideInfo.nodeSelected&&"file"===this.ideInfo.nodeSelected.type;return en.log("🔍 [DEBUG] hasSelectedFile computed:",{nodeSelected:this.ideInfo.nodeSelected,nodeType:this.ideInfo.nodeSelected?.type,result:e}),e},canDeleteFile(){const e=this.ideInfo.nodeSelected;return e&&"file"===e.type},deleteButtonTitle(){return this.ideInfo.nodeSelected?"file"!==this.ideInfo.nodeSelected.type?"Can only delete files":`Delete ${this.ideInfo.nodeSelected.label||this.ideInfo.nodeSelected.name}`:"Select a file to delete"},canSaveAsFile(){const e=this.hasSelectedFile,t=this.ideInfo.codeSelected&&this.ideInfo.codeSelected.fileName,o=e||t;return en.log("🔍 [DEBUG] canSaveAsFile computed:",{hasSelectedFile:e,nodeSelected:this.ideInfo.nodeSelected,hasCodeSelected:t,codeSelected:this.ideInfo.codeSelected,result:o}),o}},components:{Upload:lt.A,Play:Gs.A,Square:Qs.A,Settings:qs.A,Trash2:Js,UserCircle:Ys,Save:Zs,UserProfileModal:es},mounted(){const e=localStorage.getItem("theme")||"dark";document.documentElement.setAttribute("data-theme",e),document.addEventListener("click",this.closeDropdowns),en.log("🎹 TwoHeaderMenu - Adding keyboard shortcut listener"),document.addEventListener("keydown",this.handleKeyboardShortcuts)},beforeUnmount(){document.removeEventListener("click",this.closeDropdowns),document.removeEventListener("keydown",this.handleKeyboardShortcuts)},methods:{toggleDropdown(e){this.activeDropdown=this.activeDropdown===e?null:e},closeDropdowns(){this.activeDropdown=null},handleKeyboardShortcuts(e){if(e.ctrlKey&&!e.shiftKey&&"s"===e.key)return e.preventDefault(),e.stopPropagation(),void this.saveFile();if(e.ctrlKey&&e.shiftKey&&"S"===e.key)return en.log("🔍 [DEBUG] Ctrl+Shift+S keyboard shortcut triggered"),en.log("🔍 [DEBUG] canSaveAsFile:",this.canSaveAsFile),e.preventDefault(),e.stopPropagation(),void(this.canSaveAsFile?(en.log("🔍 [DEBUG] Calling saveAsFile() from keyboard shortcut"),this.saveAsFile()):en.log("🔍 [DEBUG] Cannot save as - no file available"));if(e.ctrlKey&&e.altKey&&!e.shiftKey&&"n"===e.key)return e.preventDefault(),e.stopPropagation(),void this.newFile();if(e.ctrlKey&&!e.shiftKey&&"o"===e.key)return e.preventDefault(),e.stopPropagation(),void this.openFile();if(e.ctrlKey&&!e.shiftKey&&"d"===e.key)return e.preventDefault(),e.stopPropagation(),void this.downloadFile();if(e.ctrlKey&&e.shiftKey&&"M"===e.key)return e.preventDefault(),e.stopPropagation(),void(this.hasSelectedFile&&this.moveFile());if("Delete"===e.key&&this.hasSelectedFile)return e.preventDefault(),e.stopPropagation(),void this.deleteFile();if(e.ctrlKey&&!e.shiftKey&&"z"===e.key)return e.preventDefault(),e.stopPropagation(),void this.undo();if(e.ctrlKey&&!e.shiftKey&&"y"===e.key)return e.preventDefault(),e.stopPropagation(),void this.redo();if(e.ctrlKey&&!e.shiftKey&&"x"===e.key){const t=document.activeElement,o=t&&t.classList.contains("repl-input");if(o)return;return e.preventDefault(),e.stopPropagation(),void this.cut()}if(e.ctrlKey&&!e.shiftKey&&"c"===e.key){const t=document.activeElement,o=t&&t.classList.contains("repl-input");if(o)return;return e.preventDefault(),e.stopPropagation(),void this.copy()}if(e.ctrlKey&&!e.shiftKey&&"v"===e.key){const t=document.activeElement,o=t&&t.classList.contains("repl-input");if(o)return;return e.preventDefault(),e.stopPropagation(),void this.paste()}return e.ctrlKey&&!e.shiftKey&&"f"===e.key?(e.preventDefault(),e.stopPropagation(),void this.find()):e.ctrlKey&&!e.shiftKey&&"h"===e.key?(e.preventDefault(),e.stopPropagation(),void this.replace()):e.ctrlKey&&"/"===e.key?(e.preventDefault(),e.stopPropagation(),void this.comment()):"F5"!==e.key||e.shiftKey?e.shiftKey&&"F5"===e.key?(e.preventDefault(),e.stopPropagation(),void(this.hasRunProgram&&this.stopScript())):e.ctrlKey&&"`"===e.key?(e.preventDefault(),e.stopPropagation(),void this.toggleConsole()):e.ctrlKey&&e.shiftKey&&"P"===e.key?(e.preventDefault(),e.stopPropagation(),void this.togglePreviewPanel()):e.ctrlKey&&!e.shiftKey&&"b"===e.key?(e.preventDefault(),e.stopPropagation(),void this.toggleSidebar()):"F1"===e.key?(e.preventDefault(),e.stopPropagation(),void this.showKeyboardShortcuts()):e.ctrlKey&&","===e.key?(e.preventDefault(),e.stopPropagation(),void this.openSettings()):void 0:(e.preventDefault(),e.stopPropagation(),void(this.isPythonFile&&!this.consoleLimit&&this.runScript()))},newFile(){if(this.closeDropdowns(),!this.ideInfo.nodeSelected||"dir"!==this.ideInfo.nodeSelected.type&&"folder"!==this.ideInfo.nodeSelected.type){const e=this.ideInfo.currProj?.data;e&&this.$store.commit("ide/setNodeSelected",e)}this.$emit("set-text-dialog",{type:"create-file",title:"New File",tips:"Enter file name:",text:"untitled.py"})},saveFile(){this.closeDropdowns(),this.ideInfo.codeSelected&&(this.$store.dispatch("ide/saveFile",{codeItem:this.ideInfo.codeSelected,isAutoSave:!1}),ht.nk.success("File saved"))},downloadFile(){if(this.closeDropdowns(),this.ideInfo.nodeSelected&&"file"===this.ideInfo.nodeSelected.type){const e=this.ideInfo.nodeSelected,t={fileName:e.label||e.name,filePath:e.path,projectName:e.projectName||this.ideInfo.currProj?.data?.name};this.$emit("download-file",t)}else this.ideInfo.codeSelected?this.$emit("download-file",this.ideInfo.codeSelected):ht.nk.warning("Please select a file to download")},runScript(){this.closeDropdowns(),this.$emit("run-item")},stopScript(){this.closeDropdowns();for(let e=0;e<this.ideInfo.consoleItems.length;e++)!0===this.ideInfo.consoleItems[e].run&&this.$store.commit("ide/setConsoleItemRun",{index:e,value:!1});this.$emit("stop-item",null)},clearConsole(){this.$emit("clear-console")},deleteSelectedFile(){if(!this.canDeleteFile)return void ht.nk.warning("Please select a file to delete");const e=this.ideInfo.nodeSelected,t=e.label||e.name;ao.s.confirm(`Are you sure you want to delete "${t}"?`,"Confirm Delete",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then(()=>{this.$emit("delete-selected-file",{path:e.path,type:e.type,projectName:e.projectName||this.ideInfo.currProj?.data?.name})}).catch(()=>{})},openSettings(){this.$emit("open-settings")},handleSignIn(){this.$emit("sign-in")},openFile(){this.closeDropdowns(),this.$emit("open-file-browser")},duplicateFile(){if(en.log("🔍 [DEBUG] duplicateFile() called from TwoHeaderMenu"),this.closeDropdowns(),!this.hasSelectedFile)return en.log("🔍 [DEBUG] No file selected for duplication"),void ht.nk.warning("Please select a file to duplicate");const e=this.ideInfo.nodeSelected,t=e.label||e.name,o=t.includes(".")?t.substring(t.lastIndexOf(".")):"",i=t.includes(".")?t.substring(0,t.lastIndexOf(".")):t,s=`${i}_copy${o}`;en.log("🔍 [DEBUG] Emitting duplicate-file event:",{originalPath:e.path,newName:s,projectName:e.projectName||this.ideInfo.currProj?.data?.name}),this.$emit("duplicate-file",{originalPath:e.path,newName:s,projectName:e.projectName||this.ideInfo.currProj?.data?.name})},saveAsFile(){if(en.log("🔍 [DEBUG] saveAsFile() called"),en.log("🔍 [DEBUG] hasSelectedFile:",this.hasSelectedFile),en.log("🔍 [DEBUG] nodeSelected:",this.ideInfo.nodeSelected),en.log("🔍 [DEBUG] codeSelected:",this.ideInfo.codeSelected),en.log("🔍 [DEBUG] canSaveAsFile:",this.canSaveAsFile),this.closeDropdowns(),this.hasSelectedFile){const e=this.ideInfo.nodeSelected,t={fileName:e.label||e.name,filePath:e.path,projectName:e.projectName||this.ideInfo.currProj?.data?.name};return en.log("🔍 [DEBUG] Converted tree file to fileInfo:",t),en.log("🔍 [DEBUG] Original selectedFile:",e),void this.$emit("save-as-file",t)}if(this.ideInfo.codeSelected)return en.log("🔍 [DEBUG] Emitting save-as-file for editor file:",this.ideInfo.codeSelected),void this.$emit("save-as-file",this.ideInfo.codeSelected);en.log("🔍 [DEBUG] No file available for save as"),ht.nk.warning("Please select a file to save")},moveFile(){this.closeDropdowns(),this.hasSelectedFile?this.$emit("open-move-dialog",this.ideInfo.nodeSelected):ht.nk.warning("Please select a file to move")},deleteFile(){if(this.closeDropdowns(),!this.hasSelectedFile)return void ht.nk.warning("Please select a file to delete");const e=this.ideInfo.nodeSelected,t=e.label||e.name;ao.s.confirm(`Are you sure you want to delete "${t}"?`,"Confirm Delete",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then(()=>{this.$emit("delete-file",{path:e.path,type:e.type,projectName:e.projectName||this.ideInfo.currProj?.data?.name})}).catch(()=>{})},undo(){this.closeDropdowns(),this.$emit("undo")},redo(){this.closeDropdowns(),this.$emit("redo")},cut(){this.closeDropdowns(),this.$emit("cut")},copy(){this.closeDropdowns(),this.$emit("copy")},paste(){this.closeDropdowns(),this.$emit("paste")},find(){this.closeDropdowns(),this.$emit("find")},replace(){this.closeDropdowns(),this.$emit("replace")},comment(){this.closeDropdowns(),this.$emit("comment")},toggleConsole(){this.closeDropdowns(),this.consoleVisible=!this.consoleVisible,this.$emit("toggle-console",this.consoleVisible)},togglePreviewPanel(){this.closeDropdowns(),this.previewPanelVisible=!this.previewPanelVisible,this.$emit("toggle-preview-panel",this.previewPanelVisible)},toggleSidebar(){this.closeDropdowns(),this.sidebarVisible=!this.sidebarVisible,this.$emit("toggle-sidebar",this.sidebarVisible)},showKeyboardShortcuts(){this.closeDropdowns(),this.$emit("show-keyboard-shortcuts")},handleLogout(){localStorage.removeItem("session_id"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("full_name"),this.$emit("logout"),ht.nk.success("Logged out successfully"),setTimeout(()=>{window.location.reload()},1e3)},handlePasswordChanged(){ht.nk.success("Password changed successfully!")}}};const on=(0,k.A)(tn,[["render",Ks],["__scopeId","data-v-499ff064"]]);var sn=on;const nn={class:"main-wrapper ide-wrapper ide-container"},an={id:"total-frame",class:"total-frame"},rn={id:"left-sidebar",class:"left-sidebar"},ln={id:"center-frame",class:"center-frame"},dn={class:"editor-section"},cn={class:"editor-tab-bar"},hn={class:"editor-content"},un={class:"console-section"},pn={class:"console-header"},mn={class:"console-header-left"},fn={class:"console-title"},gn={class:"console-header-center"},vn={key:0,class:"console-header-right"},yn=["title"],wn={class:"console-body"},bn={class:"console-output-area",ref:"consoleOutputArea"},kn={key:0,class:"console-text"},In={key:1,class:"console-error"},Pn={key:2,class:"console-input-prompt"},Sn={key:3,class:"console-system"},Cn={key:4,class:"console-repl-prompt"},Ln=["innerHTML"],Fn={key:6,class:"console-repl-entry"},Rn={key:0,class:"console-repl-prompt"},En=["innerHTML"],xn={key:1,class:"console-repl-line"},Dn={class:"console-repl-prompt"},jn=["innerHTML"],$n={key:7,class:"console-text"},Tn={key:0,class:"console-input-area"},Mn={class:"input-prompt"},Nn={class:"input-field-container"},An=["rows"],_n={key:1,class:"repl-section"},On={class:"repl-prompt"},Wn={class:"prompt-symbol"},Un=["rows"],zn={id:"right-sidebar",class:"right-sidebar"},Vn={class:"right-sidebar-placeholder"},Bn={class:"preview-tabs"},Xn={class:"preview-tab-list"},Hn=["onClick"],Kn={class:"tab-icon"},Gn={class:"tab-title"},Qn=["onClick"],qn={class:"preview-content"},Jn={key:0,class:"output-panel"},Yn={class:"output-content"},Zn={key:1,class:"media-preview-panel"},ea={key:2,class:"data-preview-panel"},ta={key:0,class:"right-panel-controls"},oa=["title"],ia={class:"tab-count"},sa={key:7,class:"repl-modal"},na={class:"repl-modal-content"},aa={class:"repl-modal-header"},ra={class:"repl-modal-body"};function la(e,t,o,a,r,l){const d=sn,c=ni.A,h=si,u=Yo,p=Do.A,m=(0,i.g2)("pane"),f=xo,g=wo.A,v=yo.A,y=(0,i.g2)("ChevronUp"),w=(0,i.g2)("ChevronDown"),b=(0,i.g2)("Minimize2"),k=(0,i.g2)("splitpanes"),I=vo.A,C=go.A,L=(0,i.g2)("ChevronLeft"),F=(0,i.g2)("ChevronRight"),R=fo.A,E=mo.A,x=po.A,D=uo.A,j=ho,$=_t,T=ft,M=De,N=S.A,A=P;return(0,i.uX)(),(0,i.CE)("div",nn,[(0,i.bF)(d,{class:"two-header-menu",consoleLimit:l.consoleLimit,hasRunProgram:l.hasRunProgram,currentUser:l.currentUser,onSetTextDialog:l.setTextDialog,onSetDelDialog:l.setDelDialog,onSetProjsDialog:l.setProjsDialog,onRunItem:l.runPathSelected,onStopItem:l.stop,onClearConsole:l.clearConsole,onSignIn:l.handleSignIn,onOpenUploadDialog:t[0]||(t[0]=e=>r.showUploadDialog=!0),onDownloadFile:l.downloadFile,onOpenSettings:t[1]||(t[1]=e=>r.showSettingsModal=!0),onOpenFileBrowser:l.openFileBrowser,onDuplicateFile:l.duplicateFile,onSaveAsFile:l.saveAsFile,onOpenMoveDialog:l.openMoveDialog,onDeleteFile:l.deleteFileFromMenu,onDeleteSelectedFile:l.deleteSelectedFile,onUndo:l.handleUndo,onRedo:l.handleRedo,onCut:l.handleCut,onCopy:l.handleCopy,onPaste:l.handlePaste,onFind:l.handleFind,onReplace:l.handleReplace,onComment:l.handleComment,onToggleConsole:l.toggleConsole,onTogglePreviewPanel:l.togglePreviewPanel,onToggleSidebar:l.toggleLeftSidebar,onShowKeyboardShortcuts:t[2]||(t[2]=e=>r.showKeyboardShortcutsModal=!r.showKeyboardShortcutsModal)},null,8,["consoleLimit","hasRunProgram","currentUser","onSetTextDialog","onSetDelDialog","onSetProjsDialog","onRunItem","onStopItem","onClearConsole","onSignIn","onDownloadFile","onOpenFileBrowser","onDuplicateFile","onSaveAsFile","onOpenMoveDialog","onDeleteFile","onDeleteSelectedFile","onUndo","onRedo","onCut","onCopy","onPaste","onFind","onReplace","onComment","onToggleConsole","onTogglePreviewPanel","onToggleSidebar"]),(0,i.bF)(c,{modelValue:r.showSettingsModal,"onUpdate:modelValue":t[3]||(t[3]=e=>r.showSettingsModal=e),onUpdateFontSize:l.updateFontSize,onUpdateLineNumbers:l.updateLineNumbers,onUpdateWordWrap:l.updateWordWrap,onUpdateAutoSave:l.updateAutoSave,onUpdateAutoSaveInterval:l.updateAutoSaveInterval,onUpdateAutoSaveNotifications:l.updateAutoSaveNotifications},null,8,["modelValue","onUpdateFontSize","onUpdateLineNumbers","onUpdateWordWrap","onUpdateAutoSave","onUpdateAutoSaveInterval","onUpdateAutoSaveNotifications"]),(0,i.bF)(h,{modelValue:r.showKeyboardShortcutsModal,"onUpdate:modelValue":t[4]||(t[4]=e=>r.showKeyboardShortcutsModal=e)},null,8,["modelValue"]),(0,i.bF)(u,{modelValue:r.showFindReplaceModal,"onUpdate:modelValue":t[5]||(t[5]=e=>r.showFindReplaceModal=e),mode:r.findReplaceMode},null,8,["modelValue","mode"]),(0,i.Lk)("div",an,[(0,i.bF)(k,{class:(0,n.C4)(["default-theme","main-splitpanes",{"has-right-content":r.previewTabs.length>0}])},{default:(0,i.k6)(()=>[(0,i.bF)(m,{size:l.leftSidebarSize,"min-size":l.leftSidebarMinSize,"max-size":l.leftSidebarMaxSize},{default:(0,i.k6)(()=>[(0,i.bo)((0,i.Lk)("div",rn,[(0,i.bF)(p,{currentUser:l.currentUser,onGetItem:l.getFile,onGetItemRightPanel:l.getFileForRightPanel,onContextMenu:r.showContextMenu,onRenameItem:l.handleRenameItem,onDeleteItem:l.handleDeleteItem,onDownloadItem:l.handleDownloadItem,onNewFile:l.handleNewFileFromTree,onNewFolder:l.handleNewFolderFromTree,onImportFile:l.handleImportFileFromTree},null,8,["currentUser","onGetItem","onGetItemRightPanel","onContextMenu","onRenameItem","onDeleteItem","onDownloadItem","onNewFile","onNewFolder","onImportFile"])],512),[[s.aG,r.leftSidebarVisible&&r.windowWidth>900]])]),_:1},8,["size","min-size","max-size"]),(0,i.bF)(m,{size:l.centerSize,"min-size":30},{default:(0,i.k6)(()=>[(0,i.Lk)("div",ln,[(0,i.bF)(f,{onOpenInRightPanel:l.getFileForRightPanel},null,8,["onOpenInRightPanel"]),(0,i.bF)(k,{horizontal:"",class:"default-theme"},{default:(0,i.k6)(()=>[(0,i.bF)(m,{size:l.editorPaneSize,"min-size":5,"max-size":95},{default:(0,i.k6)(()=>[(0,i.Lk)("div",dn,[(0,i.Lk)("div",cn,[l.ideInfo.codeItems.length>0?((0,i.uX)(),(0,i.Wv)(g,{key:0,onSelectItem:l.selectFile,onCloseItem:l.closeFile,onToggleSidebar:l.toggleLeftSidebar},null,8,["onSelectItem","onCloseItem","onToggleSidebar"])):(0,i.Q3)("",!0)]),(0,i.Lk)("div",hn,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(l.ideInfo.codeItems,(e,t)=>((0,i.uX)(),(0,i.CE)(i.FK,{key:`${e.projectName||"default"}:${e.path}`},[l.isSelectedFile(e)?((0,i.uX)(),(0,i.Wv)(v,{key:0,codeItem:e,codeItemIndex:t,consoleLimit:l.consoleLimit,wordWrap:r.wordWrap,onRunItem:l.runPathSelected,onUpdateItem:l.updateItem},null,8,["codeItem","codeItemIndex","consoleLimit","wordWrap","onRunItem","onUpdateItem"])):(0,i.Q3)("",!0)],64))),128))])])]),_:1},8,["size"]),(0,i.bF)(m,{size:l.consolePaneSize,"min-size":5,"max-size":95},{default:(0,i.k6)(()=>[(0,i.Lk)("div",un,[(0,i.Lk)("div",pn,[(0,i.Lk)("div",mn,[(0,i.Lk)("span",fn,(0,n.v_)((r.isReplMode,"Console")),1)]),(0,i.Lk)("div",gn,["collapsed"===r.consoleMode?((0,i.uX)(),(0,i.CE)("button",{key:0,class:"console-expand-arrow",onClick:t[6]||(t[6]=(...e)=>l.handleConsoleUpArrow&&l.handleConsoleUpArrow(...e)),title:"Open console"},[(0,i.bF)(y,{size:16})])):(0,i.Q3)("",!0),"normal"===r.consoleMode?((0,i.uX)(),(0,i.CE)("button",{key:1,class:"console-expand-arrow",onClick:t[7]||(t[7]=(...e)=>l.handleConsoleUpArrow&&l.handleConsoleUpArrow(...e)),title:"Maximize console"},[(0,i.bF)(y,{size:16})])):(0,i.Q3)("",!0),"normal"===r.consoleMode?((0,i.uX)(),(0,i.CE)("button",{key:2,class:"console-expand-arrow",onClick:t[8]||(t[8]=(...e)=>l.handleConsoleDownArrow&&l.handleConsoleDownArrow(...e)),title:"Collapse console"},[(0,i.bF)(w,{size:16})])):(0,i.Q3)("",!0),"maximized"===r.consoleMode?((0,i.uX)(),(0,i.CE)("button",{key:3,class:"console-expand-arrow",onClick:t[9]||(t[9]=(...e)=>l.handleConsoleRestore&&l.handleConsoleRestore(...e)),title:"Restore console"},[(0,i.bF)(b,{size:16})])):(0,i.Q3)("",!0),"maximized"===r.consoleMode?((0,i.uX)(),(0,i.CE)("button",{key:4,class:"console-expand-arrow",onClick:t[10]||(t[10]=(...e)=>l.handleConsoleDownArrow&&l.handleConsoleDownArrow(...e)),title:"Collapse console"},[(0,i.bF)(w,{size:16})])):(0,i.Q3)("",!0)]),r.consoleExpanded?((0,i.uX)(),(0,i.CE)("div",vn,[(0,i.Lk)("button",{class:(0,n.C4)(["console-action-btn",{active:r.isReplMode}]),onClick:t[11]||(t[11]=(0,s.D$)((...e)=>l.toggleReplMode&&l.toggleReplMode(...e),["stop"])),title:r.isReplMode?"Exit REPL Mode":"Start Python REPL"},[(0,i.Lk)("span",null,(0,n.v_)(r.isReplMode?"Exit REPL":"REPL"),1)],10,yn),(0,i.Lk)("button",{class:"console-action-btn",onClick:t[12]||(t[12]=(0,s.D$)((...e)=>l.clearConsole&&l.clearConsole(...e),["stop"])),title:"Clear Console"},t[29]||(t[29]=[(0,i.Lk)("span",null,"Clear",-1)]))])):(0,i.Q3)("",!0)]),(0,i.bo)((0,i.Lk)("div",wn,[(0,i.Lk)("div",bn,[l.ideInfo.consoleSelected&&l.ideInfo.consoleSelected.resultList?((0,i.uX)(!0),(0,i.CE)(i.FK,{key:0},(0,i.pI)(l.ideInfo.consoleSelected.resultList,(e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t,class:"console-line"},["output"!==e.type&&"text"!==e.type||l.isPromptOutput(e)?"error"===e.type?((0,i.uX)(),(0,i.CE)("pre",In,(0,n.v_)(e.text||e.content||e),1)):"input"===e.type||"input-prompt"===e.type?((0,i.uX)(),(0,i.CE)("div",Pn,[(0,i.Lk)("span",null,(0,n.v_)(e.text||e.content||e),1)])):"system"===e.type?((0,i.uX)(),(0,i.CE)("pre",Sn,(0,n.v_)(e.text||e.content||e),1)):"repl-prompt"===e.type?((0,i.uX)(),(0,i.CE)("span",Cn,(0,n.v_)(e.text||">>> "),1)):"user-input"===e.type?((0,i.uX)(),(0,i.CE)("pre",{key:5,class:"console-user-input",innerHTML:l.highlightPythonCode(e.text||e.content||e)},null,8,Ln)):"repl-input"===e.type?((0,i.uX)(),(0,i.CE)("div",Fn,[l.isMultilineCode(e.content||e.text||e)?((0,i.uX)(!0),(0,i.CE)(i.FK,{key:0},(0,i.pI)(l.splitCodeLines(e.content||e.text||e),(t,o)=>((0,i.uX)(),(0,i.CE)("div",{key:"line-"+o,class:"console-repl-line"},[0===o?((0,i.uX)(),(0,i.CE)("span",Rn,(0,n.v_)(e.prompt||">>> "),1)):(0,i.Q3)("",!0),(0,i.Lk)("pre",{class:(0,n.C4)(["console-repl-input",{"no-prompt":o>0}]),innerHTML:l.highlightPythonCode(t)},null,10,En)]))),128)):((0,i.uX)(),(0,i.CE)("div",xn,[(0,i.Lk)("span",Dn,(0,n.v_)(e.prompt||">>> "),1),(0,i.Lk)("pre",{class:"console-repl-input",innerHTML:l.highlightPythonCode(e.content||e.text||e)},null,8,jn)]))])):((0,i.uX)(),(0,i.CE)("pre",$n,(0,n.v_)("object"===typeof e?e.text||e.content||JSON.stringify(e):e),1)):((0,i.uX)(),(0,i.CE)("pre",kn,(0,n.v_)(e.text||e.content||e),1))]))),128)):(0,i.Q3)("",!0)],512),l.ideInfo.consoleSelected&&l.ideInfo.consoleSelected.waitingForInput?((0,i.uX)(),(0,i.CE)("div",Tn,[(0,i.Lk)("div",Mn,[t[30]||(t[30]=(0,i.Lk)("span",{class:"prompt-icon"},"💬",-1)),(0,i.Lk)("span",null,(0,n.v_)(l.ideInfo.consoleSelected.inputPrompt||"Enter input:"),1)]),(0,i.Lk)("div",Nn,[(0,i.bo)((0,i.Lk)("textarea",{"onUpdate:modelValue":t[13]||(t[13]=e=>r.programInput=e),onKeydown:t[14]||(t[14]=(...e)=>l.handleProgramInputKeydown&&l.handleProgramInputKeydown(...e)),ref:"programInputField",class:"program-input-field",placeholder:"Type your input and press Enter...",rows:r.programInputRows,autofocus:""},null,40,An),[[s.Jo,r.programInput]]),(0,i.Lk)("button",{onClick:t[15]||(t[15]=(...e)=>l.sendProgramInput&&l.sendProgramInput(...e)),class:"input-submit-btn"},"Send")])])):(0,i.Q3)("",!0),r.isReplMode||l.ideInfo.consoleSelected&&l.ideInfo.consoleSelected.waitingForReplInput?((0,i.uX)(),(0,i.CE)("div",_n,[(0,i.Lk)("div",On,[(0,i.Lk)("span",Wn,(0,n.v_)(r.replPrompt||">>> "),1),(0,i.bo)((0,i.Lk)("textarea",{class:"repl-input",placeholder:"Enter Python code...","onUpdate:modelValue":t[16]||(t[16]=e=>r.replInput=e),onKeydown:t[17]||(t[17]=(...e)=>l.handleReplKeydown&&l.handleReplKeydown(...e)),ref:"replInputField",rows:r.replInputRows},"                ",40,Un),[[s.Jo,r.replInput]])])])):(0,i.Q3)("",!0)],512),[[s.aG,r.consoleExpanded]])])]),_:1},8,["size"])]),_:1})])]),_:1},8,["size"]),(0,i.bF)(m,{size:l.rightSidebarSize,"min-size":l.rightSidebarMinSize,"max-size":l.rightSidebarMaxSize,"push-other-panes":!1},{default:(0,i.k6)(()=>[(0,i.Lk)("div",zn,[(0,i.bo)((0,i.Lk)("div",Vn,null,512),[[s.aG,!r.rightSidebarVisible||0===r.previewTabs.length]]),(0,i.bo)((0,i.Lk)("div",Bn,[(0,i.Lk)("div",Xn,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.previewTabs,e=>((0,i.uX)(),(0,i.CE)("button",{key:e.id,class:(0,n.C4)(["preview-tab",{active:r.selectedPreviewTab===e.id}]),onClick:t=>l.selectPreviewTab(e.id)},[(0,i.Lk)("span",Kn,(0,n.v_)(l.getTabIcon(e.type)),1),(0,i.Lk)("span",Gn,(0,n.v_)(e.title),1),(0,i.Lk)("span",{class:"tab-close",onClick:(0,s.D$)(t=>l.closePreviewTab(e.id),["stop"])},"×",8,Qn)],10,Hn))),128))])],512),[[s.aG,r.rightSidebarVisible&&r.previewTabs.length>0]]),(0,i.bo)((0,i.Lk)("div",qn,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.previewTabs,e=>(0,i.bo)(((0,i.uX)(),(0,i.CE)("div",{key:e.id,class:"preview-panel"},["output"===e.type?((0,i.uX)(),(0,i.CE)("div",Jn,[(0,i.Lk)("div",Yn,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.content,(e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t,class:(0,n.C4)(["output-line",e.type])},[(0,i.Lk)("pre",null,(0,n.v_)(e.text),1)],2))),128))])])):"image"===e.type||"pdf"===e.type?((0,i.uX)(),(0,i.CE)("div",Zn,[(0,i.bF)(I,{codeItem:l.getMediaCodeItem(e),codeItemIndex:0},null,8,["codeItem"])])):"data"===e.type?((0,i.uX)(),(0,i.CE)("div",ea,[(0,i.bF)(C,{content:e.content},null,8,["content"])])):(0,i.Q3)("",!0)],512)),[[s.aG,r.selectedPreviewTab===e.id]])),128))],512),[[s.aG,r.rightSidebarVisible&&r.previewTabs.length>0]])])]),_:1},8,["size","min-size","max-size"])]),_:1},8,["class"]),"closed"!==r.rightPanelMode&&r.previewTabs.length>0?((0,i.uX)(),(0,i.CE)("div",ta,["normal"===r.rightPanelMode?((0,i.uX)(),(0,i.CE)("button",{key:0,class:"control-arrow left-arrow",onClick:t[18]||(t[18]=(...e)=>l.handleLeftArrowClick&&l.handleLeftArrowClick(...e)),title:"Expand preview to full width"},[(0,i.bF)(L,{size:16})])):(0,i.Q3)("",!0),(0,i.Lk)("button",{class:"control-arrow right-arrow",onClick:t[19]||(t[19]=(...e)=>l.handleRightArrowClick&&l.handleRightArrowClick(...e)),title:"expanded"===r.rightPanelMode?"Restore to normal size":"Collapse preview panel"},[(0,i.bF)(F,{size:16})],8,oa)])):(0,i.Q3)("",!0),"closed"===r.rightPanelMode&&r.previewTabs.length>0?((0,i.uX)(),(0,i.CE)("div",{key:1,class:"show-preview-btn",onClick:t[20]||(t[20]=(...e)=>l.restoreRightPanel&&l.restoreRightPanel(...e)),title:"Show Preview Panel"},[(0,i.Lk)("span",ia,(0,n.v_)(r.previewTabs.length),1),t[31]||(t[31]=(0,i.Lk)("span",null,"◀",-1))])):(0,i.Q3)("",!0)]),r.showProjsDialog?((0,i.uX)(),(0,i.Wv)(R,{key:0,onOnCancel:l.onCloseProjsDialog,onOnSelect:l.onSelectProj,onOnDelete:l.onDeleteProj,onSetTextDialog:l.setTextDialog},null,8,["onOnCancel","onOnSelect","onOnDelete","onSetTextDialog"])):(0,i.Q3)("",!0),r.showFileDialog?((0,i.uX)(),(0,i.Wv)(E,{key:1,title:r.dialogTitle,text:r.dialogText,tips:r.dialogTips,onCheckInput:l.inputIsLegal,onOnCancel:l.onCloseTextDialog,onOnCreate:l.onCreate},null,8,["title","text","tips","onCheckInput","onOnCancel","onOnCreate"])):(0,i.Q3)("",!0),r.showDeleteDialog?((0,i.uX)(),(0,i.Wv)(x,{key:2,title:r.dialogTitle,onOnCancel:l.onCancelDelete,onOnDelete:l.onDelete},null,8,["title","onOnCancel","onOnDelete"])):(0,i.Q3)("",!0),r.showUploadDialog?((0,i.uX)(),(0,i.Wv)(D,{key:3,modelValue:r.showUploadDialog,"onUpdate:modelValue":t[21]||(t[21]=e=>r.showUploadDialog=e),onRefreshTree:l.refreshProjectTree,onClose:t[22]||(t[22]=e=>r.showUploadDialog=!1)},null,8,["modelValue","onRefreshTree"])):(0,i.Q3)("",!0),r.showNewFileDialog?((0,i.uX)(),(0,i.Wv)(j,{key:4,modelValue:r.showNewFileDialog,"onUpdate:modelValue":t[23]||(t[23]=e=>r.showNewFileDialog=e),onFileCreated:l.handleFileCreated},null,8,["modelValue","onFileCreated"])):(0,i.Q3)("",!0),r.showNewFolderDialog?((0,i.uX)(),(0,i.Wv)($,{key:5,modelValue:r.showNewFolderDialog,"onUpdate:modelValue":t[24]||(t[24]=e=>r.showNewFolderDialog=e),onFolderCreated:l.handleFolderCreated},null,8,["modelValue","onFolderCreated"])):(0,i.Q3)("",!0),r.showImportFileDialog?((0,i.uX)(),(0,i.Wv)(T,{key:6,modelValue:r.showImportFileDialog,"onUpdate:modelValue":t[25]||(t[25]=e=>r.showImportFileDialog=e),onFilesImported:l.handleFilesImported},null,8,["modelValue","onFilesImported"])):(0,i.Q3)("",!0),(0,i.bF)(M,{modelValue:r.showFileBrowserDialog,"onUpdate:modelValue":t[26]||(t[26]=e=>r.showFileBrowserDialog=e),mode:r.fileBrowserMode,fileToMove:r.fileToMove,currentUser:l.currentUser,onOpenFile:l.handleOpenFile,onMoveFile:l.handleMoveFile},null,8,["modelValue","mode","fileToMove","currentUser","onOpenFile","onMoveFile"]),r.showREPL?((0,i.uX)(),(0,i.CE)("div",sa,[(0,i.Lk)("div",na,[(0,i.Lk)("div",aa,[t[32]||(t[32]=(0,i.Lk)("h3",null,"Python REPL (Interactive Console)",-1)),(0,i.Lk)("button",{onClick:t[27]||(t[27]=(...e)=>l.closeREPL&&l.closeREPL(...e)),class:"repl-close-btn"},"✕")]),(0,i.Lk)("div",ra,[(0,i.bF)(N)])])])):(0,i.Q3)("",!0),(0,i.bF)(A,{visible:r.showLoginModal,onClose:t[28]||(t[28]=e=>r.showLoginModal=!1),onLoginSuccess:l.handleLoginSuccess},null,8,["visible","onLoginSuccess"])])}o(6573),o(8100),o(7936),o(9577),o(1549),o(9797),o(9631),o(5623),o(4979),o(4603),o(7566),o(8721);var da=o(9415),ca=o(3887);
/**
 * @license lucide-vue-next v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const ha=(0,Go.A)("minimize-2",[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]]),ua={class:"hybrid-console"},pa={class:"console-output",ref:"consoleOutput"},ma={key:1,class:"output-text error-output"},fa={key:2,class:"output-text system-message"},ga={key:3,class:"input-prompt-line"},va={class:"prompt-text"},ya={key:4,class:"user-input-line"},wa={class:"input-text"},ba={class:"repl-prompt"},ka={key:6,class:"repl-output"},Ia={key:7,class:"figure-container"},Pa=["src"],Sa={class:"figure-controls"},Ca=["onClick"],La=["onClick"],Fa={key:0,class:"loading-indicator"},Ra={key:0,class:"input-area"},Ea={key:0,class:"input-prompt-display"},xa={class:"prompt-label"},Da={key:1,class:"repl-input-container"},ja={class:"repl-input-prefix"},$a={class:"repl-editor-wrapper"},Ta={key:2,class:"input-container"},Ma=["rows"],Na=["disabled"],Aa={class:"input-hint"},_a={key:0},Oa={key:1},Wa={class:"console-status"},Ua={class:"status-left"},za={key:0,class:"status-item repl"},Va={key:1,class:"status-item running"},Ba={key:2,class:"status-item success"},Xa={key:3,class:"status-item error"},Ha={key:4,class:"status-item idle"},Ka={class:"status-right"};function Ga(e,t,o,a,r,l){const d=(0,i.g2)("Codemirror");return(0,i.uX)(),(0,i.CE)("div",ua,[(0,i.Lk)("div",pa,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.outputLines,(e,o)=>((0,i.uX)(),(0,i.CE)("div",{key:o,class:"output-line"},["text"===e.type?((0,i.uX)(),(0,i.CE)("pre",{key:0,class:(0,n.C4)(["output-text",e.class])},(0,n.v_)(e.content),3)):"error"===e.type?((0,i.uX)(),(0,i.CE)("pre",ma,(0,n.v_)(e.content),1)):"system"===e.type?((0,i.uX)(),(0,i.CE)("pre",fa,(0,n.v_)(e.content),1)):"input-prompt"===e.type?((0,i.uX)(),(0,i.CE)("div",ga,[t[8]||(t[8]=(0,i.Lk)("span",{class:"prompt-indicator"},"🔸",-1)),(0,i.Lk)("span",va,(0,n.v_)(e.content),1)])):"user-input"===e.type?((0,i.uX)(),(0,i.CE)("div",ya,[t[9]||(t[9]=(0,i.Lk)("span",{class:"input-indicator"},"▶",-1)),(0,i.Lk)("span",wa,(0,n.v_)(e.content),1)])):"repl-input"===e.type?((0,i.uX)(),(0,i.CE)("div",{key:5,class:(0,n.C4)(["repl-line",{multiline:e.multiline}])},[(0,i.Lk)("span",ba,(0,n.v_)(e.prompt),1),(0,i.Lk)("pre",{class:(0,n.C4)(["repl-input-text",{"multiline-content":e.multiline}])},(0,n.v_)(e.content),3)],2)):"repl-output"===e.type?((0,i.uX)(),(0,i.CE)("pre",ka,(0,n.v_)(e.content),1)):"figure"===e.type?((0,i.uX)(),(0,i.CE)("div",Ia,[(0,i.Lk)("img",{src:`data:image/png;base64,${e.data}`,alt:"Matplotlib Figure",class:"matplotlib-figure"},null,8,Pa),(0,i.Lk)("div",Sa,[(0,i.Lk)("button",{class:"figure-btn",onClick:t=>a.downloadFigure(e.data),title:"Download"}," 📥 ",8,Ca),(0,i.Lk)("button",{class:"figure-btn",onClick:t=>a.openFigureInNewTab(e.data),title:"Open in new tab"}," 🔍 ",8,La)])])):(0,i.Q3)("",!0)]))),128)),!o.isRunning||a.waitingForInput||a.isReplMode?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",Fa,t[10]||(t[10]=[(0,i.Lk)("span",{class:"loading-dots"},"●●●",-1),(0,i.Lk)("span",{class:"loading-text"},"Running...",-1)])))],512),a.waitingForInput||a.isReplMode?((0,i.uX)(),(0,i.CE)("div",Ra,[a.waitingForInput&&!a.isReplMode?((0,i.uX)(),(0,i.CE)("div",Ea,[t[11]||(t[11]=(0,i.Lk)("span",{class:"prompt-icon"},"💬",-1)),(0,i.Lk)("span",xa,(0,n.v_)(a.currentPrompt||"Waiting for input..."),1)])):(0,i.Q3)("",!0),a.isReplMode?((0,i.uX)(),(0,i.CE)("div",Da,[(0,i.Lk)("span",ja,(0,n.v_)(a.replPrompt),1),(0,i.Lk)("div",$a,[(0,i.bF)(d,{value:a.userInput,"onUpdate:value":t[0]||(t[0]=e=>a.userInput=e),options:a.replCodeMirrorOptions,onKeydown:a.handleKeyDown,ref:"replEditor",class:"repl-codemirror",placeholder:"Enter Python code..."},null,8,["value","options","onKeydown"])])])):((0,i.uX)(),(0,i.CE)("div",Ta,[t[12]||(t[12]=(0,i.Lk)("span",{class:"input-prefix"},"▶",-1)),(0,i.bo)((0,i.Lk)("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>a.userInput=e),onKeydown:t[2]||(t[2]=(...e)=>a.handleKeyDown&&a.handleKeyDown(...e)),ref:"inputField",class:"user-input-field",placeholder:"Type your input and press Enter...",rows:a.inputRows,autofocus:""},null,40,Ma),[[s.Jo,a.userInput]]),(0,i.Lk)("button",{class:"input-btn primary",onClick:t[3]||(t[3]=(...e)=>a.sendInput&&a.sendInput(...e)),disabled:!a.userInput.trim(),title:"Submit (Enter)"}," ✓ ",8,Na),(0,i.Lk)("button",{class:"input-btn secondary",onClick:t[4]||(t[4]=(...e)=>a.cancelInput&&a.cancelInput(...e)),title:"Cancel (Escape)"}," ✕ ")])),(0,i.Lk)("div",Aa,[a.isReplMode?((0,i.uX)(),(0,i.CE)("span",_a,"Enter: Execute | Shift+Enter: New line | Up/Down: History")):((0,i.uX)(),(0,i.CE)("span",Oa,"Press Enter to submit • Escape to cancel"))])])):(0,i.Q3)("",!0),(0,i.Lk)("div",Wa,[(0,i.Lk)("div",Ua,[a.isReplMode?((0,i.uX)(),(0,i.CE)("span",za,t[13]||(t[13]=[(0,i.Lk)("span",{class:"status-dot repl"},null,-1),(0,i.eW)(" REPL Mode ",-1)]))):o.isRunning?((0,i.uX)(),(0,i.CE)("span",Va,[t[14]||(t[14]=(0,i.Lk)("span",{class:"status-dot"},null,-1)),(0,i.eW)(" Running "+(0,n.v_)(a.currentProgram),1)])):0===a.lastExitCode?((0,i.uX)(),(0,i.CE)("span",Ba,t[15]||(t[15]=[(0,i.Lk)("span",{class:"status-dot"},null,-1),(0,i.eW)(" Ready ",-1)]))):null!==a.lastExitCode?((0,i.uX)(),(0,i.CE)("span",Xa,[t[16]||(t[16]=(0,i.Lk)("span",{class:"status-dot"},null,-1)),(0,i.eW)(" Exit code: "+(0,n.v_)(a.lastExitCode),1)])):((0,i.uX)(),(0,i.CE)("span",Ha,t[17]||(t[17]=[(0,i.Lk)("span",{class:"status-dot"},null,-1),(0,i.eW)(" Idle ",-1)])))]),(0,i.Lk)("div",Ka,[(0,i.Lk)("button",{class:"status-btn",onClick:t[5]||(t[5]=(...e)=>a.clearConsole&&a.clearConsole(...e)),title:"Clear console"},"🗑️"),(0,i.Lk)("button",{class:"status-btn",onClick:t[6]||(t[6]=(...e)=>a.exportOutput&&a.exportOutput(...e)),title:"Export output"},"📄"),o.isRunning||a.isReplMode?((0,i.uX)(),(0,i.CE)("button",{key:0,class:"status-btn danger",onClick:t[7]||(t[7]=(...e)=>a.stopProgram&&a.stopProgram(...e)),title:"Stop"},"⏹️")):(0,i.Q3)("",!0)])])])}var Qa=o(2453),qa=o(5237),Ja=o.n(qa),Ya=(o(4806),o(436),o(7923),o(5218),o(4317),o(7829),{name:"HybridConsole",components:{Codemirror:Qa.Ay},props:{item:{type:Object,required:!0},isRunning:{type:Boolean,default:!1}},emits:["run-item","stop-item","send-input"],setup(e,{emit:t}){const o=(0,C.KR)([]),s=(0,C.KR)(!1),n=(0,C.KR)(""),a=(0,C.KR)(""),r=(0,C.KR)(null),l=(0,C.KR)(""),d=(0,C.KR)(!1),c=(0,C.KR)(">>> "),h=(0,C.KR)([]),u=(0,C.KR)(-1),p=(0,C.KR)(1),m=(0,C.KR)(null),f=(0,C.KR)(null),g=(0,C.KR)(null),v=(0,C.KR)({mode:{name:"python",version:3,singleLineStringErrors:!1},theme:"repl-theme",lineNumbers:!1,smartIndent:!0,indentUnit:4,tabSize:4,indentWithTabs:!1,matchBrackets:!0,autoCloseBrackets:!0,styleActiveLine:!1,lineWrapping:!0,showCursorWhenSelecting:!0,viewportMargin:1/0,scrollbarStyle:null,autofocus:!0,extraKeys:{Enter:e=>{const t=e.getCursor(),o=e.getLine(t.line),i=e.getValue().trim(),s=o.trim().endsWith(":")||o.trim().endsWith("\\")||/^\s+/.test(o)||i.split("\n").some((e,o)=>o<t.line&&e.trim().endsWith(":"));if(s||t.line<e.lastLine()){const t=o.match(/^\s*/)[0],i=o.trim().endsWith(":")?"    ":"";e.replaceSelection("\n"+t+i)}else i?F():e.replaceSelection("\n")},"Shift-Enter":e=>{const t=e.getCursor(),o=e.getLine(t.line),i=o.match(/^\s*/)[0];e.replaceSelection("\n"+i)},Up:e=>{0!==e.getCursor().line||e.getSelection()?Ja().commands.goLineUp(e):R("up")},Down:e=>{e.getCursor().line!==e.lastLine()||e.getSelection()?Ja().commands.goLineDown(e):R("down")},Tab:e=>{e.getSelection()?e.indentSelection("add"):e.replaceSelection(Array(e.getOption("indentUnit")+1).join(" "))},"Shift-Tab":e=>{e.indentSelection("subtract")}}}),y=(0,i.EW)(()=>{if(!a.value)return 1;const e=a.value.split("\n").length;return Math.min(Math.max(e,1),10)});(0,i.wB)(a,()=>{p.value=y.value});const w=(e,t="text",s="")=>{o.value.push({type:t,content:e,class:s,timestamp:Date.now()}),(0,i.dY)(()=>{$()})},b=(e,t,s="repl-input")=>{const n=t.includes("\n")&&""!==t.trim()||t.trim().match(/^(def|class|if|for|while|with|try|except|finally)\s/)&&t.trim().endsWith(":");o.value.push({type:s,prompt:e,content:t,timestamp:Date.now(),multiline:n}),(0,i.dY)(()=>{$()})},k=e=>{o.value.push({type:"figure",data:e,timestamp:Date.now()}),(0,i.dY)(()=>{$()})},I=e=>{const t=e||"Program waiting for input:";n.value=t,s.value=!0,w(e||"Program waiting for input:","input-prompt"),(0,i.dY)(()=>{f.value&&f.value.focus()})},P=()=>{d.value=!0,s.value=!1,c.value=">>> ",a.value="",u.value=-1,(0,i.dY)(()=>{setTimeout(()=>{g.value?.cminstance?(g.value.cminstance.refresh(),g.value.cminstance.focus()):f.value&&f.value.focus()},100)})},S=()=>{d.value=!1,c.value=">>> ",a.value="",h.value=[],u.value=-1},L=e=>{d.value?"Enter"!==e.key||e.shiftKey?"Enter"===e.key&&e.shiftKey?c.value="... ":"ArrowUp"===e.key?(e.preventDefault(),R("up")):"ArrowDown"===e.key&&(e.preventDefault(),R("down")):(e.preventDefault(),F()):"Enter"!==e.key||e.shiftKey?"Escape"===e.key&&(e.preventDefault(),x()):(e.preventDefault(),E())},F=()=>{const o=d.value&&g.value?.cminstance?.getValue()||a.value;if(!o.trim())return b(c.value,"","repl-input"),void(c.value=">>> ");o.trim()&&(h.value.push(o),u.value=h.value.length),b(c.value,o,"repl-input"),t("send-input",{programId:e.item.id,input:o,isRepl:!0}),d.value&&g.value?.cminstance&&(g.value.cminstance.setValue(""),(0,i.dY)(()=>{g.value.cminstance.refresh(),g.value.cminstance.focus()})),a.value="",c.value=">>> ",p.value=1},R=e=>{if(0!==h.value.length)if("up"===e){u.value>0?u.value--:-1!==u.value&&u.value!==h.value.length||(u.value=h.value.length-1);const e=h.value[u.value]||"";if(d.value&&g.value?.cminstance){g.value.cminstance.setValue(e);const t=g.value.cminstance.getDoc(),o=t.lastLine(),i=t.getLine(o).length;t.setCursor(o,i)}else a.value=e}else if("down"===e)if(u.value<h.value.length-1){u.value++;const e=h.value[u.value]||"";if(d.value&&g.value?.cminstance){g.value.cminstance.setValue(e);const t=g.value.cminstance.getDoc(),o=t.lastLine(),i=t.getLine(o).length;t.setCursor(o,i)}else a.value=e}else u.value=h.value.length,d.value&&g.value?.cminstance?g.value.cminstance.setValue(""):a.value=""},E=()=>{if(!a.value.trim()&&!s.value)return;const o=a.value;w(o,"user-input"),a.value="",s.value=!1,n.value="",p.value=1,t("send-input",{programId:e.item.id,input:o,isRepl:!1})},x=()=>{a.value="",s.value=!1,n.value="",p.value=1,t("send-input",{programId:e.item.id,input:"",isRepl:!1})},D=()=>{o.value=[],r.value=null,d.value||(h.value=[],u.value=-1),ht.nk.success("Console cleared")},j=()=>{d.value&&S(),t("stop-item",e.item.id)},$=()=>{m.value&&(m.value.scrollTop=m.value.scrollHeight)},T=e=>{const t=document.createElement("a");t.href=`data:image/png;base64,${e}`,t.download=`figure_${Date.now()}.png`,t.click()},M=e=>{const t=`data:image/png;base64,${e}`;window.open(t,"_blank")},N=()=>{const e=o.value.map(e=>"text"===e.type||"error"===e.type||"system"===e.type?e.content:"input-prompt"===e.type?`Prompt: ${e.content}`:"user-input"===e.type?`> ${e.content}`:"repl-input"===e.type?`${e.prompt}${e.content}`:"repl-output"===e.type?e.content:"").join("\n"),t=new Blob([e],{type:"text/plain"}),i=URL.createObjectURL(t),s=document.createElement("a");s.href=i,s.download=`console_output_${Date.now()}.txt`,s.click(),URL.revokeObjectURL(i),ht.nk.success("Output exported")},A=e=>{0===e.code?e.data&&void 0!==e.data.stdout&&w(e.data.stdout,"text"):1===e.code?e.data&&e.data.stdout&&w(e.data.stdout,"error"):2e3===e.code?e.data&&void 0!==e.data.prompt&&I(e.data.prompt):3e3===e.code?e.data&&e.data.figure&&k(e.data.figure):4e3===e.code?e.data&&e.data.error&&(r.value=1):5e3===e.code&&e.data&&"repl"===e.data.mode&&P()};return(0,i.wB)(()=>e.item.resultList,e=>{if(e&&e.length>0){const t=e[e.length-1];A(t)}},{deep:!0}),(0,i.wB)(()=>e.item.run,t=>{t?(l.value=e.item.name||"program",r.value=null):d.value&&S()}),{outputLines:o,waitingForInput:s,currentPrompt:n,userInput:a,lastExitCode:r,currentProgram:l,isReplMode:d,replPrompt:c,inputRows:p,consoleOutput:m,inputField:f,replEditor:g,replCodeMirrorOptions:v,executeReplCommand:F,handleKeyDown:L,sendInput:E,cancelInput:x,clearConsole:D,stopProgram:j,exportOutput:N,downloadFigure:T,openFigureInNewTab:M}}});const Za=(0,k.A)(Ya,[["render",Ga],["__scopeId","data-v-51b3f28c"]]);var er=Za,tr=o(5572),or=o(1754);function ir(e,t){var o=-1,i=null==e?0:e.length;while(++o<i)if(!1===t(e[o],o,e))break;return e}var sr=ir,nr=o(2851),ar=o(2528);function rr(e,t,o,i){var s=!o;o||(o={});var n=-1,a=t.length;while(++n<a){var r=t[n],l=i?i(o[r],e[r],r,o,e):void 0;void 0===l&&(l=e[r]),s?(0,ar.A)(o,r,l):(0,nr.A)(o,r,l)}return o}var lr=rr,dr=o(9084);function cr(e,t){return e&&lr(t,(0,dr.A)(t),e)}var hr=cr,ur=o(3607),pr=o(3149),mr=o(7271);function fr(e){var t=[];if(null!=e)for(var o in Object(e))t.push(o);return t}var gr=fr,vr=Object.prototype,yr=vr.hasOwnProperty;function wr(e){if(!(0,pr.A)(e))return gr(e);var t=(0,mr.A)(e),o=[];for(var i in e)("constructor"!=i||!t&&yr.call(e,i))&&o.push(i);return o}var br=wr,kr=o(8446);function Ir(e){return(0,kr.A)(e)?(0,ur.A)(e,!0):br(e)}var Pr=Ir;function Sr(e,t){return e&&lr(t,Pr(t),e)}var Cr=Sr,Lr=o(1917),Fr="object"==typeof exports&&exports&&!exports.nodeType&&exports,Rr=Fr&&"object"==typeof module&&module&&!module.nodeType&&module,Er=Rr&&Rr.exports===Fr,xr=Er?Lr.A.Buffer:void 0,Dr=xr?xr.allocUnsafe:void 0;function jr(e,t){if(t)return e.slice();var o=e.length,i=Dr?Dr(o):new e.constructor(o);return e.copy(i),i}var $r=jr;function Tr(e,t){var o=-1,i=e.length;t||(t=Array(i));while(++o<i)t[o]=e[o];return t}var Mr=Tr,Nr=o(8634);function Ar(e,t){return lr(e,(0,Nr.A)(e),t)}var _r=Ar,Or=o(6912),Wr=o(367),Ur=(0,Wr.A)(Object.getPrototypeOf,Object),zr=Ur,Vr=o(3153),Br=Object.getOwnPropertySymbols,Xr=Br?function(e){var t=[];while(e)(0,Or.A)(t,(0,Nr.A)(e)),e=zr(e);return t}:Vr.A,Hr=Xr;function Kr(e,t){return lr(e,Hr(e),t)}var Gr=Kr,Qr=o(9042),qr=o(3831);function Jr(e){return(0,qr.A)(e,Pr,Hr)}var Yr=Jr,Zr=o(4906),el=Object.prototype,tl=el.hasOwnProperty;function ol(e){var t=e.length,o=new e.constructor(t);return t&&"string"==typeof e[0]&&tl.call(e,"index")&&(o.index=e.index,o.input=e.input),o}var il=ol,sl=o(3988);function nl(e){var t=new e.constructor(e.byteLength);return new sl.A(t).set(new sl.A(e)),t}var al=nl;function rl(e,t){var o=t?al(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.byteLength)}var ll=rl,dl=/\w*$/;function cl(e){var t=new e.constructor(e.source,dl.exec(e));return t.lastIndex=e.lastIndex,t}var hl=cl,ul=o(241),pl=ul.A?ul.A.prototype:void 0,ml=pl?pl.valueOf:void 0;function fl(e){return ml?Object(ml.call(e)):{}}var gl=fl;function vl(e,t){var o=t?al(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.length)}var yl=vl,wl="[object Boolean]",bl="[object Date]",kl="[object Map]",Il="[object Number]",Pl="[object RegExp]",Sl="[object Set]",Cl="[object String]",Ll="[object Symbol]",Fl="[object ArrayBuffer]",Rl="[object DataView]",El="[object Float32Array]",xl="[object Float64Array]",Dl="[object Int8Array]",jl="[object Int16Array]",$l="[object Int32Array]",Tl="[object Uint8Array]",Ml="[object Uint8ClampedArray]",Nl="[object Uint16Array]",Al="[object Uint32Array]";function _l(e,t,o){var i=e.constructor;switch(t){case Fl:return al(e);case wl:case bl:return new i(+e);case Rl:return ll(e,o);case El:case xl:case Dl:case jl:case $l:case Tl:case Ml:case Nl:case Al:return yl(e,o);case kl:return new i;case Il:case Cl:return new i(e);case Pl:return hl(e);case Sl:return new i;case Ll:return gl(e)}}var Ol=_l,Wl=Object.create,Ul=function(){function e(){}return function(t){if(!(0,pr.A)(t))return{};if(Wl)return Wl(t);e.prototype=t;var o=new e;return e.prototype=void 0,o}}(),zl=Ul;function Vl(e){return"function"!=typeof e.constructor||(0,mr.A)(e)?{}:zl(zr(e))}var Bl=Vl,Xl=o(2049),Hl=o(9912),Kl=o(3098),Gl="[object Map]";function Ql(e){return(0,Kl.A)(e)&&(0,Zr.A)(e)==Gl}var ql=Ql,Jl=o(2789),Yl=o(4841),Zl=Yl.A&&Yl.A.isMap,ed=Zl?(0,Jl.A)(Zl):ql,td=ed,od="[object Set]";function id(e){return(0,Kl.A)(e)&&(0,Zr.A)(e)==od}var sd=id,nd=Yl.A&&Yl.A.isSet,ad=nd?(0,Jl.A)(nd):sd,rd=ad,ld=1,dd=2,cd=4,hd="[object Arguments]",ud="[object Array]",pd="[object Boolean]",md="[object Date]",fd="[object Error]",gd="[object Function]",vd="[object GeneratorFunction]",yd="[object Map]",wd="[object Number]",bd="[object Object]",kd="[object RegExp]",Id="[object Set]",Pd="[object String]",Sd="[object Symbol]",Cd="[object WeakMap]",Ld="[object ArrayBuffer]",Fd="[object DataView]",Rd="[object Float32Array]",Ed="[object Float64Array]",xd="[object Int8Array]",Dd="[object Int16Array]",jd="[object Int32Array]",$d="[object Uint8Array]",Td="[object Uint8ClampedArray]",Md="[object Uint16Array]",Nd="[object Uint32Array]",Ad={};function _d(e,t,o,i,s,n){var a,r=t&ld,l=t&dd,d=t&cd;if(o&&(a=s?o(e,i,s,n):o(e)),void 0!==a)return a;if(!(0,pr.A)(e))return e;var c=(0,Xl.A)(e);if(c){if(a=il(e),!r)return Mr(e,a)}else{var h=(0,Zr.A)(e),u=h==gd||h==vd;if((0,Hl.A)(e))return $r(e,r);if(h==bd||h==hd||u&&!s){if(a=l||u?{}:Bl(e),!r)return l?Gr(e,Cr(a,e)):_r(e,hr(a,e))}else{if(!Ad[h])return s?e:{};a=Ol(e,h,r)}}n||(n=new or.A);var p=n.get(e);if(p)return p;n.set(e,a),rd(e)?e.forEach(function(i){a.add(_d(i,t,o,i,e,n))}):td(e)&&e.forEach(function(i,s){a.set(s,_d(i,t,o,s,e,n))});var m=d?l?Yr:Qr.A:l?Pr:dr.A,f=c?void 0:m(e);return sr(f||e,function(i,s){f&&(s=i,i=e[s]),(0,nr.A)(a,s,_d(i,t,o,s,e,n))}),a}Ad[hd]=Ad[ud]=Ad[Ld]=Ad[Fd]=Ad[pd]=Ad[md]=Ad[Rd]=Ad[Ed]=Ad[xd]=Ad[Dd]=Ad[jd]=Ad[yd]=Ad[wd]=Ad[bd]=Ad[kd]=Ad[Id]=Ad[Pd]=Ad[Sd]=Ad[$d]=Ad[Td]=Ad[Md]=Ad[Nd]=!0,Ad[fd]=Ad[gd]=Ad[Cd]=!1;var Od=_d,Wd=o(9045);function Ud(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}var zd=Ud,Vd=o(6318);function Bd(e,t,o){var i=-1,s=e.length;t<0&&(t=-t>s?0:s+t),o=o>s?s:o,o<0&&(o+=s),s=t>o?0:o-t>>>0,t>>>=0;var n=Array(s);while(++i<s)n[i]=e[i+t];return n}var Xd=Bd;function Hd(e,t){return t.length<2?e:(0,Vd.A)(e,Xd(t,0,-1))}var Kd=Hd,Gd=o(901);function Qd(e,t){return t=(0,Wd.A)(t,e),e=Kd(e,t),null==e||delete e[(0,Gd.A)(zd(t))]}var qd=Qd,Jd=o(8496),Yd="[object Object]",Zd=Function.prototype,ec=Object.prototype,tc=Zd.toString,oc=ec.hasOwnProperty,ic=tc.call(Object);function sc(e){if(!(0,Kl.A)(e)||(0,Jd.A)(e)!=Yd)return!1;var t=zr(e);if(null===t)return!0;var o=oc.call(t,"constructor")&&t.constructor;return"function"==typeof o&&o instanceof o&&tc.call(o)==ic}var nc=sc;function ac(e){return nc(e)?void 0:e}var rc=ac,lc=o(9752),dc=1,cc=2,hc=4,uc=(0,lc.A)(function(e,t){var o={};if(null==e)return o;var i=!1;t=(0,tr.A)(t,function(t){return t=(0,Wd.A)(t,e),i||(i=t.length>1),t}),lr(e,Yr(e),o),i&&(o=Od(o,dc|cc|hc,rc));var s=t.length;while(s--)qd(o,t[s]);return o}),pc=uc,mc=o(8548);const fc=Symbol("tabsRootContextKey");var gc=o(7786),vc=o(1254);const yc=(0,R.b_)({tabs:{type:(0,R.jq)(Array),default:()=>(0,vc.f)([])},tabRefs:{type:(0,R.jq)(Object),default:()=>(0,vc.f)({})}}),wc=e=>(0,n.ZH)(e);var bc=o(1651);const kc="ElTabBar",Ic=(0,i.pM)({name:kc}),Pc=(0,i.pM)({...Ic,props:yc,setup(e,{expose:t}){const o=e,s=(0,i.WQ)(fc);s||(0,bc.$)(kc,"<el-tabs><el-tab-bar /></el-tabs>");const a=(0,ie.DU)("tabs"),r=(0,C.KR)(),l=(0,C.KR)(),d=()=>{let e=0,t=0;const i=["top","bottom"].includes(s.props.tabPosition)?"width":"height",n="width"===i?"x":"y",a="x"===n?"left":"top";return o.tabs.every(s=>{if((0,Q.b0)(s.paneName))return!1;const n=o.tabRefs[s.paneName];if(!n)return!1;if(!s.active)return!0;e=n[`offset${wc(a)}`],t=n[`client${wc(i)}`];const r=window.getComputedStyle(n);return"width"===i&&(t-=Number.parseFloat(r.paddingLeft)+Number.parseFloat(r.paddingRight),e+=Number.parseFloat(r.paddingLeft)),!1}),{[i]:`${t}px`,transform:`translate${wc(n)}(${e}px)`}},c=()=>l.value=d(),h=[],u=()=>{h.forEach(e=>e.stop()),h.length=0,Object.values(o.tabRefs).forEach(e=>{h.push((0,gc.wYm)(e,c))})};(0,i.wB)(()=>o.tabs,async()=>{await(0,i.dY)(),c(),u()},{immediate:!0});const p=(0,gc.wYm)(r,()=>c());return(0,i.xo)(()=>{h.forEach(e=>e.stop()),h.length=0,p.stop()}),t({ref:r,update:c}),(e,t)=>((0,i.uX)(),(0,i.CE)("div",{ref_key:"barRef",ref:r,class:(0,n.C4)([(0,C.R1)(a).e("active-bar"),(0,C.R1)(a).is((0,C.R1)(s).props.tabPosition)]),style:(0,n.Tr)(l.value)},null,6))}});var Sc=(0,x.A)(Pc,[["__file","tab-bar.vue"]]),Cc=o(3344);const Lc=(0,R.b_)({panes:{type:(0,R.jq)(Array),default:()=>(0,vc.f)([])},currentName:{type:[String,Number],default:""},editable:Boolean,type:{type:String,values:["card","border-card",""],default:""},stretch:Boolean}),Fc={tabClick:(e,t,o)=>o instanceof Event,tabRemove:(e,t)=>t instanceof Event},Rc="ElTabNav",Ec=(0,i.pM)({name:Rc,props:Lc,emits:Fc,setup(e,{expose:t,emit:o}){const s=(0,i.WQ)(fc);s||(0,bc.$)(Rc,"<el-tabs><tab-nav /></el-tabs>");const n=(0,ie.DU)("tabs"),a=(0,gc.fho)(),r=(0,gc.esz)(),l=(0,C.KR)(),d=(0,C.KR)(),c=(0,C.KR)(),h=(0,C.KR)({}),u=(0,C.KR)(),p=(0,C.KR)(!1),m=(0,C.KR)(0),f=(0,C.KR)(!1),g=(0,C.KR)(!0),v=(0,C.IJ)(),y=(0,i.EW)(()=>["top","bottom"].includes(s.props.tabPosition)?"width":"height"),w=(0,i.EW)(()=>{const e="width"===y.value?"X":"Y";return{transform:`translate${e}(-${m.value}px)`}}),b=()=>{if(!l.value)return;const e=l.value[`offset${wc(y.value)}`],t=m.value;if(!t)return;const o=t>e?t-e:0;m.value=o},k=()=>{if(!l.value||!d.value)return;const e=d.value[`offset${wc(y.value)}`],t=l.value[`offset${wc(y.value)}`],o=m.value;if(e-o<=t)return;const i=e-o>2*t?o+t:e-t;m.value=i},I=async()=>{const t=d.value;if(!p.value||!c.value||!l.value||!t)return;await(0,i.dY)();const o=h.value[e.currentName];if(!o)return;const n=l.value,a=["top","bottom"].includes(s.props.tabPosition),r=o.getBoundingClientRect(),u=n.getBoundingClientRect(),f=a?t.offsetWidth-u.width:t.offsetHeight-u.height,g=m.value;let v=g;a?(r.left<u.left&&(v=g-(u.left-r.left)),r.right>u.right&&(v=g+r.right-u.right)):(r.top<u.top&&(v=g-(u.top-r.top)),r.bottom>u.bottom&&(v=g+(r.bottom-u.bottom))),v=Math.max(v,0),m.value=Math.min(v,f)},P=()=>{var t;if(!d.value||!l.value)return;e.stretch&&(null==(t=u.value)||t.update());const o=d.value[`offset${wc(y.value)}`],i=l.value[`offset${wc(y.value)}`],s=m.value;i<o?(p.value=p.value||{},p.value.prev=s,p.value.next=s+i<o,o-s<i&&(m.value=o-i)):(p.value=!1,s>0&&(m.value=0))},S=e=>{let t=0;switch(e.code){case Cc.R.left:case Cc.R.up:t=-1;break;case Cc.R.right:case Cc.R.down:t=1;break;default:return}const o=Array.from(e.currentTarget.querySelectorAll("[role=tab]:not(.is-disabled)")),i=o.indexOf(e.target);let s=i+t;s<0?s=o.length-1:s>=o.length&&(s=0),o[s].focus({preventScroll:!0}),o[s].click(),L()},L=()=>{g.value&&(f.value=!0)},F=()=>f.value=!1,R=(e,t)=>{h.value[t]=e},E=async()=>{await(0,i.dY)();const t=h.value[e.currentName];null==t||t.focus({preventScroll:!0})};return(0,i.wB)(a,e=>{"hidden"===e?g.value=!1:"visible"===e&&setTimeout(()=>g.value=!0,50)}),(0,i.wB)(r,e=>{e?setTimeout(()=>g.value=!0,50):g.value=!1}),(0,gc.wYm)(c,P),(0,i.sV)(()=>setTimeout(()=>I(),0)),(0,i.$u)(()=>P()),t({scrollToActiveTab:I,removeFocus:F,focusActiveTab:E,tabListRef:d,tabBarRef:u,scheduleRender:()=>(0,C.mu)(v)}),()=>{const t=p.value?[(0,i.bF)("span",{class:[n.e("nav-prev"),n.is("disabled",!p.value.prev)],onClick:b},[(0,i.bF)(M.tk,null,{default:()=>[(0,i.bF)(mc.nkM,null,null)]})]),(0,i.bF)("span",{class:[n.e("nav-next"),n.is("disabled",!p.value.next)],onClick:k},[(0,i.bF)(M.tk,null,{default:()=>[(0,i.bF)(mc.Qpb,null,null)]})])]:null,a=e.panes.map((t,a)=>{var r,l,d,c;const h=t.uid,u=t.props.disabled,p=null!=(l=null!=(r=t.props.name)?r:t.index)?l:`${a}`,m=!u&&(t.isClosable||e.editable);t.index=`${a}`;const g=m?(0,i.bF)(M.tk,{class:"is-icon-close",onClick:e=>o("tabRemove",t,e)},{default:()=>[(0,i.bF)(mc.bm,null,null)]}):null,v=(null==(c=(d=t.slots).label)?void 0:c.call(d))||t.props.label,y=!u&&t.active?0:-1;return(0,i.bF)("div",{ref:e=>R(e,p),class:[n.e("item"),n.is(s.props.tabPosition),n.is("active",t.active),n.is("disabled",u),n.is("closable",m),n.is("focus",f.value)],id:`tab-${p}`,key:`tab-${h}`,"aria-controls":`pane-${p}`,role:"tab","aria-selected":t.active,tabindex:y,onFocus:()=>L(),onBlur:()=>F(),onClick:e=>{F(),o("tabClick",t,p,e)},onKeydown:e=>{!m||e.code!==Cc.R.delete&&e.code!==Cc.R.backspace||o("tabRemove",t,e)}},[v,g])});return v.value,(0,i.bF)("div",{ref:c,class:[n.e("nav-wrap"),n.is("scrollable",!!p.value),n.is(s.props.tabPosition)]},[t,(0,i.bF)("div",{class:n.e("nav-scroll"),ref:l},[e.panes.length>0?(0,i.bF)("div",{class:[n.e("nav"),n.is(s.props.tabPosition),n.is("stretch",e.stretch&&["top","bottom"].includes(s.props.tabPosition))],ref:d,style:w.value,role:"tablist",onKeydown:S},[e.type?null:(0,i.bF)(Sc,{ref:u,tabs:[...e.panes],tabRefs:h.value},null),a]):null])])}}});var xc=o(1338);const Dc=(e,t,o)=>{const s=(0,xc.CW)(e.subTree).filter(e=>{var o;return(0,i.vv)(e)&&(null==(o=e.type)?void 0:o.name)===t&&!!e.component}),n=s.map(e=>e.component.uid);return n.map(e=>o[e]).filter(e=>!!e)},jc=(e,t)=>{const o=(0,C.IJ)({}),s=(0,C.IJ)([]),n=new WeakMap,a=e=>{o.value[e.uid]=e,(0,C.mu)(o),(0,i.sV)(()=>{const t=e.getVnode().el,i=t.parentNode;if(!n.has(i)){n.set(i,[]);const e=i.insertBefore.bind(i);i.insertBefore=(t,s)=>{const a=n.get(i).some(e=>t===e||s===e);return a&&(0,C.mu)(o),e(t,s)}}n.get(i).push(t)})},r=e=>{delete o.value[e.uid],(0,C.mu)(o);const t=e.getVnode().el,i=t.parentNode,s=n.get(i),a=s.indexOf(t);s.splice(a,1)},l=()=>{s.value=Dc(e,t,o.value)},d=e=>e.render(),c=(0,i.pM)({setup(e,{slots:t}){return()=>(l(),t.default?(0,i.h)(d,{render:t.default}):null)}});return{children:s,addChild:a,removeChild:r,ChildrenSorter:c}},$c=(0,R.b_)({type:{type:String,values:["card","border-card",""],default:""},closable:Boolean,addable:Boolean,modelValue:{type:[String,Number]},editable:Boolean,tabPosition:{type:String,values:["top","right","bottom","left"],default:"top"},beforeLeave:{type:(0,R.jq)(Function),default:()=>!0},stretch:Boolean}),Tc=e=>(0,n.Kg)(e)||(0,Q.Et)(e),Mc={[G.l4]:e=>Tc(e),tabClick:(e,t)=>t instanceof Event,tabChange:e=>Tc(e),edit:(e,t)=>["remove","add"].includes(t),tabRemove:e=>Tc(e),tabAdd:()=>!0},Nc=(0,i.pM)({name:"ElTabs",props:$c,emits:Mc,setup(e,{emit:t,slots:o,expose:s}){var n;const a=(0,ie.DU)("tabs"),r=(0,i.EW)(()=>["left","right"].includes(e.tabPosition)),{children:l,addChild:d,removeChild:c,ChildrenSorter:h}=jc((0,i.nI)(),"ElTabPane"),u=(0,C.KR)(),p=(0,C.KR)(null!=(n=e.modelValue)?n:"0"),m=async(o,i=!1)=>{var s,n,a,r;if(p.value!==o&&!(0,Q.b0)(o))try{let d;if(e.beforeLeave){const t=e.beforeLeave(o,p.value);d=t instanceof Promise?await t:t}else d=!0;if(!1!==d){const e=null==(s=l.value.find(e=>e.paneName===p.value))?void 0:s.isFocusInsidePane();p.value=o,i&&(t(G.l4,o),t("tabChange",o)),null==(a=null==(n=u.value)?void 0:n.removeFocus)||a.call(n),e&&(null==(r=u.value)||r.focusActiveTab())}}catch(d){}},f=(e,o,i)=>{e.props.disabled||(t("tabClick",e,i),m(o,!0))},g=(e,o)=>{e.props.disabled||(0,Q.b0)(e.props.name)||(o.stopPropagation(),t("edit",e.props.name,"remove"),t("tabRemove",e.props.name))},v=()=>{t("edit",void 0,"add"),t("tabAdd")},y=t=>{const o=t.el.firstChild,i=["bottom","right"].includes(e.tabPosition)?t.children[0].el:t.children[1].el;o!==i&&o.before(i)};return(0,i.wB)(()=>e.modelValue,e=>m(e)),(0,i.wB)(p,async()=>{var e;await(0,i.dY)(),null==(e=u.value)||e.scrollToActiveTab()}),(0,i.Gt)(fc,{props:e,currentName:p,registerPane:d,unregisterPane:c,nav$:u}),s({currentName:p,get tabNavRef(){return pc(u.value,["scheduleRender"])}}),()=>{const t=o["add-icon"],s=e.editable||e.addable?(0,i.bF)("div",{class:[a.e("new-tab"),r.value&&a.e("new-tab-vertical")],tabindex:"0",onClick:v,onKeydown:e=>{[Cc.R.enter,Cc.R.numpadEnter].includes(e.code)&&v()}},[t?(0,i.RG)(o,"add-icon"):(0,i.bF)(M.tk,{class:a.is("icon-plus")},{default:()=>[(0,i.bF)(mc.FWt,null,null)]})]):null,n=()=>(0,i.bF)(Ec,{ref:u,currentName:p.value,editable:e.editable,type:e.type,panes:l.value,stretch:e.stretch,onTabClick:f,onTabRemove:g},null),d=(0,i.bF)("div",{class:[a.e("header"),r.value&&a.e("header-vertical"),a.is(e.tabPosition)]},[(0,i.bF)(h,null,{default:n,$stable:!0}),s]),c=(0,i.bF)("div",{class:a.e("content")},[(0,i.RG)(o,"default")]);return(0,i.bF)("div",{class:[a.b(),a.m(e.tabPosition),{[a.m("card")]:"card"===e.type,[a.m("border-card")]:"border-card"===e.type}],onVnodeMounted:y,onVnodeUpdated:y},[c,d])}}});var Ac=Nc;const _c=(0,R.b_)({label:{type:String,default:""},name:{type:[String,Number]},closable:Boolean,disabled:Boolean,lazy:Boolean}),Oc="ElTabPane",Wc=(0,i.pM)({name:Oc}),Uc=(0,i.pM)({...Wc,props:_c,setup(e){const t=e,o=(0,i.nI)(),a=(0,i.Ht)(),r=(0,i.WQ)(fc);r||(0,bc.$)(Oc,"usage: <el-tabs><el-tab-pane /></el-tabs/>");const l=(0,ie.DU)("tab-pane"),d=(0,C.KR)(),c=(0,C.KR)(),h=(0,i.EW)(()=>t.closable||r.props.closable),u=(0,Y.uA)(()=>{var e;return r.currentName.value===(null!=(e=t.name)?e:c.value)}),p=(0,C.KR)(u.value),m=(0,i.EW)(()=>{var e;return null!=(e=t.name)?e:c.value}),f=(0,Y.uA)(()=>!t.lazy||p.value||u.value),g=()=>{var e;return null==(e=d.value)?void 0:e.contains(document.activeElement)};(0,i.wB)(u,e=>{e&&(p.value=!0)});const v=(0,C.Kh)({uid:o.uid,getVnode:()=>o.vnode,slots:a,props:t,paneName:m,active:u,index:c,isClosable:h,isFocusInsidePane:g});return r.registerPane(v),(0,i.xo)(()=>{r.unregisterPane(v)}),(0,i.Ic)(()=>{var e;a.label&&(null==(e=r.nav$.value)||e.scheduleRender())}),(e,t)=>(0,C.R1)(f)?(0,i.bo)(((0,i.uX)(),(0,i.CE)("div",{key:0,id:`pane-${(0,C.R1)(m)}`,ref_key:"paneRef",ref:d,class:(0,n.C4)((0,C.R1)(l).b()),role:"tabpanel","aria-hidden":!(0,C.R1)(u),"aria-labelledby":`tab-${(0,C.R1)(m)}`},[(0,i.RG)(e.$slots,"default")],10,["id","aria-hidden","aria-labelledby"])),[[s.aG,(0,C.R1)(u)]]):(0,i.Q3)("v-if",!0)}});var zc=(0,x.A)(Uc,[["__file","tab-pane.vue"]]);const Vc=(0,$.GU)(Ac,{TabPane:zc}),Bc=(0,$.WM)(zc),Xc={class:"noselected console-tabs"},Hc=["src"],Kc={class:"node-label"};function Gc(e,t,o,s,a,r){const l=Bc,d=Vc;return(0,i.uX)(),(0,i.CE)("div",Xc,[(0,i.bF)(d,{modelValue:r.pathSelected,"onUpdate:modelValue":t[0]||(t[0]=e=>r.pathSelected=e),type:"card",closable:"",onTabRemove:r.removeTab,onTabClick:r.selectTab},{default:(0,i.k6)(()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.consoleItems,e=>((0,i.uX)(),(0,i.Wv)(l,{key:e.path+"-|-"+e.id,label:e.name,name:e.path+"-|-"+e.id},{label:(0,i.k6)(()=>[(0,i.Lk)("img",{src:r.getIconUrl(e.path),alt:"",class:"node-icon"},null,8,Hc),(0,i.Lk)("span",Kc,(0,n.v_)(r.getItemPath(e)),1)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue","onTabRemove","onTabClick"])])}var Qc={data(){return{}},mounted(){},methods:{getItemPath(e){return this.ideInfo.consoleSelected.path!==e.path||this.ideInfo.consoleSelected.id!==e.id||"Terminal"===this.ideInfo.consoleSelected.name&&"Terminal"===this.ideInfo.consoleSelected.path?e.name:"/"+this.ideInfo.currProj.data.name+e.path},getIconUrl(e){return o(238)(`./${(0,Fe.ry)(e.substring(e.lastIndexOf(".")+1))}`)},getItem(e){if(!e)return;const t=e.split("-|-");t[1]=Number(t[1]);for(let o=0;o<this.ideInfo.consoleItems.length;o++)if(this.ideInfo.consoleItems[o].path===t[0]&&this.ideInfo.consoleItems[o].id===t[1])return this.ideInfo.consoleItems[o];return""},selectTab(e){},removeTab(e){const t=this.getItem(e);t&&this.$emit("close-item",t)}},watch:{},computed:{ideInfo(){return this.$store.state.ide.ideInfo},consoleItems(){return this.ideInfo.consoleItems},pathSelected:{get(){return this.ideInfo.consoleSelected.path+"-|-"+this.ideInfo.consoleSelected.id},set(e){const t=this.getItem(e);t&&this.$emit("select-item",t)}}},components:{}};const qc=(0,k.A)(Qc,[["render",Gc],["__scopeId","data-v-109efd1e"]]);var Jc=qc,Yc=o(6763);class Zc{constructor(){this.isActive=!1,this.lastActivity=Date.now(),this.renewalInProgress=!1,this.activityThreshold=3e4,this.renewalCheckInterval=6e4,this.renewalTimer=null,this.activityEvents=["keydown","keyup","keypress","mousedown","mouseup","mousemove","click","scroll","wheel","touchstart","touchmove","touchend"],this.init()}init(){this.hasValidSession()&&this.startTracking()}hasValidSession(){const e=localStorage.getItem("session_id"),t=localStorage.getItem("username");return!(!e||!t)}startTracking(){this.isActive=!0,this.setupActivityListeners(),this.startRenewalChecker(),Yc.log("🔄 [SessionManager] Started activity tracking and renewal system")}stopTracking(){this.isActive=!1,this.removeActivityListeners(),this.stopRenewalChecker(),Yc.log("🛑 [SessionManager] Stopped activity tracking")}setupActivityListeners(){this.activityHandler=this.onActivity.bind(this),this.activityEvents.forEach(e=>{document.addEventListener(e,this.activityHandler,!0)}),this.listenForIDEActivity()}removeActivityListeners(){this.activityEvents.forEach(e=>{document.removeEventListener(e,this.activityHandler,!0)})}listenForIDEActivity(){document.addEventListener("ide:file-save",this.activityHandler),document.addEventListener("ide:code-run",this.activityHandler),document.addEventListener("ide:file-open",this.activityHandler),document.addEventListener("ide:console-input",this.activityHandler)}onActivity(){this.isActive&&(this.lastActivity=Date.now(),!this.renewalInProgress&&this.shouldCheckRenewal()&&this.checkAndRenewSession())}shouldCheckRenewal(){const e=Date.now()-(this.lastRenewalAttempt||0);return e>this.activityThreshold}startRenewalChecker(){this.renewalTimer=setInterval(()=>{this.isActive&&this.hasRecentActivity()&&this.checkAndRenewSession()},this.renewalCheckInterval)}stopRenewalChecker(){this.renewalTimer&&(clearInterval(this.renewalTimer),this.renewalTimer=null)}hasRecentActivity(){const e=Date.now()-this.lastActivity;return e<this.activityThreshold}async checkAndRenewSession(){if(!this.renewalInProgress&&this.hasValidSession())try{this.renewalInProgress=!0,this.lastRenewalAttempt=Date.now();const e=localStorage.getItem("session_id");Yc.log("🔄 [SessionManager] Renewing session due to activity...");const t=await fetch("/api/renew-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:e})}),o=await t.json();o.success?(localStorage.setItem("session_expires_at",o.expires_at),Yc.log("✅ [SessionManager] Session renewed until:",new Date(o.expires_at).toLocaleString())):(Yc.warn("⚠️ [SessionManager] Session renewal failed:",o.error),this.handleRenewalFailure(o.error))}catch(bc){Yc.error("❌ [SessionManager] Session renewal error:",bc),this.handleRenewalFailure(bc.message)}finally{this.renewalInProgress=!1}}handleRenewalFailure(e){(e.includes("Invalid session")||e.includes("expired"))&&(Yc.log("🚪 [SessionManager] Session expired, will need re-authentication"),localStorage.removeItem("session_id"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("full_name"),localStorage.removeItem("session_expires_at"),this.stopTracking())}async renewSession(){return await this.checkAndRenewSession()}getSessionInfo(){if(!this.hasValidSession())return null;const e=localStorage.getItem("session_expires_at"),t=new Date,o=e?new Date(e):null;return{username:localStorage.getItem("username"),role:localStorage.getItem("role"),expiresAt:o,timeLeft:o?o-t:null,isNearExpiry:!!o&&o-t<72e5}}static emitIDEActivity(e,t={}){const o=new CustomEvent(`ide:${e}`,{detail:t});document.dispatchEvent(o)}}const eh=new Zc;var th=eh;"undefined"!==typeof window&&(window.sessionManager=eh);var oh=o(6763);const ih={data(){return{replMode:"auto",pyodideNamespace:null,pyodideInitialized:!1}},methods:{async startDualModeReplSession(){this.replSessionId=Date.now().toString(),oh.log("🚀 [REPL] Starting dual-mode REPL session:",this.replSessionId),oh.log("📊 [REPL] Current state:",{wsInfo:this.wsInfo,wsConnected:this.wsInfo?.connected,wsReadyState:this.wsInfo?.rws?.readyState,replMode:this.replMode,pyodideReady:this.pyodideReady,pyodideInitialized:this.pyodideInitialized}),this.ensureReplConsole();const e=this.wsInfo&&this.wsInfo.connected,t="backend"===this.replMode||"auto"===this.replMode&&e;oh.log("🔍 [REPL] Mode detection:",{backendAvailable:e,preferBackend:t,replMode:this.replMode}),t&&e?(oh.log("✅ [REPL] Using backend mode"),await this.startBackendRepl()):(oh.log("🌐 [REPL] Using Pyodide browser mode"),await this.startPyodideRepl())},async startBackendRepl(){oh.log("🔌 [REPL] Starting backend REPL...");try{const e={cmd:"start_python_repl",id:this.replSessionId,data:{projectName:this.ideInfo.currProj?.data?.name||"repl"}};if(oh.log("📤 [REPL] Sending start message:",e),oh.log("🔌 [REPL] WebSocket state:",{rws:this.wsInfo.rws,readyState:this.wsInfo.rws?.readyState,OPEN:WebSocket.OPEN}),!this.wsInfo.rws||this.wsInfo.rws.readyState!==WebSocket.OPEN)throw new Error(`WebSocket not connected: readyState=${this.wsInfo.rws?.readyState}`);this.wsInfo.rws.send(JSON.stringify(e)),oh.log("✅ [REPL] Start message sent successfully")}catch(bc){oh.error("❌ [REPL] Backend REPL failed:",bc),this.addReplOutput("Backend connection lost. Reconnecting...","system"),setTimeout(async()=>{this.wsInfo?.rws?.readyState===WebSocket.OPEN?(oh.log("🔄 [REPL] Retrying backend REPL after reconnection"),await this.startBackendRepl()):(oh.log("🌐 [REPL] Backend still unavailable, switching to browser mode"),this.addReplOutput("Backend unavailable, switching to browser mode...","error"),await this.startPyodideRepl())},2e3)}},async startPyodideRepl(){oh.log("🌐 [REPL] Starting Pyodide REPL, current state:",{pyodideReady:this.pyodideReady,pyodideInitialized:this.pyodideInitialized}),this.pyodideReady||(oh.log("🔄 [REPL] Pyodide not ready, initializing..."),await this.initializePyodideForRepl()),this.pyodideReady?oh.log("✅ [REPL] Pyodide ready for use"):(oh.log("❌ [REPL] Failed to initialize Pyodide"),this.addReplOutput("Failed to initialize browser Python","error"),this.isReplMode=!1)},async initializePyodideForRepl(){if(oh.log("🔄 [REPL] initializePyodideForRepl called, state:",{pyodideLoading:this.pyodideLoading,pyodideReady:this.pyodideReady,loadPyodideAvailable:typeof window.loadPyodide}),this.pyodideLoading||this.pyodideReady)oh.log("⚠️ [REPL] Pyodide already loading or ready, skipping");else{this.pyodideLoading=!0;try{if("function"!==typeof window.loadPyodide)throw new Error("Pyodide not available. Please check internet connection.");oh.log("📦 [REPL] Loading Pyodide from CDN..."),this.pyodide=await window.loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.24.1/full/"}),this.pyodideNamespace=this.pyodide.globals.get("dict")(),await this.pyodide.runPythonAsync("\n          import sys\n          import io\n          import builtins\n          \n          # Store the version\n          python_version = sys.version\n          \n          # Setup for REPL\n          _ = None\n        "),this.pyodideReady=!0,this.pyodideLoading=!1,this.pyodideInitialized=!0,oh.log("✅ [REPL] Pyodide REPL ready!",{pyodide:this.pyodide,namespace:this.pyodideNamespace})}catch(bc){oh.error("❌ [REPL] Pyodide initialization failed:",bc),this.pyodideLoading=!1,this.pyodideReady=!1,this.addReplOutput(`Error: ${bc.message}`,"error")}}},async executeReplCommandDualMode(e){if(oh.log("🎯 [REPL] executeReplCommandDualMode called with:",e),!e.trim())return oh.log("⚠️ [REPL] Empty command, handling continuation mode"),void(this.replContinuationMode&&(this.replContinuationMode=!1,this.replPrompt=">>> "));this.replHistory[this.replHistory.length-1]!==e&&this.replHistory.push(e),this.replHistoryIndex=-1,this.replInput="",this.replInputRows=1,this.ideInfo.consoleSelected&&this.ideInfo.consoleSelected.id&&this.$store.commit("ide/addConsoleOutput",{id:this.ideInfo.consoleSelected.id,type:"repl-input",text:e,prompt:this.replPrompt});const t=this.wsInfo?.connected&&this.replSessionId&&"pyodide"!==this.replMode;oh.log("🔍 [REPL] Execution mode check:",{wsConnected:this.wsInfo?.connected,replSessionId:this.replSessionId,replMode:this.replMode,useBackend:t,pyodideReady:this.pyodideReady}),t?(oh.log("📤 [REPL] Executing via backend"),await this.executeBackendCommand(e)):this.pyodideReady?(oh.log("🌐 [REPL] Executing via Pyodide"),await this.executePyodideCommand(e)):(oh.log("⚠️ [REPL] No environment ready, initializing Pyodide..."),await this.startPyodideRepl(),this.pyodideReady?await this.executePyodideCommand(e):this.addReplOutput("No Python environment available","error"))},async executeBackendCommand(e){oh.log("📤 [REPL] executeBackendCommand called with:",e);try{const t={cmd:"send_program_input",id:Date.now().toString(),data:{program_id:this.replSessionId,input:e}};if(oh.log("📨 [REPL] Sending command message:",t),!this.wsInfo.rws||this.wsInfo.rws.readyState!==WebSocket.OPEN)throw new Error(`WebSocket disconnected: readyState=${this.wsInfo.rws?.readyState}`);this.wsInfo.rws.send(JSON.stringify(t)),oh.log("✅ [REPL] Command sent to backend")}catch(bc){oh.error("❌ [REPL] Backend execution failed:",bc),this.addReplOutput("Backend connection lost. Please restart REPL if needed.","system"),oh.log("⚠️ [REPL] Keeping backend mode, user can manually restart if needed")}},async executePyodideCommand(e){if(this.pyodideReady&&this.pyodide){try{await this.pyodide.runPythonAsync("\n          import sys\n          from io import StringIO\n          _stdout = StringIO()\n          _stderr = StringIO()\n          _old_stdout = sys.stdout\n          _old_stderr = sys.stderr\n          sys.stdout = _stdout\n          sys.stderr = _stderr\n        ");let o=null,i=null;try{o=await this.pyodide.runPythonAsync(e,{globals:this.pyodideNamespace}),void 0!==o&&null!==o&&await this.pyodide.runPythonAsync("_ = _result",{globals:{...this.pyodideNamespace.toJs(),_result:o}})}catch(bc){i=bc}const s=await this.pyodide.runPythonAsync("\n          sys.stdout = _old_stdout\n          sys.stderr = _old_stderr\n          stdout_val = _stdout.getvalue()\n          stderr_val = _stderr.getvalue()\n          _stdout.close()\n          _stderr.close()\n          (stdout_val, stderr_val)\n        ");if(s[0]&&this.addReplOutput(s[0],"output"),s[1]&&this.addReplOutput(s[1],"error"),i)this.addReplOutput(String(i),"error");else if(void 0!==o&&null!==o){const e=this.pyodide.globals.get("None");if(o!==e)try{const e=await this.pyodide.runPythonAsync("repr(_last_val)",{globals:{...this.pyodideNamespace.toJs(),_last_val:o}});e&&"None"!==e&&this.addReplOutput(e,"output")}catch(t){const e=String(o);e&&"[object Object]"!==e&&this.addReplOutput(e,"output")}}this.replContinuationMode=!1,this.replPrompt=">>> "}catch(bc){oh.error("Pyodide execution error:",bc),this.addReplOutput(`Error: ${bc.message}`,"error")}this.$nextTick(()=>{this.$refs.consoleOutputArea&&(this.$refs.consoleOutputArea.scrollTop=this.$refs.consoleOutputArea.scrollHeight)})}else this.addReplOutput("Browser Python not ready","error")},handleBackendReplResponse(e){if(oh.log("📥 [REPL] Backend response received:",{code:e?.code,hasData:!!e?.data,dataKeys:e?.data?Object.keys(e.data):[],fullMessage:e}),e){if(0===e.code||"0"===e.code){if(e.data){if(e.data.stdout){const t=e.data.stdout,o=t.match(/^(>>>|\.\.\.)\s*$/)||t.match(/^(>>>|\.\.\.)\s*\n*$/)||">>>"===t.trim()||"..."===t.trim()||""===t.trim()||">>> "===t||"... "===t||t.match(/^\s*>>>\s*$/)||t.match(/^\s*\.\.\.\s*$/)||t.match(/^>>>\s*\n*$/)||t.match(/^\.\.\.\s*\n*$/);o||""===t.trim()||this.addReplOutput(t,"output")}e.data.stderr&&this.addReplOutput(e.data.stderr,"error")}}else 2e3===e.code?"repl_prompt"===e.data?.type?(this.replPrompt=">>> ",this.replContinuationMode=!1):e.data?.stdout&&this.addReplOutput(e.data.stdout,"output"):1111===e.code&&(this.addReplOutput("Backend session ended","system"),this.replSessionId=null,this.addReplOutput("Switching to browser mode...","system"),this.startPyodideRepl());this.$nextTick(()=>{this.$refs.consoleOutputArea&&(this.$refs.consoleOutputArea.scrollTop=this.$refs.consoleOutputArea.scrollHeight)})}else oh.log("⚠️ [REPL] Empty message received")},async stopDualModeReplSession(){if(this.replSessionId&&this.wsInfo?.rws?.readyState===WebSocket.OPEN){const e={cmd:"stop_python_program",id:Date.now().toString(),data:{program_id:this.replSessionId}};this.wsInfo.rws.send(JSON.stringify(e))}this.replSessionId=null,this.isReplMode=!1,this.replPrompt=">>> ",this.replContinuationMode=!1,this.pyodideNamespace&&(this.pyodideNamespace=this.pyodide?.globals.get("dict")())}}};var sh=ih,nh=o(6763);const ah=o(7975);var rh={data(){return{showDeleteDialog:!1,showFileDialog:!1,showProjsDialog:!1,showUploadDialog:!1,showNewFileDialog:!1,showNewFolderDialog:!1,showImportFileDialog:!1,showFileBrowserDialog:!1,showLoginModal:!1,fileBrowserMode:"open",fileToMove:null,showSettingsModal:!1,showKeyboardShortcutsModal:!1,showFindReplaceModal:!1,findReplaceMode:"find",showREPL:!1,isReplMode:!1,replSessionId:null,showCover:!0,showContextMenu:!1,contextMenuPosition:{x:0,y:0},contextMenuTarget:null,windowWidth:window.innerWidth,leftSidebarVisible:!0,dialogType:"",dialogTitle:"",dialogTips:"",dialogText:"",leftSidebarWidth:250,rightSidebarWidth:400,rightSidebarVisible:!1,consoleHeight:200,consoleExpanded:!0,consoleMaximized:!1,previousConsoleHeight:200,rightPanelExpanded:!1,previousRightWidth:400,rightPanelMode:"closed",consoleMode:"collapsed",consolePreviousMode:"normal",wasConsoleOpenBeforeRightExpand:!1,fileConsoleStates:{},activeFilePath:null,rightPanelState:"normal",rightPanelNormalWidth:400,previousConsoleState:{expanded:!0,height:200},editorHeight:"calc(100% - 235px)",minEditorWidth:500,isResizingLeft:!1,isResizingRight:!1,isResizingConsole:!1,startX:0,startY:0,startWidth:0,startHeight:0,resizeWarning:!1,programInput:"",programInputRows:1,wordWrap:!0,replInput:"",replHistory:[],replHistoryIndex:-1,replPrompt:">>> ",replInputRows:1,replContinuationMode:!1,previewTabs:[],selectedPreviewTab:null,previewTabCounter:0,terminalOutput:[],terminalSessionActive:!1,pyodide:null,pyodideLoading:!1,pyodideReady:!1,replMode:"auto",pyodideNamespace:null,pyodideInitialized:!1,wsMessageHandler:null}},mixins:[sh],components:{Splitpanes:da.S,Pane:da.Z,TwoHeaderMenu:sn,CodeTabs:wo.A,HybridConsole:er,ConsoleTabs:Jc,ProjTree:Do.A,IdeEditor:yo.A,LoginModal:P,PythonREPL:S.A,DialogProjs:fo.A,DialogText:mo.A,DialogDelete:po.A,DialogUpload:uo.A,DialogNewFile:ho,DialogNewFolder:_t,DialogImportFile:ft,DialogFileBrowser:De,CsvViewer:go.A,MediaViewer:vo.A,SettingsModal:ni.A,KeyboardShortcutsModal:si,FindReplaceModal:Yo,FullscreenPreview:xo,ChevronLeft:ca.A,ChevronRight:at.A,ChevronUp:Qo,ChevronDown:rt.A,Minimize2:ha},created(){},mounted(){this.throttledHandleResizeLeft=this.throttle(this.handleResizeLeft,16),this.throttledHandleResizeRight=this.throttle(this.handleResizeRight,16),this.throttledHandleResizeConsole=this.throttle(this.handleResizeConsole,16),this.initializeAutoSave();const e=localStorage.getItem("session_id"),t=localStorage.getItem("username");if(!e||!t)return nh.log("🔒 [VmIde] No session found, auto-opening login modal..."),void(this.showLoginModal=!0);nh.log("🔑 [VmIde] Found existing session for:",t),nh.log("🔄 [VmIde] Starting session manager for auto-renewal..."),th.startTracking();try{nh.log("🔌 [VmIde] Initializing WebSocket with authentication..."),this.wsInfo&&this.wsInfo.rws?nh.log("ℹ️ [VmIde] WebSocket already initialized"):(this.$store.dispatch("websocket/init",{}),nh.log("✅ [VmIde] WebSocket initialization dispatched"))}catch(bc){nh.error("❌ [VmIde] Error initializing WebSocket:",bc)}this.rightPanelMode="closed",this.consoleMode="collapsed",this.$nextTick(()=>{setTimeout(()=>{try{this.setupWebSocketHandler()}catch(bc){nh.error("Error in setupWebSocketHandler:",bc)}},500)}),this.loadLayoutPreferences(),window.addEventListener("resize",this.validateLayout);const o=this;if(e&&t){const e=setInterval(()=>{nh.log("⏱️ [VmIde] WebSocket check:",{connected:o.wsInfo.connected,wsInfo:o.wsInfo}),o.wsInfo.connected&&(nh.log("📡 [VmIde] WebSocket connected, listing projects..."),this.$store.dispatch(`ide/${ct.qB}`,{callback:t=>{nh.log("📋 [VmIde] Project list response:",t),clearInterval(e),0==t.code?(nh.log("✅ [VmIde] Projects found:",t.data),this.$store.commit("ide/handleProjects",t.data),o.loadAllDefaultProjects()):nh.error("❌ [VmIde] Failed to list projects:",t)}}))},1e3)}window.addEventListener("resize",this.resize),this.$nextTick(()=>{this.applyInitialEditorSettings()})},beforeUnmount(){window.removeEventListener("resize",this.validateLayout),window.removeEventListener("resize",this.resize),this.wsMessageHandler&&(this.wsMessageHandler=null),this.previewTabs.forEach(e=>{"pdf"===e.type&&e.content&&e.content.startsWith("blob:")&&URL.revokeObjectURL(e.content)})},computed:{wsInfo(){return this.$store.getters["websocket/wsInfo"]()},ideInfo(){return this.$store.state.ide.ideInfo},currentUser(){const e=this.$store.state.ide.currentUser;if(e)return e;const t=localStorage.getItem("session_id"),o=localStorage.getItem("username"),i=localStorage.getItem("role"),s=localStorage.getItem("full_name");return t&&o?{session_id:t,username:o,role:i,full_name:s}:null},isMarkdown(){return!!this.ideInfo.codeSelected.path&&this.ideInfo.codeSelected.path.endsWith(".md")},isMediaFile(){if(this.ideInfo.codeSelected.path){const e=[".png",".jpg",".jpeg",".gif",".bmp",".svg",".webp",".pdf"],t=this.ideInfo.codeSelected.path.toLowerCase();return e.some(e=>t.endsWith(e))}return!1},consoleLimit(){let e=0;for(let t=0;t<this.ideInfo.consoleItems.length;t++)!0!==this.ideInfo.consoleItems[t].run||"Terminal"===this.ideInfo.consoleItems[t].name&&"Terminal"===this.ideInfo.consoleItems[t].path||(e+=1);return e>=3},hasRunProgram(){return this.ideInfo.consoleItems.some(e=>e.run)},showConsole(){const e=0!==this.ideInfo.consoleItems.length;return e},leftSidebarSize(){if(this.windowWidth<=900)return 0;let e=20;if(this.windowWidth<=1400&&this.windowWidth>1200){const t=Math.min(250,.2*this.windowWidth);e=t/this.windowWidth*100}else this.windowWidth<=1200&&(e=180/this.windowWidth*100);return this.leftSidebarVisible?e:.1},leftSidebarMinSize(){return this.windowWidth<=900?0:.1},leftSidebarMaxSize(){return this.windowWidth<=900?0:this.windowWidth<=1400&&this.windowWidth>1200?30:40},rightSidebarSize(){if(this.windowWidth<=900)return 0;if(this.windowWidth<=1200)return 0;if(0===this.previewTabs.length)return 0;if("closed"===this.rightPanelMode)return 0;if("expanded"===this.rightPanelMode){const e=this.leftSidebarVisible?20:0;return 100-e-10}return 30},rightSidebarMinSize(){return this.windowWidth<=1200?0:.1},rightSidebarMaxSize(){return this.windowWidth<=900||this.windowWidth<=1200?0:50},centerSize(){if(this.windowWidth<=900)return 100;if(this.windowWidth<=1200){const e=this.leftSidebarVisible?this.windowWidth<=1200?180/this.windowWidth*100:20:0;return 100-e}const e=this.leftSidebarVisible?this.leftSidebarSize:0,t=this.rightSidebarSize;return 0===t?100-e:Math.max(30,100-e-t)},editorPaneSize(){return"maximized"===this.consoleMode?5:"collapsed"===this.consoleMode?95:70},consolePaneSize(){return"maximized"===this.consoleMode?95:"collapsed"===this.consoleMode?5:30}},watch:{"previewTabs.length":function(e,t){0===e&&t>0&&(this.rightPanelMode="closed",this.rightSidebarVisible=!1)},"ideInfo.codeSelected":function(e,t){e&&t&&e.path&&t.path&&e.path!==t.path?this.handleTabChange(e,t):e&&!t&&(this.activeFilePath=e.path,this.loadFileConsoleState(e.path))},"ideInfo.consoleSelected.waitingForInput":function(e){e&&this.$nextTick(()=>{this.$refs.programInputField&&this.$refs.programInputField.focus()})},consoleExpanded(e){e&&this.$nextTick(()=>{this.$refs.consoleOutputArea&&(this.$refs.consoleOutputArea.scrollTop=this.$refs.consoleOutputArea.scrollHeight)})}},methods:{throttle(e,t){let o=0,i=null;const s=this;return function(...n){const a=Date.now();a-o>=t?(e.apply(s,n),o=a):i||(i=requestAnimationFrame(()=>{e.apply(s,n),o=Date.now(),i=null}))}},toggleLeftSidebar(e){this.leftSidebarVisible=e},applyInitialEditorSettings(){const e=localStorage.getItem("fontSize");e&&this.updateFontSize(e);const t=localStorage.getItem("showLineNumbers");null!==t&&this.updateLineNumbers("true"===t)},updateFontSize(e){const t=parseInt(e)+"px",o=document.querySelectorAll(".CodeMirror");o.forEach(e=>{e.CodeMirror&&(e.style.fontSize=t,e.CodeMirror.refresh())});const i=document.getElementById("codemirror-font-size")||document.createElement("style");i.id="codemirror-font-size",i.innerHTML=`.CodeMirror { font-size: ${t} !important; } .CodeMirror pre { font-size: ${t} !important; }`,document.getElementById("codemirror-font-size")||document.head.appendChild(i),localStorage.setItem("fontSize",e),window.dispatchEvent(new CustomEvent("fontSizeChanged"))},updateLineNumbers(e){const t=document.querySelectorAll(".CodeMirror");t.forEach(t=>{t.CodeMirror&&t.CodeMirror.setOption("lineNumbers",e)}),localStorage.setItem("editorLineNumbers",e),this.$store.commit("ide/setEditorOption",{option:"lineNumbers",value:e})},updateWordWrap(e){this.wordWrap=e,this.$store.commit("ide/setEditorOption",{option:"lineWrapping",value:e})},updateAutoSave(e){this.$store.commit("ide/setAutoSave",e),e?this.startAutoSave():this.stopAutoSave()},updateAutoSaveInterval(e){this.$store.commit("ide/setAutoSaveInterval",e),this.$store.state.ide.ideInfo.autoSave&&(this.stopAutoSave(),this.startAutoSave())},updateAutoSaveNotifications(e){this.$store.commit("ide/setAutoSaveNotifications",e)},initializeAutoSave(){const e=localStorage.getItem("autoSave"),t=localStorage.getItem("autoSaveInterval"),o=localStorage.getItem("autoSaveNotifications");if(null!==e){const t="true"===e;this.$store.commit("ide/setAutoSave",t),t&&(nh.log("[AUTO-SAVE] Auto-save is enabled in settings, starting timer"),this.startAutoSave())}t&&this.$store.commit("ide/setAutoSaveInterval",parseInt(t)),null!==o&&this.$store.commit("ide/setAutoSaveNotifications","true"===o),nh.log("[AUTO-SAVE] Initialized auto-save settings:",{enabled:this.$store.state.ide.ideInfo.autoSave,interval:this.$store.state.ide.ideInfo.autoSaveInterval,notifications:this.$store.state.ide.ideInfo.autoSaveNotifications})},startAutoSave(){this.autoSaveTimer&&clearInterval(this.autoSaveTimer);const e=this.$store.state.ide.ideInfo.autoSaveInterval||60;nh.log(`[AUTO-SAVE] Starting auto-save timer with ${e}s interval`),this.autoSaveTimer=setInterval(()=>{this.saveAllFiles()},1e3*e)},stopAutoSave(){this.autoSaveTimer&&(clearInterval(this.autoSaveTimer),this.autoSaveTimer=null,nh.log("[AUTO-SAVE] Auto-save timer stopped"))},saveAllFiles(){const e=this.ideInfo.codeItems.filter(e=>e.content);if(0===e.length)return void nh.log("[AUTO-SAVE] No files to auto-save");nh.log(`[AUTO-SAVE] Auto-saving ${e.length} files`);let t=0;e.forEach(o=>{th.constructor.emitIDEActivity("file-save",{filename:o.fileName}),this.$store.dispatch("ide/saveFile",{codeItem:o,isAutoSave:!0}).then(()=>{t++,t===e.length&&this.$store.state.ide.ideInfo.autoSaveNotifications&&(0,ht.nk)({message:`Auto-saved ${t} file${t>1?"s":""}`,type:"info",duration:2e3,showClose:!1})}).catch(e=>{nh.error(`[AUTO-SAVE] Failed to auto-save ${o.path}:`,e)})})},toggleConsoleExpand(){this.consoleExpanded=!this.consoleExpanded,this.updateEditorHeight(),localStorage.setItem("console-expanded",this.consoleExpanded)},updateEditorHeight(){if(this.consoleExpanded){const e=window.innerHeight-300,t=Math.min(this.consoleHeight,e);this.editorHeight=`calc(100% - ${t+35}px)`}else this.editorHeight="calc(100% - 35px)"},clearConsole(){const e=this.ideInfo.consoleSelected;e&&e.resultList&&this.$store.commit("ide/clearConsoleOutput",e.id),this.programInput="",this.programInputRows=1},toggleWordWrap(){this.wordWrap=!this.wordWrap,localStorage.setItem("word-wrap",this.wordWrap)},openREPL(){this.toggleReplMode()},closeREPL(){this.showREPL=!1},async toggleReplMode(){this.isReplMode?(this.replSessionId&&await this.stopReplSession(),this.isReplMode=!1,this.replPrompt=">>> ",this.replInput="",this.replInputRows=1):(this.isReplMode=!0,this.clearConsole(),this.consoleExpanded||(this.consoleExpanded=!0),await this.startReplSession(),this.$nextTick(()=>{this.$refs.replInputField&&this.$refs.replInputField.focus()}))},async startReplSession(){this.ideInfo.consoleSelected&&this.addReplOutput("Type Python code and press Enter to execute","system"),await this.startDualModeReplSession()},async stopReplSession(){await this.stopDualModeReplSession()},getPythonVersion(){return"3.x"},setupWebSocketHandler(){try{if(!this.wsInfo||!this.wsInfo.rws)return nh.log("WebSocket not ready, retrying..."),void setTimeout(()=>this.setupWebSocketHandler(),500);const e=e=>{try{const t=JSON.parse(e.data);nh.log("📥 [VmIde] ALL WebSocket msg:",{id:t.id,cmd_id:t.cmd_id,code:t.code,cmd:t.cmd,programId:t.data?.program_id,ourSessionId:this.replSessionId,fullMsg:t});const o=t.id===this.replSessionId||t.cmd_id===this.replSessionId||t.data&&t.data.program_id===this.replSessionId||this.isReplMode&&this.replSessionId&&(0===t.code||2e3===t.code||1111===t.code)&&t.data&&(t.data.stdout||t.data.stderr||t.data.program_id);if(nh.log(`🔍 Match check: id=${t.id===this.replSessionId}, cmd_id=${t.cmd_id===this.replSessionId}, prog_id=${t.data?.program_id===this.replSessionId}, isReplMode=${this.isReplMode}, code=${t.code}`),o)return nh.log("🎯 REPL message matched - routing to REPL handler only!"),void this.handleReplResponse(t)}catch(t){}};this.$store.commit("websocket/addEventListener",{wsKey:"default",type:"message",listener:e}),this.wsMessageHandler=e,nh.log("WebSocket handler for REPL set up successfully")}catch(bc){nh.error("Error setting up WebSocket handler:",bc)}},handleReplMessage(e){nh.log("Handling REPL message:",e),this.handleReplResponse(e)},handleReplResponse(e){if(nh.log("🎯 [REPL] Processing REPL response:",e),nh.log("🎯 [REPL] Response code:",e?.code,"Data keys:",e?.data?Object.keys(e.data):"no data"),e){if(0===e.code||"0"===e.code){if(e.data){if(e.data.stdout){const t=e.data.stdout;nh.log("🔍 [REPL] Processing stdout:",JSON.stringify(t)),t.match(/^(>>>|\.\.\.)\s*$/)||""===t.trim()?""===t.trim()&&this.addReplOutput("","output"):this.addReplOutput(t,"output")}e.data.stderr&&this.addReplOutput(e.data.stderr,"error"),e.data.output&&this.addReplOutput(e.data.output,"output")}}else if(2e3===e.code)nh.log("Input request received:",e.data),e.data&&e.data.prompt&&this.addReplOutput(e.data.prompt,"output");else if(5e3===e.code)nh.log("Entering REPL mode after script execution"),this.isReplMode=!0;else if(1111===e.code||"python_ended"===e.cmd)this.addReplOutput("\nREPL session ended","system"),this.isReplMode=!1,this.replSessionId=null,this.replPrompt=">>> ";else if(-1===e.code||e.error){const t=e.error||e.data?.error||"Unknown error";this.addReplOutput("Error: "+t,"error")}this.$nextTick(()=>{this.$refs.consoleOutputArea&&(this.$refs.consoleOutputArea.scrollTop=this.$refs.consoleOutputArea.scrollHeight)})}},toggleRightSidebar(){(this.previewTabs.length>0||this.rightSidebarVisible)&&(this.rightSidebarVisible=!this.rightSidebarVisible,localStorage.setItem("right-sidebar-visible",this.rightSidebarVisible))},expandRightPanel(){if(!this.rightPanelExpanded){this.previousRightWidth=this.rightSidebarWidth;const e=window.innerWidth,t=this.leftSidebarVisible?this.leftSidebarWidth:0;this.rightSidebarWidth=e-t-10,this.rightPanelExpanded=!0,this.consoleExpanded&&(this.consoleExpanded=!1,this.consoleMaximized=!1,this.updateEditorHeight())}},collapseRightPanel(){this.rightPanelExpanded?(this.rightSidebarWidth=this.previousRightWidth,this.rightPanelExpanded=!1,this.previousConsoleHeight>0&&(this.consoleExpanded=!0,this.updateEditorHeight())):this.rightSidebarWidth=300},handleLeftArrowClick(){"normal"===this.rightPanelMode&&(this.wasConsoleOpenBeforeRightExpand="collapsed"!==this.consoleMode,this.consoleMode="collapsed",this.consoleExpanded=!1,this.consoleMaximized=!1,this.rightPanelMode="expanded",this.rightSidebarVisible=!0,this.saveLayoutPreferences())},handleRightArrowClick(){"expanded"===this.rightPanelMode?(this.rightPanelMode="normal",this.wasConsoleOpenBeforeRightExpand&&(this.consoleMode="normal",this.consoleExpanded=!0)):"normal"===this.rightPanelMode&&(this.rightPanelMode="closed",this.rightSidebarVisible=!1),this.saveLayoutPreferences()},expandRightPanelToFull(){"normal"===this.rightPanelState&&(this.rightPanelNormalWidth=this.rightSidebarWidth),this.previousConsoleState.expanded=this.consoleExpanded,this.previousConsoleState.height=this.consoleHeight,this.consoleExpanded=!1,this.consoleMaximized=!1;const e=window.innerWidth,t=this.leftSidebarVisible?this.leftSidebarWidth:0;this.rightSidebarWidth=e-t-10,this.rightPanelState="expanded",this.rightPanelExpanded=!0,this.rightSidebarVisible=!0,this.updateEditorHeight(),this.saveLayoutPreferences()},collapseRightPanelCompletely(){"normal"===this.rightPanelState&&(this.rightPanelNormalWidth=this.rightSidebarWidth),this.rightSidebarVisible=!1,this.rightPanelState="collapsed",this.rightPanelExpanded=!1,this.saveLayoutPreferences()},restoreRightPanelToNormal(){this.rightSidebarWidth=this.rightPanelNormalWidth||400,this.rightSidebarVisible=!0,this.rightPanelState="normal",this.rightPanelExpanded=!1,this.previousConsoleState.expanded&&(this.consoleExpanded=!0,this.consoleHeight=this.previousConsoleState.height||200),this.updateEditorHeight(),this.saveLayoutPreferences()},restoreRightPanel(){this.rightPanelMode="normal",this.rightSidebarVisible=!0,this.saveLayoutPreferences()},handleConsoleUpArrow(){"collapsed"===this.consoleMode?(this.consoleMode="normal",this.consoleExpanded=!0,this.consoleMaximized=!1,this.updateEditorHeight()):"normal"===this.consoleMode&&(this.consolePreviousMode="normal",this.consoleMode="maximized",this.consoleMaximized=!0,this.consoleExpanded=!0,this.updateEditorHeight())},handleConsoleDownArrow(){"normal"!==this.consoleMode&&"maximized"!==this.consoleMode||(this.consoleMode="collapsed",this.consoleExpanded=!1,this.consoleMaximized=!1,this.updateEditorHeight())},handleConsoleRestore(){"maximized"===this.consoleMode&&(this.consoleMode=this.consolePreviousMode||"normal",this.consoleMaximized=!1,this.consoleExpanded="normal"===this.consoleMode,this.updateEditorHeight())},handleTabChange(e,t){this.isReplMode&&this.replSessionId&&(nh.log("🔄 [VmIde] File switched - stopping REPL session"),this.stopReplSession()),t&&t.path&&this.activeFilePath&&this.saveFileConsoleState(this.activeFilePath),e&&e.path&&(this.activeFilePath=e.path,this.loadFileConsoleState(e.path))},saveFileConsoleState(e){if(!e||!e.endsWith(".py"))return;const t=this.ideInfo.consoleItems.find(t=>t.path===e);this.fileConsoleStates[e]={mode:this.consoleMode,expanded:this.consoleExpanded,maximized:this.consoleMaximized,consoleId:t?t.id:null,hasOutput:t&&t.resultList&&t.resultList.length>0}},loadFileConsoleState(e){if(!e||!e.endsWith(".py"))return this.consoleMode="collapsed",this.consoleExpanded=!1,void(this.consoleMaximized=!1);const t=this.fileConsoleStates[e];if(t){if(this.consoleMode=t.mode||"collapsed",this.consoleExpanded=t.expanded||!1,this.consoleMaximized=t.maximized||!1,t.consoleId&&this.ideInfo.consoleItems){const e=this.ideInfo.consoleItems.find(e=>e.id===t.consoleId);e&&this.$nextTick(()=>{this.$store.commit("ide/setConsoleSelected",e)})}}else this.consoleMode="collapsed",this.consoleExpanded=!1,this.consoleMaximized=!1;this.$nextTick(()=>{this.updateEditorHeight()})},getOrCreateFileConsole(e){if(!e||"string"!==typeof e)return nh.error("getOrCreateFileConsole: Invalid file path provided:",e),null;let t=this.ideInfo.consoleItems.find(t=>t.path===e);if(!t){const o=e.split("/").pop(),i={id:this.ideInfo.consoleId,path:e,name:o,run:!1,resultList:[],waitingForInput:!1,inputPrompt:""};this.$store.commit("ide/addConsoleItem",i),this.$store.commit("ide/setConsoleId",this.ideInfo.consoleId+1),t=this.ideInfo.consoleItems.find(e=>e.id===i.id)}return t},expandConsole(){this.consoleMaximized||(this.consoleMaximized=!0,this.consoleExpanded=!0)},restoreConsole(){this.consoleMaximized&&(this.consoleMaximized=!1,this.consoleExpanded=!0)},collapseConsole(){this.consoleExpanded=!1,this.consoleMaximized=!1},selectPreviewTab(e){this.selectedPreviewTab=e},closePreviewTab(e){const t=this.previewTabs.findIndex(t=>t.id===e);if(t>-1){const o=this.previewTabs[t];"pdf"===o.type&&o.content&&o.content.startsWith("blob:")&&URL.revokeObjectURL(o.content),this.previewTabs.splice(t,1),this.selectedPreviewTab===e&&(this.selectedPreviewTab=this.previewTabs.length>0?this.previewTabs[0].id:null),0===this.previewTabs.length&&(this.rightSidebarVisible=!1,this.rightPanelMode="closed")}},addPreviewTab(e,t,o,i,s){nh.log("[addPreviewTab] Adding tab:",{type:e,title:t,filePath:i,projectName:s,hasContent:!!o});const n=this.previewTabs.find(e=>e.filePath===i&&e.projectName===s);if(n)this.selectedPreviewTab=n.id,n.content!==o&&("pdf"===n.type&&n.content&&n.content.startsWith("blob:")&&URL.revokeObjectURL(n.content),n.content=o);else{const n=`${e}-${++this.previewTabCounter}`;this.previewTabs.push({id:n,type:e,title:t,content:o,filePath:i,projectName:s}),this.selectedPreviewTab=n}"closed"!==this.rightPanelMode&&this.rightSidebarVisible||(this.rightPanelMode="normal",this.rightSidebarVisible=!0,this.$nextTick(()=>{this.rightSidebarVisible||(this.rightSidebarVisible=!0)}))},getTabIcon(e){const t={output:"📄",image:"🖼️",pdf:"📑",data:"📊"};return t[e]||"📄"},handleThemeChange(e){nh.log("Theme changed to:",e)},downloadFile(e){if(!e||!e.fileName)return nh.error("[downloadFile] Invalid fileInfo:",e),void ht.nk.error("Cannot download: invalid file information");const t=[".png",".jpg",".jpeg",".gif",".bmp",".svg",".pdf",".zip",".tar",".gz"],o=t.some(t=>e.fileName.toLowerCase().endsWith(t));this.$store.dispatch(`ide/${ct.Jh}`,{projectName:e.projectName,filePath:e.filePath,binary:o,callback:t=>{if(nh.log("[downloadFile] Response:",{code:t.code,hasData:!!t.data,dataKeys:t.data?Object.keys(t.data):[]}),0==t.code){let s,n=t.data?.content||t.data;if(o)try{if("object"===typeof n&&n.content&&(n=n.content),"string"!==typeof n)throw new Error("Binary content is not a string");n.includes(",")&&(n=n.split(",")[1]);const e=atob(n),t=new Uint8Array(e.length);for(let o=0;o<e.length;o++)t[o]=e.charCodeAt(o);s=new Blob([t],{type:"application/octet-stream"})}catch(i){return nh.error("[downloadFile] Error decoding binary data:",i),void ht.nk.error("Failed to decode file data: "+i.message)}else s=new Blob([n],{type:"text/plain"});const a=window.URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=e.fileName,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a),(0,ht.nk)({type:"success",message:`Downloaded ${e.fileName}`,duration:2e3})}else(0,ht.nk)({type:"error",message:`Failed to download ${e.fileName}`,duration:3e3})}})},handleFileCreated(e){nh.log("[handleFileCreated] File created:",e),e&&e.path&&e.projectName&&this.getFile(e.path,!0,e.projectName),this.refreshProjectTree()},handleFolderCreated(e){nh.log("[handleFolderCreated] Folder created:",e),this.refreshProjectTree()},handleFilesImported(e){nh.log("[handleFilesImported] Files imported:",e),this.refreshProjectTree()},refreshProjectTree(){this.refreshProjectTreeWithCallback(null)},refreshProjectTreeWithCallback(e){const t=this;if(t.ideInfo.multiRootData&&t.ideInfo.multiRootData.children.length>0){nh.log("[VmIde] Refreshing multi-root project tree");let o=0;const i=t.ideInfo.multiRootData.children.length;t.ideInfo.multiRootData.children.forEach(s=>{t.$store.dispatch(`ide/${ct.QQ}`,{projectName:s.name,callback:n=>{0==n.code?(t.$store.commit("ide/handleProject",n.data),o++,o===i&&(nh.log("[VmIde] All projects refreshed"),e&&e())):(nh.error("[VmIde] Failed to refresh project:",s.name,n),o++,o===i&&e&&e())}})})}else this.ideInfo.currProj&&this.ideInfo.currProj.data?(nh.log("[VmIde] Refreshing single project tree"),this.$store.dispatch(`ide/${ct.QQ}`,{projectName:this.ideInfo.currProj.data.name,callback:o=>{0==o.code?(t.$store.commit("ide/handleProject",o.data),nh.log("[VmIde] Single project refreshed successfully")):nh.error("[VmIde] Failed to refresh project:",o),e&&e()}})):(nh.warn("[VmIde] No project to refresh"),e&&e())},inputIsLegal(e,t){this.dialogText=e;let o=this.checkStrIsLegal(this.dialogText,"create-file"===this.dialogType||"rename-file"===this.dialogType);return o&&("create-project"===this.dialogType||"rename-project"===this.dialogType?o=!this.isProjExist(this.dialogText):"create-file"!==this.dialogType&&"rename-file"!==this.dialogType&&"create-folder"!==this.dialogType&&"rename-folder"!==this.dialogType||(o=!this.isFileExist(this.dialogText,"create-file"===this.dialogType||"create-folder"===this.dialogType))),t(o),o},isProjExist(e){const t=this.ideInfo.projList.some(t=>t.name===e);return t&&(this.dialogTips="Project name already exists"),t},isSelectedFile(e){return this.ideInfo.codeSelected&&this.ideInfo.codeSelected.path===e.path&&this.ideInfo.codeSelected.projectName===e.projectName},getParentData(e){if(this.ideInfo.treeRef&&this.ideInfo.treeRef.currentNode&&this.ideInfo.treeRef.currentNode.parent)return this.ideInfo.treeRef.currentNode.parent.data;if(this.ideInfo.multiRootData&&this.ideInfo.multiRootData.children)for(let t of this.ideInfo.multiRootData.children){const o=this.findParentInTree(t,e);if(o)return o}return this.ideInfo.currProj&&this.ideInfo.currProj.data?this.findParentInTree(this.ideInfo.currProj.data,e):null},findParentInTree(e,t){if(!e||!e.children)return null;for(let o of e.children)if(o.path===t)return e;for(let o of e.children)if(t.startsWith(o.path+"/")||o.path===t){const e=this.findParentInTree(o,t);if(e)return e}return null},isFileExist(e,t){let o=!1;if(!this.ideInfo.nodeSelected)return!1;if(t)o=this.ideInfo.nodeSelected.children&&this.ideInfo.nodeSelected.children.some(t=>t.name===e);else{const t=this.getParentData(this.ideInfo.nodeSelected.path);t&&t.children&&(o=t.children.some(t=>t.name===e))}return o&&(this.dialogTips="File with the same name already exists"),o},checkStrIsLegal(e,t){this.dialogTips="";let o=t&&-1!==e.lastIndexOf(".")?e.substring(0,e.lastIndexOf(".")):e;if(!o)return this.dialogTips="Name cannot be empty",!1;if(o.length>15)return this.dialogTips="Name length cannot exceed 15 characters",!1;if(t&&e.endsWith("."))return this.dialogTips="Name can only contain letters, numbers and underscore _",!1;const i=/^[a-zA-Z0-9_]+$/.test(o);return i||(this.dialogTips="Name can only contain letters, numbers and underscore _"),i},listProjects(e){const t=this;this.$store.dispatch(`ide/${ct.qB}`,{callback:o=>{0==o.code&&(t.$store.commit("ide/handleProjects",o.data),e&&t.getProject(e))}})},loadAllDefaultProjects(){nh.log("🚀 [loadAllDefaultProjects] Starting to load default projects");const e=this,t=localStorage.getItem("username"),o=localStorage.getItem("role"),i=[];if("professor"===o){const e=["Local","Lecture Notes"];e.forEach(e=>{this.ideInfo.projList.some(t=>t.name===e)&&i.push(e)})}else{const e=this.ideInfo.projList.find(e=>e.name===`Local/${t}`);e&&i.push(e.name);const o=["Lecture Notes"];o.forEach(e=>{this.ideInfo.projList.some(t=>t.name===e)&&i.push(e)})}if(nh.log("📋 [loadAllDefaultProjects] Projects to load:",i),nh.log("📋 [loadAllDefaultProjects] Available projects:",this.ideInfo.projList),0===i.length)return void nh.warn("⚠️ [loadAllDefaultProjects] No projects to load");const s=[];let n=0;i.forEach(a=>{nh.log(`🔍 [loadAllDefaultProjects] Loading project: ${a}`),this.$store.dispatch(`ide/${ct.QQ}`,{projectName:a,callback:r=>{if(nh.log(`📥 [loadAllDefaultProjects] Response for ${a}:`,r),0==r.code){if(s.push(r.data),n++,n===i.length)if(nh.log("✅ [loadAllDefaultProjects] All projects loaded:",s),e.$store.commit("ide/handleMultipleProjects",s),"professor"===o){const t=s.find(e=>"Local"===e.name);t?e.$store.commit("ide/handleProject",t):s.length>0&&e.$store.commit("ide/handleProject",s[0])}else{const o=s.find(e=>e.name===`Local/${t}`);o?e.$store.commit("ide/handleProject",o):s.length>0&&e.$store.commit("ide/handleProject",s[0])}}else nh.error(`❌ [loadAllDefaultProjects] Failed to load ${a}:`,r),n++}})})},getProject(e){const t=this;this.$store.dispatch(`ide/${ct.QQ}`,{projectName:void 0===e?this.ideInfo.currProj.config.name:e,callback:e=>{if(0==e.code){t.$store.commit("ide/handleProject",e.data);for(var o=0;o<t.ideInfo.currProj.config.openList.length;o++)t.getFile(t.ideInfo.currProj.config.openList[o],!1,t.ideInfo.currProj.data.name)}}})},getFile(e,t,o,i=!1){const s=this;nh.log("[getFile] Called with:",{path:e,save:t,projectName:o,openInPanel:i});const n=o||this.ideInfo.nodeSelected&&this.ideInfo.nodeSelected.projectName||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name,a=[".png",".jpg",".jpeg",".gif",".bmp",".svg",".webp",".pdf"],r=[".csv"],l=a.some(t=>e.toLowerCase().endsWith(t)),d=r.some(t=>e.toLowerCase().endsWith(t));if(!l&&!d||i)if(l){const o=e.split("/").pop(),i=e.toLowerCase().split(".").pop(),a="pdf"===i?"pdf":"image";nh.log("[getFile] Adding media file tab:",{originalPath:e,fileName:o,fileExt:i,actualProjectName:n}),s.addPreviewTab(a,o,null,e,n),!1!==t&&s.$store.dispatch(`ide/${ct.xv}`,{})}else if(d){const o=e.split("/").pop();this.$store.dispatch(`ide/${ct.Jh}`,{projectName:n,filePath:e,callback:i=>{if(0===i.code&&i.data){const a=i.data.content||i.data;s.addPreviewTab("data",o,a,e,n),!1!==t&&s.$store.dispatch(`ide/${ct.xv}`,{})}else nh.error("Failed to get CSV file:",e,i),(0,ht.nk)({type:"error",message:`Failed to load ${o}`,duration:3e3})}})}else{this.ideInfo.fullscreenPreview&&this.ideInfo.fullscreenPreview.active&&this.$store.commit("ide/closeFullscreenPreview");let o=e;n&&e.startsWith(n+"/")&&(o=e.substring(n.length+1)),nh.log("[getFile] Getting file with relative path:",{originalPath:e,projectName:n,relativePath:o}),this.$store.dispatch(`ide/${ct.Jh}`,{projectName:n,filePath:o,callback:o=>{0==o.code?(s.$store.commit("ide/handleGetFile",{filePath:e,data:o.data,save:t,isMedia:!1,projectName:s.ideInfo.currProj?.data?.name}),!1!==t&&s.$store.dispatch(`ide/${ct.xv}`,{})):nh.error("Failed to get file:",e,o)}})}else this.openFullscreenPreview(e,n)},getFileForRightPanel(e,t){this.getFile(e,!1,t,!0)},getMediaCodeItem(e){const t=e.projectName||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name;return nh.log("[getMediaCodeItem] Creating media code item:",{tabTitle:e.title,tabFilePath:e.filePath,tabProjectName:e.projectName,actualProjectName:t,hasContent:!!e.content,contentType:e.content?e.content.startsWith("data:")?"data-url":e.content.startsWith("blob:")?"blob-url":"other":"none"}),e.content&&e.content.startsWith("data:")||e.content&&e.content.startsWith("blob:")?{name:e.title,path:e.filePath,projectName:t,content:e.content,preloaded:!0}:{name:e.title,path:e.filePath,projectName:t,preloaded:!1}},openFullscreenPreview(e,t){const o=this,i=e.split("/").pop(),s=e.toLowerCase().split(".").pop(),n=[".png",".jpg",".jpeg",".gif",".bmp",".svg",".webp",".pdf"],a=[".csv"],r=n.some(t=>e.toLowerCase().endsWith(t)),l=a.some(t=>e.toLowerCase().endsWith(t));r?this.$store.dispatch(`ide/${ct.Jh}`,{projectName:t,filePath:e,binary:!0,callback:n=>{if(0===n.code&&n.data){let a=n.data.content||n.data;if(a&&a.length>0){const n={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",bmp:"image/bmp",svg:"image/svg+xml",webp:"image/webp",pdf:"application/pdf"},r=n[s]||"application/octet-stream",l=`data:${r};base64,${a}`,d={name:i,path:e,projectName:t,content:l,type:"pdf"===s?"pdf":"image"};o.$store.commit("ide/setFullscreenPreview",{file:d,content:l})}else o.$message.error(`Failed to load ${i}: No content received`)}else o.$message.error(`Failed to load ${i}`)}}):l&&this.$store.dispatch(`ide/${ct.Jh}`,{projectName:t,filePath:e,callback:s=>{if(0===s.code&&s.data){const n=s.data.content||s.data,a={name:i,path:e,projectName:t,content:n,type:"csv"};o.$store.commit("ide/setFullscreenPreview",{file:a,content:n})}else o.$message.error(`Failed to load ${i}`)}})},setTextDialog(e){"create-file"!==e.type||"New File"!==e.title?(this.dialogType=e.type,this.dialogTitle=e.title,this.dialogText=e.text,this.dialogTips=e.tips,this.showFileDialog=!0,this.showProjsDialog=!1):this.showNewFileDialog=!0},handleRenameItem(e){nh.log("[handleRenameItem] Received rename request:",e);const{oldPath:t,newName:o,type:i,projectName:s}=e,n=s||this.ideInfo.currProj?.config?.name||this.ideInfo.currProj?.data?.name;nh.log("[handleRenameItem] Using project:",n),nh.log("[handleRenameItem] Data projectName:",s),nh.log("[handleRenameItem] Current project:",this.ideInfo.currProj?.data?.name),nh.log("[handleRenameItem] Renaming:",{oldPath:t,newName:o,type:i,actualProjectName:n}),"file"===i?this.renameFile(o,t,n):"dir"!==i&&"folder"!==i||this.renameFolder(o,t,n)},handleDeleteItem(e){const{path:t,type:o,projectName:i}=e;nh.log("[handleDeleteItem] Deleting:",o,"at path:",t,"in project:",i),"file"===o?this.deleteFile(t,i):"dir"!==o&&"folder"!==o||this.deleteFolder(t,i)},handleDownloadItem(e){if(nh.log("[handleDownloadItem] Download request:",e),!e||!e.path)return nh.error("[handleDownloadItem] Invalid data:",e),void ht.nk.error("Cannot download: no file selected");const t=e.path.split("/").pop()||e.label||e.name||"download",o={fileName:t,filePath:e.path,projectName:e.projectName||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name};nh.log("[handleDownloadItem] Downloading:",o),this.downloadFile(o)},openFileBrowser(){this.fileBrowserMode="open",this.fileToMove=null,this.showFileBrowserDialog=!0},handleSignIn(){nh.log("handleSignIn called");const e=localStorage.getItem("session_id"),t=localStorage.getItem("username");e&&t?ao.s.confirm(`You are already logged in as ${t}. Do you want to sign out and login with a different account?`,"Already Logged In",{confirmButtonText:"Sign Out",cancelButtonText:"Cancel",type:"info"}).then(()=>{localStorage.removeItem("session_id"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("full_name"),window.location.reload()}).catch(()=>{}):(nh.log("Setting showLoginModal to true"),this.showLoginModal=!0,nh.log("showLoginModal is now:",this.showLoginModal),this.$nextTick(()=>{nh.log("After nextTick, showLoginModal:",this.showLoginModal),nh.log("Login modal element:",document.querySelector(".login-modal-overlay"))}))},handleLoginSuccess(e){nh.log("Login success received:",e),e?(nh.log("🔄 [VmIde] Starting session manager after login..."),th.startTracking(),ht.nk.success(`Welcome, ${e.full_name||e.username}!`),setTimeout(()=>{window.location.reload()},500)):nh.error("No user data received in handleLoginSuccess")},reconnectWebSocket(){this.wsInfo&&this.wsInfo.rws&&this.wsInfo.rws.close(),setTimeout(()=>{this.$store.dispatch("websocket/init")},500)},handleNewFileFromTree(){const e=this.ideInfo.nodeSelected;if(!e||"dir"!==e.type&&"folder"!==e.type){const e=this.ideInfo.currProj?.data;e&&this.$store.commit("ide/setNodeSelected",e)}this.setTextDialog({type:"create-file",title:"New File",tips:"Enter file name:",text:"untitled.py"})},handleNewFolderFromTree(){const e=this.ideInfo.nodeSelected;if(!e||"dir"!==e.type&&"folder"!==e.type){const e=this.ideInfo.currProj?.data;e&&this.$store.commit("ide/setNodeSelected",e)}this.showNewFolderDialog=!0},handleImportFileFromTree(){const e=this.ideInfo.nodeSelected;if(!e||"dir"!==e.type&&"folder"!==e.type){const e=this.ideInfo.currProj?.data;e&&this.$store.commit("ide/setNodeSelected",e)}this.showImportFileDialog=!0},handleUndo(){const e=this.getActiveCodeMirrorInstance();e?e.undo():document.execCommand("undo")},handleRedo(){const e=this.getActiveCodeMirrorInstance();e?e.redo():document.execCommand("redo")},handleCut(){const e=this.getActiveCodeMirrorInstance();if(e&&e.somethingSelected()){const t=e.getSelection();navigator.clipboard.writeText(t),e.replaceSelection("")}else document.execCommand("cut")},handleCopy(){const e=this.getActiveCodeMirrorInstance();if(e&&e.somethingSelected()){const t=e.getSelection();navigator.clipboard.writeText(t)}else document.execCommand("copy")},handlePaste(){const e=this.getActiveCodeMirrorInstance();e?navigator.clipboard.readText().then(t=>{e.replaceSelection(t)}).catch(()=>{document.execCommand("paste")}):document.execCommand("paste")},handleFind(){this.findReplaceMode="find",this.showFindReplaceModal=!0},handleReplace(){this.findReplaceMode="replace",this.showFindReplaceModal=!0},handleComment(){const e=this.getActiveCodeMirrorInstance();if(e)try{const t=e.getCursor(),o=e.getLine(t.line);let i=t.ch;if(o.trim().startsWith("# ")){const s=o.replace(/^(\s*)# /,"$1");e.replaceRange(s,{line:t.line,ch:0},{line:t.line,ch:o.length}),i=Math.max(0,t.ch-2)}else if(o.trim().startsWith("#")){const s=o.replace(/^(\s*)#/,"$1");e.replaceRange(s,{line:t.line,ch:0},{line:t.line,ch:o.length}),i=Math.max(0,t.ch-1)}else if(""!==o.trim()){const s=o.match(/^(\s*)(.*)/),n=s[1]||"",a=s[2]||"",r=n+"# "+a;e.replaceRange(r,{line:t.line,ch:0},{line:t.line,ch:o.length}),i=t.ch+2}e.setCursor(t.line,i),e.focus(),e.refresh();const s=e.getValue();void 0!==this.ideInfo.codeSelectedIndex&&this.$store.commit("ide/setCodeItemContent",{index:this.ideInfo.codeSelectedIndex,content:s}),setTimeout(()=>{e.refresh()},10)}catch(bc){nh.error("Comment toggle error:",bc)}},getActiveCodeMirrorInstance(){const e=document.querySelector(".editor-content .code-editor-flex .CodeMirror");if(e&&e.CodeMirror)return e.CodeMirror;const t=document.querySelectorAll(".code-editor-container");for(let i=0;i<t.length;i++){const e=t[i];if(null!==e.offsetParent){const t=e.querySelector(".CodeMirror");if(t&&t.CodeMirror)return t.CodeMirror}}const o=document.querySelectorAll(".CodeMirror");for(let i=0;i<o.length;i++){const e=o[i];if(e.CodeMirror&&null!==e.offsetParent)return e.CodeMirror}return null},toggleConsole(e){e?(this.consoleMode="normal",this.consolePaneSize=30,this.ideInfo.consoleSelected&&this.ideInfo.consoleSelected.id||this.startEmptyRepl()):(this.consoleMode="collapsed",this.consolePaneSize=5)},startEmptyRepl(){const e={id:"empty-repl-"+Date.now(),name:"Python REPL",path:"REPL",resultList:[],run:!1,stop:!1,waitingForInput:!1,inputPrompt:""};this.$store.commit("ide/pushConsoleItem",e),this.$store.commit("ide/selectConsoleItem",e.id),this.sendMessage({cmd:"start_python_repl",cmd_id:e.id,data:{projectName:this.ideInfo.currProj?.data?.name||"Local"}}),this.$store.commit("ide/updateConsoleItem",{id:e.id,run:!0})},togglePreviewPanel(e){e&&0===this.previewTabs.length?this.$message.info("No files to preview. Open an image, PDF, or CSV file."):this.rightPanelMode=e?"normal":"closed"},handleOpenFile(e){this.getFile(e),this.showFileBrowserDialog=!1},async duplicateFile(e){const{originalPath:t,newName:o,projectName:i}=e,s=this;nh.log("🔍 [DEBUG] duplicateFile called with:",{originalPath:t,newName:o,projectName:i});const n=t.lastIndexOf("/"),a=n>0?t.substring(0,n):"/",r=await this.generateUniqueFileName(o,a,i),l=a+"/"+r;nh.log("🔍 [DEBUG] Generated unique filename:",r),nh.log("🔍 [DEBUG] New file path will be:",l),this.$store.dispatch(`ide/${ct.Jh}`,{projectName:i,filePath:t,callback:e=>{if(0==e.code){const t=e.data.content||e.data;nh.log("🔍 [DEBUG] Original file content retrieved, length:",t?.length),s.$store.dispatch(`ide/${ct.Zd}`,{projectName:i,parentPath:a,fileName:r,callback:e=>{0==e.code?(nh.log("🔍 [DEBUG] File created successfully, now writing content"),s.$store.dispatch(`ide/${ct._L}`,{projectName:i,filePath:l,fileData:t,complete:!0,callback:e=>{0==e.code?(nh.log("🔍 [DEBUG] File duplicated successfully as:",r),ht.nk.success(`File duplicated as ${r}`),s.refreshProjectTree()):(nh.error("🔍 [DEBUG] Failed to write content to duplicate file:",e),ht.nk.error("Failed to write content to duplicate file"))}})):(nh.error("🔍 [DEBUG] Failed to create duplicate file:",e),ht.nk.error("Failed to create duplicate file"))}})}else nh.error("🔍 [DEBUG] Failed to read original file:",e),ht.nk.error("Failed to read original file")}})},async generateUniqueFileName(e,t,o){const i=e.lastIndexOf("."),s=i>0?e.substring(i):"",n=i>0?e.substring(0,i):e;nh.log("🔍 [DEBUG] generateUniqueFileName:",{proposedName:e,baseName:n,extension:s,parentPath:t});const a=await this.getExistingFilesInDirectory(t,o);if(nh.log("🔍 [DEBUG] Existing files in directory:",a),!a.includes(e))return nh.log("🔍 [DEBUG] Proposed name is already unique:",e),e;for(let d=1;d<1e3;d++){const e=1===d?`${n}_copy${s}`:`${n}_copy_${d}${s}`;if(!a.includes(e))return nh.log("🔍 [DEBUG] Found unique name:",e),e}const r=Date.now(),l=`${n}_copy_${r}${s}`;return nh.log("🔍 [DEBUG] Using timestamp fallback:",l),l},async getExistingFilesInDirectory(e,t){return new Promise(t=>{try{const o=this.ideInfo.currProj?.data;if(!o)return nh.log("🔍 [DEBUG] No project data available"),void t([]);const i=(e,t)=>{try{if(!e||"object"!==typeof e)return null;if(e.path===t&&"dir"===e.type)return e;if(e.children&&Array.isArray(e.children))for(const o of e.children){if(!o||"object"!==typeof o)continue;const e=i(o,t);if(e)return e}return null}catch(o){return nh.warn("🔍 [DEBUG] Error in findDirectory:",o),null}},s=i(o,e);if(nh.log("🔍 [DEBUG] Found target directory:",s),s&&s.children&&Array.isArray(s.children)){const e=s.children.filter(e=>{try{return e&&"object"===typeof e&&"file"===e.type&&(e.label||e.name)}catch(t){return nh.warn("🔍 [DEBUG] Invalid child node, skipping:",e,t),!1}}).map(e=>{try{return e.label||e.name||"unnamed"}catch(t){return nh.warn("🔍 [DEBUG] Error extracting child name:",t),"unnamed"}}).filter(e=>e&&"unnamed"!==e);nh.log("🔍 [DEBUG] Extracted filenames:",e),t(e)}else nh.log("🔍 [DEBUG] Directory not found or has no children"),t([])}catch(bc){nh.warn("🔍 [DEBUG] Error in getExistingFilesInDirectory:",bc),t([])}})},async saveAsFile(e){if(nh.log("🔍 [DEBUG] VmIde.saveAsFile() called with:",e),!e||!e.fileName)return nh.log("🔍 [DEBUG] Invalid fileInfo - no fileName"),void ht.nk.error("No file selected to save");const t=this.ideInfo.codeItems.find(t=>t.filePath===e.filePath&&(t.projectName===e.projectName||!t.projectName&&!e.projectName));nh.log("🔍 [DEBUG] Looking for codeItem with filePath:",e.filePath),nh.log("🔍 [DEBUG] Available codeItems:",this.ideInfo.codeItems?.map(e=>({filePath:e.filePath,projectName:e.projectName}))),nh.log("🔍 [DEBUG] Found codeItem:",!!t),t?(nh.log("🔍 [DEBUG] Using editor content, calling performSaveAs"),await this.performSaveAs(e,t.content)):(nh.log("🔍 [DEBUG] File not in editor, reading from server"),this.readFileForSaveAs(e))},readFileForSaveAs(e){nh.log("🔍 [DEBUG] readFileForSaveAs called with:",e);const t=[".png",".jpg",".jpeg",".gif",".bmp",".svg",".pdf",".zip",".tar",".gz"],o=t.some(t=>e.fileName.toLowerCase().endsWith(t));nh.log("🔍 [DEBUG] File is binary:",o),nh.log("🔍 [DEBUG] Dispatching IDE_GET_FILE with:",{projectName:e.projectName,filePath:e.filePath,binary:o}),this.$store.dispatch(`ide/${ct.Jh}`,{projectName:e.projectName,filePath:e.filePath,binary:o,callback:async t=>{if(nh.log("🔍 [DEBUG] IDE_GET_FILE callback received:",{code:t.code,hasData:!!t.data}),0==t.code){let i=t.data?.content||t.data;if(o)return void ht.nk.info("Binary files should be downloaded using the Download option instead.");"object"===typeof i&&i.content&&(i=i.content),await this.performSaveAs(e,i)}else ht.nk.error("Failed to read file content")}})},async performSaveAs(e,t){nh.log("🔍 [DEBUG] performSaveAs called with fileInfo:",e),nh.log("🔍 [DEBUG] Content length:",t?.length);const o=e=>{const t=e.toLowerCase().split(".").pop(),o={py:"text/x-python",js:"text/javascript",html:"text/html",css:"text/css",json:"application/json",md:"text/markdown",txt:"text/plain",csv:"text/csv",xml:"text/xml"};return o[t]||"text/plain"},i=o(e.fileName),s="showSaveFilePicker"in window,n=window.isSecureContext;if(s&&n)try{const o=e.fileName.split(".").pop()||"txt",s={suggestedName:e.fileName,types:[{description:`${o.toUpperCase()} files`,accept:{[i]:["."+o]}}],excludeAcceptAllOption:!1},n=await window.showSaveFilePicker(s),a=await n.createWritable();if(t.length>1048576){const e=t.match(/.{1,65536}/g)||[];for(const t of e)await a.write(t)}else await a.write(t);return await a.close(),void ht.nk.success(`File saved successfully as: ${n.name}`)}catch(bc){if("AbortError"===bc.name)return;"NotAllowedError"===bc.name?ht.nk.warning("File access permission denied. Using fallback download method."):nh.warn("File System Access API failed:",bc)}else s&&!n&&nh.warn("File System Access API requires HTTPS. Using fallback method.");try{const o=new Blob([t],{type:i+";charset=utf-8"}),s=document.createElement("a"),n="download"in s;if(n){const t=window.URL.createObjectURL(o),i=document.createElement("a");if(i.href=t,i.download=e.fileName,i.style.display="none",i.setAttribute("target","_blank"),i.setAttribute("rel","noopener noreferrer"),document.body.appendChild(i),"function"===typeof i.click)i.click();else{const e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});i.dispatchEvent(e)}setTimeout(()=>{document.body.contains(i)&&document.body.removeChild(i),window.URL.revokeObjectURL(t)},150),ht.nk.success("File downloaded to your default downloads folder")}else{const e=window.URL.createObjectURL(o),t=window.open(e,"_blank");if(!t)throw new Error("Popup blocked or browser not supported");ht.nk.info("File opened in new window. Use browser's save function to download."),setTimeout(()=>{window.URL.revokeObjectURL(e)},1e3)}}catch(bc){if(nh.error("Save As failed:",bc),navigator.clipboard&&navigator.clipboard.writeText)try{await navigator.clipboard.writeText(t),ht.nk.warning("Could not download file. Content copied to clipboard instead.")}catch(a){ht.nk.error("Failed to save file. Please try using a modern browser.")}else ht.nk.error("Failed to save file. Please try using a modern browser.")}},openMoveDialog(e){nh.log("[VmIde] openMoveDialog called with:",e);e.path||e.filePath;const t=(o,i)=>{if("file"===o.type&&o.name===e.name)return o;if(o.children)for(const e of o.children){const o=t(e,i);if(o)return o}return null};let o=e;if(this.ideInfo.multiRootData&&this.ideInfo.multiRootData.children.length>0)for(const i of this.ideInfo.multiRootData.children){const s=t(i,e.name);if(s){nh.log("[VmIde] Found fresh file data in tree:",s.path),o={...e,path:s.path,filePath:s.path};break}}else if(this.ideInfo.currProj&&this.ideInfo.currProj.data){const i=t(this.ideInfo.currProj.data,e.name);i&&(nh.log("[VmIde] Found fresh file data in single project:",i.path),o={...e,path:i.path,filePath:i.path})}this.fileBrowserMode="move",this.fileToMove=o,this.showFileBrowserDialog=!0,nh.log("[VmIde] Move dialog opened with fresh data, mode:",this.fileBrowserMode,"fileToMove:",this.fileToMove)},handleMoveFile(e){nh.log("[VmIde] handleMoveFile called with data:",e);const{oldPath:t,newPath:o,projectName:i}=e,s=this,n=(e,t)=>{if(!e||!t)return e;const o=t+"/";return e.startsWith(o)?e.substring(o.length):e},a=n(t,i),r=n(o,i);if(nh.log("[VmIde] Normalized paths:",{originalOldPath:t,normalizedOldPath:a,originalNewPath:o,normalizedNewPath:r,projectName:i}),a===r)return ht.nk.warning("Source and destination paths are the same"),void(this.showFileBrowserDialog=!1);if(r.startsWith(a+"/"))return ht.nk.error("Cannot move a file into its own subdirectory"),void(this.showFileBrowserDialog=!1);const l=!1===this.ideInfo.nodeSelected?.isLeaf,d=l?ct.mr:ct.GG;nh.log("[VmIde] Using move command:",d),this.$store.dispatch(`ide/${d}`,{wsKey:this.wsKey,projectName:i,oldPath:a,newPath:r,callback:e=>{if(nh.log("[VmIde] Move result:",e),0===e.code){if(ht.nk.success((l?"Folder":"File")+" moved successfully"),s.ideInfo.nodeSelected&&s.ideInfo.nodeSelected.path===t){const e={...s.ideInfo.nodeSelected,path:o,filePath:o,fileName:o.substring(o.lastIndexOf("/")+1),name:o.substring(o.lastIndexOf("/")+1),label:o.substring(o.lastIndexOf("/")+1)};if(s.$store.commit("ide/setNodeSelected",e),!l&&s.ideInfo.openList.length>0){const e=s.ideInfo.openList.findIndex(e=>e.path===t);if(-1!==e){const i=[...s.ideInfo.openList];i[e]={...i[e],path:o,filePath:o,fileName:o.substring(o.lastIndexOf("/")+1),name:o.substring(o.lastIndexOf("/")+1),label:o.substring(o.lastIndexOf("/")+1)},s.$store.commit("ide/setOpenList",i),s.ideInfo.selectFilePath===t&&s.$store.commit("ide/setSelectFilePath",o)}}}s.refreshProjectTreeWithCallback(()=>{nh.log("[VmIde] Tree refresh completed after move"),s.showFileBrowserDialog=!1})}else nh.error("[VmIde] Move failed:",e),ht.nk.error(e.msg||"Failed to move "+(l?"folder":"file")),s.showFileBrowserDialog=!1}})},deleteFileFromMenu(e){this.handleDeleteItem(e)},deleteSelectedFile(e){this.handleDeleteItem(e)},setDelDialog(e){this.dialogType="",this.dialogTitle=e.title,this.dialogText="",this.dialogTips="",this.showDeleteDialog=!0},setProjsDialog(e){this.dialogType="",this.dialogTitle="",this.dialogText="",this.dialogTips="",this.showProjsDialog=!0},onCloseTextDialog(){this.showFileDialog=!1,this.ideInfo.nodeSelected&&this.ideInfo.treeRef.setCurrentNode(this.ideInfo.nodeSelected),"create-project"===this.dialogType&&(this.showProjsDialog=!0)},onCloseProjsDialog(){this.showProjsDialog=!1,this.showFileDialog=!1,this.showDeleteDialog=!1,this.ideInfo.nodeSelected&&this.ideInfo.treeRef.setCurrentNode(this.ideInfo.nodeSelected)},onCancelDelete(){this.showDeleteDialog=!1,this.ideInfo.nodeSelected&&this.ideInfo.treeRef.setCurrentNode(this.ideInfo.nodeSelected)},deleteProject(e){const t=this;this.$store.dispatch(`ide/${ct.DO}`,{projectName:e,callback:o=>{0==o.code&&t.$store.commit("ide/handleDelProject",e)}})},deleteFile(e,t){const o=this;nh.log("[deleteFile] Deleting file:",e,"from project:",t||this.ideInfo.currProj.config.name);const i=t||this.ideInfo.currProj.config.name||this.ideInfo.currProj.data?.name;this.$store.dispatch(`ide/${ct.w7}`,{projectName:i,filePath:e,callback:t=>{if(nh.log("[deleteFile] Response:",t),0==t.code){const t=o.getParentData(e);t&&o.$store.commit("ide/handleDelFile",{parentData:t,filePath:e}),o.refreshProjectTree(),(0,ht.nk)({type:"success",message:"File deleted successfully",duration:2e3})}else(0,ht.nk)({type:"error",message:"Failed to delete file",duration:3e3})}})},deleteFolder(e,t){const o=this;nh.log("[deleteFolder] Deleting folder:",e,"from project:",t||this.ideInfo.currProj.config.name);const i=t||this.ideInfo.currProj.config.name||this.ideInfo.currProj.data?.name;this.$store.dispatch(`ide/${ct.Ec}`,{projectName:i,folderPath:e,callback:t=>{if(nh.log("[deleteFolder] Response:",t),0==t.code){const t=o.getParentData(e);t&&o.$store.commit("ide/handleDelFolder",{parentData:t,folderPath:e}),o.refreshProjectTree(),(0,ht.nk)({type:"success",message:"Folder deleted successfully",duration:2e3})}else(0,ht.nk)({type:"error",message:"Failed to delete folder",duration:3e3})}})},createProject(e){const t=this;this.$store.dispatch(`ide/${ct.KV}`,{projectName:e,callback:o=>{0==o.code&&t.listProjects(e)}})},createFile(e,t,o){const i=this;this.$store.dispatch(`ide/${ct.Zd}`,{projectName:void 0===o?this.ideInfo.currProj.config.name:o,parentPath:void 0===t?this.ideInfo.nodeSelected.path:t,fileName:e,callback:t=>{if(0==t.code){const t=ah.join(i.ideInfo.nodeSelected.path,e);i.$store.commit("ide/addChildrenNode",{name:e,path:t,type:"file"}),i.$store.dispatch(`ide/${ct.xv}`,{})}}})},createFolder(e,t,o){const i=this;this.$store.dispatch(`ide/${ct.p_}`,{projectName:void 0===o?this.ideInfo.currProj.config.name:o,parentPath:void 0===t?this.ideInfo.nodeSelected.path:t,folderName:e,callback:t=>{if(0==t.code){const t=ah.join(i.ideInfo.nodeSelected.path,e);i.$store.commit("ide/addChildrenNode",{name:e,path:t,type:"dir"}),i.$store.dispatch(`ide/${ct.xv}`,{})}}})},renameProject(e,t){const o=this;this.$store.dispatch(`ide/${ct.sh}`,{oldName:void 0===t?this.ideInfo.currProj.config.name:t,newName:e,callback:t=>{0==t.code&&(o.$store.commit("ide/handleRename",e),o.$store.dispatch(`ide/${ct.xv}`,{}))}})},renameFile(e,t,o){const i=this;let s=t;if(void 0===s){if(!this.ideInfo.nodeSelected||!this.ideInfo.nodeSelected.path)return nh.error("Cannot rename: no path provided and nodeSelected is null"),void ht.nk.error("Cannot rename: no file selected");s=this.ideInfo.nodeSelected.path}nh.log("[renameFile] Starting rename:",{actualOldPath:s,newName:e,projectName:o});const n=o||this.ideInfo.currProj?.config?.name||this.ideInfo.currProj?.data?.name;nh.log("[renameFile] Using project name:",n),this.$store.dispatch(`ide/${ct.Z0}`,{projectName:n,oldPath:s,fileName:e,callback:t=>{if(nh.log("[renameFile] Backend response:",t),0==t.code){const t=s.substring(0,s.lastIndexOf("/")+1)+e;nh.log("[renameFile] New path will be:",t);for(let o=0;o<i.ideInfo.codeItems.length;o++)if(i.ideInfo.codeItems[o].path===s){nh.log("[renameFile] Updating open tab from",s,"to",t),i.ideInfo.codeItems[o].path=t,i.ideInfo.codeItems[o].name=e;break}i.$store.dispatch(`ide/${ct.QQ}`,{projectName:n,callback:e=>{0==e.code&&(i.$store.commit("ide/handleProject",e.data),i.$store.commit("ide/setPathSelected",t),i.ideInfo.multiRootData&&(nh.log("[renameFile] Refreshing all projects in multi-root mode"),i.loadAllDefaultProjects()),ht.nk.success("File renamed successfully"))}})}else{nh.error("[renameFile] Rename failed:",t);const e=t.data?.message||t.message||"Unknown error";ht.nk.error("Failed to rename file: "+e)}}})},renameFolder(e,t,o){const i=this;let s=t;if(void 0===s){if(!this.ideInfo.nodeSelected||!this.ideInfo.nodeSelected.path)return nh.error("Cannot rename folder: no path provided and nodeSelected is null"),void ht.nk.error("Cannot rename folder: no folder selected");s=this.ideInfo.nodeSelected.path}nh.log("[renameFolder] Starting rename:",{actualOldPath:s,newName:e,projectName:o});const n=o||this.ideInfo.currProj?.config?.name||this.ideInfo.currProj?.data?.name;nh.log("[renameFolder] Using project name:",n),this.$store.dispatch(`ide/${ct.Zz}`,{projectName:n,oldPath:s,folderName:e,callback:t=>{if(nh.log("[renameFolder] Backend response:",t),0==t.code){const t=s.substring(0,s.lastIndexOf("/")+1)+e;nh.log("[renameFolder] New path will be:",t);for(let e=0;e<i.ideInfo.codeItems.length;e++)if(i.ideInfo.codeItems[e].path.startsWith(s+"/")){const o=i.ideInfo.codeItems[e].path.substring(s.length),n=t+o;nh.log("[renameFolder] Updating open tab from",i.ideInfo.codeItems[e].path,"to",n),i.ideInfo.codeItems[e].path=n}i.$store.dispatch(`ide/${ct.QQ}`,{projectName:n,callback:e=>{0==e.code&&(i.$store.commit("ide/handleProject",e.data),i.$store.commit("ide/setPathSelected",t),i.ideInfo.multiRootData&&(nh.log("[renameFolder] Refreshing all projects in multi-root mode"),i.loadAllDefaultProjects()),ht.nk.success("Folder renamed successfully"))}})}else{nh.error("[renameFolder] Rename failed:",t);const e=t.data?.message||t.message||"Unknown error";ht.nk.error("Failed to rename folder: "+e)}}})},onDelete(){this.showDeleteDialog=!1,this.ideInfo.nodeSelected&&this.ideInfo.nodeSelected.type&&("dir"===this.ideInfo.nodeSelected.type||"folder"===this.ideInfo.nodeSelected.type)?this.deleteFolder(this.ideInfo.nodeSelected.path):this.deleteFile(this.ideInfo.nodeSelected.path)},onCreate(){const e=this.dialogText;if("create-file"===this.dialogType)this.createFile(e);else if("rename-file"===this.dialogType)this.renameFile(e);else if("create-folder"===this.dialogType)this.createFolder(e);else if("rename-folder"===this.dialogType)this.renameFolder(e);else if("create-project"===this.dialogType)if(this.hasRunProgram){const t=this;ao.s.confirm("Stop all running programs and create new project?","Warning",{confirmButtonText:"Stop and Create",cancelButtonText:"Cancel",type:"warning"}).then(()=>{t.stopAll(),t.$store.commit("ide/setConsoleItems",[]),t.createProject(e)}).catch(()=>{nh.log("canceled create project")})}else this.$store.commit("ide/setConsoleItems",[]),this.createProject(e);else"rename-project"===this.dialogType&&this.renameProject(e);this.showProjsDialog=!1,this.showFileDialog=!1,this.showDeleteDialog=!1},onDeleteProj(e){const t=this;ao.s.confirm("Delete this project?","Confirm",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then(()=>{t.deleteProject(e),(0,ht.nk)({type:"success",message:"Deleted successfully"})}).catch(()=>{(0,ht.nk)({type:"info",message:"Cancelled"})})},onSelectProj(e){this.hasRunProgram?ao.s.confirm("Stop all running programs and switch project?","Warning",{confirmButtonText:"Stop and Switch",cancelButtonText:"Cancel",type:"warning"}).then(()=>{this.stopAll(),this.$store.commit("ide/setConsoleItems",[]),this.getProject(e),this.showProjsDialog=!1}).catch(()=>{this.showProjsDialog=!1}):(this.getProject(e),this.showProjsDialog=!1,this.$store.commit("ide/setConsoleItems",[]))},selectFile(e){const t=this.ideInfo.codeSelected,o=t&&t.path!==e.path;if(o&&t.path&&t.path.endsWith(".py")){const e=this.ideInfo.consoleItems.find(e=>e.path===t.path);e&&e.run&&!this.isReplMode&&(this.stop(e.id),e.waitingForInput&&this.$store.commit("ide/updateConsoleItem",{id:e.id,waitingForInput:!1,inputPrompt:""})),this.saveFileConsoleState(t.path)}if(th.constructor.emitIDEActivity("file-open",{filename:e.fileName}),this.$store.commit("ide/setPathSelected",e.path),this.$store.commit("ide/setCodeSelected",e),this.activeFilePath=e.path,o&&e.path&&e.path.endsWith(".py")){let t=this.ideInfo.consoleItems.find(t=>t.path===e.path);t||(t={id:this.$store.state.ide.consoleId,name:e.name,path:e.path,resultList:[],run:!1,stop:!1,waitingForInput:!1,inputPrompt:""},this.$store.commit("ide/pushConsoleItem",t)),this.$store.commit("ide/setConsoleSelected",t),this.consoleMode="collapsed",this.consoleExpanded=!1,this.consoleMaximized=!1,this.$nextTick(()=>{this.updateEditorHeight()})}this.ideInfo.currProj.pathSelected&&this.ideInfo.treeRef&&(this.ideInfo.treeRef.setCurrentKey(this.ideInfo.currProj.pathSelected),this.$store.commit("ide/setNodeSelected",this.ideInfo.treeRef.getCurrentNode())),this.$store.dispatch(`ide/${ct.xv}`,{})},closeFile(e){if(e.path&&e.path.endsWith(".py")){this.activeFilePath===e.path&&this.saveFileConsoleState(e.path);const t=this.ideInfo.consoleItems.filter(t=>t.path!==e.path);this.$store.commit("ide/setConsoleItems",t)}const t=[];for(let o=0;o<this.ideInfo.codeItems.length;o++)e.path!==this.ideInfo.codeItems[o].path?t.push(this.ideInfo.codeItems[o]):o>0?this.ideInfo.currProj.pathSelected===e.path&&(this.$store.commit("ide/setPathSelected",this.ideInfo.codeItems[o-1].path),this.$store.commit("ide/setCodeSelected",this.ideInfo.codeItems[o-1])):o<this.ideInfo.codeItems.length-1&&this.ideInfo.currProj.pathSelected===e.path&&(this.$store.commit("ide/setPathSelected",this.ideInfo.codeItems[o+1].path),this.$store.commit("ide/setCodeSelected",this.ideInfo.codeItems[o+1]));this.$store.commit("ide/setCodeItems",t),0===this.ideInfo.codeItems.length&&(this.$store.commit("ide/setPathSelected",null),this.$store.commit("ide/setCodeSelected",{})),this.$store.dispatch(`ide/${ct.xv}`,{})},updateItem(e,t){for(let o=0;o<this.ideInfo.codeItems.length;o++)if(e===this.ideInfo.codeItems[o].path){this.$store.commit("ide/setCodeItemMirror",{index:o,codemirror:t});break}},selectConsole(e){this.$store.commit("ide/setConsoleSelected",e)},closeConsoleSafe(e){!0===e.run?ao.s.confirm("Stop this program and close terminal?","Warning",{confirmButtonText:"Stop and Close",cancelButtonText:"Cancel",type:"warning"}).then(()=>{this.stop(e.id),this.closeConsole(e)}).catch(()=>{nh.log("canceled close console")}):this.closeConsole(e)},closeConsole(e){const t=[];for(let o=0;o<this.ideInfo.consoleItems.length;o++)"Terminal"===e.name&&"Terminal"===e.path?e.id!==this.ideInfo.consoleItems[o].id?t.push(this.ideInfo.consoleItems[o]):o>0?this.$store.commit("ide/setConsoleSelected",this.ideInfo.consoleItems[o-1]):o<this.ideInfo.consoleItems.length-1&&this.$store.commit("ide/setConsoleSelected",this.ideInfo.consoleItems[o+1]):e.path!==this.ideInfo.consoleItems[o].path||e.id!==this.ideInfo.consoleItems[o].id?t.push(this.ideInfo.consoleItems[o]):o>0?this.$store.commit("ide/setConsoleSelected",this.ideInfo.consoleItems[o-1]):o<this.ideInfo.consoleItems.length-1&&this.$store.commit("ide/setConsoleSelected",this.ideInfo.consoleItems[o+1]);this.$store.commit("ide/setConsoleItems",t),0===this.ideInfo.consoleItems.length&&this.$store.commit("ide/setConsoleSelected",{}),this.resize()},getCurrentConsoleHeight(){return 400},resize(){this.windowWidth=window.innerWidth,this.$forceUpdate()},runPathSelected(){th.constructor.emitIDEActivity("code-run");const e=this.ideInfo.currProj.pathSelected;if(!e||""===e||null===e)return void(0,ht.nk)({type:"warning",message:"No script is open to run. Please open a Python file first.",duration:3e3});this.consoleExpanded||(this.consoleExpanded=!0,this.updateEditorHeight());const t=this.getOrCreateFileConsole(e);this.$store.commit("ide/resetConsoleItem",{consoleId:t.id,run:!1,stop:!1,resultList:[]}),this.$store.commit("ide/setConsoleSelected",t),this.$store.commit("ide/assignConsoleSelected",{id:this.ideInfo.consoleId}),this.saveFileConsoleState(e),"collapsed"===this.consoleMode&&(this.consoleMode="normal",this.consoleExpanded=!0,this.consoleMaximized=!1);const o=this.ideInfo.codeSelected?.projectName||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name,i=this.ideInfo.consoleId;this.replSessionId=i,nh.log(`[VmIde] Setting replSessionId to ${i} for Python program execution`),this.$store.dispatch(`ide/${ct.j8}`,{msgId:i,projectName:o,filePath:this.ideInfo.currProj.pathSelected,callback:{limits:-1,callback:e=>{nh.log("🔍 [VmIde] Script execution callback:",e);const t=e.id===this.replSessionId||e.cmd_id===this.replSessionId||e.data&&e.data.program_id===this.replSessionId||this.isReplMode&&this.replSessionId&&(0===e.code||2e3===e.code||5e3===e.code)&&e.data&&(e.data.stdout||e.data.stderr),o=null===e.data||void 0===e.data||2e3===e.code||4e3===e.code||5e3===e.code;nh.log("🔍 [Script] Callback - isReplMessage:",t,"isProgramLifecycle:",o,"code:",e.code,"id:",e.id,"replSessionId:",this.replSessionId),!t||o?(nh.log("✅ [Script] Processing through handleRunResult"),this.$store.commit("ide/handleRunResult",e)):nh.log("⏭️ [Script] Skipping - will be handled by REPL"),5e3!==e.code||t||(nh.log("🎯 [VmIde] Script completed, entering REPL mode"),this.isReplMode=!0)}}}),this.$store.commit("ide/setConsoleId",this.ideInfo.consoleId+1)},runConsoleSelected(){this.switchToOutputTab(),"collapsed"===this.consoleMode&&(this.consoleMode="normal",this.consoleExpanded=!0,this.consoleMaximized=!1);const e=this.ideInfo.consoleSelected?.projectName||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name,t=this.ideInfo.consoleSelected.id;this.replSessionId=t,nh.log(`[VmIde] Setting replSessionId to ${t} for Python program re-run`),this.$store.dispatch(`ide/${ct.j8}`,{msgId:t,projectName:e,filePath:this.ideInfo.consoleSelected.path,callback:{limits:-1,callback:e=>{const t=e.id===this.replSessionId||e.cmd_id===this.replSessionId||e.data&&e.data.program_id===this.replSessionId||this.isReplMode&&this.replSessionId&&(0===e.code||2e3===e.code||5e3===e.code)&&e.data&&(e.data.stdout||e.data.stderr),o=null===e.data||void 0===e.data||2e3===e.code||4e3===e.code||5e3===e.code;nh.log("🔍 [REPL] Callback - isReplMessage:",t,"isProgramLifecycle:",o,"code:",e.code,"id:",e.id,"replSessionId:",this.replSessionId),!t||o?(nh.log("✅ [REPL] Processing through handleRunResult"),this.$store.commit("ide/handleRunResult",e)):nh.log("⏭️ [REPL] Skipping - will be handled by WebSocket")}}})},stop(e){this.$store.dispatch(`ide/${ct.aQ}`,{consoleId:e,callback:{limits:-1,callback:t=>{this.$store.commit("ide/handleStopResult",{consoleId:e,dict:t})}}})},stopAll(){for(let e=0;e<this.ideInfo.consoleItems.length;e++)!0===this.ideInfo.consoleItems[e].run&&this.stop(this.ideInfo.consoleItems[e].id);this.stop(null)},startResizeLeft(e){this.isResizingLeft=!0,this.startX=e.clientX,this.startWidth=this.leftSidebarWidth,document.addEventListener("mousemove",this.throttledHandleResizeLeft),document.addEventListener("mouseup",this.stopResizeLeft),e.preventDefault()},handleResizeLeft(e){if(!this.isResizingLeft)return;const t=e.clientX-this.startX,o=window.innerWidth,i=this.rightSidebarVisible?this.rightSidebarWidth:0,s=o-i-this.minEditorWidth-10;let n=this.startWidth+t;this.resizeWarning=n<160||n>s-10,n=Math.max(150,Math.min(Math.min(500,s),n)),this.leftSidebarWidth=n},stopResizeLeft(){this.isResizingLeft=!1,this.resizeWarning=!1,document.removeEventListener("mousemove",this.throttledHandleResizeLeft),document.removeEventListener("mouseup",this.stopResizeLeft),this.validateLayout(),this.saveLayoutPreferences()},startResizeRight(e){this.isResizingRight=!0,this.startX=e.clientX,this.startWidth=this.rightSidebarWidth,document.addEventListener("mousemove",this.throttledHandleResizeRight),document.addEventListener("mouseup",this.stopResizeRight),e.preventDefault()},handleResizeRight(e){if(!this.isResizingRight)return;const t=this.startX-e.clientX,o=window.innerWidth,i=o-this.leftSidebarWidth-this.minEditorWidth-10;let s=this.startWidth+t;this.resizeWarning=s<310||s>i-10,s=Math.max(300,Math.min(i,s)),this.rightSidebarWidth=s},stopResizeRight(){this.isResizingRight=!1,this.resizeWarning=!1,document.removeEventListener("mousemove",this.throttledHandleResizeRight),document.removeEventListener("mouseup",this.stopResizeRight),this.validateLayout(),this.saveLayoutPreferences()},startResizeConsole(e){this.isResizingConsole=!0,this.startY=e.clientY,this.startHeight=this.consoleHeight,document.addEventListener("mousemove",this.throttledHandleResizeConsole),document.addEventListener("mouseup",this.stopResizeConsole),e.preventDefault()},handleResizeConsole(e){if(!this.isResizingConsole)return;const t=this.startY-e.clientY,o=window.innerHeight,i=o-200;let s=this.startHeight+t;s=Math.max(100,Math.min(i,s)),this.consoleHeight=s,this.updateEditorHeight()},stopResizeConsole(){this.isResizingConsole=!1,document.removeEventListener("mousemove",this.throttledHandleResizeConsole),document.removeEventListener("mouseup",this.stopResizeConsole),this.updateEditorHeight(),this.saveLayoutPreferences()},saveLayoutPreferences(){const e={leftSidebarWidth:this.leftSidebarWidth,rightSidebarWidth:this.rightSidebarWidth,rightSidebarVisible:this.rightSidebarVisible,consoleHeight:this.consoleHeight,consoleExpanded:this.consoleExpanded,wordWrap:this.wordWrap,rightPanelMode:this.rightPanelMode,consoleMode:this.consoleMode,consolePreviousMode:this.consolePreviousMode,wasConsoleOpenBeforeRightExpand:this.wasConsoleOpenBeforeRightExpand};localStorage.setItem("ide-layout-preferences",JSON.stringify(e))},loadLayoutPreferences(){const e=localStorage.getItem("ide-layout-preferences");if(e)try{const t=JSON.parse(e);this.leftSidebarWidth=t.leftSidebarWidth||250,this.rightSidebarWidth=t.rightSidebarWidth||400,this.rightSidebarVisible=!0===t.rightSidebarVisible,this.consoleHeight=t.consoleHeight||200,this.consoleExpanded=!1!==t.consoleExpanded,this.wordWrap=!1!==t.wordWrap,this.rightPanelMode=t.rightPanelMode||"closed",this.consoleMode=t.consoleMode||"collapsed",this.consolePreviousMode=t.consolePreviousMode||"normal",this.wasConsoleOpenBeforeRightExpand=t.wasConsoleOpenBeforeRightExpand||!1,this.rightSidebarVisible="closed"!==this.rightPanelMode,this.consoleExpanded="collapsed"!==this.consoleMode,this.consoleMaximized="maximized"===this.consoleMode}catch(t){nh.warn("Failed to load layout preferences:",t)}this.validateLayout(),this.updateEditorHeight()},validateLayout(){const e=window.innerWidth;if(e<900)return;const t=this.leftSidebarWidth+(this.rightSidebarVisible?this.rightSidebarWidth:0),o=e-t-10;if(o<this.minEditorWidth){const t=this.minEditorWidth-o;if(this.rightSidebarVisible){const o=this.leftSidebarWidth/(this.leftSidebarWidth+this.rightSidebarWidth),i=1-o,s=Math.min(this.leftSidebarWidth-150,t*o),n=Math.min(this.rightSidebarWidth-300,t*i);this.leftSidebarWidth=Math.max(150,this.leftSidebarWidth-s),this.rightSidebarWidth=Math.max(300,this.rightSidebarWidth-n);const a=this.leftSidebarWidth+this.rightSidebarWidth;e-a-10<this.minEditorWidth&&(this.rightSidebarVisible=!1)}else this.leftSidebarWidth=Math.max(150,Math.min(this.leftSidebarWidth,e-this.minEditorWidth-10))}},handleProgramInputKeydown(e){if("Enter"===e.key)if(e.shiftKey){e.preventDefault();const t=e.target.selectionStart,o=e.target.selectionEnd,i=this.programInput;this.programInput=i.substring(0,t)+"\n"+i.substring(o),this.$nextTick(()=>{e.target.selectionStart=e.target.selectionEnd=t+1,this.updateProgramInputRows()})}else e.preventDefault(),this.sendProgramInput();else if("Tab"===e.key){e.preventDefault();const t=e.target.selectionStart,o=e.target.selectionEnd,i=this.programInput;this.programInput=i.substring(0,t)+"    "+i.substring(o),this.$nextTick(()=>{e.target.selectionStart=e.target.selectionEnd=t+4,this.updateProgramInputRows()})}this.$nextTick(()=>{this.updateProgramInputRows()})},updateProgramInputRows(){const e=7,t=this.programInput.split("\n").length;this.$refs.programInputField?(this.programInputRows=1,this.$nextTick(()=>{const t=this.$refs.programInputField,o=parseInt(window.getComputedStyle(t).lineHeight)||20,i=t.scrollHeight,s=Math.ceil(i/o);this.programInputRows=Math.min(e,Math.max(1,s))})):this.programInputRows=Math.min(e,Math.max(1,t))},sendProgramInput(){if(!this.programInput.trim())return;const e=this.programInput,t=this.ideInfo.consoleSelected.id;this.$store.commit("ide/addConsoleOutput",{id:t,type:"input",text:`▶ ${e}`}),this.programInput="",this.programInputRows=1,this.$store.commit("ide/setConsoleWaiting",{id:t,waiting:!1,prompt:""}),this.$store.dispatch(`ide/${ct.WP}`,{program_id:t,input:e,callback:{limits:-1,callback:e=>{nh.log("Input sent:",e)}}}),this.$nextTick(()=>{this.$refs.consoleOutputArea&&(this.$refs.consoleOutputArea.scrollTop=this.$refs.consoleOutputArea.scrollHeight)})},handleReplKeydown(e){if("Enter"===e.key)if(e.shiftKey){e.preventDefault();const t=e.target.selectionStart,o=e.target.selectionEnd,i=this.replInput;this.replInput=i.substring(0,t)+"\n"+i.substring(o),this.$nextTick(()=>{e.target.selectionStart=e.target.selectionEnd=t+1,this.updateReplRows()})}else{e.preventDefault();const t=e.target.selectionStart,o=this.replInput.substring(0,t),i=o.split("\n"),s=i[i.length-1],n=""===s.trim(),a=this.replInput.includes("\n");if(n&&a)this.executeReplCommand();else if(this.shouldContinueMultiline(this.replInput)){const t=e.target.selectionStart,o=e.target.selectionEnd,i=this.replInput;this.replInput=i.substring(0,t)+"\n"+i.substring(o),this.$nextTick(()=>{e.target.selectionStart=e.target.selectionEnd=t+1,this.updateReplRows()})}else this.executeReplCommand()}else if("Tab"===e.key){e.preventDefault();const t=e.target.selectionStart,o=e.target.selectionEnd,i=this.replInput;this.replInput=i.substring(0,t)+"    "+i.substring(o),this.$nextTick(()=>{e.target.selectionStart=e.target.selectionEnd=t+4,this.updateReplRows()})}else"ArrowUp"!==e.key||0!==e.target.selectionStart||this.replInput.includes("\n")?"ArrowDown"!==e.key||this.replInput.includes("\n")||(e.preventDefault(),this.navigateReplHistory("down")):(e.preventDefault(),this.navigateReplHistory("up"));this.$nextTick(()=>{this.updateReplRows()})},updateReplRows(){const e=7,t=this.replInput.split("\n").length;this.$refs.replInputField?(this.replInputRows=1,this.$nextTick(()=>{const t=this.$refs.replInputField,o=parseInt(window.getComputedStyle(t).lineHeight)||20,i=t.scrollHeight,s=Math.ceil(i/o);this.replInputRows=Math.min(e,Math.max(1,s))})):this.replInputRows=Math.min(e,Math.max(1,t))},async executeReplCommand(){let e=this.replInput;while(e.endsWith("\n\n"))e=e.slice(0,-1);if(!e||!e.trim())return this.replInput="",void(this.replInputRows=1);if(this.ideInfo.consoleSelected&&this.ideInfo.consoleSelected.waitingForReplInput){const t=this.ideInfo.consoleSelected.id;if(this.replInput="",this.replInputRows=1,this.$store.commit("ide/addConsoleOutput",{id:t,type:"user-input",text:`>>> ${e}`}),this.wsInfo&&this.wsInfo.rws&&this.wsInfo.rws.readyState===WebSocket.OPEN){const o={cmd:"send_program_input",id:t,data:{program_id:t,input:e}};this.wsInfo.rws.send(JSON.stringify(o)),this.$store.commit("ide/setConsoleWaitingForReplInput",{id:t,waiting:!1})}}else await this.executeReplCommandDualMode(e)},shouldContinueMultiline(e){if(!e||!e.trim())return!1;const t=e.split("\n"),o=t[t.length-1].trim();if(o.endsWith(":"))return!0;e.trim();let i=0,s=0;for(const n of t){if(""===n.trim())continue;const e=n.search(/\S/);if(-1===e)continue;const t=n.trim();t.match(/^(def|class|if|elif|else|for|while|with|try|except|finally)\b.*:/)?(i++,s=e):e<=s&&i>0&&!t.match(/^(elif|else|except|finally)\b/)&&(i=Math.max(0,i-1),s=e)}return i>0&&!o.match(/^(return|break|continue|pass|raise)\b/)},highlightPythonCode(e){if(!e||"string"!==typeof e)return e;if("undefined"!==typeof Prism&&Prism.languages&&Prism.languages.python)try{return Prism.highlight(e,Prism.languages.python,"python")}catch(bc){return nh.warn("Prism.js highlighting failed:",bc),this.simpleHighlight(e)}return this.simpleHighlight(e)},isPromptOutput(e){const t=e.text||e.content||e;return"string"===typeof t&&(t.match(/^\s*>>>\s*$/)||t.match(/^\s*\.\.\.\s*$/)||t.match(/^>>>\s*\n*$/)||t.match(/^\.\.\.\s*\n*$/)||">>>"===t.trim()||"..."===t.trim()||">>> "===t||"... "===t)},simpleHighlight(e){if(!e)return e;let t=this.escapeHtml(e);const o=["def","class","if","elif","else","try","except","finally","for","while","with","as","import","from","return","yield","lambda","pass","break","continue","raise","assert","del","and","or","not","in","is","None","True","False","async","await"],i=new RegExp(`\\b(${o.join("|")})\\b`,"g");t=t.replace(i,'<span class="python-keyword">$1</span>'),t=t.replace(/(["'])((?:\\.|(?!\1).)*?)\1/g,'<span class="python-string">$1$2$1</span>'),t=t.replace(/\b(\d+\.?\d*)\b/g,'<span class="python-number">$1</span>'),t=t.replace(/(#.*$)/gm,'<span class="python-comment">$1</span>');const s=["print","input","range","len","str","int","float","list","dict","set","tuple","type","sum","max","min","abs","round","sorted","reversed"],n=new RegExp(`\\b(${s.join("|")})\\b`,"g");return t=t.replace(n,'<span class="python-builtin">$1</span>'),t},escapeHtml(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,e=>t[e])},isMultilineCode(e){return!(!e||"string"!==typeof e)&&(e.includes("\n")&&""!==e.trim())},splitCodeLines(e){return e&&"string"===typeof e?e.split("\n"):[e||""]},ensureReplConsole(){if(nh.log("🔍 [VmIde] ensureReplConsole called"),!this.ideInfo.consoleSelected||!this.ideInfo.consoleSelected.resultList){const e={id:"repl-console",name:"REPL",path:"REPL",resultList:[],run:!1,stop:!1,waitingForInput:!1,inputPrompt:""},t=this.ideInfo.consoleItems.find(e=>"repl-console"===e.id);t||this.$store.commit("ide/pushConsoleItem",e),this.$store.commit("ide/selectConsoleItem","repl-console")}},addReplOutput(e,t="output"){nh.log(`📢 [VmIde] addReplOutput: [${t}] ${e}`),this.ideInfo.consoleSelected&&this.ideInfo.consoleSelected.id&&(this.$store.commit("ide/addConsoleOutput",{id:this.ideInfo.consoleSelected.id,type:t,text:e}),this.$nextTick(()=>{this.$refs.consoleOutputArea&&(this.$refs.consoleOutputArea.scrollTop=this.$refs.consoleOutputArea.scrollHeight)}))},navigateReplHistory(e){if(0!==this.replHistory.length){if("up"===e)-1===this.replHistoryIndex?this.replHistoryIndex=this.replHistory.length-1:this.replHistoryIndex>0&&this.replHistoryIndex--;else if("down"===e){if(-1===this.replHistoryIndex)return;if(!(this.replHistoryIndex<this.replHistory.length-1))return this.replHistoryIndex=-1,void(this.replInput="");this.replHistoryIndex++}this.replHistoryIndex>=0&&(this.replInput=this.replHistory[this.replHistoryIndex])}},async executeTerminalCommand(){if(!this.terminalInput.trim())return;const e=this.terminalInput.trim();if(this.terminalHistory[this.terminalHistory.length-1]!==e&&this.terminalHistory.push(e),this.terminalHistoryIndex=-1,this.addTerminalOutput("input",e),"clear"===e||"clear()"===e)return this.clearTerminal(),void(this.terminalInput="");if("help"===e||"help()"===e)return this.addTerminalOutput("output",this.getHelpText()),this.terminalInput="",void this.$nextTick(()=>{this.scrollTerminalToBottom(),this.focusTerminalInput()});const t=await this.ensurePyodideReady();if(!t)return this.addTerminalOutput("error","Python environment failed to initialize"),void(this.terminalInput="");try{nh.log("[Pyodide] Executing:",e);const t=this.pyodide.runPython(e);void 0!==t&&null!==t&&this.addTerminalOutput("output",String(t))}catch(bc){nh.error("[Pyodide] Execution error:",bc),this.addTerminalOutput("error",bc.toString())}this.terminalInput="",this.$nextTick(()=>{this.scrollTerminalToBottom(),this.focusTerminalInput()})},addTerminalOutput(e,t){this.terminalOutput.push({type:e,content:t,timestamp:(new Date).toISOString()})},getHelpText(){return"🐍 Python Interactive Terminal (Powered by Pyodide)\n\nFeatures:\n• Full Python 3.11 environment in your browser\n• All variables and imports persist across commands\n• NumPy, Pandas, Matplotlib support available\n• Use Up/Down arrows for command history\n• Type 'clear' to clear the terminal\n\nTry these examples:\n  >>> import math\n  >>> math.sqrt(16)\n  >>> x = [1, 2, 3, 4, 5]\n  >>> sum(x)\n\nAdvanced packages (install with micropip):\n  >>> import micropip\n  >>> await micropip.install(\"requests\")"},navigateHistory(e){if(0!==this.terminalHistory.length){if("up"===e)-1===this.terminalHistoryIndex?this.terminalHistoryIndex=this.terminalHistory.length-1:this.terminalHistoryIndex>0&&this.terminalHistoryIndex--;else if("down"===e){if(-1===this.terminalHistoryIndex)return;if(!(this.terminalHistoryIndex<this.terminalHistory.length-1))return this.terminalHistoryIndex=-1,void(this.terminalInput="");this.terminalHistoryIndex++}this.terminalHistoryIndex>=0&&(this.terminalInput=this.terminalHistory[this.terminalHistoryIndex])}},scrollTerminalToBottom(){this.$refs.terminalContent&&(this.$refs.terminalContent.scrollTop=this.$refs.terminalContent.scrollHeight)},focusTerminalInput(){this.$refs.terminalInputField&&this.$refs.terminalInputField.focus()},switchToOutputTab(){this.consoleModeTab="output"},switchToTerminalTab(){this.consoleModeTab="terminal",this.$nextTick(()=>{this.focusTerminalInput()})}}};const lh=(0,k.A)(rh,[["render",la],["__scopeId","data-v-37f2ca8a"]]);var dh=lh}}]);