(self["webpackChunkvm_web_ide"]=self["webpackChunkvm_web_ide"]||[]).push([[321],{18237:function(e,t,i){"use strict";var o=i(46518),s=i(72652),n=i(79306),a=i(28551),r=i(1767),l=i(9539),d=i(84549),c=i(18745),h=i(79039),p=TypeError,u=h(function(){[].keys().reduce(function(){},void 0)}),m=!u&&d("reduce",p);o({target:"Iterator",proto:!0,real:!0,forced:u||m},{reduce:function(e){a(this);try{n(e)}catch(h){l(this,"throw",h)}var t=arguments.length<2,i=t?void 0:arguments[1];if(m)return c(m,this,t?[e]:[e,i]);var o=r(this),d=0;if(s(o,function(o){t?(t=!1,i=o):i=e(i,o,d),d++},{IS_RECORD:!0}),t)throw new p("Reduce of empty iterator with no initial value");return i}})},18745:function(e,t,i){"use strict";var o=i(40616),s=Function.prototype,n=s.apply,a=s.call;e.exports="object"==typeof Reflect&&Reflect.apply||(o?a.bind(n):function(){return a.apply(n,arguments)})},44317:function(e,t,i){(function(e){e(i(15237))})(function(e){e.defineOption("showTrailingSpace",!1,function(t,i,o){o==e.Init&&(o=!1),o&&!i?t.removeOverlay("trailingspace"):!o&&i&&t.addOverlay({token:function(e){for(var t=e.string.length,i=t;i&&/\s/.test(e.string.charAt(i-1));--i);return i>e.pos?(e.pos=i,null):(e.pos=t,"trailingspace")},name:"trailingspace"})})})},93321:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return Sl}});var o=i(20641),s=i(53751),n=i(90033);const a={class:"login-modal"},r={class:"login-header"},l={class:"login-body"},d={class:"form-group"},c=["disabled"],h={class:"form-group"},p=["disabled"],u={key:0,class:"error-message"},m=["disabled"],f={key:0},g={key:1};function v(e,t,i,v,w,y){const b=(0,o.g2)("X");return i.visible?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"login-modal-overlay",onClick:t[6]||(t[6]=(0,s.D$)((...e)=>y.close&&y.close(...e),["self"]))},[(0,o.Lk)("div",a,[(0,o.Lk)("div",r,[t[7]||(t[7]=(0,o.Lk)("h3",null,"Sign In to Python IDE",-1)),(0,o.Lk)("div",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>y.close&&y.close(...e))},[(0,o.bF)(b,{size:20})])]),(0,o.Lk)("div",l,[(0,o.Lk)("form",{onSubmit:t[5]||(t[5]=(0,s.D$)((...e)=>y.handleLogin&&y.handleLogin(...e),["prevent"]))},[(0,o.Lk)("div",d,[t[8]||(t[8]=(0,o.Lk)("label",{for:"username"},"Username (Net ID)",-1)),(0,o.bo)((0,o.Lk)("input",{id:"username","onUpdate:modelValue":t[1]||(t[1]=e=>w.username=e),type:"text",placeholder:"Enter your net id",required:"",disabled:w.loading,onInput:t[2]||(t[2]=(...e)=>y.clearError&&y.clearError(...e))},null,40,c),[[s.Jo,w.username]])]),(0,o.Lk)("div",h,[t[9]||(t[9]=(0,o.Lk)("label",{for:"password"},"Password",-1)),(0,o.bo)((0,o.Lk)("input",{id:"password","onUpdate:modelValue":t[3]||(t[3]=e=>w.password=e),type:"password",placeholder:"Enter your password",required:"",disabled:w.loading,onInput:t[4]||(t[4]=(...e)=>y.clearError&&y.clearError(...e))},null,40,p),[[s.Jo,w.password]])]),w.error?((0,o.uX)(),(0,o.CE)("div",u,(0,n.v_)(w.error),1)):(0,o.Q3)("",!0),(0,o.Lk)("button",{type:"submit",class:"login-btn",disabled:w.loading},[w.loading?((0,o.uX)(),(0,o.CE)("span",f,"Signing in...")):((0,o.uX)(),(0,o.CE)("span",g,"Sign In"))],8,m)],32)])])])):(0,o.Q3)("",!0)}var w=i(6494),y=i(96763),b={name:"LoginModal",components:{X:w.A},props:{visible:{type:Boolean,default:!1}},data(){return{username:"",password:"",loading:!1,error:"",isFirstLogin:!1}},watch:{username(e){e&&e.match(/^[a-z]{2}\d{4}$/)?this.isFirstLogin=!0:this.isFirstLogin=!1}},methods:{async handleLogin(){this.loading=!0,this.error="";try{const e="/api/login",t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.username,password:this.password})}),i=await t.json();i.success?(localStorage.setItem("session_id",i.session_id),localStorage.setItem("username",i.username),localStorage.setItem("role",i.role),localStorage.setItem("full_name",i.full_name),this.$emit("login-success",{username:i.username,role:i.role,full_name:i.full_name,session_id:i.session_id}),this.close(),window.location.reload()):this.error=i.error||"Invalid username or password"}catch(Dr){y.error("Login error:",Dr),this.error="Connection error. Please try again."}finally{this.loading=!1}},clearError(){this.error=""},close(){this.username="",this.password="",this.error="",this.loading=!1,this.$emit("close")},async validateSession(e){try{const t="/api/validate-session",i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:e})}),o=await i.json();o.success||(localStorage.removeItem("session_id"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("full_name"))}catch(Dr){y.error("Session validation error:",Dr)}}},mounted(){const e=localStorage.getItem("session_id");e&&this.validateSession(e)}},k=i(66262);const I=(0,k.A)(b,[["render",v],["__scopeId","data-v-f34a53b2"]]);var P=I,S=i(5012),C=i(42496),L=i(64481),F=i(28643);const E={class:"file-browser-content"},x={class:"current-path"},D={class:"path-value"},R={class:"file-tree-container"},T={class:"node-item"},$=["src"],j={class:"node-label"},N={key:0,class:"selected-file"},M={class:"selected-value"},A={key:1,class:"selected-file"},_={class:"selected-value"},U={class:"dialog-footer"};function O(e,t,i,s,a,r){const l=F.qk,d=L.S2,c=C.kZ;return(0,o.uX)(),(0,o.Wv)(c,{title:r.title,modelValue:r.visible,"onUpdate:modelValue":t[0]||(t[0]=e=>r.visible=e),width:"600px","close-on-click-modal":!1,onClose:r.handleClose,class:"file-browser-dialog custom-dialog"},{footer:(0,o.k6)(()=>[(0,o.Lk)("div",U,[(0,o.bF)(d,{onClick:r.handleClose},{default:(0,o.k6)(()=>t[4]||(t[4]=[(0,o.eW)("Cancel",-1)])),_:1,__:[4]},8,["onClick"]),(0,o.bF)(d,{type:"primary",onClick:r.handleConfirm,disabled:!r.canConfirm},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(r.confirmButtonText),1)]),_:1},8,["onClick","disabled"])])]),default:(0,o.k6)(()=>[(0,o.Lk)("div",E,[(0,o.Lk)("div",x,[t[1]||(t[1]=(0,o.Lk)("span",{class:"path-label"},"Current Path:",-1)),(0,o.Lk)("span",D,(0,n.v_)(a.currentPath||"/"),1)]),(0,o.Lk)("div",R,[(0,o.bF)(l,{data:r.treeData,props:a.treeProps,"node-key":"path","expand-on-click-node":!1,"default-expanded-keys":a.expandedKeys,"highlight-current":"",onNodeClick:r.handleNodeClick,onNodeExpand:r.handleNodeExpand,onNodeCollapse:r.handleNodeCollapse,ref:"fileTree"},{default:(0,o.k6)(({node:e,data:t})=>[(0,o.Lk)("span",T,[(0,o.Lk)("img",{src:r.getIconUrl(t),alt:"",class:"node-icon"},null,8,$),(0,o.Lk)("span",j,(0,n.v_)(e.label),1)])]),_:1},8,["data","props","default-expanded-keys","onNodeClick","onNodeExpand","onNodeCollapse"])]),"open"===i.mode?((0,o.uX)(),(0,o.CE)("div",N,[t[2]||(t[2]=(0,o.Lk)("span",{class:"selected-label"},"Selected File:",-1)),(0,o.Lk)("span",M,(0,n.v_)(a.selectedFile?a.selectedFile.label:"None"),1)])):(0,o.Q3)("",!0),"move"===i.mode?((0,o.uX)(),(0,o.CE)("div",A,[t[3]||(t[3]=(0,o.Lk)("span",{class:"selected-label"},"Move to:",-1)),(0,o.Lk)("span",_,(0,n.v_)(a.selectedFolder?a.selectedFolder.path:"/"),1)])):(0,o.Q3)("",!0)])]),_:1},8,["title","modelValue","onClose"])}i(44114),i(18111),i(22489),i(7588),i(61701);var W=i(53793),V=i(96763),z={name:"DialogFileBrowser",props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"open",validator:e=>["open","move"].includes(e)},fileToMove:{type:Object,default:null},currentUser:{type:Object,default:null}},data(){return{selectedFile:null,selectedFolder:null,currentPath:"/",expandedKeys:[],treeProps:{label:"label",children:"children"}}},computed:{visible:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},title(){return"open"===this.mode?"Open File":"Move File"},confirmButtonText(){return"open"===this.mode?"Open":"Move"},canConfirm(){return"open"===this.mode?null!==this.selectedFile:"move"===this.mode&&(null!==this.selectedFolder&&this.fileToMove&&this.selectedFolder.path!==this.getParentPath(this.fileToMove.path))},ideInfo(){return this.$store?.state?.ide?.ideInfo||{}},treeData(){let e;return e=this.ideInfo.multiRootData&&this.ideInfo.multiRootData.children.length>0?this.ideInfo.multiRootData.children:this.ideInfo.currProj.data?[this.ideInfo.currProj.data]:[],"move"===this.mode&&(e=this.filterOutFile(e),e=this.filterByPermissions(e)),e},isStudent(){return this.currentUser&&"student"===this.currentUser.role},studentDirectory(){return this.isStudent&&this.currentUser?.username?`Local/${this.currentUser.username}`:null}},methods:{getIconUrl(e){try{if("file"===e.type){const t=e.path.substring(e.path.lastIndexOf(".")+1);return i(80238)(`./${(0,W.ry)(t)}`)}if("dir"===e.type||"folder"===e.type){const t=this.expandedKeys.includes(e.path),o=t?(0,W.vT)(e.label):(0,W.lM)(e.label);return i(80238)(`./${o}`)}}catch(t){return"file"===e.type?i(77844):i(67734)}},handleNodeClick(e){if("open"===this.mode)"file"===e.type?(this.selectedFile=e,this.currentPath=e.path):this.expandedKeys.includes(e.path)?this.handleNodeCollapse(e):this.handleNodeExpand(e);else if("move"===this.mode&&("dir"===e.type||"folder"===e.type)){if(this.currentUser&&this.isStudent&&!this.canAccessPath(e.path))return void this.$message.warning("You can only move files within your personal directory");this.selectedFolder=e,this.currentPath=e.path}},handleNodeExpand(e){this.expandedKeys.includes(e.path)||this.expandedKeys.push(e.path)},handleNodeCollapse(e){const t=this.expandedKeys.indexOf(e.path);t>-1&&this.expandedKeys.splice(t,1)},handleConfirm(){if(V.log("[DialogFileBrowser] handleConfirm called:",{mode:this.mode,selectedFile:this.selectedFile,selectedFolder:this.selectedFolder,fileToMove:this.fileToMove}),"open"===this.mode&&this.selectedFile)V.log("[DialogFileBrowser] Opening file:",this.selectedFile.path),this.$emit("open-file",this.selectedFile.path),this.handleClose();else if("move"===this.mode&&this.selectedFolder&&this.fileToMove){const e=this.getFileName(this.fileToMove.path),t=this.selectedFolder.path.endsWith("/")?this.selectedFolder.path+e:this.selectedFolder.path+"/"+e;V.log("[DialogFileBrowser] Moving file - DETAILED DEBUG:",{mode:this.mode,oldPath:this.fileToMove.path,newPath:t,selectedFolderPath:this.selectedFolder.path,fileName:e,fileToMove:this.fileToMove,selectedFolder:this.selectedFolder,projectName:this.fileToMove.projectName||this.ideInfo.currProj?.data?.name}),this.$emit("move-file",{oldPath:this.fileToMove.path,newPath:t,projectName:this.fileToMove.projectName||this.ideInfo.currProj?.data?.name}),this.handleClose()}else V.log("[DialogFileBrowser] Cannot confirm - missing requirements:",{mode:this.mode,hasSelectedFile:!!this.selectedFile,hasSelectedFolder:!!this.selectedFolder,hasFileToMove:!!this.fileToMove,canConfirm:this.canConfirm})},handleClose(){this.selectedFile=null,this.selectedFolder=null,this.currentPath="/",this.expandedKeys=[],this.$emit("update:modelValue",!1)},getParentPath(e){const t=e.lastIndexOf("/");return t>0?e.substring(0,t):"/"},getFileName(e){const t=e.lastIndexOf("/");return t>=0?e.substring(t+1):e},filterOutFile(e){return this.fileToMove?e.map(e=>e.path===this.fileToMove.path?null:e.children&&e.children.length>0?{...e,children:this.filterOutFile(e.children).filter(Boolean)}:e).filter(Boolean):e},filterByPermissions(e){return this.isStudent?e.map(e=>this.canAccessPath(e.path)?e.children&&e.children.length>0?{...e,children:this.filterByPermissions(e.children)}:e:null).filter(Boolean):e},canAccessPath(e){return!this.isStudent||!(!e||!this.studentDirectory)&&(e===this.studentDirectory||e.startsWith(this.studentDirectory+"/"))}},watch:{visible(e){e&&(this.selectedFile=null,this.selectedFolder=null,this.currentPath="/",this.expandedKeys=[],this.$nextTick(()=>{this.treeData&&this.treeData.length>0&&this.treeData.forEach(e=>{"dir"!==e.type&&"folder"!==e.type||!e.path||this.expandedKeys.push(e.path)})}))}}};const B=(0,k.A)(z,[["render",O]]);var X=B;const H={class:"bulk-upload-dialog"},K={class:"dialog-header"},G={class:"dialog-body"},Q={class:"students-section"},J={class:"target-selection"},q={key:0,class:"specific-students"},Y={class:"student-list"},Z=["onClick"],ee=["checked","onChange"],te={class:"student-info"},ie={class:"username"},oe={class:"fullname"},se={class:"selection-summary"},ne={class:"folder-section"},ae={class:"folder-input-group"},re={class:"path-preview"},le={class:"upload-section"},de={class:"upload-mode-toggle"},ce={class:"upload-icon"},he={class:"upload-text"},pe={class:"main-text"},ue={key:0,class:"error-hint"},me={key:0,class:"preview-section"},fe={class:"files-preview"},ge=["src"],ve={class:"file-name"},we={class:"file-size"},ye={key:0,class:"more-files"},be={class:"dialog-footer"},ke=["disabled"];function Ie(e,t,i,a,r,l){const d=(0,o.g2)("X"),c=(0,o.g2)("Users"),h=(0,o.g2)("UserCheck"),p=(0,o.g2)("Upload");return(0,o.uX)(),(0,o.CE)("div",null,[t[24]||(t[24]=(0,o.Lk)("div",{class:"dialog-cover"},null,-1)),(0,o.Lk)("div",H,[(0,o.Lk)("div",K,[t[16]||(t[16]=(0,o.Lk)("h3",null,"Bulk Upload to Students",-1)),(0,o.Lk)("div",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>l.onCancel&&l.onCancel(...e))},[(0,o.bF)(d,{size:20})])]),(0,o.Lk)("div",G,[(0,o.Lk)("div",Q,[t[18]||(t[18]=(0,o.Lk)("label",null,"Upload To:",-1)),(0,o.Lk)("div",J,[(0,o.Lk)("button",{class:(0,n.C4)([{active:"all"===r.targetMode},"target-btn"]),onClick:t[1]||(t[1]=e=>r.targetMode="all")},[(0,o.bF)(c,{size:16}),(0,o.eW)(" All Students ("+(0,n.v_)(l.totalStudents)+") ",1)],2),(0,o.Lk)("button",{class:(0,n.C4)([{active:"specific"===r.targetMode},"target-btn"]),onClick:t[2]||(t[2]=e=>r.targetMode="specific")},[(0,o.bF)(h,{size:16}),t[17]||(t[17]=(0,o.eW)(" Specific Students ",-1))],2)]),"specific"===r.targetMode?((0,o.uX)(),(0,o.CE)("div",q,[(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=e=>r.studentSearch=e),placeholder:"Search students...",class:"search-input"},null,512),[[s.Jo,r.studentSearch]]),(0,o.Lk)("div",Y,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.filteredStudents,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.username,class:(0,n.C4)(["student-item",{selected:l.isStudentSelected(e.username)}]),onClick:t=>l.toggleStudent(e.username)},[(0,o.Lk)("input",{type:"checkbox",checked:l.isStudentSelected(e.username),onChange:(0,s.D$)(t=>l.toggleStudent(e.username),["stop"])},null,40,ee),(0,o.Lk)("div",te,[(0,o.Lk)("span",ie,(0,n.v_)(e.username),1),(0,o.Lk)("span",oe,(0,n.v_)(e.full_name),1)])],10,Z))),128))]),(0,o.Lk)("div",se," Selected: "+(0,n.v_)(r.selectedStudents.length)+" student(s) ",1)])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",ne,[t[21]||(t[21]=(0,o.Lk)("label",null,"Destination Folder (optional - leave empty for root):",-1)),(0,o.Lk)("div",ae,[(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>r.commonFolder=e),placeholder:"Leave empty for root, or e.g., Examples",class:"folder-input"},null,512),[[s.Jo,r.commonFolder]]),t[19]||(t[19]=(0,o.Lk)("span",{class:"path-separator"},"/",-1)),(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=e=>r.subPath=e),placeholder:"e.g., Week1 (optional)",class:"folder-input"},null,512),[[s.Jo,r.subPath]])]),(0,o.Lk)("div",re,[t[20]||(t[20]=(0,o.eW)(" Path: ",-1)),(0,o.Lk)("code",null,"Local/<username>/"+(0,n.v_)(l.previewPath),1)])]),(0,o.Lk)("div",le,[t[23]||(t[23]=(0,o.Lk)("label",null,"Select Files or Folder:",-1)),(0,o.Lk)("div",de,[(0,o.Lk)("button",{class:(0,n.C4)([{active:"files"===r.uploadMode},"mode-btn"]),onClick:t[6]||(t[6]=e=>l.switchUploadMode("files"))}," Files ",2),(0,o.Lk)("button",{class:(0,n.C4)([{active:"folder"===r.uploadMode},"mode-btn"]),onClick:t[7]||(t[7]=e=>l.switchUploadMode("folder"))}," Folder ",2)]),(0,o.Lk)("div",{class:(0,n.C4)(["file-drop-area",{"drag-over":r.dragOver}]),onDrop:t[10]||(t[10]=(...e)=>l.handleDrop&&l.handleDrop(...e)),onDragover:t[11]||(t[11]=(0,s.D$)(e=>r.dragOver=!0,["prevent"])),onDragleave:t[12]||(t[12]=(0,s.D$)(e=>r.dragOver=!1,["prevent"])),onClick:t[13]||(t[13]=(...e)=>l.triggerFileInput&&l.triggerFileInput(...e))},["files"===r.uploadMode?((0,o.uX)(),(0,o.CE)("input",{key:0,type:"file",ref:"fileInput",onChange:t[8]||(t[8]=(...e)=>l.handleFileSelect&&l.handleFileSelect(...e)),multiple:"",accept:".py,.txt,.csv,.pdf",style:{display:"none"}},null,544)):((0,o.uX)(),(0,o.CE)("input",{key:1,type:"file",ref:"folderInput",onChange:t[9]||(t[9]=(...e)=>l.handleFolderSelect&&l.handleFolderSelect(...e)),webkitdirectory:"",directory:"",multiple:"",style:{display:"none"}},null,544)),(0,o.Lk)("div",ce,[(0,o.bF)(p,{size:48})]),(0,o.Lk)("div",he,[(0,o.Lk)("div",pe,(0,n.v_)("files"===r.uploadMode?"Click to select files or drag and drop":"Click to select folder or drag and drop"),1),t[22]||(t[22]=(0,o.Lk)("div",{class:"sub-text"}," Supported formats: .py, .txt, .csv, .pdf ",-1))])],34),r.uploadError?((0,o.uX)(),(0,o.CE)("div",ue,(0,n.v_)(r.uploadError),1)):(0,o.Q3)("",!0)]),r.selectedFiles.length>0?((0,o.uX)(),(0,o.CE)("div",me,[(0,o.Lk)("label",null,"Files to Upload ("+(0,n.v_)(r.selectedFiles.length)+"):",1),(0,o.Lk)("div",fe,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.selectedFiles.slice(0,5),(e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:t,class:"file-preview-item"},[(0,o.Lk)("img",{src:l.getFileIcon(e.name),alt:"",class:"file-icon"},null,8,ge),(0,o.Lk)("span",ve,(0,n.v_)(e.name),1),(0,o.Lk)("span",we,(0,n.v_)(l.formatFileSize(e.size)),1)]))),128)),r.selectedFiles.length>5?((0,o.uX)(),(0,o.CE)("div",ye," + "+(0,n.v_)(r.selectedFiles.length-5)+" more files ",1)):(0,o.Q3)("",!0)])])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",be,[(0,o.Lk)("button",{class:"btn-cancel",onClick:t[14]||(t[14]=(...e)=>l.onCancel&&l.onCancel(...e))},"Cancel"),(0,o.Lk)("button",{class:"btn-upload",onClick:t[15]||(t[15]=(...e)=>l.onBulkUpload&&l.onBulkUpload(...e)),disabled:!l.canUpload||r.uploading},(0,n.v_)(r.uploading?"Uploading...":`Upload to ${l.targetCount} Student(s)`),9,ke)])])])}i(18237);var Pe=i(75365),Se=i(86774),Ce=i(53957);
/**
 * @license lucide-vue-next v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const Le=(0,Ce.A)("user-check",[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);var Fe=i(74829),Ee=i(16990),xe=i(96763),De={props:{modelValue:Boolean},data(){return{targetMode:"all",selectedStudents:[],studentSearch:"",allStudents:[],commonFolder:"",subPath:"",uploadMode:"files",selectedFiles:[],fileStructure:[],uploadError:"",uploading:!1,dragOver:!1,supportedExtensions:[".py",".txt",".csv",".pdf"]}},computed:{currentUser(){const e=localStorage.getItem("session_id"),t=localStorage.getItem("username"),i=localStorage.getItem("role");return e&&t?{session_id:e,username:t,role:i}:null},filteredStudents(){if(!this.studentSearch)return this.allStudents;const e=this.studentSearch.toLowerCase();return this.allStudents.filter(t=>t.username.toLowerCase().includes(e)||t.full_name.toLowerCase().includes(e))},totalStudents(){return this.allStudents.length},targetCount(){return"all"===this.targetMode?this.totalStudents:this.selectedStudents.length},previewPath(){const e=this.commonFolder.trim(),t=this.subPath.trim();return e&&t?`${e}/${t}/`:e?`${e}/`:t?`${t}/`:"(root directory)"},canUpload(){const e=this.selectedFiles.length>0,t="all"===this.targetMode||this.selectedStudents.length>0;return e&&t}},components:{X:w.A,Upload:Pe.A,Users:Se.A,UserCheck:Le,FolderOpen:Fe.A},mounted(){this.loadAllStudents()},methods:{async loadAllStudents(){try{const e=await fetch("/api/get-all-students",{method:"GET",headers:{"session-id":this.currentUser?.session_id}}),t=await e.json();if(!t.success)throw new Error(t.error||"Failed to fetch students");this.allStudents=t.students,xe.log(`[BulkUpload] Loaded ${t.count} students`)}catch(Dr){xe.error("[BulkUpload] Error loading students:",Dr),Ee.nk.error("Failed to load student list: "+Dr.message),this.allStudents=[]}},isStudentSelected(e){return this.selectedStudents.includes(e)},toggleStudent(e){const t=this.selectedStudents.indexOf(e);t>-1?this.selectedStudents.splice(t,1):this.selectedStudents.push(e)},switchUploadMode(e){this.uploadMode=e,this.selectedFiles=[],this.fileStructure=[],this.uploadError=""},triggerFileInput(){"files"===this.uploadMode?this.$refs.fileInput?.click():this.$refs.folderInput?.click()},handleFileSelect(e){const t=Array.from(e.target.files);this.processFiles(t)},handleFolderSelect(e){const t=Array.from(e.target.files);this.processFolderFiles(t)},handleDrop(e){e.preventDefault(),this.dragOver=!1;const t=e.dataTransfer.items;if(t){const e=[],i=[];for(let o=0;o<t.length;o++){const s=t[o].webkitGetAsEntry();s&&i.push(this.traverseFileTree(s,e))}Promise.all(i).then(()=>{if(e.length>0){const t=e.some(e=>e.webkitRelativePath);t||"folder"===this.uploadMode?this.processFolderFiles(e):this.processFiles(e)}})}else{const t=Array.from(e.dataTransfer.files);this.processFiles(t)}},async traverseFileTree(e,t,i=""){if(e.isFile)return new Promise(o=>{e.file(e=>{e.relativePath=i+e.name,t.push(e),o()})});if(e.isDirectory){const o=e.createReader();return new Promise(s=>{o.readEntries(async o=>{for(const s of o)await this.traverseFileTree(s,t,i+e.name+"/");s()})})}},processFiles(e){this.uploadError="";const t=[],i=[];e.forEach(e=>{const o="."+e.name.split(".").pop().toLowerCase();this.supportedExtensions.includes(o)?e.size<=10485760?t.push(e):i.push(`${e.name} (too large)`):i.push(`${e.name} (unsupported)`)}),i.length>0&&(this.uploadError=`Invalid files: ${i.join(", ")}`),this.selectedFiles=t},processFolderFiles(e){this.uploadError="";const t=[],i=[];this.fileStructure=[],e.forEach(e=>{const o="."+e.name.split(".").pop().toLowerCase(),s=e.webkitRelativePath||e.relativePath||e.name;this.supportedExtensions.includes(o)&&(e.size<=10485760?(t.push(e),this.fileStructure.push({file:e,relativePath:s,name:e.name,size:e.size})):i.push(`${s} (too large)`))}),i.length>0&&(this.uploadError=`Invalid files: ${i.join(", ")}`),this.selectedFiles=t,0===this.selectedFiles.length&&e.length>0&&(this.uploadError="No supported files found in the selected folder")},formatFileSize(e){if(0===e)return"0 Bytes";const t=1024,i=["Bytes","KB","MB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+i[o]},getFileIcon(e){const t=e.substring(e.lastIndexOf(".")+1);return i(80238)(`./${(0,W.ry)(t)}`)},async onBulkUpload(){if(this.canUpload){this.uploading=!0;try{const e="all"===this.targetMode?"all":JSON.stringify(this.selectedStudents),t=this.selectedFiles.map(async(t,i)=>{const o=new FormData;if(o.append("file",t),o.append("targetStudents",e),o.append("commonFolder",this.commonFolder),o.append("subPath",this.subPath||""),o.append("filename",t.name),"folder"===this.uploadMode&&this.fileStructure[i]){const e=this.fileStructure[i].relativePath;o.append("relativePath",e),o.append("preserveStructure","true")}const s=await fetch("/api/bulk-upload",{method:"POST",body:o,headers:{"session-id":this.currentUser?.session_id}}),n=await s.json();if(!n.success)throw new Error(`Failed to upload ${t.name}: ${n.error}`);return n}),i=await Promise.all(t),o=i.reduce((e,t)=>e+t.uploaded_to,0),s=Math.round(o/i.length);Ee.nk.success(`Successfully uploaded ${this.selectedFiles.length} file(s) to ${s} students`),this.$emit("update:modelValue",!1)}catch(Dr){xe.error("[BulkUpload] Error:",Dr),Ee.nk.error("Failed to upload files: "+Dr.message)}finally{this.uploading=!1}}},onCancel(){this.$emit("update:modelValue",!1)}}};const Re=(0,k.A)(De,[["render",Ie],["__scopeId","data-v-6215f3ba"]]);var Te=Re;const $e={class:"import-file-dialog"},je={class:"dialog-header"},Ne={class:"dialog-body"},Me={class:"directory-section"},Ae={class:"directory-nav"},_e={key:0,class:"directory-tree"},Ue=["onClick"],Oe={class:"upload-section"},We={class:"upload-mode-toggle"},Ve={class:"upload-icon"},ze={class:"upload-text"},Be={class:"main-text"},Xe={class:"sub-text"},He={key:0,class:"error-hint"},Ke={key:0,class:"selected-files-section"},Ge={class:"selected-files-list"},Qe={class:"file-info"},Je=["src"],qe={class:"file-details"},Ye={class:"file-name"},Ze={class:"file-size"},et=["onClick"],tt={key:1,class:"preview-section"},it={class:"import-preview"},ot={class:"destination-info"},st={class:"destination-path"},nt={class:"file-count"},at={class:"dialog-footer"},rt=["disabled"];function lt(e,t,i,a,r,l){const d=(0,o.g2)("X"),c=(0,o.g2)("FolderOpen"),h=(0,o.g2)("ChevronDown"),p=(0,o.g2)("ChevronRight"),u=(0,o.g2)("Home"),m=(0,o.g2)("Folder"),f=(0,o.g2)("Upload");return(0,o.uX)(),(0,o.CE)("div",null,[t[16]||(t[16]=(0,o.Lk)("div",{class:"dialog-cover"},null,-1)),(0,o.Lk)("div",$e,[(0,o.Lk)("div",je,[t[12]||(t[12]=(0,o.Lk)("h3",null,"Import Files",-1)),(0,o.Lk)("div",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>l.onCancel&&l.onCancel(...e))},[(0,o.bF)(d,{size:20})])]),(0,o.Lk)("div",Ne,[(0,o.Lk)("div",Me,[t[13]||(t[13]=(0,o.Lk)("label",null,"Select Destination Directory:",-1)),(0,o.Lk)("div",Ae,[(0,o.Lk)("div",{class:"current-path",onClick:t[1]||(t[1]=(...e)=>l.toggleDirectoryTree&&l.toggleDirectoryTree(...e))},[(0,o.bF)(c,{size:16}),(0,o.Lk)("span",null,(0,n.v_)(l.formatCurrentPath(r.currentPath)),1),r.showDirectoryTree?((0,o.uX)(),(0,o.Wv)(h,{key:0,size:16,class:"chevron"})):((0,o.uX)(),(0,o.Wv)(p,{key:1,size:16,class:"chevron"}))]),r.showDirectoryTree?((0,o.uX)(),(0,o.CE)("div",_e,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.directories,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.path,class:(0,n.C4)(["directory-item",{selected:r.currentPath===e.path,"root-item":e.isRoot}]),style:(0,n.Tr)({paddingLeft:20*e.level+12+"px"}),onClick:t=>l.selectDirectory(e)},[e.isRoot?((0,o.uX)(),(0,o.Wv)(u,{key:0,size:14})):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.bF)(p,{size:14}),(0,o.bF)(m,{size:14})],64)),(0,o.Lk)("span",null,(0,n.v_)(e.displayName||e.name),1)],14,Ue))),128))])):(0,o.Q3)("",!0)])]),(0,o.Lk)("div",Oe,[t[14]||(t[14]=(0,o.Lk)("label",null,"Select Files or Folder to Import:",-1)),(0,o.Lk)("div",We,[(0,o.Lk)("button",{class:(0,n.C4)([{active:"files"===r.uploadMode},"mode-btn"]),onClick:t[2]||(t[2]=e=>l.switchUploadMode("files"))}," Files ",2),(0,o.Lk)("button",{class:(0,n.C4)([{active:"folder"===r.uploadMode},"mode-btn"]),onClick:t[3]||(t[3]=e=>l.switchUploadMode("folder"))}," Folder ",2)]),(0,o.Lk)("div",{class:(0,n.C4)(["file-drop-area",{"drag-over":r.dragOver}]),onDrop:t[6]||(t[6]=(...e)=>l.handleDrop&&l.handleDrop(...e)),onDragover:t[7]||(t[7]=(0,s.D$)(e=>r.dragOver=!0,["prevent"])),onDragleave:t[8]||(t[8]=(0,s.D$)(e=>r.dragOver=!1,["prevent"])),onClick:t[9]||(t[9]=(...e)=>l.triggerFileInput&&l.triggerFileInput(...e))},["files"===r.uploadMode?((0,o.uX)(),(0,o.CE)("input",{key:0,type:"file",ref:"fileInput",onChange:t[4]||(t[4]=(...e)=>l.handleFileSelect&&l.handleFileSelect(...e)),multiple:"",accept:".py,.txt,.csv,.pdf",style:{display:"none"}},null,544)):((0,o.uX)(),(0,o.CE)("input",{key:1,type:"file",ref:"folderInput",onChange:t[5]||(t[5]=(...e)=>l.handleFolderSelect&&l.handleFolderSelect(...e)),webkitdirectory:"",directory:"",multiple:"",style:{display:"none"}},null,544)),(0,o.Lk)("div",Ve,[(0,o.bF)(f,{size:48})]),(0,o.Lk)("div",ze,[(0,o.Lk)("div",Be,(0,n.v_)("files"===r.uploadMode?"Click to select files or drag and drop":"Click to select folder or drag and drop"),1),(0,o.Lk)("div",Xe,(0,n.v_)("files"===r.uploadMode?"Supported formats: .py, .txt, .csv, .pdf":"All supported files in folder will be uploaded"),1)])],34),r.uploadError?((0,o.uX)(),(0,o.CE)("div",He,(0,n.v_)(r.uploadError),1)):(0,o.Q3)("",!0)]),r.selectedFiles.length>0?((0,o.uX)(),(0,o.CE)("div",Ke,[(0,o.Lk)("label",null,"Selected Files ("+(0,n.v_)(r.selectedFiles.length)+"):",1),(0,o.Lk)("div",Ge,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.selectedFiles,(e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:t,class:"file-item"},[(0,o.Lk)("div",Qe,[(0,o.Lk)("img",{src:l.getFileIcon(e.name),alt:"",class:"file-icon"},null,8,Je),(0,o.Lk)("div",qe,[(0,o.Lk)("div",Ye,(0,n.v_)(e.name),1),(0,o.Lk)("div",Ze,(0,n.v_)(l.formatFileSize(e.size)),1)])]),(0,o.Lk)("button",{class:"remove-btn",onClick:e=>l.removeFile(t),title:"Remove"},[(0,o.bF)(d,{size:16})],8,et)]))),128))])])):(0,o.Q3)("",!0),r.selectedFiles.length>0&&!r.uploadError?((0,o.uX)(),(0,o.CE)("div",tt,[t[15]||(t[15]=(0,o.Lk)("label",null,"Files will be imported to:",-1)),(0,o.Lk)("div",it,[(0,o.Lk)("div",ot,[(0,o.bF)(c,{size:20}),(0,o.Lk)("div",null,[(0,o.Lk)("div",st,(0,n.v_)(l.formatCurrentPath(r.currentPath)),1),(0,o.Lk)("div",nt,(0,n.v_)(r.selectedFiles.length)+" file(s) selected",1)])])])])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",at,[(0,o.Lk)("button",{class:"btn-cancel",onClick:t[10]||(t[10]=(...e)=>l.onCancel&&l.onCancel(...e))},"Cancel"),(0,o.Lk)("button",{class:"btn-import",onClick:t[11]||(t[11]=(...e)=>l.onImport&&l.onImport(...e)),disabled:0===r.selectedFiles.length||r.uploading},(0,n.v_)(r.uploading?"Importing...":`Import ${r.selectedFiles.length} file(s)`),9,rt)])])])}i(13579);var dt=i(27336),ct=i(77950),ht=i(24758),pt=i(51058),ut=i(56660),mt=i(96763),ft={props:{modelValue:Boolean},data(){return{currentPath:"/",currentProject:null,directories:[],selectedFiles:[],uploadError:"",uploading:!1,showDirectoryTree:!1,dragOver:!1,supportedExtensions:[".py",".txt",".csv",".pdf"],uploadMode:"files",fileStructure:[]}},computed:{ideInfo(){return this.$store.state.ide.ideInfo},currentUser(){const e=localStorage.getItem("session_id"),t=localStorage.getItem("username"),i=localStorage.getItem("role"),o=localStorage.getItem("full_name");return e&&t?{session_id:e,username:t,role:i,full_name:o}:null}},components:{X:w.A,FolderOpen:Fe.A,Folder:dt.A,ChevronRight:ct.A,ChevronDown:ht.A,Upload:Pe.A,Home:pt.A},mounted(){this.loadDirectoryStructure()},methods:{loadDirectoryStructure(){if(this.ideInfo.multiRootData&&this.ideInfo.multiRootData.children.length>0?(this.directories=[],this.ideInfo.multiRootData.children.forEach(e=>{const t=this.buildDirectoryTree(e,0,e.label);this.directories=this.directories.concat(t)})):this.ideInfo.currProj&&this.ideInfo.currProj.data&&(this.directories=this.buildDirectoryTree(this.ideInfo.currProj.data,0,this.ideInfo.currProj.data.label)),this.ideInfo.nodeSelected){if("dir"===this.ideInfo.nodeSelected.type||"folder"===this.ideInfo.nodeSelected.type)this.currentPath=this.ideInfo.nodeSelected.path,this.currentProject=this.ideInfo.nodeSelected.projectName||this.ideInfo.currProj?.data?.name;else if("file"===this.ideInfo.nodeSelected.type){const e=this.ideInfo.nodeSelected.path.substring(0,this.ideInfo.nodeSelected.path.lastIndexOf("/"))||"/";this.currentPath=e,this.currentProject=this.ideInfo.nodeSelected.projectName||this.ideInfo.currProj?.data?.name}}else this.currentProject=this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name},buildDirectoryTree(e,t=0,i=null){let o=[];return 0===t&&o.push({name:i||e.label||"/",displayName:i||e.label||"/",path:e.path||"/",level:0,isRoot:!0,projectName:i||e.label,fullPath:i?`${i}${e.path}`:e.path}),e.children&&e.children.forEach(e=>{"dir"!==e.type&&"folder"!==e.type||(o.push({name:e.label,displayName:e.label,path:e.path,level:t+1,isRoot:!1,projectName:i||e.projectName,fullPath:i?`${i}${e.path}`:e.path}),e.children&&(o=o.concat(this.buildDirectoryTree(e,t+1,i))))}),o},selectDirectory(e){this.currentPath=e.path,this.currentProject=e.projectName,this.showDirectoryTree=!1},toggleDirectoryTree(){this.showDirectoryTree=!this.showDirectoryTree},formatCurrentPath(e){if(this.currentProject)return"/"===e?this.currentProject:e.startsWith(this.currentProject)?e:this.currentProject+e;if("/"===e&&this.ideInfo.currProj)return this.ideInfo.currProj.data?.label||this.ideInfo.currProj.config?.name;if(e.startsWith("/")&&this.ideInfo.currProj){const t=this.ideInfo.currProj.data?.label||this.ideInfo.currProj.config?.name;return e.includes(t)?e:t+e}return e},switchUploadMode(e){this.uploadMode=e,this.selectedFiles=[],this.fileStructure=[],this.uploadError=""},triggerFileInput(){"files"===this.uploadMode?this.$refs.fileInput?.click():this.$refs.folderInput?.click()},handleFileSelect(e){const t=Array.from(e.target.files);this.processFiles(t)},handleFolderSelect(e){const t=Array.from(e.target.files);this.processFolderFiles(t)},handleDrop(e){e.preventDefault(),this.dragOver=!1;const t=e.dataTransfer.items;if(t){const e=[],i=[];for(let o=0;o<t.length;o++){const s=t[o].webkitGetAsEntry();s&&i.push(this.traverseFileTree(s,e))}Promise.all(i).then(()=>{if(e.length>0){const t=e.some(e=>e.webkitRelativePath);t||"folder"===this.uploadMode?this.processFolderFiles(e):this.processFiles(e)}})}else{const t=Array.from(e.dataTransfer.files);this.processFiles(t)}},async traverseFileTree(e,t,i=""){if(e.isFile)return new Promise(o=>{e.file(e=>{e.relativePath=i+e.name,t.push(e),o()})});if(e.isDirectory){const o=e.createReader();return new Promise(s=>{o.readEntries(async o=>{for(const s of o)await this.traverseFileTree(s,t,i+e.name+"/");s()})})}},processFiles(e){this.uploadError="";const t=[],i=[];e.forEach(e=>{const o="."+e.name.split(".").pop().toLowerCase();this.supportedExtensions.includes(o)?e.size<=10485760?t.push(e):i.push(`${e.name} (file too large, max 10MB)`):i.push(`${e.name} (unsupported format)`)}),i.length>0&&(this.uploadError=`Invalid files: ${i.join(", ")}`),t.forEach(e=>{const t=this.selectedFiles.some(t=>t.name===e.name&&t.size===e.size);t||this.selectedFiles.push(e)})},processFolderFiles(e){this.uploadError="";const t=[],i=[];this.fileStructure=[],e.forEach(e=>{const o="."+e.name.split(".").pop().toLowerCase(),s=e.webkitRelativePath||e.relativePath||e.name;this.supportedExtensions.includes(o)?e.size<=10485760?(t.push(e),this.fileStructure.push({file:e,relativePath:s,name:e.name,size:e.size})):i.push(`${s} (file too large, max 10MB)`):mt.log(`Skipping unsupported file: ${s}`)}),i.length>0&&(this.uploadError=`Invalid files: ${i.join(", ")}`),this.selectedFiles=t,0===this.selectedFiles.length&&e.length>0&&(this.uploadError="No supported files found in the selected folder")},removeFile(e){this.selectedFiles.splice(e,1),0===this.selectedFiles.length&&(this.uploadError="")},formatFileSize(e){if(0===e)return"0 Bytes";const t=1024,i=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+i[o]},getFileIcon(e){const t=e.substring(e.lastIndexOf(".")+1);return i(80238)(`./${(0,W.ry)(t)}`)},async onImport(){if(0===this.selectedFiles.length)return;this.uploading=!0;const e=this.currentProject||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name;let t=this.currentPath;t&&e&&t.startsWith(e)&&(t=t.substring(e.length)||"/"),t&&!t.startsWith("/")&&(t="/"+t),mt.log("[DialogImportFile] Upload params:",{projectName:e,rawCurrentPath:this.currentPath,cleanedParentPath:t,uploadMode:this.uploadMode,fileCount:this.selectedFiles.length});try{const i=this.selectedFiles.map(async(i,o)=>{const s=new FormData;if(s.append("file",i),s.append("projectName",e),s.append("parentPath",t),s.append("filename",i.name),"folder"===this.uploadMode&&this.fileStructure[o]){const e=this.fileStructure[o].relativePath;s.append("relativePath",e),s.append("preserveStructure","true"),mt.log("[DialogImportFile] Folder upload:",{filename:i.name,relativePath:e})}const n=await fetch("/api/upload-file",{method:"POST",body:s,headers:{"session-id":this.currentUser?.session_id}}),a=await n.json();if(!a.success)throw new Error(`Failed to upload ${i.name}: ${a.error}`);return a});await Promise.all(i),Ee.nk.success(`Successfully imported ${this.selectedFiles.length} file(s)`),this.$store.dispatch(`ide/${ut.QQ}`,{projectName:e,callback:e=>{0===e.code&&(this.$store.commit("ide/handleProject",e.data),this.ideInfo.multiRootData&&this.$parent.loadAllDefaultProjects?.())}}),this.$emit("files-imported",{count:this.selectedFiles.length,destination:this.currentPath,projectName:e}),this.$emit("update:modelValue",!1)}catch(Dr){mt.error("[DialogImportFile] Error importing files:",Dr),Ee.nk.error("Failed to import files: "+Dr.message)}finally{this.uploading=!1}},onCancel(){this.$emit("update:modelValue",!1)}}};const gt=(0,k.A)(ft,[["render",lt],["__scopeId","data-v-5cc52b6a"]]);var vt=gt;const wt={class:"new-folder-dialog"},yt={class:"dialog-header"},bt={class:"dialog-body"},kt={class:"directory-section"},It={class:"directory-nav"},Pt={key:0,class:"directory-tree"},St=["onClick"],Ct={key:1,class:"folder-spacer"},Lt={class:"foldername-section"},Ft={class:"foldername-input-wrapper"},Et={class:"folder-type-icon"},xt={key:0,class:"error-hint"},Dt={key:1,class:"folder-hint"},Rt={key:0,class:"preview-section"},Tt={class:"folder-preview"},$t={class:"folder-info"},jt={class:"folder-path"},Nt={class:"dialog-footer"},Mt=["disabled"];function At(e,t,i,a,r,l){const d=(0,o.g2)("X"),c=(0,o.g2)("FolderOpen"),h=(0,o.g2)("ChevronDown"),p=(0,o.g2)("ChevronRight"),u=(0,o.g2)("Home"),m=(0,o.g2)("FolderPlus"),f=(0,o.g2)("Folder");return(0,o.uX)(),(0,o.CE)("div",null,[t[11]||(t[11]=(0,o.Lk)("div",{class:"dialog-cover"},null,-1)),(0,o.Lk)("div",wt,[(0,o.Lk)("div",yt,[t[6]||(t[6]=(0,o.Lk)("h3",null,"New Folder",-1)),(0,o.Lk)("div",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>l.onCancel&&l.onCancel(...e))},[(0,o.bF)(d,{size:20})])]),(0,o.Lk)("div",bt,[(0,o.Lk)("div",kt,[t[7]||(t[7]=(0,o.Lk)("label",null,"Select Parent Directory:",-1)),(0,o.Lk)("div",It,[(0,o.Lk)("div",{class:"current-path",onClick:t[1]||(t[1]=(...e)=>l.toggleDirectoryTree&&l.toggleDirectoryTree(...e))},[(0,o.bF)(c,{size:16}),(0,o.Lk)("span",null,(0,n.v_)(l.formatCurrentPath(r.currentPath)),1),r.showDirectoryTree?((0,o.uX)(),(0,o.Wv)(h,{key:0,size:16,class:"chevron"})):((0,o.uX)(),(0,o.Wv)(p,{key:1,size:16,class:"chevron"}))]),r.showDirectoryTree?((0,o.uX)(),(0,o.CE)("div",Pt,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.visibleDirectories,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.path,class:(0,n.C4)(["directory-item",{selected:r.currentPath===e.path,"root-item":e.isRoot,collapsible:e.hasChildren,collapsed:l.isCollapsed(e.path)}]),style:(0,n.Tr)({paddingLeft:20*e.level+12+"px"}),onClick:t=>l.selectDirectory(e)},[e.hasChildren?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[l.isCollapsed(e.path)?((0,o.uX)(),(0,o.Wv)(p,{key:1,size:14,class:"folder-chevron",onClick:(0,s.D$)(t=>l.toggleCollapse(e),["stop"])},null,8,["onClick"])):((0,o.uX)(),(0,o.Wv)(h,{key:0,size:14,class:"folder-chevron",onClick:(0,s.D$)(t=>l.toggleCollapse(e),["stop"])},null,8,["onClick"]))],64)):((0,o.uX)(),(0,o.CE)("span",Ct)),e.isRoot&&!e.isRootCreation?((0,o.uX)(),(0,o.Wv)(u,{key:2,size:14})):e.isRootCreation?((0,o.uX)(),(0,o.Wv)(m,{key:3,size:14})):((0,o.uX)(),(0,o.Wv)(f,{key:4,size:14})),(0,o.Lk)("span",null,(0,n.v_)(e.displayName||e.name),1)],14,St))),128))])):(0,o.Q3)("",!0)])]),(0,o.Lk)("div",Lt,[t[8]||(t[8]=(0,o.Lk)("label",null,"Folder Name:",-1)),(0,o.Lk)("div",Ft,[(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>r.folderName=e),onInput:t[3]||(t[3]=(...e)=>l.validateFolderName&&l.validateFolderName(...e)),placeholder:"Enter folder name",class:"foldername-input",ref:"folderNameInput"},null,544),[[s.Jo,r.folderName]]),(0,o.Lk)("div",Et,[(0,o.bF)(f,{size:20})])]),r.folderNameError?((0,o.uX)(),(0,o.CE)("div",xt,(0,n.v_)(r.folderNameError),1)):((0,o.uX)(),(0,o.CE)("div",Dt," Folder names should not contain special characters "))]),r.folderName&&!r.folderNameError?((0,o.uX)(),(0,o.CE)("div",Rt,[t[10]||(t[10]=(0,o.Lk)("label",null,"Folder will be created at:",-1)),(0,o.Lk)("div",Tt,[(0,o.Lk)("div",$t,[(0,o.bF)(f,{size:20}),(0,o.Lk)("div",null,[(0,o.Lk)("div",jt,(0,n.v_)(l.getFullFolderPath()),1),t[9]||(t[9]=(0,o.Lk)("div",{class:"folder-type"},"Directory",-1))])])])])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",Nt,[(0,o.Lk)("button",{class:"btn-cancel",onClick:t[4]||(t[4]=(...e)=>l.onCancel&&l.onCancel(...e))},"Cancel"),(0,o.Lk)("button",{class:"btn-create",onClick:t[5]||(t[5]=(...e)=>l.onCreate&&l.onCreate(...e)),disabled:!r.folderName||!!r.folderNameError||r.creating},(0,n.v_)(r.creating?"Creating...":"Create Folder"),9,Mt)])])])}i(20116),i(17642),i(58004),i(33853),i(45876),i(32475),i(15024),i(31698);var _t=i(79769),Ut=i(96763),Ot={props:{modelValue:Boolean},data(){return{currentPath:"/",currentProject:null,directories:[],folderName:"",folderNameError:"",creating:!1,showDirectoryTree:!1,collapsedFolders:new Set}},components:{X:w.A,FolderOpen:Fe.A,Folder:dt.A,ChevronRight:ct.A,ChevronDown:ht.A,Home:pt.A,FolderPlus:_t.A},mounted(){this.loadDirectoryStructure(),this.$nextTick(()=>{this.$refs.folderNameInput?.focus()})},methods:{isDirectoryVisibleToStudent(e){return this.currentUser&&this.currentUser.role,!0},loadDirectoryStructure(){if(this.ideInfo.multiRootData&&this.ideInfo.multiRootData.children.length>0)this.directories=[],this.ideInfo.multiRootData.children.forEach(e=>{if(this.currentUser&&"student"===this.currentUser.role){const t=`Local/${this.currentUser.username}`;if(!e.label.startsWith("Local/")||e.label!==t)return}const t=this.buildDirectoryTree(e,0,e.label);this.directories=this.directories.concat(t)});else if(this.ideInfo.currProj&&this.ideInfo.currProj.data){const e=this.ideInfo.currProj.data.label||this.ideInfo.currProj.data.name;if(this.currentUser&&"student"===this.currentUser.role){const t=`Local/${this.currentUser.username}`;if(e!==t)return void(this.directories=[])}this.directories=this.buildDirectoryTree(this.ideInfo.currProj.data,0,e)}if(this.currentUser&&"professor"===this.currentUser.role&&this.directories.unshift({name:"../",displayName:"../ (Root Level)",path:"ROOT_LEVEL",level:-1,isRoot:!0,hasChildren:!1,parentPath:"",projectName:"",fullPath:"ROOT_LEVEL",isRootCreation:!0}),this.currentUser&&"student"===this.currentUser.role)this.currentProject=`Local/${this.currentUser.username}`,this.currentPath="/";else if(this.ideInfo.nodeSelected){if("dir"===this.ideInfo.nodeSelected.type||"folder"===this.ideInfo.nodeSelected.type)this.currentPath=this.ideInfo.nodeSelected.path,this.currentProject=this.ideInfo.nodeSelected.projectName||this.ideInfo.currProj?.data?.name;else if("file"===this.ideInfo.nodeSelected.type){const e=this.ideInfo.nodeSelected.path.substring(0,this.ideInfo.nodeSelected.path.lastIndexOf("/"))||"/";this.currentPath=e,this.currentProject=this.ideInfo.nodeSelected.projectName||this.ideInfo.currProj?.data?.name}}else this.currentProject=this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name},buildDirectoryTree(e,t=0,i=null,o=""){let s=[];if(0===t){const t=e.children&&e.children.some(e=>("dir"===e.type||"folder"===e.type)&&this.isDirectoryVisibleToStudent(e.path));s.push({name:i||e.label||"/",displayName:i||e.label||"/",path:e.path||"/",level:0,isRoot:!0,hasChildren:t,parentPath:"",projectName:i||e.label,fullPath:i?`${i}${e.path}`:e.path})}return e.children&&e.children.forEach(n=>{if(("dir"===n.type||"folder"===n.type)&&this.isDirectoryVisibleToStudent(n.path)){const a=n.children&&n.children.some(e=>("dir"===e.type||"folder"===e.type)&&this.isDirectoryVisibleToStudent(e.path)),r=0===t?e.path||"/":o;s.push({name:n.label,displayName:n.label,path:n.path,level:t+1,isRoot:!1,hasChildren:a,parentPath:r,projectName:i||n.projectName,fullPath:i?`${i}${n.path}`:n.path}),n.children&&(s=s.concat(this.buildDirectoryTree(n,t+1,i,n.path)))}}),s},selectDirectory(e){this.currentPath=e.path,this.currentProject=e.projectName,this.showDirectoryTree=!1},toggleDirectoryTree(){this.showDirectoryTree=!this.showDirectoryTree},toggleCollapse(e){e.hasChildren&&(this.collapsedFolders.has(e.path)?this.collapsedFolders.delete(e.path):this.collapsedFolders.add(e.path),this.$forceUpdate())},isCollapsed(e){return this.collapsedFolders.has(e)},isDirectoryVisible(e){if(0===e.level||e.isRoot)return!0;let t=e.parentPath;while(t&&"/"!==t){if(this.collapsedFolders.has(t))return!1;const e=this.directories.find(e=>e.path===t);t=e?e.parentPath:null}return!0},formatCurrentPath(e){if("ROOT_LEVEL"===this.currentPath)return"../ (Root Level)";if(e&&"/"!==e){const t=["Local","Lecture Notes"];for(let i of t)if(e.startsWith(i))return e}if(this.currentProject)return"/"===e?this.currentUser&&"student"===this.currentUser.role&&"Local"===this.currentProject?`Local/${this.currentUser.username}`:this.currentProject:e.startsWith(this.currentProject)?e:this.currentProject+e;if("/"===e&&this.ideInfo.currProj)return this.ideInfo.currProj.data?.label||this.ideInfo.currProj.config?.name;if(e.startsWith("/")&&this.ideInfo.currProj){const t=this.ideInfo.currProj.data?.label||this.ideInfo.currProj.config?.name;return e.includes(t)?e:t+e}return e},validateFolderName(){if(this.folderNameError="",!this.folderName)return;if(/[<>:"|?*\\\/]/.test(this.folderName))return void(this.folderNameError="Folder name contains invalid characters");const e=["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"],t=this.folderName.toUpperCase();e.includes(t)?this.folderNameError="This is a reserved folder name":this.folderName.startsWith(".")||this.folderName.endsWith(".")?this.folderNameError="Folder name cannot start or end with a dot":this.folderName.length>255&&(this.folderNameError="Folder name is too long")},getFullFolderPath(){const e=this.folderName||"new_folder";if("ROOT_LEVEL"===this.currentPath)return`${e} (at root level)`;const t="/"===this.currentPath?`/${e}`:`${this.currentPath}/${e}`;return this.formatCurrentPath(t)},async onCreate(){if(this.folderName&&!this.folderNameError){this.creating=!0;try{const e=this.folderName;let t=this.currentPath,i=this.currentProject||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name;const o="ROOT_LEVEL"===t;o||this.currentUser&&"student"===this.currentUser.role&&"Local"===i&&("/"===t||t===`Local/${this.currentUser.username}`?(t=`Local/${this.currentUser.username}`,i=""):(t.startsWith(`Local/${this.currentUser.username}/`)||(t=`Local/${this.currentUser.username}${"/"===t?"":t}`),i=""));const s=o?"":t,n=o?"":i;Ut.log("[DialogNewFolder] ========== FOLDER CREATION DEBUG =========="),Ut.log("[DialogNewFolder] Input values:",{folderName:e,parentPath:t,projectName:i,"this.currentPath":this.currentPath,"this.currentProject":this.currentProject}),Ut.log("[DialogNewFolder] Computed values:",{actualParentPath:s,actualProjectName:n,isRootCreation:o}),Ut.log("[DialogNewFolder] Will send to server:",{projectName:n,parentPath:s,folderName:e,isRootCreation:o}),await new Promise((t,i)=>{this.$store.dispatch(`ide/${ut.p_}`,{projectName:n,parentPath:s,folderName:e,isRootCreation:o,callback:a=>{if(Ut.log("[DialogNewFolder] Create folder response:",a),0===a.code){Ee.nk.success(`Folder "${e}" created successfully`),o?this.$store.dispatch(`ide/${ut.qB}`,{callback:e=>{Ut.log("[DialogNewFolder] Project list refresh response:",e),0===e.code&&(this.$store.commit("ide/handleProjects",e.data),this.ideInfo.multiRootData&&this.$parent.loadAllDefaultProjects?.())}}):this.$store.dispatch(`ide/${ut.QQ}`,{projectName:n,callback:e=>{0===e.code&&(this.$store.commit("ide/handleProject",e.data),this.ideInfo.multiRootData&&this.$parent.loadAllDefaultProjects?.())}});const i=o||"/"===s?`/${e}`:`${s}/${e}`;this.$emit("folder-created",{path:i,projectName:n,isRootCreation:o}),this.$emit("update:modelValue",!1),t()}else{const e=a.message||a.msg||"Failed to create folder";Ee.nk.error(e),i(new Error(e))}}})})}catch(Dr){Ut.error("[DialogNewFolder] Error creating folder:",Dr),Ee.nk.error("Failed to create folder: "+Dr.message)}finally{this.creating=!1}}},onCancel(){this.$emit("update:modelValue",!1)}},computed:{ideInfo(){return this.$store.state.ide.ideInfo},currentUser(){const e=localStorage.getItem("session_id"),t=localStorage.getItem("username"),i=localStorage.getItem("role"),o=localStorage.getItem("full_name");return e&&t?{session_id:e,username:t,role:i,full_name:o}:null},visibleDirectories(){return this.directories.filter(e=>{const t=this.isDirectoryVisible(e),i=this.isDirectoryVisibleToStudent(e.path);return t&&i})}}};const Wt=(0,k.A)(Ot,[["render",At],["__scopeId","data-v-3422cd8f"]]);var Vt=Wt;const zt={class:"new-file-dialog"},Bt={class:"dialog-header"},Xt={class:"dialog-body"},Ht={class:"directory-section"},Kt={class:"directory-nav"},Gt={key:0,class:"directory-tree"},Qt=["onClick"],Jt={key:1,class:"directory-expand-placeholder"},qt=["onClick"],Yt={class:"filename-section"},Zt={class:"filename-input-wrapper"},ei={key:0,class:"file-type-icon"},ti={key:0,class:"error-hint"},ii={key:1,class:"file-types-hint"},oi={key:0,class:"preview-section"},si={class:"file-preview"},ni={class:"file-info"},ai={class:"file-path"},ri={class:"file-type"},li={class:"dialog-footer"},di=["disabled"];function ci(e,t,i,a,r,l){const d=(0,o.g2)("X"),c=(0,o.g2)("FolderOpen"),h=(0,o.g2)("ChevronDown"),p=(0,o.g2)("ChevronRight"),u=(0,o.g2)("Home"),m=(0,o.g2)("Folder"),f=(0,o.g2)("FileText");return(0,o.uX)(),(0,o.CE)("div",null,[t[10]||(t[10]=(0,o.Lk)("div",{class:"dialog-cover"},null,-1)),(0,o.Lk)("div",zt,[(0,o.Lk)("div",Bt,[t[6]||(t[6]=(0,o.Lk)("h3",null,"New File",-1)),(0,o.Lk)("div",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>l.onCancel&&l.onCancel(...e))},[(0,o.bF)(d,{size:20})])]),(0,o.Lk)("div",Xt,[(0,o.Lk)("div",Ht,[t[7]||(t[7]=(0,o.Lk)("label",null,"Select Directory:",-1)),(0,o.Lk)("div",Kt,[(0,o.Lk)("div",{class:"current-path",onClick:t[1]||(t[1]=(...e)=>l.toggleDirectoryTree&&l.toggleDirectoryTree(...e))},[(0,o.bF)(c,{size:16}),(0,o.Lk)("span",null,(0,n.v_)(l.formatCurrentPath(r.currentPath)),1),r.showDirectoryTree?((0,o.uX)(),(0,o.Wv)(h,{key:0,size:16,class:"chevron"})):((0,o.uX)(),(0,o.Wv)(p,{key:1,size:16,class:"chevron"}))]),r.showDirectoryTree?((0,o.uX)(),(0,o.CE)("div",Gt,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.visibleDirectories,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.path,class:(0,n.C4)(["directory-item",{selected:r.currentPath===e.path,"root-item":e.isRoot}]),style:(0,n.Tr)({paddingLeft:20*e.level+12+"px"})},[e.hasChildren?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"directory-expand-icon",onClick:(0,s.D$)(t=>l.toggleDirectory(e),["stop"])},[l.isExpanded(e.path)?((0,o.uX)(),(0,o.Wv)(h,{key:0,size:14})):((0,o.uX)(),(0,o.Wv)(p,{key:1,size:14}))],8,Qt)):((0,o.uX)(),(0,o.CE)("div",Jt)),(0,o.Lk)("div",{class:"directory-content",onClick:t=>l.selectDirectory(e)},[e.isRoot?((0,o.uX)(),(0,o.Wv)(u,{key:0,size:14})):((0,o.uX)(),(0,o.Wv)(m,{key:1,size:14})),(0,o.Lk)("span",null,(0,n.v_)(e.displayName||e.name),1)],8,qt)],6))),128))])):(0,o.Q3)("",!0)])]),(0,o.Lk)("div",Yt,[t[8]||(t[8]=(0,o.Lk)("label",null,"File Name:",-1)),(0,o.Lk)("div",Zt,[(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>r.fileName=e),onInput:t[3]||(t[3]=(...e)=>l.validateFileName&&l.validateFileName(...e)),placeholder:"Enter file name (e.g., script.py)",class:"filename-input",ref:"fileNameInput"},null,544),[[s.Jo,r.fileName]]),l.fileExtension?((0,o.uX)(),(0,o.CE)("div",ei,[(0,o.bF)(f,{size:20})])):(0,o.Q3)("",!0)]),r.fileNameError?((0,o.uX)(),(0,o.CE)("div",ti,(0,n.v_)(r.fileNameError),1)):((0,o.uX)(),(0,o.CE)("div",ii," Common extensions: .py, .txt, .csv, .json, .md, .html, .css, .js "))]),r.fileName&&!r.fileNameError?((0,o.uX)(),(0,o.CE)("div",oi,[t[9]||(t[9]=(0,o.Lk)("label",null,"File will be created at:",-1)),(0,o.Lk)("div",si,[(0,o.Lk)("div",ni,[(0,o.bF)(f,{size:20}),(0,o.Lk)("div",null,[(0,o.Lk)("div",ai,(0,n.v_)(l.getFullFilePath()),1),(0,o.Lk)("div",ri,(0,n.v_)(l.getFileTypeDescription()),1)])])])])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",li,[(0,o.Lk)("button",{class:"btn-cancel",onClick:t[4]||(t[4]=(...e)=>l.onCancel&&l.onCancel(...e))},"Cancel"),(0,o.Lk)("button",{class:"btn-create",onClick:t[5]||(t[5]=(...e)=>l.onCreate&&l.onCreate(...e)),disabled:!r.fileName||!!r.fileNameError&&!r.fileNameError.includes("already exists")||r.creating},(0,n.v_)(r.creating?"Creating...":"Create File"),9,di)])])])}var hi=i(79992),pi=i(38880),ui=i(96763),mi={props:{modelValue:Boolean},data(){return{currentPath:"/",currentProject:null,directories:[],expandedDirectories:new Set,fileName:"",fileNameError:"",creating:!1,showDirectoryTree:!1}},computed:{ideInfo(){return this.$store.state.ide.ideInfo},currentUser(){const e=localStorage.getItem("session_id"),t=localStorage.getItem("username"),i=localStorage.getItem("role"),o=localStorage.getItem("full_name");return e&&t?{session_id:e,username:t,role:i,full_name:o}:null},fileExtension(){if(!this.fileName)return"";const e=this.fileName.lastIndexOf(".");return e>0?this.fileName.substring(e):""},visibleDirectories(){return this.directories.filter(e=>{if(!this.isDirectoryVisibleToStudent(e.path))return!1;if(e.isRoot)return!0;const t=this.getParentPath(e.path);return"/"===t||this.expandedDirectories.has(t)})}},components:{X:w.A,FolderOpen:Fe.A,Folder:dt.A,ChevronRight:ct.A,ChevronDown:ht.A,FileText:hi.A,Home:pt.A},mounted(){this.loadDirectoryStructure(),this.$nextTick(()=>{this.$refs.fileNameInput?.focus()})},methods:{isDirectoryVisibleToStudent(e){return this.currentUser&&this.currentUser.role,!0},loadDirectoryStructure(){if(this.ideInfo.multiRootData&&this.ideInfo.multiRootData.children.length>0)this.directories=[],this.ideInfo.multiRootData.children.forEach(e=>{if(this.currentUser&&"student"===this.currentUser.role){const t=`Local/${this.currentUser.username}`;if(!e.label.startsWith("Local/")||e.label!==t)return}const t=this.buildDirectoryTree(e,0,e.label);this.directories=this.directories.concat(t)});else if(this.ideInfo.currProj&&this.ideInfo.currProj.data){const e=this.ideInfo.currProj.data.label||this.ideInfo.currProj.data.name;if(this.currentUser&&"student"===this.currentUser.role){const t=`Local/${this.currentUser.username}`;if(e!==t)return void(this.directories=[])}this.directories=this.buildDirectoryTree(this.ideInfo.currProj.data,0,e)}if(this.currentUser&&"student"===this.currentUser.role){this.currentProject=`Local/${this.currentUser.username}`;const e=`Local/${this.currentUser.username}`,t=this.directories.find(t=>t.path===e);if(t)this.currentPath=e;else if(this.directories.length>0){const e=`Local/${this.currentUser.username}`,t=this.directories.find(t=>!t.isRoot&&t.projectName===e);this.currentPath=t?t.path:"/"}else this.currentPath="/"}else if(this.ideInfo.nodeSelected){if("dir"===this.ideInfo.nodeSelected.type||"folder"===this.ideInfo.nodeSelected.type)this.currentPath=this.ideInfo.nodeSelected.path,this.currentProject=this.ideInfo.nodeSelected.projectName||this.ideInfo.currProj?.data?.name;else if("file"===this.ideInfo.nodeSelected.type){const e=this.ideInfo.nodeSelected.path.substring(0,this.ideInfo.nodeSelected.path.lastIndexOf("/"))||"/";this.currentPath=e,this.currentProject=this.ideInfo.nodeSelected.projectName||this.ideInfo.currProj?.data?.name}}else this.currentProject=this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name},buildDirectoryTree(e,t=0,i=null){let o=[];if(0===t){const t=e.children&&e.children.some(e=>("dir"===e.type||"folder"===e.type)&&this.isDirectoryVisibleToStudent(e.path)),s={name:i||e.label||"/",displayName:i||e.label||"/",path:e.path||"/",level:0,isRoot:!0,hasChildren:t,projectName:i||e.label,fullPath:i?`${i}${e.path}`:e.path};o.push(s),t&&this.expandedDirectories.add(s.path)}return e.children&&e.children.forEach(e=>{if(("dir"===e.type||"folder"===e.type)&&this.isDirectoryVisibleToStudent(e.path)){const s=e.children&&e.children.some(e=>("dir"===e.type||"folder"===e.type)&&this.isDirectoryVisibleToStudent(e.path));o.push({name:e.label,displayName:e.label,path:e.path,level:t+1,isRoot:!1,hasChildren:s,projectName:i||e.projectName,fullPath:i?`${i}${e.path}`:e.path}),e.children&&(o=o.concat(this.buildDirectoryTree(e,t+1,i)))}}),o},getParentPath(e){if("/"===e||!e)return"/";const t=e.lastIndexOf("/");return 0===t?"/":e.substring(0,t)},isExpanded(e){return this.expandedDirectories.has(e)},toggleDirectory(e){e.hasChildren&&(this.expandedDirectories.has(e.path)?this.expandedDirectories.delete(e.path):this.expandedDirectories.add(e.path))},selectDirectory(e){this.currentPath=e.path,this.currentProject=e.projectName,this.showDirectoryTree=!1},toggleDirectoryTree(){this.showDirectoryTree=!this.showDirectoryTree},formatCurrentPath(e){if(e&&"/"!==e){const t=["Local","Lecture Notes"];for(let i of t)if(e.startsWith(i))return e}if(this.currentProject)return"/"===e?this.currentUser&&"student"===this.currentUser.role&&"Local"===this.currentProject?`Local/${this.currentUser.username}`:this.currentProject:e.startsWith(this.currentProject)?e:this.currentProject+e;if("/"===e&&this.ideInfo.currProj)return this.ideInfo.currProj.data?.label||this.ideInfo.currProj.config?.name;if(e.startsWith("/")&&this.ideInfo.currProj){const t=this.ideInfo.currProj.data?.label||this.ideInfo.currProj.config?.name;return e.includes(t)?e:t+e}return e},validateFileName(){if(this.fileNameError="",!this.fileName)return;if(/[<>:"|?*\\]/.test(this.fileName))return void(this.fileNameError="File name contains invalid characters");const e=["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"],t=this.fileName.split(".")[0].toUpperCase();if(e.includes(t))return void(this.fileNameError="This is a reserved file name");if(this.fileName.startsWith(".")||this.fileName.endsWith("."))return void(this.fileNameError="File name cannot start or end with a dot");const i=this.currentProject||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name,o=this.checkFileExists(this.fileName,this.currentPath,i);o?this.fileNameError="A file with this name already exists (keep a unique file name)":this.fileExtension||(this.fileNameError="Consider adding a file extension (e.g., .py, .txt)")},getFullFilePath(){const e=this.fileName||"new_file",t="/"===this.currentPath?`/${e}`:`${this.currentPath}/${e}`;return this.formatCurrentPath(t)},getFileTypeDescription(){const e=this.fileExtension.toLowerCase(),t={".py":"Python Script",".txt":"Text File",".csv":"CSV Data File",".json":"JSON Data File",".md":"Markdown Document",".html":"HTML Document",".css":"CSS Stylesheet",".js":"JavaScript File",".xml":"XML Document",".yaml":"YAML Configuration",".yml":"YAML Configuration",".ini":"Configuration File",".log":"Log File"};return t[e]||"File"},checkFileExists(e,t,i){const o=(e,t,i)=>{if(!e||!e.children)return null;if(e.path===t)return e.children.find(e=>"file"===e.type&&(e.label===i||e.name===i));for(let s of e.children){const e=o(s,t,i);if(e)return e}return null};if(this.ideInfo.multiRootData&&this.ideInfo.multiRootData.children.length>0){for(let s of this.ideInfo.multiRootData.children)if(s.name===i||s.label===i)return o(s,t,e)}else if(this.ideInfo.currProj&&this.ideInfo.currProj.data)return o(this.ideInfo.currProj.data,t,e);return null},async onCreate(){if(!this.fileName||this.fileNameError)return;const e=this.fileName;let t=this.currentPath,i=this.currentProject||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name;this.currentUser&&"student"===this.currentUser.role&&"Local"===i&&("/"===t||t===`Local/${this.currentUser.username}`?(t=`Local/${this.currentUser.username}`,i=""):(t.startsWith(`Local/${this.currentUser.username}/`)||(t=`Local/${this.currentUser.username}${"/"===t?"":t}`),i=""));const o=this.checkFileExists(e,t,i);if(o)try{await pi.s.confirm(`A file named "${e}" already exists in this directory. Creating this file will replace the existing file.`,"File Already Exists",{confirmButtonText:"Replace File",cancelButtonText:"Cancel",type:"warning",confirmButtonClass:"el-button--danger"})}catch{return}this.creating=!0;try{ui.log("[DialogNewFile] Creating file:",{fileName:e,parentPath:t,projectName:i,replaceExisting:!!o});let s="";const n=this.fileExtension.toLowerCase();".py"===n?s="":".json"===n&&(s="{}"),await new Promise((o,n)=>{this.$store.dispatch(`ide/${ut.Zd}`,{projectName:i,parentPath:t,fileName:e,callback:a=>{if(ui.log("[DialogNewFile] Create file response:",a),0===a.code){if(Ee.nk.success(`File "${e}" created successfully`),s){const n="/"===t?`/${e}`:`${t}/${e}`;this.$store.dispatch(`ide/${ut._L}`,{projectName:i,filePath:n,fileData:s,callback:e=>{ui.log("[DialogNewFile] Write file response:",e),o()}})}else o();this.$store.dispatch(`ide/${ut.QQ}`,{projectName:i,callback:e=>{0===e.code&&(this.$store.commit("ide/handleProject",e.data),this.ideInfo.multiRootData&&this.$parent.loadAllDefaultProjects?.())}});const n="/"===t?`/${e}`:`${t}/${e}`;this.$emit("file-created",{path:n,projectName:i}),this.$emit("update:modelValue",!1)}else{const e=a.message||"Failed to create file";Ee.nk.error(e),n(new Error(e))}}})})}catch(Dr){ui.error("[DialogNewFile] Error creating file:",Dr),Ee.nk.error("Failed to create file: "+Dr.message)}finally{this.creating=!1}},onCancel(){this.$emit("update:modelValue",!1)}}};const fi=(0,k.A)(mi,[["render",ci],["__scopeId","data-v-2c0ff972"]]);var gi=fi,vi=i(22542),wi=i(7093),yi=i(22164),bi=i(94411),ki=i(32104),Ii=i(42258),Pi=i(37093),Si=i(98095);const Ci={key:0,class:"fullscreen-preview"},Li={class:"preview-header"},Fi={class:"preview-header-left"},Ei={class:"preview-title"},xi={class:"preview-header-right"},Di={class:"preview-content"},Ri={key:2,class:"unsupported-preview"};function Ti(e,t,i,s,a,r){const l=ki.A,d=Ii.A;return r.isActive?((0,o.uX)(),(0,o.CE)("div",Ci,[(0,o.Lk)("div",Li,[(0,o.Lk)("div",Fi,[(0,o.Lk)("span",Ei,(0,n.v_)(r.fileName),1)]),(0,o.Lk)("div",xi,[(0,o.Lk)("button",{class:"preview-action-btn",onClick:t[0]||(t[0]=(...e)=>r.openInRightPanel&&r.openInRightPanel(...e)),title:"Open in Right Panel"},t[2]||(t[2]=[(0,o.Lk)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,o.Lk)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),(0,o.Lk)("path",{d:"M15 3v18"})],-1)])),(0,o.Lk)("button",{class:"preview-close-btn",onClick:t[1]||(t[1]=(...e)=>r.close&&r.close(...e)),title:"Close Preview"},t[3]||(t[3]=[(0,o.Lk)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,o.Lk)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,o.Lk)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)]))])]),(0,o.Lk)("div",Di,[r.isCsvFile?((0,o.uX)(),(0,o.Wv)(l,{key:0,content:r.content},null,8,["content"])):r.isMediaFile?((0,o.uX)(),(0,o.Wv)(d,{key:1,codeItem:r.mediaCodeItem,codeItemIndex:0},null,8,["codeItem"])):((0,o.uX)(),(0,o.CE)("div",Ri,t[4]||(t[4]=[(0,o.Lk)("p",null,"Preview not supported for this file type",-1)])))])])):(0,o.Q3)("",!0)}var $i={name:"FullscreenPreview",components:{CsvViewer:ki.A,MediaViewer:Ii.A},computed:{ideInfo(){return this.$store.state.ide.ideInfo},isActive(){return this.ideInfo.fullscreenPreview.active},file(){return this.ideInfo.fullscreenPreview.file},content(){return this.ideInfo.fullscreenPreview.content},fileName(){return this.file?.name||""},filePath(){return this.file?.path||""},isCsvFile(){return this.filePath.toLowerCase().endsWith(".csv")},isMediaFile(){const e=[".png",".jpg",".jpeg",".gif",".bmp",".svg",".webp",".pdf"],t=this.filePath.toLowerCase();return e.some(e=>t.endsWith(e))},mediaCodeItem(){return this.file?{name:this.file.name,path:this.file.path,projectName:this.file.projectName,content:this.content,preloaded:!0}:null}},methods:{close(){this.$store.commit("ide/closeFullscreenPreview")},openInRightPanel(){this.$store.commit("ide/closeFullscreenPreview"),this.file&&this.$emit("open-in-right-panel",this.file.path)}},mounted(){this.handleEsc=e=>{"Escape"===e.key&&this.isActive&&this.close()},document.addEventListener("keydown",this.handleEsc)},beforeUnmount(){document.removeEventListener("keydown",this.handleEsc)}};const ji=(0,k.A)($i,[["render",Ti],["__scopeId","data-v-3c263865"]]);var Ni=ji,Mi=i(21365);const Ai={class:"modal-header"},_i={class:"modal-body"},Ui={class:"input-group"},Oi={key:0,class:"input-group"},Wi={class:"options-group"},Vi={class:"checkbox-label"},zi={class:"checkbox-label"},Bi={class:"checkbox-label"},Xi={key:1,class:"search-info"},Hi={class:"modal-footer"},Ki={class:"button-group"},Gi=["disabled"],Qi=["disabled"],Ji=["disabled"],qi=["disabled"];function Yi(e,t,i,a,r,l){const d=(0,o.g2)("X"),c=(0,o.g2)("ChevronUp"),h=(0,o.g2)("ChevronDown");return(0,o.uX)(),(0,o.Wv)(s.eB,{name:"modal-fade"},{default:(0,o.k6)(()=>[i.modelValue?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"find-replace-overlay",onClick:t[16]||(t[16]=(0,s.D$)((...e)=>l.close&&l.close(...e),["self"]))},[(0,o.Lk)("div",{class:"find-replace-modal",onClick:t[15]||(t[15]=(0,s.D$)(()=>{},["stop"]))},[(0,o.Lk)("div",Ai,[(0,o.Lk)("h3",null,(0,n.v_)(l.isReplaceMode?"Find and Replace":"Find"),1),(0,o.Lk)("button",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>l.close&&l.close(...e)),title:"Close (Esc)"},[(0,o.bF)(d,{size:18})])]),(0,o.Lk)("div",_i,[(0,o.Lk)("div",Ui,[t[17]||(t[17]=(0,o.Lk)("label",null,"Find:",-1)),(0,o.bo)((0,o.Lk)("input",{ref:"findInput","onUpdate:modelValue":t[1]||(t[1]=e=>r.findText=e),type:"text",class:"modal-input",placeholder:"Enter text to find...",onKeydown:[t[2]||(t[2]=(0,s.jR)((...e)=>l.findNext&&l.findNext(...e),["enter"])),t[3]||(t[3]=(0,s.jR)((...e)=>l.close&&l.close(...e),["escape"]))]},null,544),[[s.Jo,r.findText]])]),l.isReplaceMode?((0,o.uX)(),(0,o.CE)("div",Oi,[t[18]||(t[18]=(0,o.Lk)("label",null,"Replace with:",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>r.replaceText=e),type:"text",class:"modal-input",placeholder:"Enter replacement text...",onKeydown:[t[5]||(t[5]=(0,s.jR)((...e)=>l.replace&&l.replace(...e),["enter"])),t[6]||(t[6]=(0,s.jR)((...e)=>l.close&&l.close(...e),["escape"]))]},null,544),[[s.Jo,r.replaceText]])])):(0,o.Q3)("",!0),(0,o.Lk)("div",Wi,[(0,o.Lk)("label",Vi,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=e=>r.caseSensitive=e)},null,512),[[s.lH,r.caseSensitive]]),t[19]||(t[19]=(0,o.Lk)("span",null,"Case sensitive",-1))]),(0,o.Lk)("label",zi,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=e=>r.wholeWord=e)},null,512),[[s.lH,r.wholeWord]]),t[20]||(t[20]=(0,o.Lk)("span",null,"Whole word",-1))]),(0,o.Lk)("label",Bi,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=e=>r.useRegex=e)},null,512),[[s.lH,r.useRegex]]),t[21]||(t[21]=(0,o.Lk)("span",null,"Regular expression",-1))])]),r.searchInfo?((0,o.uX)(),(0,o.CE)("div",Xi,(0,n.v_)(r.searchInfo),1)):(0,o.Q3)("",!0)]),(0,o.Lk)("div",Hi,[(0,o.Lk)("div",Ki,[(0,o.Lk)("button",{class:"action-btn",onClick:t[10]||(t[10]=(...e)=>l.findPrevious&&l.findPrevious(...e)),disabled:!r.findText},[(0,o.bF)(c,{size:16}),t[22]||(t[22]=(0,o.eW)(" Find Previous ",-1))],8,Gi),(0,o.Lk)("button",{class:"action-btn primary",onClick:t[11]||(t[11]=(...e)=>l.findNext&&l.findNext(...e)),disabled:!r.findText},[(0,o.bF)(h,{size:16}),t[23]||(t[23]=(0,o.eW)(" Find Next ",-1))],8,Qi),l.isReplaceMode?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.Lk)("button",{class:"action-btn",onClick:t[12]||(t[12]=(...e)=>l.replace&&l.replace(...e)),disabled:!r.findText}," Replace ",8,Ji),(0,o.Lk)("button",{class:"action-btn",onClick:t[13]||(t[13]=(...e)=>l.replaceAll&&l.replaceAll(...e)),disabled:!r.findText}," Replace All ",8,qi)],64)):(0,o.Q3)("",!0),(0,o.Lk)("button",{class:"action-btn",onClick:t[14]||(t[14]=(...e)=>l.close&&l.close(...e))}," Close ")])])])])):(0,o.Q3)("",!0)]),_:1})}
/**
 * @license lucide-vue-next v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const Zi=(0,Ce.A)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);var eo={name:"FindReplaceModal",components:{X:w.A,ChevronUp:Zi,ChevronDown:ht.A},props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"find",validator:e=>["find","replace"].includes(e)}},data(){return{findText:"",replaceText:"",caseSensitive:!1,wholeWord:!1,useRegex:!1,searchInfo:"",currentMatch:0,totalMatches:0,searchCursor:null}},computed:{isReplaceMode(){return"replace"===this.mode},activeEditor(){const e=document.querySelector(".editor-content .code-editor-flex .CodeMirror");return e&&e.CodeMirror?e.CodeMirror:null}},watch:{modelValue(e){e?this.$nextTick(()=>{this.$refs.findInput?.focus(),this.initializeSearch()}):this.clearSearch()},findText(){this.findText?this.updateSearchInfo():(this.searchInfo="",this.clearSearch())}},methods:{initializeSearch(){if(this.activeEditor){const e=this.activeEditor.getSelection();e&&(this.findText=e)}},clearSearch(){this.activeEditor&&this.activeEditor.operation(()=>{const e=this.activeEditor.getAllMarks();e.forEach(e=>{"CodeMirror-search-match"===e.className&&e.clear()})}),this.searchCursor=null,this.currentMatch=0,this.totalMatches=0,this.searchInfo=""},getSearchQuery(){let e=this.findText;this.useRegex||(e=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")),this.wholeWord&&(e="\\b"+e+"\\b");try{return new RegExp(e,this.caseSensitive?"g":"gi")}catch(t){return this.findText}},findNext(){if(!this.findText||!this.activeEditor)return;const e=this.getSearchQuery(),t=this.activeEditor.getSearchCursor(e,this.activeEditor.getCursor(),!this.caseSensitive);if(t.findNext())this.activeEditor.setSelection(t.from(),t.to()),this.activeEditor.scrollIntoView(t.from(),50),this.highlightMatch(t);else{const t=this.activeEditor.getSearchCursor(e,{line:0,ch:0},!this.caseSensitive);t.findNext()?(this.activeEditor.setSelection(t.from(),t.to()),this.activeEditor.scrollIntoView(t.from(),50),this.highlightMatch(t),this.searchInfo="Wrapped to beginning"):this.searchInfo="No matches found"}this.updateSearchInfo()},findPrevious(){if(!this.findText||!this.activeEditor)return;const e=this.getSearchQuery(),t=this.activeEditor.getSearchCursor(e,this.activeEditor.getCursor("from"),!this.caseSensitive);if(t.findPrevious())this.activeEditor.setSelection(t.from(),t.to()),this.activeEditor.scrollIntoView(t.from(),50),this.highlightMatch(t);else{const t=this.activeEditor.lastLine(),i=this.activeEditor.getLine(t).length,o=this.activeEditor.getSearchCursor(e,{line:t,ch:i},!this.caseSensitive);o.findPrevious()?(this.activeEditor.setSelection(o.from(),o.to()),this.activeEditor.scrollIntoView(o.from(),50),this.highlightMatch(o),this.searchInfo="Wrapped to end"):this.searchInfo="No matches found"}this.updateSearchInfo()},replace(){if(!this.findText||!this.activeEditor)return;const e=this.activeEditor.getSelection(),t=this.getSearchQuery();e&&("string"===typeof t&&e===t||t instanceof RegExp&&t.test(e))?(this.activeEditor.replaceSelection(this.replaceText),this.findNext()):this.findNext()},replaceAll(){if(!this.findText||!this.activeEditor)return;const e=this.getSearchQuery(),t=this.activeEditor.getSearchCursor(e,{line:0,ch:0},!this.caseSensitive);let i=0;this.activeEditor.operation(()=>{while(t.findNext())t.replace(this.replaceText),i++}),this.searchInfo=`Replaced ${i} occurrence${1!==i?"s":""}`},highlightMatch(e){},updateSearchInfo(){if(!this.findText||!this.activeEditor)return void(this.searchInfo="");const e=this.getSearchQuery(),t=this.activeEditor.getSearchCursor(e,{line:0,ch:0},!this.caseSensitive);let i=0;while(t.findNext())i++;this.searchInfo=0===i?"No matches found":1===i?"1 match found":`${i} matches found`},close(){this.clearSearch(),this.$emit("update:modelValue",!1)},handleKeydown(e){"Escape"===e.key?this.close():("F3"===e.key||e.ctrlKey&&"g"===e.key)&&(e.preventDefault(),e.shiftKey?this.findPrevious():this.findNext())}},mounted(){document.addEventListener("keydown",this.handleKeydown)},beforeUnmount(){document.removeEventListener("keydown",this.handleKeydown),this.clearSearch()}};const to=(0,k.A)(eo,[["render",Yi],["__scopeId","data-v-28db288f"]]);var io=to;const oo={class:"modal-container"},so={class:"modal-header"},no={class:"modal-body"},ao={class:"shortcut-section"},ro={class:"shortcut-list"},lo={class:"shortcut-item"},co={class:"shortcut-keys"},ho={class:"shortcut-item"},po={class:"shortcut-keys"},uo={class:"shortcut-item"},mo={class:"shortcut-keys"};function fo(e,t,i,a,r,l){const d=(0,o.g2)("X");return(0,o.uX)(),(0,o.Wv)(s.eB,{name:"modal-fade"},{default:(0,o.k6)(()=>[i.modelValue?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"modal-overlay",onClick:t[1]||(t[1]=(0,s.D$)((...e)=>l.close&&l.close(...e),["self"]))},[(0,o.Lk)("div",oo,[(0,o.Lk)("div",so,[(0,o.Lk)("h2",null,"Keyboard Shortcuts "+(0,n.v_)(l.isMac?"(Mac)":"(Windows/Linux)"),1),(0,o.Lk)("button",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>l.close&&l.close(...e))},[(0,o.bF)(d,{size:20})])]),(0,o.Lk)("div",no,[t[6]||(t[6]=(0,o.Lk)("div",{class:"shortcut-section"},[(0,o.Lk)("h3",null,"File Operations"),(0,o.Lk)("div",{class:"shortcut-list"},[(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"New File"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+Alt+N")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Open File"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+O")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Save"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+S")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Save As"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+Shift+S")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Move"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+Shift+M")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Download"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+D")])])],-1)),t[7]||(t[7]=(0,o.Lk)("div",{class:"shortcut-section"},[(0,o.Lk)("h3",null,"Edit Operations"),(0,o.Lk)("div",{class:"shortcut-list"},[(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Undo"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+Z")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Redo"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+Y")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Cut"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+X")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Copy"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+C")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Paste"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+V")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Select All"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+A")])])],-1)),t[8]||(t[8]=(0,o.Lk)("div",{class:"shortcut-section"},[(0,o.Lk)("h3",null,"Run Operations"),(0,o.Lk)("div",{class:"shortcut-list"},[(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Run Script"),(0,o.Lk)("span",{class:"shortcut-keys"},"F5")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Stop Script"),(0,o.Lk)("span",{class:"shortcut-keys"},"Shift+F5")])])],-1)),t[9]||(t[9]=(0,o.Lk)("div",{class:"shortcut-section"},[(0,o.Lk)("h3",null,"View Operations"),(0,o.Lk)("div",{class:"shortcut-list"},[(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Toggle Console"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+`")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Toggle Preview Panel"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+Shift+P")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Toggle Sidebar"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+B")])])],-1)),(0,o.Lk)("div",ao,[t[5]||(t[5]=(0,o.Lk)("h3",null,"Tab Navigation",-1)),(0,o.Lk)("div",ro,[(0,o.Lk)("div",lo,[t[2]||(t[2]=(0,o.Lk)("span",{class:"shortcut-action"},"Previous Tab",-1)),(0,o.Lk)("span",co,(0,n.v_)(l.formatKey("Alt"))+"+",1)]),(0,o.Lk)("div",ho,[t[3]||(t[3]=(0,o.Lk)("span",{class:"shortcut-action"},"Next Tab",-1)),(0,o.Lk)("span",po,(0,n.v_)(l.formatKey("Alt"))+"+",1)]),(0,o.Lk)("div",uo,[t[4]||(t[4]=(0,o.Lk)("span",{class:"shortcut-action"},"Go to Tab 1-6",-1)),(0,o.Lk)("span",mo,(0,n.v_)(l.formatKey("Alt"))+"+1-6",1)])])]),t[10]||(t[10]=(0,o.Lk)("div",{class:"shortcut-section"},[(0,o.Lk)("h3",null,"General"),(0,o.Lk)("div",{class:"shortcut-list"},[(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Show Keyboard Shortcuts"),(0,o.Lk)("span",{class:"shortcut-keys"},"F1")]),(0,o.Lk)("div",{class:"shortcut-item"},[(0,o.Lk)("span",{class:"shortcut-action"},"Settings"),(0,o.Lk)("span",{class:"shortcut-keys"},"Ctrl+,")])])],-1))])])])):(0,o.Q3)("",!0)]),_:1})}var go={name:"KeyboardShortcutsModal",props:{modelValue:{type:Boolean,default:!1}},components:{X:w.A},computed:{isMac(){return navigator.platform.toUpperCase().indexOf("MAC")>=0}},methods:{close(){this.$emit("update:modelValue",!1)},formatKey(e){return this.isMac?e.replace("Ctrl","").replace("Alt","").replace("Shift",""):e}},mounted(){this.handleEsc=e=>{"Escape"===e.key&&this.modelValue&&this.close()},document.addEventListener("keydown",this.handleEsc)},beforeUnmount(){document.removeEventListener("keydown",this.handleEsc)}};const vo=(0,k.A)(go,[["render",fo],["__scopeId","data-v-6e26e148"]]);var wo=vo,yo=i(3549);const bo={class:"profile-modal"},ko={class:"dialog-header"},Io={class:"dialog-body"},Po={class:"tab-navigation"},So=["onClick"],Co={class:"tab-content"},Lo={key:0,class:"profile-section"},Fo={class:"user-info"},Eo={class:"info-row"},xo={class:"info-row"},Do={class:"info-row"},Ro={class:"info-row"},To={class:"session-id"},$o={key:1,class:"password-section"},jo={class:"form-group"},No=["disabled"],Mo={class:"form-group"},Ao=["disabled"],_o={class:"form-group"},Uo=["disabled"],Oo={class:"form-actions"},Wo=["disabled"],Vo={class:"dialog-footer"};function zo(e,t,i,a,r,l){const d=(0,o.g2)("X"),c=(0,o.g2)("LogOut");return l.visible?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"profile-modal-overlay",onClick:t[8]||(t[8]=(0,s.D$)((...e)=>l.handleClose&&l.handleClose(...e),["self"]))},[(0,o.Lk)("div",bo,[(0,o.Lk)("div",ko,[(0,o.Lk)("h3",null,(0,n.v_)(i.currentUser?`${i.currentUser.full_name||i.currentUser.username}`:"User Profile"),1),(0,o.Lk)("div",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>l.handleClose&&l.handleClose(...e))},[(0,o.bF)(d,{size:20})])]),(0,o.Lk)("div",Io,[(0,o.Lk)("div",Po,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.tabs,e=>((0,o.uX)(),(0,o.CE)("button",{key:e.id,onClick:t=>r.activeTab=e.id,class:(0,n.C4)(["tab-btn",{active:r.activeTab===e.id}])},[((0,o.uX)(),(0,o.Wv)((0,o.$y)(e.icon),{size:16})),(0,o.eW)(" "+(0,n.v_)(e.label),1)],10,So))),128))]),(0,o.Lk)("div",Co,["profile"===r.activeTab?((0,o.uX)(),(0,o.CE)("div",Lo,[(0,o.Lk)("div",Fo,[(0,o.Lk)("div",Eo,[t[9]||(t[9]=(0,o.Lk)("label",null,"Username:",-1)),(0,o.Lk)("span",null,(0,n.v_)(i.currentUser?.username),1)]),(0,o.Lk)("div",xo,[t[10]||(t[10]=(0,o.Lk)("label",null,"Full Name:",-1)),(0,o.Lk)("span",null,(0,n.v_)(i.currentUser?.full_name||"Not set"),1)]),(0,o.Lk)("div",Do,[t[11]||(t[11]=(0,o.Lk)("label",null,"Role:",-1)),(0,o.Lk)("span",{class:(0,n.C4)(["role-badge",i.currentUser?.role])},(0,n.v_)("professor"===i.currentUser?.role?"Professor":"Student"),3)]),(0,o.Lk)("div",Ro,[t[12]||(t[12]=(0,o.Lk)("label",null,"Session:",-1)),(0,o.Lk)("span",To,(0,n.v_)(r.sessionId?.substring(0,20))+"...",1)])])])):(0,o.Q3)("",!0),"change-password"===r.activeTab?((0,o.uX)(),(0,o.CE)("div",$o,[(0,o.Lk)("form",{onSubmit:t[5]||(t[5]=(0,s.D$)((...e)=>l.changePassword&&l.changePassword(...e),["prevent"]))},[(0,o.Lk)("div",jo,[t[13]||(t[13]=(0,o.Lk)("label",null,"Current Password",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>r.passwordForm.currentPassword=e),type:"password",placeholder:"Enter your current password",disabled:r.loading},null,8,No),[[s.Jo,r.passwordForm.currentPassword]])]),(0,o.Lk)("div",Mo,[t[14]||(t[14]=(0,o.Lk)("label",null,"New Password",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>r.passwordForm.newPassword=e),type:"password",placeholder:"Enter new password (min 6 characters)",disabled:r.loading},null,8,Ao),[[s.Jo,r.passwordForm.newPassword]])]),(0,o.Lk)("div",_o,[t[15]||(t[15]=(0,o.Lk)("label",null,"Confirm New Password",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>r.passwordForm.confirmPassword=e),type:"password",placeholder:"Confirm new password",disabled:r.loading},null,8,Uo),[[s.Jo,r.passwordForm.confirmPassword]])]),(0,o.Lk)("div",Oo,[(0,o.Lk)("button",{type:"submit",class:"btn-primary",disabled:r.loading},(0,n.v_)(r.loading?"Changing...":"Change Password"),9,Wo),(0,o.Lk)("button",{type:"button",class:"btn-secondary",onClick:t[4]||(t[4]=(...e)=>l.resetPasswordForm&&l.resetPasswordForm(...e))}," Reset ")])],32)])):(0,o.Q3)("",!0)])]),(0,o.Lk)("div",Vo,["profile"===r.activeTab?((0,o.uX)(),(0,o.CE)("button",{key:0,class:"btn-danger",onClick:t[6]||(t[6]=(...e)=>l.handleLogout&&l.handleLogout(...e))},[(0,o.bF)(c,{size:16}),t[16]||(t[16]=(0,o.eW)(" Logout ",-1))])):(0,o.Q3)("",!0),(0,o.Lk)("button",{class:"btn-secondary",onClick:t[7]||(t[7]=(...e)=>l.handleClose&&l.handleClose(...e))},"Close")])])])):(0,o.Q3)("",!0)}
/**
 * @license lucide-vue-next v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const Bo=(0,Ce.A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Xo=(0,Ce.A)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Ho=(0,Ce.A)("circle-question-mark",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Ko=(0,Ce.A)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]),Go=(0,Ce.A)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]),Qo=(0,Ce.A)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]);var Jo=i(96763),qo={name:"UserProfileModal",props:{modelValue:{type:Boolean,default:!1},currentUser:{type:Object,default:null}},emits:["update:modelValue","logout","password-changed"],components:{User:Bo,Lock:Xo,HelpCircle:Ho,LogOut:Ko,Mail:Go,MessageSquare:Qo,X:w.A},data(){return{activeTab:"profile",loading:!1,passwordVerified:!1,sessionId:localStorage.getItem("session_id"),tabs:[{id:"profile",label:"Profile",icon:"User"},{id:"change-password",label:"Change Password",icon:"Lock"}],passwordForm:{currentPassword:"",newPassword:"",confirmPassword:""},forgotForm:{currentPassword:"",newPassword:"",confirmPassword:""}}},computed:{visible:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},methods:{handleClose(){this.visible=!1,this.resetAllForms()},async handleLogout(){try{const e=await fetch("/api/logout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:this.sessionId})}),t=await e.json();t.success?(localStorage.removeItem("session_id"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("full_name"),Ee.nk.success("Logged out successfully"),this.handleClose(),this.$emit("logout"),setTimeout(()=>{window.location.reload()},1e3)):Ee.nk.error("Logout failed. Please try again.")}catch(Dr){Jo.error("Logout error:",Dr),Ee.nk.error("Network error during logout")}},async changePassword(){if(this.passwordForm.currentPassword)if(!this.passwordForm.newPassword||this.passwordForm.newPassword.length<6)Ee.nk.warning("New password must be at least 6 characters");else if(this.passwordForm.newPassword===this.passwordForm.confirmPassword){this.loading=!0;try{const e=await fetch("/api/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:this.sessionId,old_password:this.passwordForm.currentPassword,new_password:this.passwordForm.newPassword})}),t=await e.json();t.success?(Ee.nk.success("Password changed successfully!"),this.$emit("password-changed"),this.resetPasswordForm(),this.activeTab="profile"):Ee.nk.error(t.error||"Failed to change password")}catch(Dr){Ee.nk.error("Network error. Please try again.")}finally{this.loading=!1}}else Ee.nk.warning("Passwords do not match");else Ee.nk.warning("Please enter your current password")},async verifyCurrentPassword(){if(this.forgotForm.currentPassword){this.loading=!0;try{const e=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.currentUser.username,password:this.forgotForm.currentPassword})}),t=await e.json();t.success?(this.passwordVerified=!0,Ee.nk.success("Password verified! Now enter your new password.")):Ee.nk.error("Incorrect password. Please try again.")}catch(Dr){Ee.nk.error("Network error. Please try again.")}finally{this.loading=!1}}else Ee.nk.warning("Please enter your current password")},async resetPasswordWithVerification(){if(this.passwordVerified)if(!this.forgotForm.newPassword||this.forgotForm.newPassword.length<6)Ee.nk.warning("New password must be at least 6 characters");else if(this.forgotForm.newPassword===this.forgotForm.confirmPassword){this.loading=!0;try{const e=await fetch("/api/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:this.sessionId,old_password:this.forgotForm.currentPassword,new_password:this.forgotForm.newPassword})}),t=await e.json();t.success?(Ee.nk.success("Password reset successfully!"),this.$emit("password-changed"),this.resetForgotForm(),this.activeTab="profile"):Ee.nk.error(t.error||"Failed to reset password")}catch(Dr){Ee.nk.error("Network error. Please try again.")}finally{this.loading=!1}}else Ee.nk.warning("Passwords do not match");else Ee.nk.warning("Please verify your current password first")},resetPasswordForm(){this.passwordForm={currentPassword:"",newPassword:"",confirmPassword:""}},resetForgotForm(){this.forgotForm={currentPassword:"",newPassword:"",confirmPassword:""},this.passwordVerified=!1},resetAllForms(){this.resetPasswordForm(),this.resetForgotForm(),this.activeTab="profile"}}};const Yo=(0,k.A)(qo,[["render",zo],["__scopeId","data-v-7228530a"]]);var Zo=Yo;const es={class:"two-header-container"},ts={class:"header-first"},is={class:"nav-menu"},os={class:"nav__items-left"},ss={class:"nav__item"},ns=["aria-expanded"],as={class:"nav__dropdown-item"},rs={class:"nav__dropdown-item"},ls={class:"nav__dropdown-item"},ds=["disabled"],cs={class:"nav__dropdown-item"},hs={class:"nav__dropdown-item"},ps=["disabled"],us={class:"nav__dropdown-item"},ms=["disabled"],fs={class:"nav__dropdown-item"},gs={class:"nav__item"},vs=["aria-expanded"],ws={class:"nav__dropdown-item"},ys={class:"nav__dropdown-item"},bs={class:"nav__dropdown-item"},ks={class:"nav__dropdown-item"},Is={class:"nav__dropdown-item"},Ps={class:"nav__dropdown-item"},Ss={class:"nav__item"},Cs=["aria-expanded"],Ls={class:"nav__dropdown-item"},Fs={class:"nav__dropdown-item"},Es={class:"nav__dropdown-item"},xs={class:"nav__item"},Ds=["aria-expanded"],Rs={class:"nav__dropdown-item"},Ts={class:"nav__dropdown-item"},$s={class:"nav__dropdown-item"},js={class:"nav__item"},Ns=["aria-expanded"],Ms={class:"nav__dropdown-item"},As={class:"header-right-section"},_s={class:"header-second"},Us={class:"header-second-center-container"},Os={class:"header-second-right"};function Ws(e,t,i,a,r,l){const d=(0,o.g2)("UserCircle"),c=(0,o.g2)("Play"),h=(0,o.g2)("Square"),p=(0,o.g2)("Save"),u=(0,o.g2)("Settings"),m=Zo;return(0,o.uX)(),(0,o.CE)("div",es,[(0,o.Lk)("div",ts,[(0,o.Lk)("nav",is,[(0,o.Lk)("ul",os,[(0,o.Lk)("li",ss,[(0,o.Lk)("button",{class:"nav__item-button",onClick:t[0]||(t[0]=(0,s.D$)(e=>l.toggleDropdown("file"),["stop"])),"aria-haspopup":"menu","aria-expanded":"file"===r.activeDropdown},t[37]||(t[37]=[(0,o.Lk)("span",{class:"nav__item-header"},"File",-1),(0,o.Lk)("svg",{class:"nav__item-triangle",width:"9",height:"6",viewBox:"0 0 9 6",xmlns:"http://www.w3.org/2000/svg"},[(0,o.Lk)("polygon",{points:"4.5 6 9 0 0 0",fill:"currentColor"})],-1)]),8,ns),(0,o.bo)((0,o.Lk)("ul",{class:"nav__dropdown",onClick:t[8]||(t[8]=(0,s.D$)(()=>{},["stop"]))},[(0,o.Lk)("li",as,[(0,o.Lk)("button",{onClick:t[1]||(t[1]=e=>l.newFile())},t[38]||(t[38]=[(0,o.Lk)("span",null,"New File",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+Alt+N",-1)]))]),(0,o.Lk)("li",rs,[(0,o.Lk)("button",{onClick:t[2]||(t[2]=e=>l.openFile())},t[39]||(t[39]=[(0,o.Lk)("span",null,"Open File",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+O",-1)]))]),(0,o.Lk)("li",ls,[(0,o.Lk)("button",{onClick:t[3]||(t[3]=e=>l.duplicateFile()),disabled:!l.hasSelectedFile},t[40]||(t[40]=[(0,o.Lk)("span",null,"Duplicate (Make a copy)",-1)]),8,ds)]),(0,o.Lk)("li",cs,[(0,o.Lk)("button",{onClick:t[4]||(t[4]=e=>l.saveFile())},t[41]||(t[41]=[(0,o.Lk)("span",null,"Save",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+S",-1)]))]),(0,o.Lk)("li",hs,[(0,o.Lk)("button",{onClick:t[5]||(t[5]=e=>l.saveAsFile()),disabled:!l.canSaveAsFile},t[42]||(t[42]=[(0,o.Lk)("span",null,"Save As",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+Shift+S",-1)]),8,ps)]),(0,o.Lk)("li",us,[(0,o.Lk)("button",{onClick:t[6]||(t[6]=e=>l.moveFile()),disabled:!l.hasSelectedFile},t[43]||(t[43]=[(0,o.Lk)("span",null,"Move",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+Shift+M",-1)]),8,ms)]),(0,o.Lk)("li",fs,[(0,o.Lk)("button",{onClick:t[7]||(t[7]=e=>l.downloadFile())},t[44]||(t[44]=[(0,o.Lk)("span",null,"Download",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+D",-1)]))])],512),[[s.aG,"file"===r.activeDropdown]])]),(0,o.Lk)("li",gs,[(0,o.Lk)("button",{class:"nav__item-button",onClick:t[9]||(t[9]=(0,s.D$)(e=>l.toggleDropdown("edit"),["stop"])),"aria-haspopup":"menu","aria-expanded":"edit"===r.activeDropdown},t[45]||(t[45]=[(0,o.Lk)("span",{class:"nav__item-header"},"Edit",-1),(0,o.Lk)("svg",{class:"nav__item-triangle",width:"9",height:"6",viewBox:"0 0 9 6",xmlns:"http://www.w3.org/2000/svg"},[(0,o.Lk)("polygon",{points:"4.5 6 9 0 0 0",fill:"currentColor"})],-1)]),8,vs),(0,o.bo)((0,o.Lk)("ul",{class:"nav__dropdown",onClick:t[16]||(t[16]=(0,s.D$)(()=>{},["stop"]))},[(0,o.Lk)("li",ws,[(0,o.Lk)("button",{onClick:t[10]||(t[10]=e=>l.undo())},t[46]||(t[46]=[(0,o.Lk)("span",null,"Undo",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+Z",-1)]))]),(0,o.Lk)("li",ys,[(0,o.Lk)("button",{onClick:t[11]||(t[11]=e=>l.redo())},t[47]||(t[47]=[(0,o.Lk)("span",null,"Redo",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+Y",-1)]))]),t[52]||(t[52]=(0,o.Lk)("li",{class:"nav__dropdown-divider"},null,-1)),(0,o.Lk)("li",bs,[(0,o.Lk)("button",{onClick:t[12]||(t[12]=e=>l.cut())},t[48]||(t[48]=[(0,o.Lk)("span",null,"Cut",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+X",-1)]))]),(0,o.Lk)("li",ks,[(0,o.Lk)("button",{onClick:t[13]||(t[13]=e=>l.copy())},t[49]||(t[49]=[(0,o.Lk)("span",null,"Copy",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+C",-1)]))]),(0,o.Lk)("li",Is,[(0,o.Lk)("button",{onClick:t[14]||(t[14]=e=>l.paste())},t[50]||(t[50]=[(0,o.Lk)("span",null,"Paste",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+V",-1)]))]),t[53]||(t[53]=(0,o.Lk)("li",{class:"nav__dropdown-divider"},null,-1)),(0,o.Lk)("li",Ps,[(0,o.Lk)("button",{onClick:t[15]||(t[15]=e=>l.comment())},t[51]||(t[51]=[(0,o.Lk)("span",null,"Comment",-1)]))])],512),[[s.aG,"edit"===r.activeDropdown]])]),(0,o.Lk)("li",Ss,[(0,o.Lk)("button",{class:"nav__item-button",onClick:t[17]||(t[17]=(0,s.D$)(e=>l.toggleDropdown("run"),["stop"])),"aria-haspopup":"menu","aria-expanded":"run"===r.activeDropdown},t[54]||(t[54]=[(0,o.Lk)("span",{class:"nav__item-header"},"Run",-1),(0,o.Lk)("svg",{class:"nav__item-triangle",width:"9",height:"6",viewBox:"0 0 9 6",xmlns:"http://www.w3.org/2000/svg"},[(0,o.Lk)("polygon",{points:"4.5 6 9 0 0 0",fill:"currentColor"})],-1)]),8,Cs),(0,o.bo)((0,o.Lk)("ul",{class:"nav__dropdown",onClick:t[21]||(t[21]=(0,s.D$)(()=>{},["stop"]))},[(0,o.Lk)("li",Ls,[(0,o.Lk)("button",{onClick:t[18]||(t[18]=e=>l.runScript())},t[55]||(t[55]=[(0,o.Lk)("span",null,"Run Script",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"F5",-1)]))]),(0,o.Lk)("li",Fs,[(0,o.Lk)("button",{onClick:t[19]||(t[19]=e=>l.stopScript())},t[56]||(t[56]=[(0,o.Lk)("span",null,"Stop",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Shift+F5",-1)]))]),(0,o.Lk)("li",Es,[(0,o.Lk)("button",{onClick:t[20]||(t[20]=e=>l.clearConsole())},t[57]||(t[57]=[(0,o.Lk)("span",null,"Clear Console",-1)]))])],512),[[s.aG,"run"===r.activeDropdown]])]),(0,o.Lk)("li",xs,[(0,o.Lk)("button",{class:"nav__item-button",onClick:t[22]||(t[22]=(0,s.D$)(e=>l.toggleDropdown("view"),["stop"])),"aria-haspopup":"menu","aria-expanded":"view"===r.activeDropdown},t[58]||(t[58]=[(0,o.Lk)("span",{class:"nav__item-header"},"View",-1),(0,o.Lk)("svg",{class:"nav__item-triangle",width:"9",height:"6",viewBox:"0 0 9 6",xmlns:"http://www.w3.org/2000/svg"},[(0,o.Lk)("polygon",{points:"4.5 6 9 0 0 0",fill:"currentColor"})],-1)]),8,Ds),(0,o.bo)((0,o.Lk)("ul",{class:"nav__dropdown",onClick:t[26]||(t[26]=(0,s.D$)(()=>{},["stop"]))},[(0,o.Lk)("li",Rs,[(0,o.Lk)("button",{onClick:t[23]||(t[23]=e=>l.toggleConsole())},[(0,o.Lk)("span",null,(0,n.v_)(r.consoleVisible?"Hide REPL":"Show REPL"),1),t[59]||(t[59]=(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+`",-1))])]),(0,o.Lk)("li",Ts,[(0,o.Lk)("button",{onClick:t[24]||(t[24]=e=>l.togglePreviewPanel())},[(0,o.Lk)("span",null,(0,n.v_)(r.previewPanelVisible?"Hide Right Panel":"Show Right Panel"),1),t[60]||(t[60]=(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+Shift+P",-1))])]),(0,o.Lk)("li",$s,[(0,o.Lk)("button",{onClick:t[25]||(t[25]=e=>l.toggleSidebar())},[(0,o.Lk)("span",null,(0,n.v_)(r.sidebarVisible?"Hide Sidebar":"Show Sidebar"),1),t[61]||(t[61]=(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"Ctrl+B",-1))])])],512),[[s.aG,"view"===r.activeDropdown]])]),(0,o.Lk)("li",js,[(0,o.Lk)("button",{class:"nav__item-button",onClick:t[27]||(t[27]=(0,s.D$)(e=>l.toggleDropdown("help"),["stop"])),"aria-haspopup":"menu","aria-expanded":"help"===r.activeDropdown},t[62]||(t[62]=[(0,o.Lk)("span",{class:"nav__item-header"},"Help",-1),(0,o.Lk)("svg",{class:"nav__item-triangle",width:"9",height:"6",viewBox:"0 0 9 6",xmlns:"http://www.w3.org/2000/svg"},[(0,o.Lk)("polygon",{points:"4.5 6 9 0 0 0",fill:"currentColor"})],-1)]),8,Ns),(0,o.bo)((0,o.Lk)("ul",{class:"nav__dropdown",onClick:t[29]||(t[29]=(0,s.D$)(()=>{},["stop"]))},[(0,o.Lk)("li",Ms,[(0,o.Lk)("button",{onClick:t[28]||(t[28]=e=>l.showKeyboardShortcuts())},t[63]||(t[63]=[(0,o.Lk)("span",null,"Keyboard Shortcuts",-1),(0,o.Lk)("span",{class:"nav__keyboard-shortcut"},"F1",-1)]))])],512),[[s.aG,"help"===r.activeDropdown]])])])]),(0,o.Lk)("div",As,[i.currentUser?((0,o.uX)(),(0,o.CE)("button",{key:1,class:"user-btn",onClick:t[31]||(t[31]=e=>r.showUserProfile=!0)},[(0,o.bF)(d,{size:18}),(0,o.Lk)("span",null,(0,n.v_)(i.currentUser.username),1)])):((0,o.uX)(),(0,o.CE)("button",{key:0,class:"sign-in-btn",onClick:t[30]||(t[30]=(...e)=>l.handleSignIn&&l.handleSignIn(...e))},[(0,o.bF)(d,{size:18}),t[64]||(t[64]=(0,o.Lk)("span",null,"Sign In",-1))]))])]),(0,o.Lk)("div",_s,[(0,o.Lk)("div",Us,[i.hasRunProgram?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",{key:0,class:"icon-btn run-btn",onClick:t[32]||(t[32]=e=>l.runScript()),title:"Run (F5)"},[(0,o.bF)(c,{size:20})])),i.hasRunProgram?((0,o.uX)(),(0,o.CE)("div",{key:1,class:"icon-btn stop-btn",onClick:t[33]||(t[33]=e=>l.stopScript()),title:"Stop (Shift+F5)"},[(0,o.bF)(h,{size:20})])):(0,o.Q3)("",!0),(0,o.Lk)("div",{class:"icon-btn save-btn",onClick:t[34]||(t[34]=e=>l.saveFile()),title:"Save (Ctrl+S)"},[(0,o.bF)(p,{size:20})])]),(0,o.Lk)("div",Os,[(0,o.Lk)("div",{class:"icon-btn settings-btn",onClick:t[35]||(t[35]=e=>l.openSettings()),title:"Settings"},[(0,o.bF)(u,{size:20})])])]),(0,o.bF)(m,{modelValue:r.showUserProfile,"onUpdate:modelValue":t[36]||(t[36]=e=>r.showUserProfile=e),"current-user":i.currentUser,onLogout:l.handleLogout,onPasswordChanged:l.handlePasswordChanged},null,8,["modelValue","current-user","onLogout","onPasswordChanged"])])}var Vs=i(47478),zs=i(58263),Bs=i(39037);
/**
 * @license lucide-vue-next v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const Xs=(0,Ce.A)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),Hs=(0,Ce.A)("circle-user",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]),Ks=(0,Ce.A)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var Gs=i(96763),Qs={props:{consoleLimit:Boolean,hasRunProgram:Boolean,currentUser:{type:Object,default:null}},data(){return{isRun:!0,activeDropdown:null,consoleVisible:!0,previewPanelVisible:!1,sidebarVisible:!0,showUserProfile:!1}},computed:{ideInfo(){return this.$store?.state?.ide?.ideInfo||{}},isPythonFile(){return this.ideInfo.currProj&&this.ideInfo.currProj.pathSelected&&this.ideInfo.codeItems&&this.ideInfo.codeItems.length>0&&this.ideInfo.currProj.pathSelected.endsWith(".py")},hasSelectedFile(){const e=this.ideInfo.nodeSelected&&"file"===this.ideInfo.nodeSelected.type;return Gs.log(" [DEBUG] hasSelectedFile computed:",{nodeSelected:this.ideInfo.nodeSelected,nodeType:this.ideInfo.nodeSelected?.type,result:e}),e},canDeleteFile(){const e=this.ideInfo.nodeSelected;return e&&"file"===e.type},deleteButtonTitle(){return this.ideInfo.nodeSelected?"file"!==this.ideInfo.nodeSelected.type?"Can only delete files":`Delete ${this.ideInfo.nodeSelected.label||this.ideInfo.nodeSelected.name}`:"Select a file to delete"},canSaveAsFile(){const e=this.hasSelectedFile,t=this.ideInfo.codeSelected&&this.ideInfo.codeSelected.fileName,i=e||t;return Gs.log(" [DEBUG] canSaveAsFile computed:",{hasSelectedFile:e,nodeSelected:this.ideInfo.nodeSelected,hasCodeSelected:t,codeSelected:this.ideInfo.codeSelected,result:i}),i}},components:{Upload:Pe.A,Play:Vs.A,Square:zs.A,Settings:Bs.A,Trash2:Xs,UserCircle:Hs,Save:Ks,UserProfileModal:Zo},mounted(){const e=localStorage.getItem("theme")||"dark";document.documentElement.setAttribute("data-theme",e),document.addEventListener("click",this.closeDropdowns),Gs.log(" TwoHeaderMenu - Adding keyboard shortcut listener"),document.addEventListener("keydown",this.handleKeyboardShortcuts)},beforeUnmount(){document.removeEventListener("click",this.closeDropdowns),document.removeEventListener("keydown",this.handleKeyboardShortcuts)},methods:{toggleDropdown(e){this.activeDropdown=this.activeDropdown===e?null:e},closeDropdowns(){this.activeDropdown=null},handleKeyboardShortcuts(e){if(e.ctrlKey&&!e.shiftKey&&"s"===e.key)return e.preventDefault(),e.stopPropagation(),void this.saveFile();if(e.ctrlKey&&e.shiftKey&&"S"===e.key)return Gs.log(" [DEBUG] Ctrl+Shift+S keyboard shortcut triggered"),Gs.log(" [DEBUG] canSaveAsFile:",this.canSaveAsFile),e.preventDefault(),e.stopPropagation(),void(this.canSaveAsFile?(Gs.log(" [DEBUG] Calling saveAsFile() from keyboard shortcut"),this.saveAsFile()):Gs.log(" [DEBUG] Cannot save as - no file available"));if(e.ctrlKey&&e.altKey&&!e.shiftKey&&"n"===e.key)return e.preventDefault(),e.stopPropagation(),void this.newFile();if(e.ctrlKey&&!e.shiftKey&&"o"===e.key)return e.preventDefault(),e.stopPropagation(),void this.openFile();if(e.ctrlKey&&!e.shiftKey&&"d"===e.key)return e.preventDefault(),e.stopPropagation(),void this.downloadFile();if(e.ctrlKey&&e.shiftKey&&"M"===e.key)return e.preventDefault(),e.stopPropagation(),void(this.hasSelectedFile&&this.moveFile());if(e.ctrlKey&&!e.shiftKey&&"z"===e.key)return e.preventDefault(),e.stopPropagation(),void this.undo();if(e.ctrlKey&&!e.shiftKey&&"y"===e.key)return e.preventDefault(),e.stopPropagation(),void this.redo();const t=()=>{const e=document.activeElement;return!!e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||e.classList.contains("repl-input")||"true"===e.contentEditable||e.classList.contains("filename-input")||e.classList.contains("el-input__inner")||"textbox"===e.getAttribute("role"))},i=e.ctrlKey||e.metaKey;if(i&&!e.shiftKey&&"x"===e.key){if(t())return;return e.preventDefault(),e.stopPropagation(),void this.cut()}if(i&&!e.shiftKey&&"c"===e.key){if(t())return;return e.preventDefault(),e.stopPropagation(),void this.copy()}if(i&&"v"===e.key){if(t())return;return e.preventDefault(),e.stopPropagation(),void this.paste()}if((e.ctrlKey||e.metaKey)&&!e.shiftKey&&"f"===e.key)return e.preventDefault(),void e.stopPropagation();if((e.ctrlKey||e.metaKey)&&!e.shiftKey&&"h"===e.key)return e.preventDefault(),void e.stopPropagation();if(e.ctrlKey&&"/"===e.key)return e.preventDefault(),e.stopPropagation(),void this.comment();if("F5"===e.key&&!e.shiftKey)return e.preventDefault(),e.stopPropagation(),void(this.isPythonFile&&!this.consoleLimit&&this.runScript());if(e.shiftKey&&"F5"===e.key)return e.preventDefault(),e.stopPropagation(),void(this.hasRunProgram&&this.stopScript());if(e.ctrlKey&&"`"===e.key)return e.preventDefault(),e.stopPropagation(),void this.toggleConsole();if(e.ctrlKey&&e.shiftKey&&"P"===e.key)return Gs.log(" [SHORTCUT] Ctrl+Shift+P - Toggle Preview Panel"),e.preventDefault(),e.stopPropagation(),void this.$emit("toggle-preview-panel");if(e.ctrlKey&&!e.shiftKey&&"b"===e.key)return e.preventDefault(),e.stopPropagation(),void this.toggleSidebar();if("F1"===e.key)return e.preventDefault(),e.stopPropagation(),void this.showKeyboardShortcuts();if(e.ctrlKey&&","===e.key)return e.preventDefault(),e.stopPropagation(),void this.openSettings();if(e.altKey&&!e.ctrlKey&&!e.shiftKey&&!e.metaKey){if(Gs.log(" [TAB-NAV] Alt key detected, key:",e.key,"code:",e.code),"ArrowLeft"===e.key)return Gs.log(" [TAB-NAV] Navigate to previous tab"),e.preventDefault(),e.stopPropagation(),void this.$emit("navigate-tab","previous");if("ArrowRight"===e.key)return Gs.log(" [TAB-NAV] Navigate to next tab"),e.preventDefault(),e.stopPropagation(),void this.$emit("navigate-tab","next");const t=e.code.match(/^Digit([1-6])$/);if(t){const i=parseInt(t[1])-1;return Gs.log(" [TAB-NAV] Jump to tab index:",i,"(code:",e.code,")"),e.preventDefault(),e.stopPropagation(),void this.$emit("jump-to-tab",i)}}},newFile(){if(this.closeDropdowns(),!this.ideInfo.nodeSelected||"dir"!==this.ideInfo.nodeSelected.type&&"folder"!==this.ideInfo.nodeSelected.type){const e=this.ideInfo.currProj?.data;e&&this.$store.commit("ide/setNodeSelected",e)}this.$emit("set-text-dialog",{type:"create-file",title:"New File",tips:"Enter file name:",text:"untitled.py"})},saveFile(){this.closeDropdowns(),this.ideInfo.codeSelected&&this.$store.dispatch("ide/saveFile",{codeItem:this.ideInfo.codeSelected,isAutoSave:!1}).then(()=>{Ee.nk.success("File saved")}).catch(e=>{const t=e.message||"Failed to save file";Ee.nk.error(t),Gs.error("[SAVE-ERROR]",e)})},downloadFile(){if(this.closeDropdowns(),this.ideInfo.nodeSelected&&"file"===this.ideInfo.nodeSelected.type){const e=this.ideInfo.nodeSelected,t={fileName:e.label||e.name,filePath:e.path,projectName:e.projectName||this.ideInfo.currProj?.data?.name};this.$emit("download-file",t)}else this.ideInfo.codeSelected?this.$emit("download-file",this.ideInfo.codeSelected):Ee.nk.warning("Please select a file to download")},runScript(){this.closeDropdowns(),this.$emit("run-item")},stopScript(){this.closeDropdowns();for(let e=0;e<this.ideInfo.consoleItems.length;e++)!0===this.ideInfo.consoleItems[e].run&&this.$store.commit("ide/setConsoleItemRun",{index:e,value:!1});this.$emit("stop-item",null)},clearConsole(){this.$emit("clear-console")},deleteSelectedFile(){if(!this.canDeleteFile)return void Ee.nk.warning("Please select a file to delete");const e=this.ideInfo.nodeSelected,t=e.label||e.name;pi.s.confirm(`Are you sure you want to delete "${t}"?`,"Confirm Delete",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then(()=>{this.$emit("delete-selected-file",{path:e.path,type:e.type,projectName:e.projectName||this.ideInfo.currProj?.data?.name})}).catch(()=>{})},openSettings(){this.$emit("open-settings")},handleSignIn(){this.$emit("sign-in")},openFile(){this.closeDropdowns(),this.$emit("open-file-browser")},duplicateFile(){if(Gs.log(" [DEBUG] duplicateFile() called from TwoHeaderMenu"),this.closeDropdowns(),!this.hasSelectedFile)return Gs.log(" [DEBUG] No file selected for duplication"),void Ee.nk.warning("Please select a file to duplicate");const e=this.ideInfo.nodeSelected,t=e.label||e.name,i=t.includes(".")?t.substring(t.lastIndexOf(".")):"",o=t.includes(".")?t.substring(0,t.lastIndexOf(".")):t,s=`${o}_copy${i}`;Gs.log(" [DEBUG] Emitting duplicate-file event:",{originalPath:e.path,newName:s,projectName:e.projectName||this.ideInfo.currProj?.data?.name}),this.$emit("duplicate-file",{originalPath:e.path,newName:s,projectName:e.projectName||this.ideInfo.currProj?.data?.name})},saveAsFile(){if(Gs.log(" [DEBUG] saveAsFile() called"),Gs.log(" [DEBUG] hasSelectedFile:",this.hasSelectedFile),Gs.log(" [DEBUG] nodeSelected:",this.ideInfo.nodeSelected),Gs.log(" [DEBUG] codeSelected:",this.ideInfo.codeSelected),Gs.log(" [DEBUG] canSaveAsFile:",this.canSaveAsFile),this.closeDropdowns(),this.hasSelectedFile){const e=this.ideInfo.nodeSelected,t={fileName:e.label||e.name,filePath:e.path,projectName:e.projectName||this.ideInfo.currProj?.data?.name};return Gs.log(" [DEBUG] Converted tree file to fileInfo:",t),Gs.log(" [DEBUG] Original selectedFile:",e),void this.$emit("save-as-file",t)}if(this.ideInfo.codeSelected)return Gs.log(" [DEBUG] Emitting save-as-file for editor file:",this.ideInfo.codeSelected),void this.$emit("save-as-file",this.ideInfo.codeSelected);Gs.log(" [DEBUG] No file available for save as"),Ee.nk.warning("Please select a file to save")},moveFile(){this.closeDropdowns(),this.hasSelectedFile?this.$emit("open-move-dialog",this.ideInfo.nodeSelected):Ee.nk.warning("Please select a file to move")},deleteFile(){if(this.closeDropdowns(),!this.hasSelectedFile)return void Ee.nk.warning("Please select a file to delete");const e=this.ideInfo.nodeSelected,t=e.label||e.name;pi.s.confirm(`Are you sure you want to delete "${t}"?`,"Confirm Delete",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then(()=>{this.$emit("delete-file",{path:e.path,type:e.type,projectName:e.projectName||this.ideInfo.currProj?.data?.name})}).catch(()=>{})},undo(){this.closeDropdowns(),this.$emit("undo")},redo(){this.closeDropdowns(),this.$emit("redo")},cut(){this.closeDropdowns(),this.$emit("cut")},copy(){this.closeDropdowns(),this.$emit("copy")},paste(){this.closeDropdowns(),this.$emit("paste")},find(){this.closeDropdowns(),this.$emit("find")},replace(){this.closeDropdowns(),this.$emit("replace")},comment(){this.closeDropdowns(),this.$emit("comment")},toggleConsole(){this.closeDropdowns(),this.consoleVisible=!this.consoleVisible,this.$emit("toggle-console",this.consoleVisible)},togglePreviewPanel(){this.closeDropdowns(),Gs.log(" [MENU] Toggle Preview Panel clicked"),this.$emit("toggle-preview-panel")},toggleSidebar(){this.closeDropdowns(),this.sidebarVisible=!this.sidebarVisible,this.$emit("toggle-sidebar",this.sidebarVisible)},showKeyboardShortcuts(){this.closeDropdowns(),this.$emit("show-keyboard-shortcuts")},handleLogout(){localStorage.removeItem("session_id"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("full_name"),this.$emit("logout"),Ee.nk.success("Logged out successfully"),setTimeout(()=>{window.location.reload()},1e3)},handlePasswordChanged(){Ee.nk.success("Password changed successfully!")}}};const Js=(0,k.A)(Qs,[["render",Ws],["__scopeId","data-v-3adfcdfe"]]);var qs=Js;const Ys={class:"main-wrapper ide-wrapper ide-container"},Zs={id:"total-frame",class:"total-frame"},en={id:"left-sidebar",class:"left-sidebar"},tn={id:"center-frame",class:"center-frame"},on={class:"editor-tab-bar"},sn={class:"editor-content"},nn={class:"console-section"},an={class:"console-header"},rn={class:"console-header-left"},ln={class:"console-title"},dn={class:"console-header-center"},cn={key:0,class:"console-header-right"},hn=["title"],pn={class:"console-body"},un={class:"console-output-area",ref:"consoleOutputArea"},mn={key:0,class:"console-text"},fn={key:1,class:"console-error"},gn={key:2,class:"console-input-prompt"},vn={key:3,class:"console-system"},wn={key:4,class:"console-repl-prompt"},yn=["innerHTML"],bn={key:6,class:"console-repl-entry"},kn={key:0,class:"console-repl-prompt"},In=["innerHTML"],Pn={key:1,class:"console-repl-line"},Sn={class:"console-repl-prompt"},Cn=["innerHTML"],Ln={key:7,class:"console-text"},Fn={key:0,class:"console-input-area"},En={class:"input-prompt"},xn={class:"input-field-container"},Dn=["rows"],Rn={key:1,class:"repl-section"},Tn={class:"repl-prompt"},$n={class:"prompt-symbol"},jn=["rows"],Nn={id:"right-sidebar",class:"right-sidebar"},Mn={class:"right-sidebar-placeholder"},An={class:"preview-tabs"},_n=["onClick","onDragstart","onDragover","onDragenter","onDrop"],Un={class:"tab-icon"},On={class:"tab-title"},Wn=["onClick"],Vn={key:0,class:"output-panel"},zn={class:"output-content"},Bn={key:1,class:"media-preview-panel"},Xn={key:2,class:"data-preview-panel"},Hn={key:3,class:"text-preview-panel"},Kn={class:"text-content"},Gn={key:0,class:"right-panel-controls"},Qn=["title"],Jn={class:"tab-count"},qn={key:8,class:"repl-modal"},Yn={class:"repl-modal-content"},Zn={class:"repl-modal-header"},ea={class:"repl-modal-body"};function ta(e,t,i,a,r,l){const d=qs,c=yo.A,h=wo,p=io,u=Mi.A,m=(0,o.g2)("pane"),f=Ni,g=Si.A,v=Pi.A,w=(0,o.g2)("ChevronUp"),y=(0,o.g2)("ChevronDown"),b=(0,o.g2)("Minimize2"),k=(0,o.g2)("splitpanes"),I=Ii.A,C=ki.A,L=(0,o.g2)("ChevronLeft"),F=(0,o.g2)("ChevronRight"),E=bi.A,x=yi.A,D=wi.A,R=vi.A,T=gi,$=Vt,j=vt,N=Te,M=X,A=S.A,_=P;return(0,o.uX)(),(0,o.CE)("div",Ys,[(0,o.bF)(d,{class:"two-header-menu",consoleLimit:l.consoleLimit,hasRunProgram:l.hasRunProgram,currentUser:l.currentUser,onSetTextDialog:l.setTextDialog,onSetDelDialog:l.setDelDialog,onSetProjsDialog:l.setProjsDialog,onRunItem:l.runPathSelected,onStopItem:l.stop,onClearConsole:l.clearConsole,onSignIn:l.handleSignIn,onOpenUploadDialog:t[0]||(t[0]=e=>r.showUploadDialog=!0),onDownloadFile:l.downloadFile,onOpenSettings:t[1]||(t[1]=e=>r.showSettingsModal=!0),onOpenFileBrowser:l.openFileBrowser,onDuplicateFile:l.duplicateFile,onSaveAsFile:l.saveAsFile,onOpenMoveDialog:l.openMoveDialog,onDeleteFile:l.deleteFileFromMenu,onDeleteSelectedFile:l.deleteSelectedFile,onUndo:l.handleUndo,onRedo:l.handleRedo,onCut:l.handleCut,onCopy:l.handleCopy,onPaste:l.handlePaste,onFind:l.handleFind,onReplace:l.handleReplace,onComment:l.handleComment,onToggleConsole:l.toggleConsole,onTogglePreviewPanel:l.togglePreviewPanel,onToggleSidebar:l.toggleLeftSidebar,onShowKeyboardShortcuts:t[2]||(t[2]=e=>r.showKeyboardShortcutsModal=!r.showKeyboardShortcutsModal),onNavigateTab:l.handleNavigateTab,onJumpToTab:l.handleJumpToTab,onCloseCurrentTab:l.handleCloseCurrentTab},null,8,["consoleLimit","hasRunProgram","currentUser","onSetTextDialog","onSetDelDialog","onSetProjsDialog","onRunItem","onStopItem","onClearConsole","onSignIn","onDownloadFile","onOpenFileBrowser","onDuplicateFile","onSaveAsFile","onOpenMoveDialog","onDeleteFile","onDeleteSelectedFile","onUndo","onRedo","onCut","onCopy","onPaste","onFind","onReplace","onComment","onToggleConsole","onTogglePreviewPanel","onToggleSidebar","onNavigateTab","onJumpToTab","onCloseCurrentTab"]),(0,o.bF)(c,{modelValue:r.showSettingsModal,"onUpdate:modelValue":t[3]||(t[3]=e=>r.showSettingsModal=e),onUpdateFontSize:l.updateFontSize,onUpdateLineNumbers:l.updateLineNumbers,onUpdateWordWrap:l.updateWordWrap,onUpdateAutoSave:l.updateAutoSave,onUpdateAutoSaveInterval:l.updateAutoSaveInterval,onUpdateAutoSaveNotifications:l.updateAutoSaveNotifications},null,8,["modelValue","onUpdateFontSize","onUpdateLineNumbers","onUpdateWordWrap","onUpdateAutoSave","onUpdateAutoSaveInterval","onUpdateAutoSaveNotifications"]),(0,o.bF)(h,{modelValue:r.showKeyboardShortcutsModal,"onUpdate:modelValue":t[4]||(t[4]=e=>r.showKeyboardShortcutsModal=e)},null,8,["modelValue"]),(0,o.bF)(p,{modelValue:r.showFindReplaceModal,"onUpdate:modelValue":t[5]||(t[5]=e=>r.showFindReplaceModal=e),mode:r.findReplaceMode},null,8,["modelValue","mode"]),(0,o.Lk)("div",Zs,[(0,o.bF)(k,{class:(0,n.C4)(["default-theme","main-splitpanes",{"has-right-content":r.previewTabs.length>0}])},{default:(0,o.k6)(()=>[(0,o.bF)(m,{size:l.leftSidebarSize,"min-size":l.leftSidebarMinSize,"max-size":l.leftSidebarMaxSize},{default:(0,o.k6)(()=>[(0,o.bo)((0,o.Lk)("div",en,[(0,o.bF)(u,{currentUser:l.currentUser,onGetItem:l.getFile,onContextMenu:r.showContextMenu,onRenameItem:l.handleRenameItem,onDeleteItem:l.handleDeleteItem,onDownloadItem:l.handleDownloadItem,onNewFile:l.handleNewFileFromTree,onNewFolder:l.handleNewFolderFromTree,onImportFile:l.handleImportFileFromTree,onBulkUpload:l.handleBulkUpload},null,8,["currentUser","onGetItem","onContextMenu","onRenameItem","onDeleteItem","onDownloadItem","onNewFile","onNewFolder","onImportFile","onBulkUpload"])],512),[[s.aG,r.leftSidebarVisible&&r.windowWidth>900]])]),_:1},8,["size","min-size","max-size"]),(0,o.bF)(m,{size:l.centerSize,"min-size":30},{default:(0,o.k6)(()=>[(0,o.Lk)("div",tn,[(0,o.bF)(f,{onOpenInRightPanel:l.getFileForRightPanel},null,8,["onOpenInRightPanel"]),(0,o.bF)(k,{horizontal:"",class:"default-theme"},{default:(0,o.k6)(()=>[(0,o.bF)(m,{size:l.editorPaneSize,"min-size":5,"max-size":95},{default:(0,o.k6)(()=>[(0,o.Lk)("div",{class:"editor-section",onClick:t[6]||(t[6]=e=>l.setFocusedPanel("editor"))},[(0,o.Lk)("div",on,[l.ideInfo.codeItems.length>0?((0,o.uX)(),(0,o.Wv)(g,{key:0,onSelectItem:l.selectFile,onCloseItem:l.closeFile,onToggleSidebar:l.toggleLeftSidebar,onReorderTabs:l.handleReorderTabs},null,8,["onSelectItem","onCloseItem","onToggleSidebar","onReorderTabs"])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",sn,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.ideInfo.codeItems,(e,t)=>((0,o.uX)(),(0,o.CE)(o.FK,{key:`${e.projectName||"default"}:${e.path}`},[l.isSelectedFile(e)?((0,o.uX)(),(0,o.Wv)(v,{key:0,codeItem:e,codeItemIndex:t,consoleLimit:l.consoleLimit,wordWrap:r.wordWrap,onRunItem:l.runPathSelected,onUpdateItem:l.updateItem},null,8,["codeItem","codeItemIndex","consoleLimit","wordWrap","onRunItem","onUpdateItem"])):(0,o.Q3)("",!0)],64))),128))])])]),_:1},8,["size"]),(0,o.bF)(m,{size:l.consolePaneSize,"min-size":5,"max-size":95},{default:(0,o.k6)(()=>[(0,o.Lk)("div",nn,[(0,o.Lk)("div",an,[(0,o.Lk)("div",rn,[(0,o.Lk)("span",ln,(0,n.v_)((r.isReplMode,"Console")),1)]),(0,o.Lk)("div",dn,["collapsed"===r.consoleMode?((0,o.uX)(),(0,o.CE)("button",{key:0,class:"console-expand-arrow",onClick:t[7]||(t[7]=(...e)=>l.handleConsoleUpArrow&&l.handleConsoleUpArrow(...e)),title:"Open console"},[(0,o.bF)(w,{size:16})])):(0,o.Q3)("",!0),"normal"===r.consoleMode?((0,o.uX)(),(0,o.CE)("button",{key:1,class:"console-expand-arrow",onClick:t[8]||(t[8]=(...e)=>l.handleConsoleUpArrow&&l.handleConsoleUpArrow(...e)),title:"Maximize console"},[(0,o.bF)(w,{size:16})])):(0,o.Q3)("",!0),"normal"===r.consoleMode?((0,o.uX)(),(0,o.CE)("button",{key:2,class:"console-expand-arrow",onClick:t[9]||(t[9]=(...e)=>l.handleConsoleDownArrow&&l.handleConsoleDownArrow(...e)),title:"Collapse console"},[(0,o.bF)(y,{size:16})])):(0,o.Q3)("",!0),"maximized"===r.consoleMode?((0,o.uX)(),(0,o.CE)("button",{key:3,class:"console-expand-arrow",onClick:t[10]||(t[10]=(...e)=>l.handleConsoleRestore&&l.handleConsoleRestore(...e)),title:"Restore console"},[(0,o.bF)(b,{size:16})])):(0,o.Q3)("",!0),"maximized"===r.consoleMode?((0,o.uX)(),(0,o.CE)("button",{key:4,class:"console-expand-arrow",onClick:t[11]||(t[11]=(...e)=>l.handleConsoleDownArrow&&l.handleConsoleDownArrow(...e)),title:"Collapse console"},[(0,o.bF)(y,{size:16})])):(0,o.Q3)("",!0)]),r.consoleExpanded?((0,o.uX)(),(0,o.CE)("div",cn,[(0,o.Lk)("button",{class:(0,n.C4)(["console-action-btn",{active:r.isReplMode}]),onClick:t[12]||(t[12]=(0,s.D$)((...e)=>l.toggleReplMode&&l.toggleReplMode(...e),["stop"])),title:r.isReplMode?"Exit REPL Mode":"Start Python REPL"},[(0,o.Lk)("span",null,(0,n.v_)(r.isReplMode?"Exit REPL":"REPL"),1)],10,hn),(0,o.Lk)("button",{class:"console-action-btn",onClick:t[13]||(t[13]=(0,s.D$)((...e)=>l.clearConsole&&l.clearConsole(...e),["stop"])),title:"Clear Console"},t[36]||(t[36]=[(0,o.Lk)("span",null,"Clear",-1)]))])):(0,o.Q3)("",!0)]),(0,o.bo)((0,o.Lk)("div",pn,[(0,o.Lk)("div",un,[l.ideInfo.consoleSelected&&l.ideInfo.consoleSelected.resultList?((0,o.uX)(!0),(0,o.CE)(o.FK,{key:0},(0,o.pI)(l.ideInfo.consoleSelected.resultList,(e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:t,class:"console-line"},["output"!==e.type&&"text"!==e.type||l.isPromptOutput(e)?"error"===e.type?((0,o.uX)(),(0,o.CE)("pre",fn,(0,n.v_)(e.text||e.content||e),1)):"input"===e.type||"input-prompt"===e.type?((0,o.uX)(),(0,o.CE)("div",gn,[(0,o.Lk)("span",null,(0,n.v_)(e.text||e.content||e),1)])):"system"===e.type?((0,o.uX)(),(0,o.CE)("pre",vn,(0,n.v_)(e.text||e.content||e),1)):"repl-prompt"===e.type?((0,o.uX)(),(0,o.CE)("span",wn,(0,n.v_)(e.text||">>> "),1)):"user-input"===e.type?((0,o.uX)(),(0,o.CE)("pre",{key:5,class:"console-user-input",innerHTML:l.highlightPythonCode(e.text||e.content||e)},null,8,yn)):"repl-input"===e.type?((0,o.uX)(),(0,o.CE)("div",bn,[l.isMultilineCode(e.content||e.text||e)?((0,o.uX)(!0),(0,o.CE)(o.FK,{key:0},(0,o.pI)(l.splitCodeLines(e.content||e.text||e),(t,i)=>((0,o.uX)(),(0,o.CE)("div",{key:"line-"+i,class:"console-repl-line"},[0===i?((0,o.uX)(),(0,o.CE)("span",kn,(0,n.v_)(e.prompt||">>> "),1)):(0,o.Q3)("",!0),(0,o.Lk)("pre",{class:(0,n.C4)(["console-repl-input",{"no-prompt":i>0}]),innerHTML:l.highlightPythonCode(t)},null,10,In)]))),128)):((0,o.uX)(),(0,o.CE)("div",Pn,[(0,o.Lk)("span",Sn,(0,n.v_)(e.prompt||">>> "),1),(0,o.Lk)("pre",{class:"console-repl-input",innerHTML:l.highlightPythonCode(e.content||e.text||e)},null,8,Cn)]))])):((0,o.uX)(),(0,o.CE)("pre",Ln,(0,n.v_)("object"===typeof e?e.text||e.content||JSON.stringify(e):e),1)):((0,o.uX)(),(0,o.CE)("pre",mn,(0,n.v_)(e.text||e.content||e),1))]))),128)):(0,o.Q3)("",!0)],512),l.ideInfo.consoleSelected&&l.ideInfo.consoleSelected.waitingForInput?((0,o.uX)(),(0,o.CE)("div",Fn,[(0,o.Lk)("div",En,[t[37]||(t[37]=(0,o.Lk)("span",{class:"prompt-icon"},"",-1)),(0,o.Lk)("span",null,(0,n.v_)(l.ideInfo.consoleSelected.inputPrompt||"Enter input:"),1)]),(0,o.Lk)("div",xn,[(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":t[14]||(t[14]=e=>r.programInput=e),onKeydown:t[15]||(t[15]=(...e)=>l.handleProgramInputKeydown&&l.handleProgramInputKeydown(...e)),ref:"programInputField",class:"program-input-field",placeholder:"Type your input and press Enter...",rows:r.programInputRows,autofocus:""},null,40,Dn),[[s.Jo,r.programInput]]),(0,o.Lk)("button",{onClick:t[16]||(t[16]=(...e)=>l.sendProgramInput&&l.sendProgramInput(...e)),class:"input-submit-btn"},"Send")])])):(0,o.Q3)("",!0),r.isReplMode||l.ideInfo.consoleSelected&&l.ideInfo.consoleSelected.waitingForReplInput?((0,o.uX)(),(0,o.CE)("div",Rn,[(0,o.Lk)("div",Tn,[(0,o.Lk)("span",$n,(0,n.v_)(r.replPrompt||">>> "),1),(0,o.bo)((0,o.Lk)("textarea",{class:"repl-input",placeholder:"Enter Python code...","onUpdate:modelValue":t[17]||(t[17]=e=>r.replInput=e),onKeydown:t[18]||(t[18]=(...e)=>l.handleReplKeydown&&l.handleReplKeydown(...e)),ref:"replInputField",rows:r.replInputRows},"                ",40,jn),[[s.Jo,r.replInput]])])])):(0,o.Q3)("",!0)],512),[[s.aG,r.consoleExpanded]])])]),_:1},8,["size"])]),_:1})])]),_:1},8,["size"]),(0,o.bF)(m,{size:l.rightSidebarSize,"min-size":l.rightSidebarMinSize,"max-size":l.rightSidebarMaxSize,"push-other-panes":!1},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Nn,[(0,o.bo)((0,o.Lk)("div",Mn,null,512),[[s.aG,!r.rightSidebarVisible||0===r.previewTabs.length]]),(0,o.bo)((0,o.Lk)("div",An,[(0,o.Lk)("div",{class:"preview-tab-list",onDragover:t[21]||(t[21]=(0,s.D$)(()=>{},["prevent"])),onDrop:t[22]||(t[22]=(...e)=>l.handlePreviewDropOnContainer&&l.handlePreviewDropOnContainer(...e))},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.previewTabs,(e,i)=>((0,o.uX)(),(0,o.CE)("button",{key:e.id,class:(0,n.C4)(["preview-tab",{active:r.selectedPreviewTab===e.id,dragging:r.previewDraggedIndex===i,"drop-target-left":r.previewDropTargetIndex===i&&r.previewDraggedIndex>i,"drop-target-right":r.previewDropTargetIndex===i&&r.previewDraggedIndex<i}]),draggable:"true",onClick:t=>l.selectPreviewTab(e.id),onDragstart:e=>l.handlePreviewDragStart(e,i),onDragover:e=>l.handlePreviewDragOver(e,i),onDragenter:e=>l.handlePreviewDragEnter(e,i),onDragleave:t[19]||(t[19]=e=>l.handlePreviewDragLeave(e)),onDrop:e=>l.handlePreviewDrop(e,i),onDragend:t[20]||(t[20]=(...e)=>l.handlePreviewDragEnd&&l.handlePreviewDragEnd(...e))},[(0,o.Lk)("span",Un,(0,n.v_)(l.getTabIcon(e.type)),1),(0,o.Lk)("span",On,(0,n.v_)(e.title),1),(0,o.Lk)("span",{class:"tab-close",onClick:(0,s.D$)(t=>l.closePreviewTab(e.id),["stop"])},"",8,Wn)],42,_n))),128))],32)],512),[[s.aG,r.rightSidebarVisible&&r.previewTabs.length>0]]),(0,o.bo)((0,o.Lk)("div",{class:"preview-content",onClick:t[23]||(t[23]=e=>l.setFocusedPanel("preview"))},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.previewTabs,e=>(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"preview-panel"},["output"===e.type?((0,o.uX)(),(0,o.CE)("div",Vn,[(0,o.Lk)("div",zn,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.content,(e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:t,class:(0,n.C4)(["output-line",e.type])},[(0,o.Lk)("pre",null,(0,n.v_)(e.text),1)],2))),128))])])):"image"===e.type||"pdf"===e.type?((0,o.uX)(),(0,o.CE)("div",Bn,[(0,o.bF)(I,{codeItem:l.getMediaCodeItem(e),codeItemIndex:0},null,8,["codeItem"])])):"data"===e.type?((0,o.uX)(),(0,o.CE)("div",Xn,[(0,o.bF)(C,{content:e.content},null,8,["content"])])):"text"===e.type?((0,o.uX)(),(0,o.CE)("div",Hn,[(0,o.Lk)("pre",Kn,(0,n.v_)(e.content),1)])):(0,o.Q3)("",!0)],512)),[[s.aG,r.selectedPreviewTab===e.id]])),128))],512),[[s.aG,r.rightSidebarVisible&&r.previewTabs.length>0]])])]),_:1},8,["size","min-size","max-size"])]),_:1},8,["class"]),"closed"!==r.rightPanelMode&&r.previewTabs.length>0?((0,o.uX)(),(0,o.CE)("div",Gn,["normal"===r.rightPanelMode?((0,o.uX)(),(0,o.CE)("button",{key:0,class:"control-arrow left-arrow",onClick:t[24]||(t[24]=(...e)=>l.handleLeftArrowClick&&l.handleLeftArrowClick(...e)),title:"Expand preview to full width"},[(0,o.bF)(L,{size:16})])):(0,o.Q3)("",!0),(0,o.Lk)("button",{class:"control-arrow right-arrow",onClick:t[25]||(t[25]=(...e)=>l.handleRightArrowClick&&l.handleRightArrowClick(...e)),title:"expanded"===r.rightPanelMode?"Restore to normal size":"Collapse preview panel"},[(0,o.bF)(F,{size:16})],8,Qn)])):(0,o.Q3)("",!0),"closed"===r.rightPanelMode&&r.previewTabs.length>0?((0,o.uX)(),(0,o.CE)("div",{key:1,class:"show-preview-btn",onClick:t[26]||(t[26]=(...e)=>l.restoreRightPanel&&l.restoreRightPanel(...e)),title:"Show Preview Panel"},[(0,o.Lk)("span",Jn,(0,n.v_)(r.previewTabs.length),1),t[38]||(t[38]=(0,o.Lk)("span",null,"",-1))])):(0,o.Q3)("",!0)]),r.showProjsDialog?((0,o.uX)(),(0,o.Wv)(E,{key:0,onOnCancel:l.onCloseProjsDialog,onOnSelect:l.onSelectProj,onOnDelete:l.onDeleteProj,onSetTextDialog:l.setTextDialog},null,8,["onOnCancel","onOnSelect","onOnDelete","onSetTextDialog"])):(0,o.Q3)("",!0),r.showFileDialog?((0,o.uX)(),(0,o.Wv)(x,{key:1,title:r.dialogTitle,text:r.dialogText,tips:r.dialogTips,onCheckInput:l.inputIsLegal,onOnCancel:l.onCloseTextDialog,onOnCreate:l.onCreate},null,8,["title","text","tips","onCheckInput","onOnCancel","onOnCreate"])):(0,o.Q3)("",!0),r.showDeleteDialog?((0,o.uX)(),(0,o.Wv)(D,{key:2,title:r.dialogTitle,onOnCancel:l.onCancelDelete,onOnDelete:l.onDelete},null,8,["title","onOnCancel","onOnDelete"])):(0,o.Q3)("",!0),r.showUploadDialog?((0,o.uX)(),(0,o.Wv)(R,{key:3,modelValue:r.showUploadDialog,"onUpdate:modelValue":t[27]||(t[27]=e=>r.showUploadDialog=e),onRefreshTree:l.refreshProjectTree,onClose:t[28]||(t[28]=e=>r.showUploadDialog=!1)},null,8,["modelValue","onRefreshTree"])):(0,o.Q3)("",!0),r.showNewFileDialog?((0,o.uX)(),(0,o.Wv)(T,{key:4,modelValue:r.showNewFileDialog,"onUpdate:modelValue":t[29]||(t[29]=e=>r.showNewFileDialog=e),onFileCreated:l.handleFileCreated},null,8,["modelValue","onFileCreated"])):(0,o.Q3)("",!0),r.showNewFolderDialog?((0,o.uX)(),(0,o.Wv)($,{key:5,modelValue:r.showNewFolderDialog,"onUpdate:modelValue":t[30]||(t[30]=e=>r.showNewFolderDialog=e),onFolderCreated:l.handleFolderCreated},null,8,["modelValue","onFolderCreated"])):(0,o.Q3)("",!0),r.showImportFileDialog?((0,o.uX)(),(0,o.Wv)(j,{key:6,modelValue:r.showImportFileDialog,"onUpdate:modelValue":t[31]||(t[31]=e=>r.showImportFileDialog=e),onFilesImported:l.handleFilesImported},null,8,["modelValue","onFilesImported"])):(0,o.Q3)("",!0),r.showBulkUploadDialog?((0,o.uX)(),(0,o.Wv)(N,{key:7,modelValue:r.showBulkUploadDialog,"onUpdate:modelValue":t[32]||(t[32]=e=>r.showBulkUploadDialog=e)},null,8,["modelValue"])):(0,o.Q3)("",!0),(0,o.bF)(M,{modelValue:r.showFileBrowserDialog,"onUpdate:modelValue":t[33]||(t[33]=e=>r.showFileBrowserDialog=e),mode:r.fileBrowserMode,fileToMove:r.fileToMove,currentUser:l.currentUser,onOpenFile:l.handleOpenFile,onMoveFile:l.handleMoveFile},null,8,["modelValue","mode","fileToMove","currentUser","onOpenFile","onMoveFile"]),r.showREPL?((0,o.uX)(),(0,o.CE)("div",qn,[(0,o.Lk)("div",Yn,[(0,o.Lk)("div",Zn,[t[39]||(t[39]=(0,o.Lk)("h3",null,"Python REPL (Interactive Console)",-1)),(0,o.Lk)("button",{onClick:t[34]||(t[34]=(...e)=>l.closeREPL&&l.closeREPL(...e)),class:"repl-close-btn"},"")]),(0,o.Lk)("div",ea,[(0,o.bF)(A)])])])):(0,o.Q3)("",!0),(0,o.bF)(_,{visible:r.showLoginModal,onClose:t[35]||(t[35]=e=>r.showLoginModal=!1),onLoginSuccess:l.handleLoginSuccess},null,8,["visible","onLoginSuccess"])])}i(16573),i(78100),i(77936),i(79577),i(41549),i(49797),i(49631),i(35623),i(64979),i(14603),i(47566),i(98721);var ia=i(99415),oa=i(33887);
/**
 * @license lucide-vue-next v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const sa=(0,Ce.A)("minimize-2",[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]]),na={class:"hybrid-console"},aa={class:"console-output",ref:"consoleOutput"},ra={key:1,class:"output-text error-output"},la={key:2,class:"output-text system-message"},da={key:3,class:"input-prompt-line"},ca={class:"prompt-text"},ha={key:4,class:"user-input-line"},pa={class:"input-text"},ua={class:"repl-prompt"},ma={key:6,class:"repl-output"},fa={key:7,class:"figure-container"},ga=["src"],va={class:"figure-controls"},wa=["onClick"],ya=["onClick"],ba={key:0,class:"loading-indicator"},ka={key:0,class:"input-area"},Ia={key:0,class:"input-prompt-display"},Pa={class:"prompt-label"},Sa={key:1,class:"repl-input-container"},Ca={class:"repl-input-prefix"},La={class:"repl-editor-wrapper"},Fa={key:2,class:"input-container"},Ea=["rows"],xa=["disabled"],Da={class:"input-hint"},Ra={key:0},Ta={key:1},$a={class:"console-status"},ja={class:"status-left"},Na={key:0,class:"status-item repl"},Ma={key:1,class:"status-item running"},Aa={key:2,class:"status-item success"},_a={key:3,class:"status-item error"},Ua={key:4,class:"status-item idle"},Oa={class:"status-right"};function Wa(e,t,i,a,r,l){const d=(0,o.g2)("Codemirror");return(0,o.uX)(),(0,o.CE)("div",na,[(0,o.Lk)("div",aa,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.outputLines,(e,i)=>((0,o.uX)(),(0,o.CE)("div",{key:i,class:"output-line"},["text"===e.type?((0,o.uX)(),(0,o.CE)("pre",{key:0,class:(0,n.C4)(["output-text",e.class])},(0,n.v_)(e.content),3)):"error"===e.type?((0,o.uX)(),(0,o.CE)("pre",ra,(0,n.v_)(e.content),1)):"system"===e.type?((0,o.uX)(),(0,o.CE)("pre",la,(0,n.v_)(e.content),1)):"input-prompt"===e.type?((0,o.uX)(),(0,o.CE)("div",da,[t[9]||(t[9]=(0,o.Lk)("span",{class:"prompt-indicator"},"",-1)),(0,o.Lk)("span",ca,(0,n.v_)(e.content),1)])):"user-input"===e.type?((0,o.uX)(),(0,o.CE)("div",ha,[t[10]||(t[10]=(0,o.Lk)("span",{class:"input-indicator"},"",-1)),(0,o.Lk)("span",pa,(0,n.v_)(e.content),1)])):"repl-input"===e.type?((0,o.uX)(),(0,o.CE)("div",{key:5,class:(0,n.C4)(["repl-line",{multiline:e.multiline}])},[(0,o.Lk)("span",ua,(0,n.v_)(e.prompt),1),(0,o.Lk)("pre",{class:(0,n.C4)(["repl-input-text",{"multiline-content":e.multiline}])},(0,n.v_)(e.content),3)],2)):"repl-output"===e.type?((0,o.uX)(),(0,o.CE)("pre",ma,(0,n.v_)(e.content),1)):"figure"===e.type?((0,o.uX)(),(0,o.CE)("div",fa,[(0,o.Lk)("img",{src:`data:image/png;base64,${e.data}`,alt:"Matplotlib Figure",class:"matplotlib-figure"},null,8,ga),(0,o.Lk)("div",va,[(0,o.Lk)("button",{class:"figure-btn",onClick:t=>a.downloadFigure(e.data),title:"Download"},"  ",8,wa),(0,o.Lk)("button",{class:"figure-btn",onClick:t=>a.openFigureInNewTab(e.data),title:"Open in new tab"},"  ",8,ya)])])):(0,o.Q3)("",!0)]))),128)),!i.isRunning||a.waitingForInput||a.isReplMode?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",ba,t[11]||(t[11]=[(0,o.Lk)("span",{class:"loading-dots"},"",-1),(0,o.Lk)("span",{class:"loading-text"},"Running...",-1)])))],512),a.waitingForInput||a.isReplMode?((0,o.uX)(),(0,o.CE)("div",ka,[a.waitingForInput&&!a.isReplMode?((0,o.uX)(),(0,o.CE)("div",Ia,[t[12]||(t[12]=(0,o.Lk)("span",{class:"prompt-icon"},"",-1)),(0,o.Lk)("span",Pa,(0,n.v_)(a.currentPrompt||"Waiting for input..."),1)])):(0,o.Q3)("",!0),a.isReplMode?((0,o.uX)(),(0,o.CE)("div",Sa,[(0,o.Lk)("span",Ca,(0,n.v_)(a.replPrompt),1),(0,o.Lk)("div",La,[(0,o.bF)(d,{value:a.userInput,"onUpdate:value":t[0]||(t[0]=e=>a.userInput=e),options:a.replCodeMirrorOptions,onKeydown:a.handleKeyDown,ref:"replEditor",class:"repl-codemirror",placeholder:"Enter Python code..."},null,8,["value","options","onKeydown"])])])):((0,o.uX)(),(0,o.CE)("div",Fa,[t[13]||(t[13]=(0,o.Lk)("span",{class:"input-prefix"},"",-1)),(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>a.userInput=e),onKeydown:t[2]||(t[2]=(...e)=>a.handleKeyDown&&a.handleKeyDown(...e)),onPaste:t[3]||(t[3]=(...e)=>a.handleTextareaPaste&&a.handleTextareaPaste(...e)),ref:"inputField",class:"user-input-field",placeholder:"Type your input and press Enter...",rows:a.inputRows,autofocus:""},null,40,Ea),[[s.Jo,a.userInput]]),(0,o.Lk)("button",{class:"input-btn primary",onClick:t[4]||(t[4]=(...e)=>a.sendInput&&a.sendInput(...e)),disabled:!a.userInput.trim(),title:"Submit (Enter)"},"  ",8,xa),(0,o.Lk)("button",{class:"input-btn secondary",onClick:t[5]||(t[5]=(...e)=>a.cancelInput&&a.cancelInput(...e)),title:"Cancel (Escape)"},"  ")])),(0,o.Lk)("div",Da,[a.isReplMode?((0,o.uX)(),(0,o.CE)("span",Ra,"Enter: Execute | Shift+Enter: New line | Up/Down: History")):((0,o.uX)(),(0,o.CE)("span",Ta,"Press Enter to submit  Escape to cancel"))])])):(0,o.Q3)("",!0),(0,o.Lk)("div",$a,[(0,o.Lk)("div",ja,[a.isReplMode?((0,o.uX)(),(0,o.CE)("span",Na,t[14]||(t[14]=[(0,o.Lk)("span",{class:"status-dot repl"},null,-1),(0,o.eW)(" REPL Mode ",-1)]))):i.isRunning?((0,o.uX)(),(0,o.CE)("span",Ma,[t[15]||(t[15]=(0,o.Lk)("span",{class:"status-dot"},null,-1)),(0,o.eW)(" Running "+(0,n.v_)(a.currentProgram),1)])):0===a.lastExitCode?((0,o.uX)(),(0,o.CE)("span",Aa,t[16]||(t[16]=[(0,o.Lk)("span",{class:"status-dot"},null,-1),(0,o.eW)(" Ready ",-1)]))):null!==a.lastExitCode?((0,o.uX)(),(0,o.CE)("span",_a,[t[17]||(t[17]=(0,o.Lk)("span",{class:"status-dot"},null,-1)),(0,o.eW)(" Exit code: "+(0,n.v_)(a.lastExitCode),1)])):((0,o.uX)(),(0,o.CE)("span",Ua,t[18]||(t[18]=[(0,o.Lk)("span",{class:"status-dot"},null,-1),(0,o.eW)(" Idle ",-1)])))]),(0,o.Lk)("div",Oa,[(0,o.Lk)("button",{class:"status-btn",onClick:t[6]||(t[6]=(...e)=>a.clearConsole&&a.clearConsole(...e)),title:"Clear console"},""),(0,o.Lk)("button",{class:"status-btn",onClick:t[7]||(t[7]=(...e)=>a.exportOutput&&a.exportOutput(...e)),title:"Export output"},""),i.isRunning||a.isReplMode?((0,o.uX)(),(0,o.CE)("button",{key:0,class:"status-btn danger",onClick:t[8]||(t[8]=(...e)=>a.stopProgram&&a.stopProgram(...e)),title:"Stop"},"")):(0,o.Q3)("",!0)])])])}var Va=i(50953),za=i(277),Ba=i(42453),Xa=i(15237),Ha=i.n(Xa),Ka=(i(74806),i(50436),i(97923),i(55218),i(44317),i(57829),i(96763)),Ga={name:"HybridConsole",components:{Codemirror:Ba.Ay},props:{item:{type:Object,required:!0},isRunning:{type:Boolean,default:!1}},emits:["run-item","stop-item","send-input"],setup(e,{emit:t}){const i=(0,Va.KR)([]),s=(0,Va.KR)(!1),n=(0,Va.KR)(""),a=(0,Va.KR)(""),r=(0,Va.KR)(null),l=(0,Va.KR)(""),d=(0,Va.KR)(!1),c=(0,Va.KR)(">>> "),h=(0,Va.KR)([]),p=(0,Va.KR)(-1),u=(0,Va.KR)(1),m=(0,Va.KR)(null),f=(0,Va.KR)(null),g=(0,Va.KR)(null),v=(0,Va.KR)({mode:{name:"python",version:3,singleLineStringErrors:!1},theme:"repl-theme",lineNumbers:!1,smartIndent:!0,indentUnit:4,tabSize:4,indentWithTabs:!1,matchBrackets:!0,autoCloseBrackets:!0,styleActiveLine:!1,lineWrapping:!0,showCursorWhenSelecting:!0,viewportMargin:1/0,scrollbarStyle:null,autofocus:!0,extraKeys:{Enter:e=>{const t=e.getCursor(),i=e.getLine(t.line),o=e.getValue().trim(),s=i.trim().endsWith(":")||i.trim().endsWith("\\")||/^\s+/.test(i)||o.split("\n").some((e,i)=>i<t.line&&e.trim().endsWith(":"));if(s||t.line<e.lastLine()){const t=i.match(/^\s*/)[0],o=i.trim().endsWith(":")?"    ":"";e.replaceSelection("\n"+t+o)}else o?x():e.replaceSelection("\n")},"Shift-Enter":e=>{const t=e.getCursor(),i=e.getLine(t.line),o=i.match(/^\s*/)[0];e.replaceSelection("\n"+o)},Up:e=>{0!==e.getCursor().line||e.getSelection()?Ha().commands.goLineUp(e):D("up")},Down:e=>{e.getCursor().line!==e.lastLine()||e.getSelection()?Ha().commands.goLineDown(e):D("down")},Tab:e=>{e.getSelection()?e.indentSelection("add"):e.replaceSelection(Array(e.getOption("indentUnit")+1).join(" "))},"Shift-Tab":e=>{e.indentSelection("subtract")},"Ctrl-V":async e=>{await y(e)},"Shift-Ctrl-V":async e=>{await y(e)},"Cmd-V":async e=>{await y(e)},"Shift-Cmd-V":async e=>{await y(e)},"Ctrl-C":e=>{const t=e.getSelection();return t&&(za.A.trackIDECopy(t),navigator.clipboard&&navigator.clipboard.writeText&&window.isSecureContext&&navigator.clipboard.writeText(t)),!1},"Cmd-C":e=>{const t=e.getSelection();return t&&(za.A.trackIDECopy(t),navigator.clipboard&&navigator.clipboard.writeText&&window.isSecureContext&&navigator.clipboard.writeText(t)),!1}}}),w=(0,o.EW)(()=>{if(!a.value)return 1;const e=a.value.split("\n").length;return Math.min(Math.max(e,1),10)});(0,o.wB)(a,()=>{u.value=w.value});const y=async e=>{try{if(navigator.clipboard&&navigator.clipboard.readText&&window.isSecureContext){const t=await navigator.clipboard.readText(),i=await za.A.validatePaste(t);i&&e.replaceSelection(t)}}catch(t){za.A.isProfessor()?Ka.log("[HybridConsole] Clipboard read failed for professor, native paste allowed"):Ka.log("[HybridConsole] Paste blocked for student (clipboard API failed)")}},b=async e=>{if(!za.A.isProfessor()){e.preventDefault(),e.stopPropagation();const t=e.clipboardData||window.clipboardData,i=t?.getData("text");if(i){const t=await za.A.validatePaste(i);if(t){const t=e.target,s=t.selectionStart,n=t.selectionEnd,r=t.value;a.value=r.substring(0,s)+i+r.substring(n),(0,o.dY)(()=>{t.selectionStart=t.selectionEnd=s+i.length})}}}},k=(e,t="text",s="")=>{i.value.push({type:t,content:e,class:s,timestamp:Date.now()}),(0,o.dY)(()=>{N()})},I=(e,t,s="repl-input")=>{const n=t.includes("\n")&&""!==t.trim()||t.trim().match(/^(def|class|if|for|while|with|try|except|finally)\s/)&&t.trim().endsWith(":");i.value.push({type:s,prompt:e,content:t,timestamp:Date.now(),multiline:n}),(0,o.dY)(()=>{N()})},P=e=>{i.value.push({type:"figure",data:e,timestamp:Date.now()}),(0,o.dY)(()=>{N()})},S=e=>{const t=e||"Program waiting for input:";n.value=t,s.value=!0,k(e||"Program waiting for input:","input-prompt"),(0,o.dY)(()=>{f.value&&f.value.focus()})},C=async e=>{if(!za.A.isProfessor()){e.preventDefault(),e.stopPropagation();const t=e.clipboardData||window.clipboardData,i=t?.getData("text");if(i){const e=await za.A.validatePaste(i);e&&g.value?.cminstance&&g.value.cminstance.replaceSelection(i)}}},L=()=>{d.value=!0,s.value=!1,c.value=">>> ",a.value="",p.value=-1,(0,o.dY)(()=>{setTimeout(()=>{if(g.value?.cminstance){g.value.cminstance.refresh(),g.value.cminstance.focus();const e=g.value.$el;e&&!e._replPasteListenerAdded&&(e.addEventListener("paste",C,!0),e._replPasteListenerAdded=!0)}else f.value&&f.value.focus()},100)})},F=()=>{d.value=!1,c.value=">>> ",a.value="",h.value=[],p.value=-1},E=e=>{d.value?"Enter"!==e.key||e.shiftKey?"Enter"===e.key&&e.shiftKey?c.value="... ":"ArrowUp"===e.key?(e.preventDefault(),D("up")):"ArrowDown"===e.key&&(e.preventDefault(),D("down")):(e.preventDefault(),x()):"Enter"!==e.key||e.shiftKey?"Escape"===e.key&&(e.preventDefault(),T()):(e.preventDefault(),R())},x=()=>{const i=d.value&&g.value?.cminstance?.getValue()||a.value;if(!i.trim())return I(c.value,"","repl-input"),void(c.value=">>> ");i.trim()&&(h.value.push(i),p.value=h.value.length),I(c.value,i,"repl-input"),t("send-input",{programId:e.item.id,input:i,isRepl:!0}),d.value&&g.value?.cminstance&&(g.value.cminstance.setValue(""),(0,o.dY)(()=>{g.value.cminstance.refresh(),g.value.cminstance.focus()})),a.value="",c.value=">>> ",u.value=1},D=e=>{if(0!==h.value.length)if("up"===e){p.value>0?p.value--:-1!==p.value&&p.value!==h.value.length||(p.value=h.value.length-1);const e=h.value[p.value]||"";if(d.value&&g.value?.cminstance){g.value.cminstance.setValue(e);const t=g.value.cminstance.getDoc(),i=t.lastLine(),o=t.getLine(i).length;t.setCursor(i,o)}else a.value=e}else if("down"===e)if(p.value<h.value.length-1){p.value++;const e=h.value[p.value]||"";if(d.value&&g.value?.cminstance){g.value.cminstance.setValue(e);const t=g.value.cminstance.getDoc(),i=t.lastLine(),o=t.getLine(i).length;t.setCursor(i,o)}else a.value=e}else p.value=h.value.length,d.value&&g.value?.cminstance?g.value.cminstance.setValue(""):a.value=""},R=()=>{if(!a.value.trim()&&!s.value)return;const i=a.value;k(i,"user-input"),a.value="",s.value=!1,n.value="",u.value=1,t("send-input",{programId:e.item.id,input:i,isRepl:!1})},T=()=>{a.value="",s.value=!1,n.value="",u.value=1,t("send-input",{programId:e.item.id,input:"",isRepl:!1})},$=()=>{i.value=[],r.value=null,d.value||(h.value=[],p.value=-1),Ee.nk.success("Console cleared")},j=()=>{d.value&&F(),t("stop-item",e.item.id)},N=()=>{m.value&&(m.value.scrollTop=m.value.scrollHeight)},M=e=>{const t=document.createElement("a");t.href=`data:image/png;base64,${e}`,t.download=`figure_${Date.now()}.png`,t.click()},A=e=>{const t=`data:image/png;base64,${e}`;window.open(t,"_blank")},_=()=>{const e=i.value.map(e=>"text"===e.type||"error"===e.type||"system"===e.type?e.content:"input-prompt"===e.type?`Prompt: ${e.content}`:"user-input"===e.type?`> ${e.content}`:"repl-input"===e.type?`${e.prompt}${e.content}`:"repl-output"===e.type?e.content:"").join("\n"),t=new Blob([e],{type:"text/plain"}),o=URL.createObjectURL(t),s=document.createElement("a");s.href=o,s.download=`console_output_${Date.now()}.txt`,s.click(),URL.revokeObjectURL(o),Ee.nk.success("Output exported")},U=e=>{0===e.code?e.data&&void 0!==e.data.stdout&&""!==e.data.stdout&&k(e.data.stdout,"text"):1===e.code?e.data&&e.data.stdout&&k(e.data.stdout,"error"):2e3===e.code?e.data&&void 0!==e.data.prompt&&S(e.data.prompt):3e3===e.code?e.data&&e.data.figure&&P(e.data.figure):4e3===e.code?e.data&&e.data.error&&(r.value=1):5e3===e.code&&e.data&&"repl"===e.data.mode&&L()};return(0,o.wB)(()=>e.item.resultList,e=>{if(e&&e.length>0){const t=e[e.length-1];U(t)}},{deep:!0}),(0,o.wB)(()=>e.item.run,t=>{t?(l.value=e.item.name||"program",r.value=null):d.value&&F()}),{outputLines:i,waitingForInput:s,currentPrompt:n,userInput:a,lastExitCode:r,currentProgram:l,isReplMode:d,replPrompt:c,inputRows:u,consoleOutput:m,inputField:f,replEditor:g,replCodeMirrorOptions:v,executeReplCommand:x,handleKeyDown:E,sendInput:R,cancelInput:T,clearConsole:$,stopProgram:j,exportOutput:_,downloadFigure:M,openFigureInNewTab:A,handleTextareaPaste:b}}};const Qa=(0,k.A)(Ga,[["render",Wa],["__scopeId","data-v-44905964"]]);var Ja=Qa,qa=i(45572),Ya=i(22532),Za=i(14188);function er(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}var tr=er,ir=i(66318);function or(e,t,i){var o=-1,s=e.length;t<0&&(t=-t>s?0:s+t),i=i>s?s:i,i<0&&(i+=s),s=t>i?0:i-t>>>0,t>>>=0;var n=Array(s);while(++o<s)n[o]=e[o+t];return n}var sr=or;function nr(e,t){return t.length<2?e:(0,ir.A)(e,sr(t,0,-1))}var ar=nr,rr=i(30901);function lr(e,t){return t=(0,Za.A)(t,e),e=ar(e,t),null==e||delete e[(0,rr.A)(tr(t))]}var dr=lr,cr=i(22031),hr=i(34963);function pr(e){return(0,hr.A)(e)?void 0:e}var ur=pr,mr=i(9036),fr=i(83973),gr=1,vr=2,wr=4,yr=(0,mr.A)(function(e,t){var i={};if(null==e)return i;var o=!1;t=(0,qa.A)(t,function(t){return t=(0,Za.A)(t,e),o||(o=t.length>1),t}),(0,cr.A)(e,(0,fr.A)(e),i),o&&(i=(0,Ya.A)(i,gr|vr|wr,ur));var s=t.length;while(s--)dr(i,t[s]);return i}),br=yr,kr=i(91361),Ir=i(48548);const Pr=Symbol("tabsRootContextKey");var Sr=i(97786),Cr=i(50819),Lr=i(51254);const Fr=(0,Cr.b_)({tabs:{type:(0,Cr.jq)(Array),default:()=>(0,Lr.f)([])},tabRefs:{type:(0,Cr.jq)(Object),default:()=>(0,Lr.f)({})}});var Er=i(78396),xr=i(69527),Dr=i(41651),Rr=i(65980),Tr=i(2154);const $r="ElTabBar",jr=(0,o.pM)({name:$r}),Nr=(0,o.pM)({...jr,props:Fr,setup(e,{expose:t}){const i=e,s=(0,o.WQ)(Pr);s||(0,Dr.$)($r,"<el-tabs><el-tab-bar /></el-tabs>");const a=(0,Rr.DU)("tabs"),r=(0,Va.KR)(),l=(0,Va.KR)(),d=()=>{let e=0,t=0;const o=["top","bottom"].includes(s.props.tabPosition)?"width":"height",n="width"===o?"x":"y",a="x"===n?"left":"top";return i.tabs.every(s=>{if((0,Tr.b0)(s.paneName))return!1;const n=i.tabRefs[s.paneName];if(!n)return!1;if(!s.active)return!0;e=n[`offset${(0,xr.ZH)(a)}`],t=n[`client${(0,xr.ZH)(o)}`];const r=window.getComputedStyle(n);return"width"===o&&(t-=Number.parseFloat(r.paddingLeft)+Number.parseFloat(r.paddingRight),e+=Number.parseFloat(r.paddingLeft)),!1}),{[o]:`${t}px`,transform:`translate${(0,xr.ZH)(n)}(${e}px)`}},c=()=>l.value=d(),h=[],p=()=>{h.forEach(e=>e.stop()),h.length=0,Object.values(i.tabRefs).forEach(e=>{h.push((0,Sr.wYm)(e,c))})};(0,o.wB)(()=>i.tabs,async()=>{await(0,o.dY)(),c(),p()},{immediate:!0});const u=(0,Sr.wYm)(r,()=>c());return(0,o.xo)(()=>{h.forEach(e=>e.stop()),h.length=0,u.stop()}),t({ref:r,update:c}),(e,t)=>((0,o.uX)(),(0,o.CE)("div",{ref_key:"barRef",ref:r,class:(0,n.C4)([(0,Va.R1)(a).e("active-bar"),(0,Va.R1)(a).is((0,Va.R1)(s).props.tabPosition)]),style:(0,n.Tr)(l.value)},null,6))}});var Mr=(0,Er.A)(Nr,[["__file","tab-bar.vue"]]),Ar=i(53344);const _r=(0,Cr.b_)({panes:{type:(0,Cr.jq)(Array),default:()=>(0,Lr.f)([])},currentName:{type:[String,Number],default:""},editable:Boolean,type:{type:String,values:["card","border-card",""],default:""},stretch:Boolean}),Ur={tabClick:(e,t,i)=>i instanceof Event,tabRemove:(e,t)=>t instanceof Event},Or="ElTabNav",Wr=(0,o.pM)({name:Or,props:_r,emits:Ur,setup(e,{expose:t,emit:i}){const s=(0,o.WQ)(Pr);s||(0,Dr.$)(Or,"<el-tabs><tab-nav /></el-tabs>");const n=(0,Rr.DU)("tabs"),a=(0,Sr.fho)(),r=(0,Sr.esz)(),l=(0,Va.KR)(),d=(0,Va.KR)(),c=(0,Va.KR)(),h=(0,Va.KR)({}),p=(0,Va.KR)(),u=(0,Va.KR)(!1),m=(0,Va.KR)(0),f=(0,Va.KR)(!1),g=(0,Va.KR)(!0),v=(0,Va.IJ)(),w=(0,o.EW)(()=>["top","bottom"].includes(s.props.tabPosition)?"width":"height"),y=(0,o.EW)(()=>{const e="width"===w.value?"X":"Y";return{transform:`translate${e}(-${m.value}px)`}}),b=()=>{if(!l.value)return;const e=l.value[`offset${(0,xr.ZH)(w.value)}`],t=m.value;if(!t)return;const i=t>e?t-e:0;m.value=i},k=()=>{if(!l.value||!d.value)return;const e=d.value[`offset${(0,xr.ZH)(w.value)}`],t=l.value[`offset${(0,xr.ZH)(w.value)}`],i=m.value;if(e-i<=t)return;const o=e-i>2*t?i+t:e-t;m.value=o},I=async()=>{const t=d.value;if(!u.value||!c.value||!l.value||!t)return;await(0,o.dY)();const i=h.value[e.currentName];if(!i)return;const n=l.value,a=["top","bottom"].includes(s.props.tabPosition),r=i.getBoundingClientRect(),p=n.getBoundingClientRect(),f=a?t.offsetWidth-p.width:t.offsetHeight-p.height,g=m.value;let v=g;a?(r.left<p.left&&(v=g-(p.left-r.left)),r.right>p.right&&(v=g+r.right-p.right)):(r.top<p.top&&(v=g-(p.top-r.top)),r.bottom>p.bottom&&(v=g+(r.bottom-p.bottom))),v=Math.max(v,0),m.value=Math.min(v,f)},P=()=>{var t;if(!d.value||!l.value)return;e.stretch&&(null==(t=p.value)||t.update());const i=d.value[`offset${(0,xr.ZH)(w.value)}`],o=l.value[`offset${(0,xr.ZH)(w.value)}`],s=m.value;o<i?(u.value=u.value||{},u.value.prev=s,u.value.next=s+o<i,i-s<o&&(m.value=i-o)):(u.value=!1,s>0&&(m.value=0))},S=e=>{let t=0;switch(e.code){case Ar.R.left:case Ar.R.up:t=-1;break;case Ar.R.right:case Ar.R.down:t=1;break;default:return}const i=Array.from(e.currentTarget.querySelectorAll("[role=tab]:not(.is-disabled)")),o=i.indexOf(e.target);let s=o+t;s<0?s=i.length-1:s>=i.length&&(s=0),i[s].focus({preventScroll:!0}),i[s].click(),C()},C=()=>{g.value&&(f.value=!0)},L=()=>f.value=!1,F=(e,t)=>{h.value[t]=e},E=async()=>{await(0,o.dY)();const t=h.value[e.currentName];null==t||t.focus({preventScroll:!0})};return(0,o.wB)(a,e=>{"hidden"===e?g.value=!1:"visible"===e&&setTimeout(()=>g.value=!0,50)}),(0,o.wB)(r,e=>{e?setTimeout(()=>g.value=!0,50):g.value=!1}),(0,Sr.wYm)(c,P),(0,o.sV)(()=>setTimeout(()=>I(),0)),(0,o.$u)(()=>P()),t({scrollToActiveTab:I,removeFocus:L,focusActiveTab:E,tabListRef:d,tabBarRef:p,scheduleRender:()=>(0,Va.mu)(v)}),()=>{const t=u.value?[(0,o.bF)("span",{class:[n.e("nav-prev"),n.is("disabled",!u.value.prev)],onClick:b},[(0,o.bF)(kr.tk,null,{default:()=>[(0,o.bF)(Ir.nkM,null,null)]})]),(0,o.bF)("span",{class:[n.e("nav-next"),n.is("disabled",!u.value.next)],onClick:k},[(0,o.bF)(kr.tk,null,{default:()=>[(0,o.bF)(Ir.Qpb,null,null)]})])]:null,a=e.panes.map((t,a)=>{var r,l,d,c;const h=t.uid,p=t.props.disabled,u=null!=(l=null!=(r=t.props.name)?r:t.index)?l:`${a}`,m=!p&&(t.isClosable||e.editable);t.index=`${a}`;const g=m?(0,o.bF)(kr.tk,{class:"is-icon-close",onClick:e=>i("tabRemove",t,e)},{default:()=>[(0,o.bF)(Ir.bm,null,null)]}):null,v=(null==(c=(d=t.slots).label)?void 0:c.call(d))||t.props.label,w=!p&&t.active?0:-1;return(0,o.bF)("div",{ref:e=>F(e,u),class:[n.e("item"),n.is(s.props.tabPosition),n.is("active",t.active),n.is("disabled",p),n.is("closable",m),n.is("focus",f.value)],id:`tab-${u}`,key:`tab-${h}`,"aria-controls":`pane-${u}`,role:"tab","aria-selected":t.active,tabindex:w,onFocus:()=>C(),onBlur:()=>L(),onClick:e=>{L(),i("tabClick",t,u,e)},onKeydown:e=>{!m||e.code!==Ar.R.delete&&e.code!==Ar.R.backspace||i("tabRemove",t,e)}},[v,g])});return v.value,(0,o.bF)("div",{ref:c,class:[n.e("nav-wrap"),n.is("scrollable",!!u.value),n.is(s.props.tabPosition)]},[t,(0,o.bF)("div",{class:n.e("nav-scroll"),ref:l},[e.panes.length>0?(0,o.bF)("div",{class:[n.e("nav"),n.is(s.props.tabPosition),n.is("stretch",e.stretch&&["top","bottom"].includes(s.props.tabPosition))],ref:d,style:y.value,role:"tablist",onKeydown:S},[e.type?null:(0,o.bF)(Mr,{ref:p,tabs:[...e.panes],tabRefs:h.value},null),a]):null])])}}});var Vr=i(31069),zr=i(51338);const Br=(e,t,i)=>{const s=(0,zr.CW)(e.subTree).filter(e=>{var i;return(0,o.vv)(e)&&(null==(i=e.type)?void 0:i.name)===t&&!!e.component}),n=s.map(e=>e.component.uid);return n.map(e=>i[e]).filter(e=>!!e)},Xr=(e,t)=>{const i=(0,Va.IJ)({}),s=(0,Va.IJ)([]),n=new WeakMap,a=e=>{i.value[e.uid]=e,(0,Va.mu)(i),(0,o.sV)(()=>{const t=e.getVnode().el,o=t.parentNode;if(!n.has(o)){n.set(o,[]);const e=o.insertBefore.bind(o);o.insertBefore=(t,s)=>{const a=n.get(o).some(e=>t===e||s===e);return a&&(0,Va.mu)(i),e(t,s)}}n.get(o).push(t)})},r=e=>{delete i.value[e.uid],(0,Va.mu)(i);const t=e.getVnode().el,o=t.parentNode,s=n.get(o),a=s.indexOf(t);s.splice(a,1)},l=()=>{s.value=Br(e,t,i.value)},d=e=>e.render(),c=(0,o.pM)({setup(e,{slots:t}){return()=>(l(),t.default?(0,o.h)(d,{render:t.default}):null)}});return{children:s,addChild:a,removeChild:r,ChildrenSorter:c}},Hr=(0,Cr.b_)({type:{type:String,values:["card","border-card",""],default:""},closable:Boolean,addable:Boolean,modelValue:{type:[String,Number]},editable:Boolean,tabPosition:{type:String,values:["top","right","bottom","left"],default:"top"},beforeLeave:{type:(0,Cr.jq)(Function),default:()=>!0},stretch:Boolean}),Kr=e=>(0,n.Kg)(e)||(0,Tr.Et)(e),Gr={[Vr.l4]:e=>Kr(e),tabClick:(e,t)=>t instanceof Event,tabChange:e=>Kr(e),edit:(e,t)=>["remove","add"].includes(t),tabRemove:e=>Kr(e),tabAdd:()=>!0},Qr=(0,o.pM)({name:"ElTabs",props:Hr,emits:Gr,setup(e,{emit:t,slots:i,expose:s}){var n;const a=(0,Rr.DU)("tabs"),r=(0,o.EW)(()=>["left","right"].includes(e.tabPosition)),{children:l,addChild:d,removeChild:c,ChildrenSorter:h}=Xr((0,o.nI)(),"ElTabPane"),p=(0,Va.KR)(),u=(0,Va.KR)(null!=(n=e.modelValue)?n:"0"),m=async(i,o=!1)=>{var s,n,a,r;if(u.value!==i&&!(0,Tr.b0)(i))try{let d;if(e.beforeLeave){const t=e.beforeLeave(i,u.value);d=t instanceof Promise?await t:t}else d=!0;if(!1!==d){const e=null==(s=l.value.find(e=>e.paneName===u.value))?void 0:s.isFocusInsidePane();u.value=i,o&&(t(Vr.l4,i),t("tabChange",i)),null==(a=null==(n=p.value)?void 0:n.removeFocus)||a.call(n),e&&(null==(r=p.value)||r.focusActiveTab())}}catch(d){}},f=(e,i,o)=>{e.props.disabled||(t("tabClick",e,o),m(i,!0))},g=(e,i)=>{e.props.disabled||(0,Tr.b0)(e.props.name)||(i.stopPropagation(),t("edit",e.props.name,"remove"),t("tabRemove",e.props.name))},v=()=>{t("edit",void 0,"add"),t("tabAdd")},w=t=>{const i=t.el.firstChild,o=["bottom","right"].includes(e.tabPosition)?t.children[0].el:t.children[1].el;i!==o&&i.before(o)};return(0,o.wB)(()=>e.modelValue,e=>m(e)),(0,o.wB)(u,async()=>{var e;await(0,o.dY)(),null==(e=p.value)||e.scrollToActiveTab()}),(0,o.Gt)(Pr,{props:e,currentName:u,registerPane:d,unregisterPane:c,nav$:p}),s({currentName:u,get tabNavRef(){return br(p.value,["scheduleRender"])}}),()=>{const t=i["add-icon"],s=e.editable||e.addable?(0,o.bF)("div",{class:[a.e("new-tab"),r.value&&a.e("new-tab-vertical")],tabindex:"0",onClick:v,onKeydown:e=>{[Ar.R.enter,Ar.R.numpadEnter].includes(e.code)&&v()}},[t?(0,o.RG)(i,"add-icon"):(0,o.bF)(kr.tk,{class:a.is("icon-plus")},{default:()=>[(0,o.bF)(Ir.FWt,null,null)]})]):null,n=()=>(0,o.bF)(Wr,{ref:p,currentName:u.value,editable:e.editable,type:e.type,panes:l.value,stretch:e.stretch,onTabClick:f,onTabRemove:g},null),d=(0,o.bF)("div",{class:[a.e("header"),r.value&&a.e("header-vertical"),a.is(e.tabPosition)]},[(0,o.bF)(h,null,{default:n,$stable:!0}),s]),c=(0,o.bF)("div",{class:a.e("content")},[(0,o.RG)(i,"default")]);return(0,o.bF)("div",{class:[a.b(),a.m(e.tabPosition),{[a.m("card")]:"card"===e.type,[a.m("border-card")]:"border-card"===e.type}],onVnodeMounted:w,onVnodeUpdated:w},[c,d])}}});var Jr=Qr,qr=i(52307);const Yr=(0,Cr.b_)({label:{type:String,default:""},name:{type:[String,Number]},closable:Boolean,disabled:Boolean,lazy:Boolean}),Zr="ElTabPane",el=(0,o.pM)({name:Zr}),tl=(0,o.pM)({...el,props:Yr,setup(e){const t=e,i=(0,o.nI)(),a=(0,o.Ht)(),r=(0,o.WQ)(Pr);r||(0,Dr.$)(Zr,"usage: <el-tabs><el-tab-pane /></el-tabs/>");const l=(0,Rr.DU)("tab-pane"),d=(0,Va.KR)(),c=(0,Va.KR)(),h=(0,o.EW)(()=>t.closable||r.props.closable),p=(0,qr.uA)(()=>{var e;return r.currentName.value===(null!=(e=t.name)?e:c.value)}),u=(0,Va.KR)(p.value),m=(0,o.EW)(()=>{var e;return null!=(e=t.name)?e:c.value}),f=(0,qr.uA)(()=>!t.lazy||u.value||p.value),g=()=>{var e;return null==(e=d.value)?void 0:e.contains(document.activeElement)};(0,o.wB)(p,e=>{e&&(u.value=!0)});const v=(0,Va.Kh)({uid:i.uid,getVnode:()=>i.vnode,slots:a,props:t,paneName:m,active:p,index:c,isClosable:h,isFocusInsidePane:g});return r.registerPane(v),(0,o.xo)(()=>{r.unregisterPane(v)}),(0,o.Ic)(()=>{var e;a.label&&(null==(e=r.nav$.value)||e.scheduleRender())}),(e,t)=>(0,Va.R1)(f)?(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",{key:0,id:`pane-${(0,Va.R1)(m)}`,ref_key:"paneRef",ref:d,class:(0,n.C4)((0,Va.R1)(l).b()),role:"tabpanel","aria-hidden":!(0,Va.R1)(p),"aria-labelledby":`tab-${(0,Va.R1)(m)}`},[(0,o.RG)(e.$slots,"default")],10,["id","aria-hidden","aria-labelledby"])),[[s.aG,(0,Va.R1)(p)]]):(0,o.Q3)("v-if",!0)}});var il=(0,Er.A)(tl,[["__file","tab-pane.vue"]]),ol=i(64769);const sl=(0,ol.GU)(Jr,{TabPane:il}),nl=(0,ol.WM)(il),al={class:"noselected console-tabs"},rl=["src"],ll={class:"node-label"};function dl(e,t,i,s,a,r){const l=nl,d=sl;return(0,o.uX)(),(0,o.CE)("div",al,[(0,o.bF)(d,{modelValue:r.pathSelected,"onUpdate:modelValue":t[0]||(t[0]=e=>r.pathSelected=e),type:"card",closable:"",onTabRemove:r.removeTab,onTabClick:r.selectTab},{default:(0,o.k6)(()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.consoleItems,e=>((0,o.uX)(),(0,o.Wv)(l,{key:e.path+"-|-"+e.id,label:e.name,name:e.path+"-|-"+e.id},{label:(0,o.k6)(()=>[(0,o.Lk)("img",{src:r.getIconUrl(e.path),alt:"",class:"node-icon"},null,8,rl),(0,o.Lk)("span",ll,(0,n.v_)(r.getItemPath(e)),1)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue","onTabRemove","onTabClick"])])}var cl={data(){return{}},mounted(){},methods:{getItemPath(e){return this.ideInfo.consoleSelected.path!==e.path||this.ideInfo.consoleSelected.id!==e.id||"Terminal"===this.ideInfo.consoleSelected.name&&"Terminal"===this.ideInfo.consoleSelected.path?e.name:"/"+this.ideInfo.currProj.data.name+e.path},getIconUrl(e){return i(80238)(`./${(0,W.ry)(e.substring(e.lastIndexOf(".")+1))}`)},getItem(e){if(!e)return;const t=e.split("-|-");t[1]=Number(t[1]);for(let i=0;i<this.ideInfo.consoleItems.length;i++)if(this.ideInfo.consoleItems[i].path===t[0]&&this.ideInfo.consoleItems[i].id===t[1])return this.ideInfo.consoleItems[i];return""},selectTab(e){},removeTab(e){const t=this.getItem(e);t&&this.$emit("close-item",t)}},watch:{},computed:{ideInfo(){return this.$store.state.ide.ideInfo},consoleItems(){return this.ideInfo.consoleItems},pathSelected:{get(){return this.ideInfo.consoleSelected.path+"-|-"+this.ideInfo.consoleSelected.id},set(e){const t=this.getItem(e);t&&this.$emit("select-item",t)}}},components:{}};const hl=(0,k.A)(cl,[["render",dl],["__scopeId","data-v-109efd1e"]]);var pl=hl,ul=i(96763);class ml{constructor(){this.isActive=!1,this.lastActivity=Date.now(),this.renewalInProgress=!1,this.activityThreshold=3e4,this.renewalCheckInterval=6e4,this.renewalTimer=null,this.activityEvents=["keydown","keyup","keypress","mousedown","mouseup","mousemove","click","scroll","wheel","touchstart","touchmove","touchend"],this.init()}init(){this.hasValidSession()&&this.startTracking()}hasValidSession(){const e=localStorage.getItem("session_id"),t=localStorage.getItem("username");return!(!e||!t)}startTracking(){this.isActive=!0,this.setupActivityListeners(),this.startRenewalChecker(),ul.log(" [SessionManager] Started activity tracking and renewal system")}stopTracking(){this.isActive=!1,this.removeActivityListeners(),this.stopRenewalChecker(),ul.log(" [SessionManager] Stopped activity tracking")}setupActivityListeners(){this.activityHandler=this.onActivity.bind(this),this.activityEvents.forEach(e=>{document.addEventListener(e,this.activityHandler,!0)}),this.listenForIDEActivity()}removeActivityListeners(){this.activityEvents.forEach(e=>{document.removeEventListener(e,this.activityHandler,!0)})}listenForIDEActivity(){document.addEventListener("ide:file-save",this.activityHandler),document.addEventListener("ide:code-run",this.activityHandler),document.addEventListener("ide:file-open",this.activityHandler),document.addEventListener("ide:console-input",this.activityHandler)}onActivity(){this.isActive&&(this.lastActivity=Date.now(),!this.renewalInProgress&&this.shouldCheckRenewal()&&this.checkAndRenewSession())}shouldCheckRenewal(){const e=Date.now()-(this.lastRenewalAttempt||0);return e>this.activityThreshold}startRenewalChecker(){this.renewalTimer=setInterval(()=>{this.isActive&&this.hasRecentActivity()&&this.checkAndRenewSession()},this.renewalCheckInterval)}stopRenewalChecker(){this.renewalTimer&&(clearInterval(this.renewalTimer),this.renewalTimer=null)}hasRecentActivity(){const e=Date.now()-this.lastActivity;return e<this.activityThreshold}async checkAndRenewSession(){if(!this.renewalInProgress&&this.hasValidSession())try{this.renewalInProgress=!0,this.lastRenewalAttempt=Date.now();const e=localStorage.getItem("session_id");ul.log(" [SessionManager] Renewing session due to activity...");const t=await fetch("/api/renew-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:e})}),i=await t.json();i.success?(localStorage.setItem("session_expires_at",i.expires_at),ul.log(" [SessionManager] Session renewed until:",new Date(i.expires_at).toLocaleString())):(ul.warn(" [SessionManager] Session renewal failed:",i.error),this.handleRenewalFailure(i.error))}catch(Dr){ul.error(" [SessionManager] Session renewal error:",Dr),this.handleRenewalFailure(Dr.message)}finally{this.renewalInProgress=!1}}handleRenewalFailure(e){(e.includes("Invalid session")||e.includes("expired"))&&(ul.log(" [SessionManager] Session expired, will need re-authentication"),localStorage.removeItem("session_id"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("full_name"),localStorage.removeItem("session_expires_at"),this.stopTracking())}async renewSession(){return await this.checkAndRenewSession()}getSessionInfo(){if(!this.hasValidSession())return null;const e=localStorage.getItem("session_expires_at"),t=new Date,i=e?new Date(e):null;return{username:localStorage.getItem("username"),role:localStorage.getItem("role"),expiresAt:i,timeLeft:i?i-t:null,isNearExpiry:!!i&&i-t<72e5}}static emitIDEActivity(e,t={}){const i=new CustomEvent(`ide:${e}`,{detail:t});document.dispatchEvent(i)}}const fl=new ml;var gl=fl;"undefined"!==typeof window&&(window.sessionManager=fl);var vl=i(96763);const wl={data(){return{replMode:"auto",pyodideNamespace:null,pyodideInitialized:!1}},methods:{async startDualModeReplSession(){this.replSessionId=Date.now().toString(),vl.log(" [REPL] Starting dual-mode REPL session:",this.replSessionId),vl.log(" [REPL] Current state:",{wsInfo:this.wsInfo,wsConnected:this.wsInfo?.connected,wsReadyState:this.wsInfo?.rws?.readyState,replMode:this.replMode,pyodideReady:this.pyodideReady,pyodideInitialized:this.pyodideInitialized}),this.ensureReplConsole();const e=this.wsInfo&&this.wsInfo.connected,t="backend"===this.replMode||"auto"===this.replMode&&e;vl.log(" [REPL] Mode detection:",{backendAvailable:e,preferBackend:t,replMode:this.replMode}),t&&e?(vl.log(" [REPL] Using backend mode"),await this.startBackendRepl()):(vl.log(" [REPL] Using Pyodide browser mode"),await this.startPyodideRepl())},async startBackendRepl(){vl.log(" [REPL] Starting backend REPL...");try{const e={cmd:"start_python_repl",id:this.replSessionId,data:{projectName:this.ideInfo.currProj?.data?.name||"repl"}};if(vl.log(" [REPL] Sending start message:",e),vl.log(" [REPL] WebSocket state:",{rws:this.wsInfo.rws,readyState:this.wsInfo.rws?.readyState,OPEN:WebSocket.OPEN}),!this.wsInfo.rws||this.wsInfo.rws.readyState!==WebSocket.OPEN)throw new Error(`WebSocket not connected: readyState=${this.wsInfo.rws?.readyState}`);this.wsInfo.rws.send(JSON.stringify(e)),vl.log(" [REPL] Start message sent successfully")}catch(Dr){vl.error(" [REPL] Backend REPL failed:",Dr),this.addReplOutput("Backend connection lost. Reconnecting...","system"),setTimeout(async()=>{this.wsInfo?.rws?.readyState===WebSocket.OPEN?(vl.log(" [REPL] Retrying backend REPL after reconnection"),await this.startBackendRepl()):(vl.log(" [REPL] Backend still unavailable, switching to browser mode"),this.addReplOutput("Backend unavailable, switching to browser mode...","error"),await this.startPyodideRepl())},2e3)}},async startPyodideRepl(){vl.log(" [REPL] Starting Pyodide REPL, current state:",{pyodideReady:this.pyodideReady,pyodideInitialized:this.pyodideInitialized}),this.pyodideReady||(vl.log(" [REPL] Pyodide not ready, initializing..."),await this.initializePyodideForRepl()),this.pyodideReady?vl.log(" [REPL] Pyodide ready for use"):(vl.log(" [REPL] Failed to initialize Pyodide"),this.addReplOutput("Failed to initialize browser Python","error"),this.isReplMode=!1)},async initializePyodideForRepl(){if(vl.log(" [REPL] initializePyodideForRepl called, state:",{pyodideLoading:this.pyodideLoading,pyodideReady:this.pyodideReady,loadPyodideAvailable:typeof window.loadPyodide}),this.pyodideLoading||this.pyodideReady)vl.log(" [REPL] Pyodide already loading or ready, skipping");else{this.pyodideLoading=!0;try{if("function"!==typeof window.loadPyodide)throw new Error("Pyodide not available. Please check internet connection.");vl.log(" [REPL] Loading Pyodide from CDN..."),this.pyodide=await window.loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.24.1/full/"}),this.pyodideNamespace=this.pyodide.globals.get("dict")(),await this.pyodide.runPythonAsync("\n          import sys\n          import io\n          import builtins\n          \n          # Store the version\n          python_version = sys.version\n          \n          # Setup for REPL\n          _ = None\n        "),this.pyodideReady=!0,this.pyodideLoading=!1,this.pyodideInitialized=!0,vl.log(" [REPL] Pyodide REPL ready!",{pyodide:this.pyodide,namespace:this.pyodideNamespace})}catch(Dr){vl.error(" [REPL] Pyodide initialization failed:",Dr),this.pyodideLoading=!1,this.pyodideReady=!1,this.addReplOutput(`Error: ${Dr.message}`,"error")}}},async executeReplCommandDualMode(e){if(vl.log(" [REPL] executeReplCommandDualMode called with:",e),!e.trim())return vl.log(" [REPL] Empty command, handling continuation mode"),void(this.replContinuationMode&&(this.replContinuationMode=!1,this.replPrompt=">>> "));this.replHistory[this.replHistory.length-1]!==e&&this.replHistory.push(e),this.replHistoryIndex=-1,this.replInput="",this.replInputRows=1,this.ideInfo.consoleSelected&&this.ideInfo.consoleSelected.id&&this.$store.commit("ide/addConsoleOutput",{id:this.ideInfo.consoleSelected.id,type:"repl-input",text:e,prompt:this.replPrompt});const t=this.wsInfo?.connected&&this.replSessionId&&"pyodide"!==this.replMode;vl.log(" [REPL] Execution mode check:",{wsConnected:this.wsInfo?.connected,replSessionId:this.replSessionId,replMode:this.replMode,useBackend:t,pyodideReady:this.pyodideReady}),t?(vl.log(" [REPL] Executing via backend"),await this.executeBackendCommand(e)):this.pyodideReady?(vl.log(" [REPL] Executing via Pyodide"),await this.executePyodideCommand(e)):(vl.log(" [REPL] No environment ready, initializing Pyodide..."),await this.startPyodideRepl(),this.pyodideReady?await this.executePyodideCommand(e):this.addReplOutput("No Python environment available","error"))},async executeBackendCommand(e){vl.log(" [REPL] executeBackendCommand called with:",e);try{const t={cmd:"send_program_input",id:Date.now().toString(),data:{program_id:this.replSessionId,input:e}};if(vl.log(" [REPL] Sending command message:",t),!this.wsInfo.rws||this.wsInfo.rws.readyState!==WebSocket.OPEN)throw new Error(`WebSocket disconnected: readyState=${this.wsInfo.rws?.readyState}`);this.wsInfo.rws.send(JSON.stringify(t)),vl.log(" [REPL] Command sent to backend")}catch(Dr){vl.error(" [REPL] Backend execution failed:",Dr),this.addReplOutput("Backend connection lost. Please restart REPL if needed.","system"),vl.log(" [REPL] Keeping backend mode, user can manually restart if needed")}},async executePyodideCommand(e){if(this.pyodideReady&&this.pyodide){try{await this.pyodide.runPythonAsync("\n          import sys\n          from io import StringIO\n          _stdout = StringIO()\n          _stderr = StringIO()\n          _old_stdout = sys.stdout\n          _old_stderr = sys.stderr\n          sys.stdout = _stdout\n          sys.stderr = _stderr\n        ");let i=null,o=null;try{i=await this.pyodide.runPythonAsync(e,{globals:this.pyodideNamespace}),void 0!==i&&null!==i&&await this.pyodide.runPythonAsync("_ = _result",{globals:{...this.pyodideNamespace.toJs(),_result:i}})}catch(Dr){o=Dr}const s=await this.pyodide.runPythonAsync("\n          sys.stdout = _old_stdout\n          sys.stderr = _old_stderr\n          stdout_val = _stdout.getvalue()\n          stderr_val = _stderr.getvalue()\n          _stdout.close()\n          _stderr.close()\n          (stdout_val, stderr_val)\n        ");if(s[0]&&this.addReplOutput(s[0],"output"),s[1]&&this.addReplOutput(s[1],"error"),o)this.addReplOutput(String(o),"error");else if(void 0!==i&&null!==i){const e=this.pyodide.globals.get("None");if(i!==e)try{const e=await this.pyodide.runPythonAsync("repr(_last_val)",{globals:{...this.pyodideNamespace.toJs(),_last_val:i}});e&&"None"!==e&&this.addReplOutput(e,"output")}catch(t){const e=String(i);e&&"[object Object]"!==e&&this.addReplOutput(e,"output")}}this.replContinuationMode=!1,this.replPrompt=">>> "}catch(Dr){vl.error("Pyodide execution error:",Dr),this.addReplOutput(`Error: ${Dr.message}`,"error")}this.$nextTick(()=>{this.$refs.consoleOutputArea&&(this.$refs.consoleOutputArea.scrollTop=this.$refs.consoleOutputArea.scrollHeight)})}else this.addReplOutput("Browser Python not ready","error")},handleBackendReplResponse(e){if(vl.log(" [REPL] Backend response received:",{code:e?.code,hasData:!!e?.data,dataKeys:e?.data?Object.keys(e.data):[],fullMessage:e}),e){if(0===e.code||"0"===e.code){if(e.data){if(e.data.stdout){const t=e.data.stdout,i=t.match(/^(>>>|\.\.\.)\s*$/)||t.match(/^(>>>|\.\.\.)\s*\n*$/)||">>>"===t.trim()||"..."===t.trim()||""===t.trim()||">>> "===t||"... "===t||t.match(/^\s*>>>\s*$/)||t.match(/^\s*\.\.\.\s*$/)||t.match(/^>>>\s*\n*$/)||t.match(/^\.\.\.\s*\n*$/);i||""===t.trim()||this.addReplOutput(t,"output")}e.data.stderr&&this.addReplOutput(e.data.stderr,"error")}}else 2e3===e.code?"repl_prompt"===e.data?.type?(this.replPrompt=">>> ",this.replContinuationMode=!1):e.data?.stdout&&this.addReplOutput(e.data.stdout,"output"):1111===e.code&&(this.addReplOutput("Backend session ended","system"),this.replSessionId=null,this.addReplOutput("Switching to browser mode...","system"),this.startPyodideRepl());this.$nextTick(()=>{this.$refs.consoleOutputArea&&(this.$refs.consoleOutputArea.scrollTop=this.$refs.consoleOutputArea.scrollHeight)})}else vl.log(" [REPL] Empty message received")},async stopDualModeReplSession(){if(this.replSessionId&&this.wsInfo?.rws?.readyState===WebSocket.OPEN){const e={cmd:"stop_python_program",id:Date.now().toString(),data:{program_id:this.replSessionId}};this.wsInfo.rws.send(JSON.stringify(e))}this.replSessionId=null,this.isReplMode=!1,this.replPrompt=">>> ",this.replContinuationMode=!1,this.pyodideNamespace&&(this.pyodideNamespace=this.pyodide?.globals.get("dict")())}}};var yl=wl,bl=i(96763);const kl=i(57975);var Il={data(){return{showDeleteDialog:!1,showFileDialog:!1,showProjsDialog:!1,showUploadDialog:!1,showNewFileDialog:!1,showNewFolderDialog:!1,showImportFileDialog:!1,showBulkUploadDialog:!1,showFileBrowserDialog:!1,showLoginModal:!1,fileBrowserMode:"open",fileToMove:null,showSettingsModal:!1,showKeyboardShortcutsModal:!1,showFindReplaceModal:!1,findReplaceMode:"find",showREPL:!1,isReplMode:!1,replSessionId:null,showCover:!0,showContextMenu:!1,contextMenuPosition:{x:0,y:0},contextMenuTarget:null,windowWidth:window.innerWidth,leftSidebarVisible:!0,dialogType:"",dialogTitle:"",dialogTips:"",dialogText:"",leftSidebarWidth:250,rightSidebarWidth:400,rightSidebarVisible:!1,consoleHeight:200,consoleExpanded:!0,consoleMaximized:!1,previousConsoleHeight:200,rightPanelExpanded:!1,previousRightWidth:400,rightPanelMode:"closed",consoleMode:"collapsed",consolePreviousMode:"normal",wasConsoleOpenBeforeRightExpand:!1,fileConsoleStates:{},activeFilePath:null,rightPanelState:"normal",rightPanelNormalWidth:400,previousConsoleState:{expanded:!0,height:200},editorHeight:"calc(100% - 235px)",minEditorWidth:500,isResizingLeft:!1,isResizingRight:!1,isResizingConsole:!1,startX:0,startY:0,startWidth:0,startHeight:0,resizeWarning:!1,programInput:"",programInputRows:1,wordWrap:!0,replInput:"",replHistory:[],replHistoryIndex:-1,replPrompt:">>> ",replInputRows:1,replContinuationMode:!1,previewTabs:[],selectedPreviewTab:null,previewTabCounter:0,previewDraggedIndex:-1,previewDropTargetIndex:-1,focusedPanel:"editor",terminalOutput:[],terminalSessionActive:!1,pyodide:null,pyodideLoading:!1,pyodideReady:!1,replMode:"auto",pyodideNamespace:null,pyodideInitialized:!1,wsMessageHandler:null}},mixins:[yl],components:{Splitpanes:ia.S,Pane:ia.Z,TwoHeaderMenu:qs,CodeTabs:Si.A,HybridConsole:Ja,ConsoleTabs:pl,ProjTree:Mi.A,IdeEditor:Pi.A,LoginModal:P,PythonREPL:S.A,DialogProjs:bi.A,DialogText:yi.A,DialogDelete:wi.A,DialogUpload:vi.A,DialogNewFile:gi,DialogNewFolder:Vt,DialogImportFile:vt,DialogBulkUpload:Te,DialogFileBrowser:X,CsvViewer:ki.A,MediaViewer:Ii.A,SettingsModal:yo.A,KeyboardShortcutsModal:wo,FindReplaceModal:io,FullscreenPreview:Ni,ChevronLeft:oa.A,ChevronRight:ct.A,ChevronUp:Zi,ChevronDown:ht.A,Minimize2:sa},created(){},mounted(){this.throttledHandleResizeLeft=this.throttle(this.handleResizeLeft,16),this.throttledHandleResizeRight=this.throttle(this.handleResizeRight,16),this.throttledHandleResizeConsole=this.throttle(this.handleResizeConsole,16),this.initializeAutoSave();const e=localStorage.getItem("session_id"),t=localStorage.getItem("username");if(!e||!t)return bl.log(" [VmIde] No session found, auto-opening login modal..."),void(this.showLoginModal=!0);bl.log(" [VmIde] Found existing session for:",t),bl.log(" [VmIde] Starting session manager for auto-renewal..."),gl.startTracking();try{bl.log(" [VmIde] Initializing WebSocket with authentication..."),this.wsInfo&&this.wsInfo.rws?bl.log(" [VmIde] WebSocket already initialized"):(this.$store.dispatch("websocket/init",{}),bl.log(" [VmIde] WebSocket initialization dispatched"))}catch(Dr){bl.error(" [VmIde] Error initializing WebSocket:",Dr)}this.rightPanelMode="closed",this.consoleMode="collapsed",this.$nextTick(()=>{setTimeout(()=>{try{this.setupWebSocketHandler()}catch(Dr){bl.error("Error in setupWebSocketHandler:",Dr)}},500)}),this.loadLayoutPreferences(),window.addEventListener("resize",this.validateLayout);const i=this;if(e&&t){const e=setInterval(()=>{bl.log(" [VmIde] WebSocket check:",{connected:i.wsInfo.connected,wsInfo:i.wsInfo}),i.wsInfo.connected&&(bl.log(" [VmIde] WebSocket connected, listing projects..."),this.$store.dispatch(`ide/${ut.qB}`,{callback:t=>{bl.log(" [VmIde] Project list response:",t),clearInterval(e),0==t.code?(bl.log(" [VmIde] Projects found:",t.data),this.$store.commit("ide/handleProjects",t.data),i.loadAllDefaultProjects()):bl.error(" [VmIde] Failed to list projects:",t)}}))},1e3)}window.addEventListener("resize",this.resize),this.$nextTick(()=>{this.applyInitialEditorSettings()})},beforeUnmount(){window.removeEventListener("resize",this.validateLayout),window.removeEventListener("resize",this.resize),this.wsMessageHandler&&(this.wsMessageHandler=null),this.previewTabs.forEach(e=>{"pdf"===e.type&&e.content&&e.content.startsWith("blob:")&&URL.revokeObjectURL(e.content)})},computed:{wsInfo(){return this.$store.getters["websocket/wsInfo"]()},ideInfo(){return this.$store.state.ide.ideInfo},currentUser(){const e=this.$store.state.ide.currentUser;if(e)return e;const t=localStorage.getItem("session_id"),i=localStorage.getItem("username"),o=localStorage.getItem("role"),s=localStorage.getItem("full_name");return t&&i?{session_id:t,username:i,role:o,full_name:s}:null},isMarkdown(){return!!this.ideInfo.codeSelected.path&&this.ideInfo.codeSelected.path.endsWith(".md")},isMediaFile(){if(this.ideInfo.codeSelected.path){const e=[".png",".jpg",".jpeg",".gif",".bmp",".svg",".webp",".pdf"],t=this.ideInfo.codeSelected.path.toLowerCase();return e.some(e=>t.endsWith(e))}return!1},consoleLimit(){let e=0;for(let t=0;t<this.ideInfo.consoleItems.length;t++)!0!==this.ideInfo.consoleItems[t].run||"Terminal"===this.ideInfo.consoleItems[t].name&&"Terminal"===this.ideInfo.consoleItems[t].path||(e+=1);return e>=3},hasRunProgram(){return this.ideInfo.consoleItems.some(e=>e.run)},showConsole(){const e=0!==this.ideInfo.consoleItems.length;return e},leftSidebarSize(){if(this.windowWidth<=900)return 0;let e=20;if(this.windowWidth<=1400&&this.windowWidth>1200){const t=Math.min(250,.2*this.windowWidth);e=t/this.windowWidth*100}else this.windowWidth<=1200&&(e=180/this.windowWidth*100);return this.leftSidebarVisible?e:.1},leftSidebarMinSize(){return this.windowWidth<=900?0:.1},leftSidebarMaxSize(){return this.windowWidth<=900?0:this.windowWidth<=1400&&this.windowWidth>1200?30:40},rightSidebarSize(){if(this.windowWidth<=900)return 0;if(this.windowWidth<=1200)return 0;if(0===this.previewTabs.length)return 0;if("closed"===this.rightPanelMode)return 0;if("expanded"===this.rightPanelMode){const e=this.leftSidebarVisible?20:0;return 100-e-10}return 30},rightSidebarMinSize(){return this.windowWidth<=1200?0:.1},rightSidebarMaxSize(){return this.windowWidth<=900||this.windowWidth<=1200?0:50},centerSize(){if(this.windowWidth<=900)return 100;if(this.windowWidth<=1200){const e=this.leftSidebarVisible?this.windowWidth<=1200?180/this.windowWidth*100:20:0;return 100-e}const e=this.leftSidebarVisible?this.leftSidebarSize:0,t=this.rightSidebarSize;return 0===t?100-e:Math.max(30,100-e-t)},editorPaneSize(){return"maximized"===this.consoleMode?5:"collapsed"===this.consoleMode?95:70},consolePaneSize(){return"maximized"===this.consoleMode?95:"collapsed"===this.consoleMode?5:30}},watch:{"previewTabs.length":function(e,t){0===e&&t>0&&(this.rightPanelMode="closed",this.rightSidebarVisible=!1)},"ideInfo.codeSelected":function(e,t){e&&t&&e.path&&t.path&&e.path!==t.path?this.handleTabChange(e,t):e&&!t&&(this.activeFilePath=e.path,this.loadFileConsoleState(e.path))},"ideInfo.consoleSelected.waitingForInput":function(e){e&&this.$nextTick(()=>{this.$refs.programInputField&&this.$refs.programInputField.focus()})},consoleExpanded(e){e&&this.$nextTick(()=>{this.$refs.consoleOutputArea&&(this.$refs.consoleOutputArea.scrollTop=this.$refs.consoleOutputArea.scrollHeight)})}},methods:{throttle(e,t){let i=0,o=null;const s=this;return function(...n){const a=Date.now();a-i>=t?(e.apply(s,n),i=a):o||(o=requestAnimationFrame(()=>{e.apply(s,n),i=Date.now(),o=null}))}},toggleLeftSidebar(e){this.leftSidebarVisible=e},applyInitialEditorSettings(){const e=localStorage.getItem("fontSize");e&&this.updateFontSize(e);const t=localStorage.getItem("showLineNumbers");null!==t&&this.updateLineNumbers("true"===t)},updateFontSize(e){const t=parseInt(e)+"px",i=document.querySelectorAll(".CodeMirror");i.forEach(e=>{e.CodeMirror&&(e.style.fontSize=t,e.CodeMirror.refresh())});const o=document.getElementById("codemirror-font-size")||document.createElement("style");o.id="codemirror-font-size",o.innerHTML=`.CodeMirror { font-size: ${t} !important; } .CodeMirror pre { font-size: ${t} !important; }`,document.getElementById("codemirror-font-size")||document.head.appendChild(o),localStorage.setItem("fontSize",e),window.dispatchEvent(new CustomEvent("fontSizeChanged"))},updateLineNumbers(e){const t=document.querySelectorAll(".CodeMirror");t.forEach(t=>{t.CodeMirror&&t.CodeMirror.setOption("lineNumbers",e)}),localStorage.setItem("editorLineNumbers",e),this.$store.commit("ide/setEditorOption",{option:"lineNumbers",value:e})},updateWordWrap(e){this.wordWrap=e,this.$store.commit("ide/setEditorOption",{option:"lineWrapping",value:e})},updateAutoSave(e){this.$store.commit("ide/setAutoSave",e),e?this.startAutoSave():this.stopAutoSave()},updateAutoSaveInterval(e){this.$store.commit("ide/setAutoSaveInterval",e),this.$store.state.ide.ideInfo.autoSave&&(this.stopAutoSave(),this.startAutoSave())},updateAutoSaveNotifications(e){this.$store.commit("ide/setAutoSaveNotifications",e)},initializeAutoSave(){const e=localStorage.getItem("autoSave"),t=localStorage.getItem("autoSaveInterval"),i=localStorage.getItem("autoSaveNotifications");if(null!==e){const t="true"===e;this.$store.commit("ide/setAutoSave",t),t&&(bl.log("[AUTO-SAVE] Auto-save is enabled in settings, starting timer"),this.startAutoSave())}t&&this.$store.commit("ide/setAutoSaveInterval",parseInt(t)),null!==i&&this.$store.commit("ide/setAutoSaveNotifications","true"===i),bl.log("[AUTO-SAVE] Initialized auto-save settings:",{enabled:this.$store.state.ide.ideInfo.autoSave,interval:this.$store.state.ide.ideInfo.autoSaveInterval,notifications:this.$store.state.ide.ideInfo.autoSaveNotifications})},startAutoSave(){this.autoSaveTimer&&clearInterval(this.autoSaveTimer);const e=this.$store.state.ide.ideInfo.autoSaveInterval||60;bl.log(`[AUTO-SAVE] Starting auto-save timer with ${e}s interval`),this.autoSaveTimer=setInterval(()=>{this.saveAllFiles()},1e3*e)},stopAutoSave(){this.autoSaveTimer&&(clearInterval(this.autoSaveTimer),this.autoSaveTimer=null,bl.log("[AUTO-SAVE] Auto-save timer stopped"))},saveAllFiles(){const e=this.ideInfo.codeItems.filter(e=>e.content);if(0===e.length)return void bl.log("[AUTO-SAVE] No files to auto-save");bl.log(`[AUTO-SAVE] Auto-saving ${e.length} files`);let t=0;e.forEach(i=>{gl.constructor.emitIDEActivity("file-save",{filename:i.fileName}),this.$store.dispatch("ide/saveFile",{codeItem:i,isAutoSave:!0}).then(()=>{t++,t===e.length&&this.$store.state.ide.ideInfo.autoSaveNotifications&&(0,Ee.nk)({message:`Auto-saved ${t} file${t>1?"s":""}`,type:"info",duration:2e3,showClose:!1})}).catch(e=>{bl.error(`[AUTO-SAVE] Failed to auto-save ${i.path}:`,e),403===e.code&&bl.warn(`[AUTO-SAVE] Permission denied for ${i.path}, skipping auto-save`)})})},toggleConsoleExpand(){this.consoleExpanded=!this.consoleExpanded,this.updateEditorHeight(),localStorage.setItem("console-expanded",this.consoleExpanded)},updateEditorHeight(){if(this.consoleExpanded){const e=window.innerHeight-300,t=Math.min(this.consoleHeight,e);this.editorHeight=`calc(100% - ${t+35}px)`}else this.editorHeight="calc(100% - 35px)"},clearConsole(){const e=this.ideInfo.consoleSelected;e&&e.resultList&&this.$store.commit("ide/clearConsoleOutput",e.id),this.programInput="",this.programInputRows=1},toggleWordWrap(){this.wordWrap=!this.wordWrap,localStorage.setItem("word-wrap",this.wordWrap)},openREPL(){this.toggleReplMode()},closeREPL(){this.showREPL=!1},async toggleReplMode(){this.isReplMode?(this.replSessionId&&await this.stopReplSession(),this.isReplMode=!1,this.replPrompt=">>> ",this.replInput="",this.replInputRows=1):(this.isReplMode=!0,this.clearConsole(),this.consoleExpanded||(this.consoleExpanded=!0),await this.startReplSession(),this.$nextTick(()=>{this.$refs.replInputField&&this.$refs.replInputField.focus()}))},async startReplSession(){this.ideInfo.consoleSelected&&this.addReplOutput("Type Python code and press Enter to execute","system"),await this.startDualModeReplSession()},async stopReplSession(){await this.stopDualModeReplSession()},getPythonVersion(){return"3.x"},setupWebSocketHandler(){try{if(!this.wsInfo||!this.wsInfo.rws)return bl.log("WebSocket not ready, retrying..."),void setTimeout(()=>this.setupWebSocketHandler(),500);const e=e=>{try{const t=JSON.parse(e.data);bl.log(" [VmIde] ALL WebSocket msg:",{id:t.id,cmd_id:t.cmd_id,code:t.code,cmd:t.cmd,programId:t.data?.program_id,ourSessionId:this.replSessionId,fullMsg:t});const i=t.id===this.replSessionId||t.cmd_id===this.replSessionId||t.data&&t.data.program_id===this.replSessionId||this.isReplMode&&this.replSessionId&&(0===t.code||2e3===t.code||1111===t.code)&&t.data&&(t.data.stdout||t.data.stderr||t.data.program_id);if(bl.log(` Match check: id=${t.id===this.replSessionId}, cmd_id=${t.cmd_id===this.replSessionId}, prog_id=${t.data?.program_id===this.replSessionId}, isReplMode=${this.isReplMode}, code=${t.code}`),i)return bl.log(" REPL message matched - routing to REPL handler only!"),void this.handleReplResponse(t)}catch(t){}};this.$store.commit("websocket/addEventListener",{wsKey:"default",type:"message",listener:e}),this.wsMessageHandler=e,bl.log("WebSocket handler for REPL set up successfully")}catch(Dr){bl.error("Error setting up WebSocket handler:",Dr)}},handleReplMessage(e){bl.log("Handling REPL message:",e),this.handleReplResponse(e)},handleReplResponse(e){if(bl.log(" [REPL] Processing REPL response:",e),bl.log(" [REPL] Response type:",e?.type,"Data:",e?.data),e){if(e.type)switch(e.type){case"stdout":if(e.data&&e.data.text){const t=e.data.text;t.match(/^(>>>|\.\.\.)\s*$/)||""===t.trim()||this.addReplOutput(t,"output")}break;case"stderr":e.data&&e.data.text&&this.addReplOutput(e.data.text,"error");break;case"input_request":bl.log("Input request received:",e.data),e.data&&e.data.prompt&&(this.addReplOutput(e.data.prompt,"output"),this.$store.commit("ide/setConsoleWaiting",{id:this.ideInfo.consoleSelected?.id||e.cmd_id,waiting:!0,prompt:e.data.prompt}),this.programInputPrompt=e.data.prompt,this.$nextTick(()=>{this.$refs.programInputField&&this.$refs.programInputField.focus()}));break;case"repl_ready":bl.log("REPL ready:",e.data),this.isReplMode=!0,e.data&&e.data.prompt&&(this.replPrompt=e.data.prompt);break;case"complete":bl.log("Execution complete:",e.data),this.isReplMode=!1,e.data&&0!==e.data.exit_code&&this.addReplOutput(`\nProcess exited with code ${e.data.exit_code}`,"system"),this.$store.commit("ide/setConsoleWaiting",{id:this.ideInfo.consoleSelected?.id||e.cmd_id,waiting:!1});break;case"error":if(e.data){const t=e.data.error||"Unknown error";this.addReplOutput("Error: "+t,"error"),e.data.traceback&&this.addReplOutput(e.data.traceback,"error");const i=t.includes("Script timeout")||t.includes("Time limit exceeded")||t.includes("Infinite loop detected")||t.includes("Output rate limit exceeded")||t.includes("Flood detected");if(i){const i=t.includes("timeout")?"Timeout":"Infinite loop";bl.log(` [AUTO-STOP] ${i} detected - automatically stopping console`);const o=this.ideInfo.consoleSelected?.id||e.cmd_id;o&&setTimeout(()=>{this.stop(o),this.$store.commit("ide/updateConsoleItem",{id:o,run:!1,stop:!0}),this.addReplOutput("\nConsole stopped .\n","system")},100)}}break;case"figure":e.data&&e.data.content&&bl.log("Figure received, base64 length:",e.data.content.length);break;default:bl.log("Unknown message type:",e.type)}else if(0===e.code||"0"===e.code){if(e.data){if(e.data.stdout){const t=e.data.stdout;t.match(/^(>>>|\.\.\.)\s*$/)||""===t.trim()||this.addReplOutput(t,"output")}e.data.stderr&&this.addReplOutput(e.data.stderr,"error")}}else 2e3===e.code?e.data&&e.data.prompt&&(this.addReplOutput(e.data.prompt,"output"),this.$store.commit("ide/setConsoleWaiting",{id:this.ideInfo.consoleSelected?.id,waiting:!0,prompt:e.data.prompt})):5e3===e.code&&(this.isReplMode=!0);this.$nextTick(()=>{this.$refs.consoleOutputArea&&(this.$refs.consoleOutputArea.scrollTop=this.$refs.consoleOutputArea.scrollHeight)})}},toggleRightSidebar(){(this.previewTabs.length>0||this.rightSidebarVisible)&&(this.rightSidebarVisible=!this.rightSidebarVisible,localStorage.setItem("right-sidebar-visible",this.rightSidebarVisible))},expandRightPanel(){if(!this.rightPanelExpanded){this.previousRightWidth=this.rightSidebarWidth;const e=window.innerWidth,t=this.leftSidebarVisible?this.leftSidebarWidth:0;this.rightSidebarWidth=e-t-10,this.rightPanelExpanded=!0,this.consoleExpanded&&(this.consoleExpanded=!1,this.consoleMaximized=!1,this.updateEditorHeight())}},collapseRightPanel(){this.rightPanelExpanded?(this.rightSidebarWidth=this.previousRightWidth,this.rightPanelExpanded=!1,this.previousConsoleHeight>0&&(this.consoleExpanded=!0,this.updateEditorHeight())):this.rightSidebarWidth=300},handleLeftArrowClick(){"normal"===this.rightPanelMode&&(this.wasConsoleOpenBeforeRightExpand="collapsed"!==this.consoleMode,this.consoleMode="collapsed",this.consoleExpanded=!1,this.consoleMaximized=!1,this.rightPanelMode="expanded",this.rightSidebarVisible=!0,this.saveLayoutPreferences())},handleRightArrowClick(){"expanded"===this.rightPanelMode?(this.rightPanelMode="normal",this.wasConsoleOpenBeforeRightExpand&&(this.consoleMode="normal",this.consoleExpanded=!0)):"normal"===this.rightPanelMode&&(this.rightPanelMode="closed",this.rightSidebarVisible=!1),this.saveLayoutPreferences()},expandRightPanelToFull(){"normal"===this.rightPanelState&&(this.rightPanelNormalWidth=this.rightSidebarWidth),this.previousConsoleState.expanded=this.consoleExpanded,this.previousConsoleState.height=this.consoleHeight,this.consoleExpanded=!1,this.consoleMaximized=!1;const e=window.innerWidth,t=this.leftSidebarVisible?this.leftSidebarWidth:0;this.rightSidebarWidth=e-t-10,this.rightPanelState="expanded",this.rightPanelExpanded=!0,this.rightSidebarVisible=!0,this.updateEditorHeight(),this.saveLayoutPreferences()},collapseRightPanelCompletely(){"normal"===this.rightPanelState&&(this.rightPanelNormalWidth=this.rightSidebarWidth),this.rightSidebarVisible=!1,this.rightPanelState="collapsed",this.rightPanelExpanded=!1,this.saveLayoutPreferences()},restoreRightPanelToNormal(){this.rightSidebarWidth=this.rightPanelNormalWidth||400,this.rightSidebarVisible=!0,this.rightPanelState="normal",this.rightPanelExpanded=!1,this.previousConsoleState.expanded&&(this.consoleExpanded=!0,this.consoleHeight=this.previousConsoleState.height||200),this.updateEditorHeight(),this.saveLayoutPreferences()},restoreRightPanel(){this.rightPanelMode="normal",this.rightSidebarVisible=!0,this.saveLayoutPreferences()},handleConsoleUpArrow(){"collapsed"===this.consoleMode?(this.consoleMode="normal",this.consoleExpanded=!0,this.consoleMaximized=!1,this.updateEditorHeight()):"normal"===this.consoleMode&&(this.consolePreviousMode="normal",this.consoleMode="maximized",this.consoleMaximized=!0,this.consoleExpanded=!0,this.updateEditorHeight())},handleConsoleDownArrow(){"normal"!==this.consoleMode&&"maximized"!==this.consoleMode||(this.consoleMode="collapsed",this.consoleExpanded=!1,this.consoleMaximized=!1,this.updateEditorHeight())},handleConsoleRestore(){"maximized"===this.consoleMode&&(this.consoleMode=this.consolePreviousMode||"normal",this.consoleMaximized=!1,this.consoleExpanded="normal"===this.consoleMode,this.updateEditorHeight())},handleTabChange(e,t){this.isReplMode&&this.replSessionId&&(bl.log(" [VmIde] File switched - stopping REPL session"),this.stopReplSession()),t&&t.path&&this.activeFilePath&&this.saveFileConsoleState(this.activeFilePath),e&&e.path&&(this.activeFilePath=e.path,this.loadFileConsoleState(e.path))},saveFileConsoleState(e){if(!e||!e.endsWith(".py"))return;const t=this.ideInfo.consoleItems.find(t=>t.path===e);this.fileConsoleStates[e]={mode:this.consoleMode,expanded:this.consoleExpanded,maximized:this.consoleMaximized,consoleId:t?t.id:null,hasOutput:t&&t.resultList&&t.resultList.length>0}},loadFileConsoleState(e){if(!e||!e.endsWith(".py"))return this.consoleMode="collapsed",this.consoleExpanded=!1,void(this.consoleMaximized=!1);const t=this.fileConsoleStates[e];if(t){if(this.consoleMode=t.mode||"collapsed",this.consoleExpanded=t.expanded||!1,this.consoleMaximized=t.maximized||!1,t.consoleId&&this.ideInfo.consoleItems){const e=this.ideInfo.consoleItems.find(e=>e.id===t.consoleId);e&&this.$nextTick(()=>{this.$store.commit("ide/setConsoleSelected",e)})}}else this.consoleMode="collapsed",this.consoleExpanded=!1,this.consoleMaximized=!1;this.$nextTick(()=>{this.updateEditorHeight()})},getOrCreateFileConsole(e){if(!e||"string"!==typeof e)return bl.error("getOrCreateFileConsole: Invalid file path provided:",e),null;let t=this.ideInfo.consoleItems.find(t=>t.path===e);if(!t){const i=e.split("/").pop(),o={id:this.ideInfo.consoleId,path:e,name:i,run:!1,resultList:[],waitingForInput:!1,inputPrompt:""};this.$store.commit("ide/addConsoleItem",o),this.$store.commit("ide/setConsoleId",this.ideInfo.consoleId+1),t=this.ideInfo.consoleItems.find(e=>e.id===o.id)}return t},expandConsole(){this.consoleMaximized||(this.consoleMaximized=!0,this.consoleExpanded=!0)},restoreConsole(){this.consoleMaximized&&(this.consoleMaximized=!1,this.consoleExpanded=!0)},collapseConsole(){this.consoleExpanded=!1,this.consoleMaximized=!1},selectPreviewTab(e){this.selectedPreviewTab=e},closePreviewTab(e){const t=this.previewTabs.findIndex(t=>t.id===e);if(t>-1){const i=this.previewTabs[t];"pdf"===i.type&&i.content&&i.content.startsWith("blob:")&&URL.revokeObjectURL(i.content),this.previewTabs.splice(t,1),this.selectedPreviewTab===e&&(this.selectedPreviewTab=this.previewTabs.length>0?this.previewTabs[0].id:null),0===this.previewTabs.length&&(this.rightSidebarVisible=!1,this.rightPanelMode="closed")}},addPreviewTab(e,t,i,o,s){bl.log("[addPreviewTab] Adding tab:",{type:e,title:t,filePath:o,projectName:s,hasContent:!!i});const n=this.previewTabs.find(e=>e.filePath===o&&e.projectName===s);if(n)this.selectedPreviewTab=n.id,n.content!==i&&("pdf"===n.type&&n.content&&n.content.startsWith("blob:")&&URL.revokeObjectURL(n.content),n.content=i);else{this.previewTabs.length>0&&(this.previewTabs.forEach(e=>{"pdf"===e.type&&e.content&&e.content.startsWith("blob:")&&URL.revokeObjectURL(e.content)}),this.previewTabs=[]);const n=`${e}-${++this.previewTabCounter}`;this.previewTabs.push({id:n,type:e,title:t,content:i,filePath:o,projectName:s}),this.selectedPreviewTab=n}"closed"!==this.rightPanelMode&&this.rightSidebarVisible||(this.rightPanelMode="normal",this.rightSidebarVisible=!0,this.$nextTick(()=>{this.rightSidebarVisible||(this.rightSidebarVisible=!0)}))},getTabIcon(e){const t={output:"",image:"",pdf:"",data:"",text:""};return t[e]||""},handleThemeChange(e){bl.log("Theme changed to:",e)},downloadFile(e){if(!e||!e.fileName)return bl.error("[downloadFile] Invalid fileInfo:",e),void Ee.nk.error("Cannot download: invalid file information");const t=[".png",".jpg",".jpeg",".gif",".bmp",".svg",".pdf",".zip",".tar",".gz"],i=t.some(t=>e.fileName.toLowerCase().endsWith(t));this.$store.dispatch(`ide/${ut.Jh}`,{projectName:e.projectName,filePath:e.filePath,binary:i,callback:t=>{if(bl.log("[downloadFile] Response:",{code:t.code,hasData:!!t.data,dataKeys:t.data?Object.keys(t.data):[]}),0==t.code){let s,n=t.data?.content||t.data;if(i)try{if("object"===typeof n&&n.content&&(n=n.content),"string"!==typeof n)throw new Error("Binary content is not a string");n.includes(",")&&(n=n.split(",")[1]);const e=atob(n),t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);s=new Blob([t],{type:"application/octet-stream"})}catch(o){return bl.error("[downloadFile] Error decoding binary data:",o),void Ee.nk.error("Failed to decode file data: "+o.message)}else s=new Blob([n],{type:"text/plain"});const a=window.URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=e.fileName,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a),(0,Ee.nk)({type:"success",message:`Downloaded ${e.fileName}`,duration:2e3})}else(0,Ee.nk)({type:"error",message:`Failed to download ${e.fileName}`,duration:3e3})}})},handleFileCreated(e){bl.log("[handleFileCreated] File created:",e),this.refreshProjectTree()},handleFolderCreated(e){bl.log("[handleFolderCreated] Folder created:",e),this.refreshProjectTree()},handleFilesImported(e){bl.log("[handleFilesImported] Files imported:",e),this.refreshProjectTree()},handleBulkUpload(){localStorage.getItem("role");const e=localStorage.getItem("username"),t=["sl7927","sa9082","et2434","admin_editor","test_admin"];t.includes(e)?this.showBulkUploadDialog=!0:this.$message.warning("Only admin users can access bulk upload")},refreshProjectTree(){this.refreshProjectTreeWithCallback(null)},refreshProjectTreeWithCallback(e){const t=this;if(t.ideInfo.multiRootData&&t.ideInfo.multiRootData.children.length>0){bl.log("[VmIde] Refreshing multi-root project tree");let i=0;const o=t.ideInfo.multiRootData.children.length;t.ideInfo.multiRootData.children.forEach(s=>{t.$store.dispatch(`ide/${ut.QQ}`,{projectName:s.name,callback:n=>{0==n.code?(t.$store.commit("ide/handleProject",n.data),i++,i===o&&(bl.log("[VmIde] All projects refreshed"),e&&e())):(bl.error("[VmIde] Failed to refresh project:",s.name,n),i++,i===o&&e&&e())}})})}else this.ideInfo.currProj&&this.ideInfo.currProj.data?(bl.log("[VmIde] Refreshing single project tree"),this.$store.dispatch(`ide/${ut.QQ}`,{projectName:this.ideInfo.currProj.data.name,callback:i=>{0==i.code?(t.$store.commit("ide/handleProject",i.data),bl.log("[VmIde] Single project refreshed successfully")):bl.error("[VmIde] Failed to refresh project:",i),e&&e()}})):(bl.warn("[VmIde] No project to refresh"),e&&e())},inputIsLegal(e,t){this.dialogText=e;let i=this.checkStrIsLegal(this.dialogText,"create-file"===this.dialogType||"rename-file"===this.dialogType);return i&&("create-project"===this.dialogType||"rename-project"===this.dialogType?i=!this.isProjExist(this.dialogText):"create-file"!==this.dialogType&&"rename-file"!==this.dialogType&&"create-folder"!==this.dialogType&&"rename-folder"!==this.dialogType||(i=!this.isFileExist(this.dialogText,"create-file"===this.dialogType||"create-folder"===this.dialogType))),t(i),i},isProjExist(e){const t=this.ideInfo.projList.some(t=>t.name===e);return t&&(this.dialogTips="Project name already exists"),t},isSelectedFile(e){return this.ideInfo.codeSelected&&this.ideInfo.codeSelected.path===e.path&&this.ideInfo.codeSelected.projectName===e.projectName},getParentData(e){if(this.ideInfo.treeRef&&this.ideInfo.treeRef.currentNode&&this.ideInfo.treeRef.currentNode.parent)return this.ideInfo.treeRef.currentNode.parent.data;if(this.ideInfo.multiRootData&&this.ideInfo.multiRootData.children)for(let t of this.ideInfo.multiRootData.children){const i=this.findParentInTree(t,e);if(i)return i}return this.ideInfo.currProj&&this.ideInfo.currProj.data?this.findParentInTree(this.ideInfo.currProj.data,e):null},findParentInTree(e,t){if(!e||!e.children)return null;for(let i of e.children)if(i.path===t)return e;for(let i of e.children)if(t.startsWith(i.path+"/")||i.path===t){const e=this.findParentInTree(i,t);if(e)return e}return null},isFileExist(e,t){let i=!1;if(!this.ideInfo.nodeSelected)return!1;if(t)i=this.ideInfo.nodeSelected.children&&this.ideInfo.nodeSelected.children.some(t=>t.name===e);else{const t=this.getParentData(this.ideInfo.nodeSelected.path);t&&t.children&&(i=t.children.some(t=>t.name===e))}return i&&(this.dialogTips="File with the same name already exists"),i},checkStrIsLegal(e,t){this.dialogTips="";let i=t&&-1!==e.lastIndexOf(".")?e.substring(0,e.lastIndexOf(".")):e;if(!i)return this.dialogTips="Name cannot be empty",!1;if(i.length>15)return this.dialogTips="Name length cannot exceed 15 characters",!1;if(t&&e.endsWith("."))return this.dialogTips="Name can only contain letters, numbers and underscore _",!1;const o=/^[a-zA-Z0-9_]+$/.test(i);return o||(this.dialogTips="Name can only contain letters, numbers and underscore _"),o},listProjects(e){const t=this;this.$store.dispatch(`ide/${ut.qB}`,{callback:i=>{0==i.code&&(t.$store.commit("ide/handleProjects",i.data),e&&t.getProject(e))}})},loadAllDefaultProjects(){bl.log(" [loadAllDefaultProjects] Starting to load default projects");const e=this,t=localStorage.getItem("username"),i=localStorage.getItem("role"),o=[];if("professor"===i?this.ideInfo.projList.forEach(e=>{const t="string"===typeof e?e:e.name;t&&o.push(t)}):(this.ideInfo.projList.forEach(e=>{const t="string"===typeof e?e:e.name;t&&o.push(t)}),bl.log(` [loadAllDefaultProjects] Student ${t} loading all visible projects:`,o)),bl.log(" [loadAllDefaultProjects] Projects to load:",o),bl.log(" [loadAllDefaultProjects] Available projects:",this.ideInfo.projList),0===o.length)return void bl.warn(" [loadAllDefaultProjects] No projects to load");const s=[];let n=0;o.forEach(a=>{bl.log(` [loadAllDefaultProjects] Loading project: ${a}`),this.$store.dispatch(`ide/${ut.QQ}`,{projectName:a,callback:r=>{if(bl.log(` [loadAllDefaultProjects] Response for ${a}:`,r),0==r.code){if(s.push(r.data),n++,n===o.length)if(bl.log(" [loadAllDefaultProjects] All projects loaded:",s),e.$store.commit("ide/handleMultipleProjects",s),"professor"===i){const t=s.find(e=>"Local"===e.name);t?e.$store.commit("ide/handleProject",t):s.length>0&&e.$store.commit("ide/handleProject",s[0])}else{const i=s.find(e=>e.name===`Local/${t}`);i?e.$store.commit("ide/handleProject",i):s.length>0&&e.$store.commit("ide/handleProject",s[0])}}else bl.error(` [loadAllDefaultProjects] Failed to load ${a}:`,r),n++}})})},getProject(e){const t=this;this.$store.dispatch(`ide/${ut.QQ}`,{projectName:void 0===e?this.ideInfo.currProj.config.name:e,callback:e=>{if(0==e.code){t.$store.commit("ide/handleProject",e.data);for(var i=0;i<t.ideInfo.currProj.config.openList.length;i++)t.getFile(t.ideInfo.currProj.config.openList[i],!1,t.ideInfo.currProj.data.name)}}})},getFile(e,t,i){const o=this;bl.log("[getFile] Called with:",{path:e,save:t,projectName:i});const s=i||this.ideInfo.nodeSelected&&this.ideInfo.nodeSelected.projectName||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name,n=[".png",".jpg",".jpeg",".gif",".bmp",".svg",".webp",".pdf"],a=[".csv"],r=[".txt"],l=n.some(t=>e.toLowerCase().endsWith(t)),d=a.some(t=>e.toLowerCase().endsWith(t)),c=r.some(t=>e.toLowerCase().endsWith(t));if(l){const i=e.split("/").pop(),n=e.toLowerCase().split(".").pop(),a="pdf"===n?"pdf":"image";bl.log("[getFile] Adding media file tab:",{originalPath:e,fileName:i,fileExt:n,actualProjectName:s}),o.addPreviewTab(a,i,null,e,s),!1!==t&&o.$store.dispatch(`ide/${ut.xv}`,{})}else if(d){const i=e.split("/").pop();this.$store.dispatch(`ide/${ut.Jh}`,{projectName:s,filePath:e,callback:n=>{if(0===n.code&&n.data){const a=n.data.content||n.data;o.addPreviewTab("data",i,a,e,s),!1!==t&&o.$store.dispatch(`ide/${ut.xv}`,{})}else bl.error("Failed to get CSV file:",e,n),(0,Ee.nk)({type:"error",message:`Failed to load ${i}`,duration:3e3})}})}else if(c){const i=e.split("/").pop();this.$store.dispatch(`ide/${ut.Jh}`,{projectName:s,filePath:e,callback:n=>{if(0===n.code&&n.data){const a=n.data.content||n.data;o.addPreviewTab("text",i,a,e,s),!1!==t&&o.$store.dispatch(`ide/${ut.xv}`,{})}else bl.error("Failed to get text file:",e,n),(0,Ee.nk)({type:"error",message:`Failed to load ${i}`,duration:3e3})}})}else{this.ideInfo.fullscreenPreview&&this.ideInfo.fullscreenPreview.active&&this.$store.commit("ide/closeFullscreenPreview");let i=e;s&&e.startsWith(s+"/")&&(i=e.substring(s.length+1)),bl.log("[getFile] Getting file with relative path:",{originalPath:e,projectName:s,relativePath:i}),this.$store.dispatch(`ide/${ut.Jh}`,{projectName:s,filePath:i,callback:i=>{0==i.code?(o.$store.commit("ide/handleGetFile",{filePath:e,data:i.data,save:t,isMedia:!1,projectName:o.ideInfo.currProj?.data?.name}),!1!==t&&o.$store.dispatch(`ide/${ut.xv}`,{})):bl.error("Failed to get file:",e,i)}})}},getFileForRightPanel(e,t){this.getFile(e,!1,t)},handleReorderTabs(e,t){this.$store.commit("ide/reorderCodeItems",{fromIndex:e,toIndex:t})},handlePreviewDragStart(e,t){this.previewDraggedIndex=t,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",t.toString())},handlePreviewDragOver(e,t){e.preventDefault(),e.dataTransfer.dropEffect="move"},handlePreviewDragEnter(e,t){e.preventDefault(),t!==this.previewDraggedIndex&&-1!==this.previewDraggedIndex&&(this.previewDropTargetIndex=t)},handlePreviewDragLeave(e){},handlePreviewDrop(e,t){if(e.preventDefault(),-1!==this.previewDraggedIndex&&t!==this.previewDraggedIndex){const e=[...this.previewTabs],[i]=e.splice(this.previewDraggedIndex,1);e.splice(t,0,i),this.previewTabs=e}this.resetPreviewDragState()},handlePreviewDropOnContainer(e){this.resetPreviewDragState()},handlePreviewDragEnd(){this.resetPreviewDragState()},resetPreviewDragState(){this.previewDraggedIndex=-1,this.previewDropTargetIndex=-1},handleNavigateTab(e){bl.log(" [TAB-NAV] handleNavigateTab called:",e,"focusedPanel:",this.focusedPanel),"editor"===this.focusedPanel?this.navigateEditorTab(e):this.navigatePreviewTab(e)},navigateEditorTab(e){const t=this.ideInfo.codeItems;if(bl.log(" [TAB-NAV] navigateEditorTab:",e,"items count:",t.length),0===t.length)return;const i=t.findIndex(e=>e.path===this.ideInfo.codeSelected?.path&&e.projectName===this.ideInfo.codeSelected?.projectName);let o;o="next"===e?(i+1)%t.length:(i-1+t.length)%t.length,bl.log(" [TAB-NAV] Moving from index",i,"to",o),this.selectFile(t[o])},navigatePreviewTab(e){if(bl.log(" [TAB-NAV] navigatePreviewTab:",e,"previewTabs count:",this.previewTabs.length),0===this.previewTabs.length)return;const t=this.previewTabs.findIndex(e=>e.id===this.selectedPreviewTab);let i;i="next"===e?(t+1)%this.previewTabs.length:(t-1+this.previewTabs.length)%this.previewTabs.length,bl.log(" [TAB-NAV] Preview tab moving from index",t,"to",i),this.selectedPreviewTab=this.previewTabs[i].id},handleJumpToTab(e){if(bl.log(" [TAB-NAV] handleJumpToTab called:",e,"focusedPanel:",this.focusedPanel),"editor"===this.focusedPanel){const t=this.ideInfo.codeItems;bl.log(" [TAB-NAV] Editor tabs:",t.length,"jumping to index:",e),e<t.length?(bl.log(" [TAB-NAV] Selecting file:",t[e]?.fileName),this.selectFile(t[e])):bl.log(" [TAB-NAV] Index out of bounds, max is:",t.length-1)}else bl.log(" [TAB-NAV] Preview tabs:",this.previewTabs.length,"jumping to index:",e),e<this.previewTabs.length?(bl.log(" [TAB-NAV] Selecting preview tab:",this.previewTabs[e]?.name),this.selectedPreviewTab=this.previewTabs[e].id):bl.log(" [TAB-NAV] Index out of bounds, max is:",this.previewTabs.length-1)},handleCloseCurrentTab(){"editor"===this.focusedPanel?this.ideInfo.codeSelected&&this.closeFile(this.ideInfo.codeSelected):this.selectedPreviewTab&&this.closePreviewTab(this.selectedPreviewTab)},setFocusedPanel(e){this.focusedPanel=e},getMediaCodeItem(e){const t=e.projectName||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name;return bl.log("[getMediaCodeItem] Creating media code item:",{tabTitle:e.title,tabFilePath:e.filePath,tabProjectName:e.projectName,actualProjectName:t,hasContent:!!e.content,contentType:e.content?e.content.startsWith("data:")?"data-url":e.content.startsWith("blob:")?"blob-url":"other":"none"}),e.content&&e.content.startsWith("data:")||e.content&&e.content.startsWith("blob:")?{name:e.title,path:e.filePath,projectName:t,content:e.content,preloaded:!0}:{name:e.title,path:e.filePath,projectName:t,preloaded:!1}},openFullscreenPreview(e,t){const i=this,o=e.split("/").pop(),s=e.toLowerCase().split(".").pop(),n=[".png",".jpg",".jpeg",".gif",".bmp",".svg",".webp",".pdf"],a=[".csv"],r=n.some(t=>e.toLowerCase().endsWith(t)),l=a.some(t=>e.toLowerCase().endsWith(t));r?this.$store.dispatch(`ide/${ut.Jh}`,{projectName:t,filePath:e,binary:!0,callback:n=>{if(0===n.code&&n.data){let a=n.data.content||n.data;if(a&&a.length>0){const n={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",bmp:"image/bmp",svg:"image/svg+xml",webp:"image/webp",pdf:"application/pdf"},r=n[s]||"application/octet-stream",l=`data:${r};base64,${a}`,d={name:o,path:e,projectName:t,content:l,type:"pdf"===s?"pdf":"image"};i.$store.commit("ide/setFullscreenPreview",{file:d,content:l})}else i.$message.error(`Failed to load ${o}: No content received`)}else i.$message.error(`Failed to load ${o}`)}}):l&&this.$store.dispatch(`ide/${ut.Jh}`,{projectName:t,filePath:e,callback:s=>{if(0===s.code&&s.data){const n=s.data.content||s.data,a={name:o,path:e,projectName:t,content:n,type:"csv"};i.$store.commit("ide/setFullscreenPreview",{file:a,content:n})}else i.$message.error(`Failed to load ${o}`)}})},setTextDialog(e){"create-file"!==e.type||"New File"!==e.title?(this.dialogType=e.type,this.dialogTitle=e.title,this.dialogText=e.text,this.dialogTips=e.tips,this.showFileDialog=!0,this.showProjsDialog=!1):this.showNewFileDialog=!0},handleRenameItem(e){bl.log("[handleRenameItem] Received rename request:",e);const{oldPath:t,newName:i,type:o,projectName:s}=e,n=s||this.ideInfo.currProj?.config?.name||this.ideInfo.currProj?.data?.name;bl.log("[handleRenameItem] Using project:",n),bl.log("[handleRenameItem] Data projectName:",s),bl.log("[handleRenameItem] Current project:",this.ideInfo.currProj?.data?.name),bl.log("[handleRenameItem] Renaming:",{oldPath:t,newName:i,type:o,actualProjectName:n}),"file"===o?this.renameFile(i,t,n):"dir"!==o&&"folder"!==o||this.renameFolder(i,t,n)},handleDeleteItem(e){const{path:t,type:i,projectName:o}=e;bl.log("[handleDeleteItem] Deleting:",i,"at path:",t,"in project:",o),"file"===i?this.deleteFile(t,o):"dir"!==i&&"folder"!==i||this.deleteFolder(t,o)},handleDownloadItem(e){if(bl.log("[handleDownloadItem] Download request:",e),!e||!e.path)return bl.error("[handleDownloadItem] Invalid data:",e),void Ee.nk.error("Cannot download: no file selected");const t=e.path.split("/").pop()||e.label||e.name||"download",i={fileName:t,filePath:e.path,projectName:e.projectName||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name};bl.log("[handleDownloadItem] Downloading:",i),this.downloadFile(i)},openFileBrowser(){this.fileBrowserMode="open",this.fileToMove=null,this.showFileBrowserDialog=!0},handleSignIn(){bl.log("handleSignIn called");const e=localStorage.getItem("session_id"),t=localStorage.getItem("username");e&&t?pi.s.confirm(`You are already logged in as ${t}. Do you want to sign out and login with a different account?`,"Already Logged In",{confirmButtonText:"Sign Out",cancelButtonText:"Cancel",type:"info"}).then(()=>{localStorage.removeItem("session_id"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("full_name"),window.location.reload()}).catch(()=>{}):(bl.log("Setting showLoginModal to true"),this.showLoginModal=!0,bl.log("showLoginModal is now:",this.showLoginModal),this.$nextTick(()=>{bl.log("After nextTick, showLoginModal:",this.showLoginModal),bl.log("Login modal element:",document.querySelector(".login-modal-overlay"))}))},handleLoginSuccess(e){bl.log("Login success received:",e),e?(bl.log(" [VmIde] Starting session manager after login..."),gl.startTracking(),Ee.nk.success(`Welcome, ${e.full_name||e.username}!`),setTimeout(()=>{window.location.reload()},500)):bl.error("No user data received in handleLoginSuccess")},reconnectWebSocket(){this.wsInfo&&this.wsInfo.rws&&this.wsInfo.rws.close(),setTimeout(()=>{this.$store.dispatch("websocket/init")},500)},handleNewFileFromTree(){const e=this.ideInfo.nodeSelected;if(!e||"dir"!==e.type&&"folder"!==e.type){const e=this.ideInfo.currProj?.data;e&&this.$store.commit("ide/setNodeSelected",e)}this.setTextDialog({type:"create-file",title:"New File",tips:"Enter file name:",text:"untitled.py"})},handleNewFolderFromTree(){const e=this.ideInfo.nodeSelected;if(!e||"dir"!==e.type&&"folder"!==e.type){const e=this.ideInfo.currProj?.data;e&&this.$store.commit("ide/setNodeSelected",e)}this.showNewFolderDialog=!0},handleImportFileFromTree(){const e=this.ideInfo.nodeSelected;if(!e||"dir"!==e.type&&"folder"!==e.type){const e=this.ideInfo.currProj?.data;e&&this.$store.commit("ide/setNodeSelected",e)}this.showImportFileDialog=!0},handleUndo(){const e=this.getActiveCodeMirrorInstance();e?e.undo():document.execCommand("undo")},handleRedo(){const e=this.getActiveCodeMirrorInstance();e?e.redo():document.execCommand("redo")},handleCut(){const e=this.getActiveCodeMirrorInstance();if(e&&e.somethingSelected()){const t=e.getSelection();navigator.clipboard.writeText(t),e.replaceSelection("")}else document.execCommand("cut")},handleCopy(){const e=this.getActiveCodeMirrorInstance();if(e&&e.somethingSelected()){const t=e.getSelection();navigator.clipboard.writeText(t)}else document.execCommand("copy")},async handlePaste(){const e=this.getActiveCodeMirrorInstance();if(e)try{const t=await navigator.clipboard.readText(),i=await za.A.validatePaste(t);i&&e.replaceSelection(t)}catch(t){za.A.isProfessor()?document.execCommand("paste"):bl.log("[VmIde] Paste blocked for student (clipboard API failed)")}else za.A.isProfessor()&&document.execCommand("paste")},handleFind(){bl.log("[FIND DISABLED] Find feature temporarily disabled for file handling assignment")},handleReplace(){bl.log("[REPLACE DISABLED] Replace feature temporarily disabled for file handling assignment")},handleComment(){const e=this.getActiveCodeMirrorInstance();if(e)try{const t=e.getCursor(),i=e.getLine(t.line);let o=t.ch;if(i.trim().startsWith("# ")){const s=i.replace(/^(\s*)# /,"$1");e.replaceRange(s,{line:t.line,ch:0},{line:t.line,ch:i.length}),o=Math.max(0,t.ch-2)}else if(i.trim().startsWith("#")){const s=i.replace(/^(\s*)#/,"$1");e.replaceRange(s,{line:t.line,ch:0},{line:t.line,ch:i.length}),o=Math.max(0,t.ch-1)}else if(""!==i.trim()){const s=i.match(/^(\s*)(.*)/),n=s[1]||"",a=s[2]||"",r=n+"# "+a;e.replaceRange(r,{line:t.line,ch:0},{line:t.line,ch:i.length}),o=t.ch+2}e.setCursor(t.line,o),e.focus(),e.refresh();const s=e.getValue();void 0!==this.ideInfo.codeSelectedIndex&&this.$store.commit("ide/setCodeItemContent",{index:this.ideInfo.codeSelectedIndex,content:s}),setTimeout(()=>{e.refresh()},10)}catch(Dr){bl.error("Comment toggle error:",Dr)}},getActiveCodeMirrorInstance(){const e=document.querySelector(".editor-content .code-editor-flex .CodeMirror");if(e&&e.CodeMirror)return e.CodeMirror;const t=document.querySelectorAll(".code-editor-container");for(let o=0;o<t.length;o++){const e=t[o];if(null!==e.offsetParent){const t=e.querySelector(".CodeMirror");if(t&&t.CodeMirror)return t.CodeMirror}}const i=document.querySelectorAll(".CodeMirror");for(let o=0;o<i.length;o++){const e=i[o];if(e.CodeMirror&&null!==e.offsetParent)return e.CodeMirror}return null},toggleConsole(e){e?(this.consoleMode="normal",this.consolePaneSize=30,this.ideInfo.consoleSelected&&this.ideInfo.consoleSelected.id||this.startEmptyRepl()):(this.consoleMode="collapsed",this.consolePaneSize=5)},startEmptyRepl(){const e={id:"empty-repl-"+Date.now(),name:"Python REPL",path:"REPL",resultList:[],run:!1,stop:!1,waitingForInput:!1,inputPrompt:""};this.$store.commit("ide/pushConsoleItem",e),this.$store.commit("ide/selectConsoleItem",e.id),this.sendMessage({cmd:"start_python_repl",cmd_id:e.id,data:{projectName:this.ideInfo.currProj?.data?.name||"Local"}}),this.$store.commit("ide/updateConsoleItem",{id:e.id,run:!0})},togglePreviewPanel(){bl.log(" [TOGGLE-PREVIEW] Current rightPanelMode:",this.rightPanelMode,"previewTabs:",this.previewTabs.length),"closed"===this.rightPanelMode?0===this.previewTabs.length?(this.$message.info("No files to preview. Open an image, PDF, or CSV file."),bl.log(" [TOGGLE-PREVIEW] No preview tabs, showing info message")):(this.rightPanelMode="normal",bl.log(" [TOGGLE-PREVIEW] Opening panel -> normal")):(this.rightPanelMode="closed",bl.log(" [TOGGLE-PREVIEW] Closing panel -> closed"))},handleOpenFile(e){this.getFile(e),this.showFileBrowserDialog=!1},async duplicateFile(e){const{originalPath:t,newName:i,projectName:o}=e,s=this;bl.log(" [DEBUG] duplicateFile called with:",{originalPath:t,newName:i,projectName:o});const n=t.lastIndexOf("/"),a=n>0?t.substring(0,n):"/",r=await this.generateUniqueFileName(i,a,o),l=a+"/"+r;bl.log(" [DEBUG] Generated unique filename:",r),bl.log(" [DEBUG] New file path will be:",l),this.$store.dispatch(`ide/${ut.Jh}`,{projectName:o,filePath:t,callback:e=>{if(0==e.code){const t=e.data.content||e.data;bl.log(" [DEBUG] Original file content retrieved, length:",t?.length),s.$store.dispatch(`ide/${ut.Zd}`,{projectName:o,parentPath:a,fileName:r,callback:e=>{0==e.code?(bl.log(" [DEBUG] File created successfully, now writing content"),s.$store.dispatch(`ide/${ut._L}`,{projectName:o,filePath:l,fileData:t,complete:!0,callback:e=>{0==e.code?(bl.log(" [DEBUG] File duplicated successfully as:",r),Ee.nk.success(`File duplicated as ${r}`),s.refreshProjectTree()):(bl.error(" [DEBUG] Failed to write content to duplicate file:",e),Ee.nk.error("Failed to write content to duplicate file"))}})):(bl.error(" [DEBUG] Failed to create duplicate file:",e),Ee.nk.error("Failed to create duplicate file"))}})}else bl.error(" [DEBUG] Failed to read original file:",e),Ee.nk.error("Failed to read original file")}})},async generateUniqueFileName(e,t,i){const o=e.lastIndexOf("."),s=o>0?e.substring(o):"",n=o>0?e.substring(0,o):e;bl.log(" [DEBUG] generateUniqueFileName:",{proposedName:e,baseName:n,extension:s,parentPath:t});const a=await this.getExistingFilesInDirectory(t,i);if(bl.log(" [DEBUG] Existing files in directory:",a),!a.includes(e))return bl.log(" [DEBUG] Proposed name is already unique:",e),e;for(let d=1;d<1e3;d++){const e=1===d?`${n}_copy${s}`:`${n}_copy_${d}${s}`;if(!a.includes(e))return bl.log(" [DEBUG] Found unique name:",e),e}const r=Date.now(),l=`${n}_copy_${r}${s}`;return bl.log(" [DEBUG] Using timestamp fallback:",l),l},async getExistingFilesInDirectory(e,t){return new Promise(t=>{try{const i=this.ideInfo.currProj?.data;if(!i)return bl.log(" [DEBUG] No project data available"),void t([]);const o=(e,t)=>{try{if(!e||"object"!==typeof e)return null;if(e.path===t&&"dir"===e.type)return e;if(e.children&&Array.isArray(e.children))for(const i of e.children){if(!i||"object"!==typeof i)continue;const e=o(i,t);if(e)return e}return null}catch(i){return bl.warn(" [DEBUG] Error in findDirectory:",i),null}},s=o(i,e);if(bl.log(" [DEBUG] Found target directory:",s),s&&s.children&&Array.isArray(s.children)){const e=s.children.filter(e=>{try{return e&&"object"===typeof e&&"file"===e.type&&(e.label||e.name)}catch(t){return bl.warn(" [DEBUG] Invalid child node, skipping:",e,t),!1}}).map(e=>{try{return e.label||e.name||"unnamed"}catch(t){return bl.warn(" [DEBUG] Error extracting child name:",t),"unnamed"}}).filter(e=>e&&"unnamed"!==e);bl.log(" [DEBUG] Extracted filenames:",e),t(e)}else bl.log(" [DEBUG] Directory not found or has no children"),t([])}catch(Dr){bl.warn(" [DEBUG] Error in getExistingFilesInDirectory:",Dr),t([])}})},async saveAsFile(e){if(bl.log(" [DEBUG] VmIde.saveAsFile() called with:",e),!e||!e.fileName)return bl.log(" [DEBUG] Invalid fileInfo - no fileName"),void Ee.nk.error("No file selected to save");const t=this.ideInfo.codeItems.find(t=>t.filePath===e.filePath&&(t.projectName===e.projectName||!t.projectName&&!e.projectName));bl.log(" [DEBUG] Looking for codeItem with filePath:",e.filePath),bl.log(" [DEBUG] Available codeItems:",this.ideInfo.codeItems?.map(e=>({filePath:e.filePath,projectName:e.projectName}))),bl.log(" [DEBUG] Found codeItem:",!!t),t?(bl.log(" [DEBUG] Using editor content, calling performSaveAs"),await this.performSaveAs(e,t.content)):(bl.log(" [DEBUG] File not in editor, reading from server"),this.readFileForSaveAs(e))},readFileForSaveAs(e){bl.log(" [DEBUG] readFileForSaveAs called with:",e);const t=[".png",".jpg",".jpeg",".gif",".bmp",".svg",".pdf",".zip",".tar",".gz"],i=t.some(t=>e.fileName.toLowerCase().endsWith(t));bl.log(" [DEBUG] File is binary:",i),bl.log(" [DEBUG] Dispatching IDE_GET_FILE with:",{projectName:e.projectName,filePath:e.filePath,binary:i}),this.$store.dispatch(`ide/${ut.Jh}`,{projectName:e.projectName,filePath:e.filePath,binary:i,callback:async t=>{if(bl.log(" [DEBUG] IDE_GET_FILE callback received:",{code:t.code,hasData:!!t.data}),0==t.code){let o=t.data?.content||t.data;if(i)return void Ee.nk.info("Binary files should be downloaded using the Download option instead.");"object"===typeof o&&o.content&&(o=o.content),await this.performSaveAs(e,o)}else Ee.nk.error("Failed to read file content")}})},async performSaveAs(e,t){bl.log(" [DEBUG] performSaveAs called with fileInfo:",e),bl.log(" [DEBUG] Content length:",t?.length);const i=e=>{const t=e.toLowerCase().split(".").pop(),i={py:"text/x-python",js:"text/javascript",html:"text/html",css:"text/css",json:"application/json",md:"text/markdown",txt:"text/plain",csv:"text/csv",xml:"text/xml"};return i[t]||"text/plain"},o=i(e.fileName),s="showSaveFilePicker"in window,n=window.isSecureContext;if(s&&n)try{const i=e.fileName.split(".").pop()||"txt",s={suggestedName:e.fileName,types:[{description:`${i.toUpperCase()} files`,accept:{[o]:["."+i]}}],excludeAcceptAllOption:!1},n=await window.showSaveFilePicker(s),a=await n.createWritable();if(t.length>1048576){const e=t.match(/.{1,65536}/g)||[];for(const t of e)await a.write(t)}else await a.write(t);return await a.close(),void Ee.nk.success(`File saved successfully as: ${n.name}`)}catch(Dr){if("AbortError"===Dr.name)return;"NotAllowedError"===Dr.name?Ee.nk.warning("File access permission denied. Using fallback download method."):bl.warn("File System Access API failed:",Dr)}else s&&!n&&bl.warn("File System Access API requires HTTPS. Using fallback method.");try{const i=new Blob([t],{type:o+";charset=utf-8"}),s=document.createElement("a"),n="download"in s;if(n){const t=window.URL.createObjectURL(i),o=document.createElement("a");if(o.href=t,o.download=e.fileName,o.style.display="none",o.setAttribute("target","_blank"),o.setAttribute("rel","noopener noreferrer"),document.body.appendChild(o),"function"===typeof o.click)o.click();else{const e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});o.dispatchEvent(e)}setTimeout(()=>{document.body.contains(o)&&document.body.removeChild(o),window.URL.revokeObjectURL(t)},150),Ee.nk.success("File downloaded to your default downloads folder")}else{const e=window.URL.createObjectURL(i),t=window.open(e,"_blank");if(!t)throw new Error("Popup blocked or browser not supported");Ee.nk.info("File opened in new window. Use browser's save function to download."),setTimeout(()=>{window.URL.revokeObjectURL(e)},1e3)}}catch(Dr){if(bl.error("Save As failed:",Dr),navigator.clipboard&&navigator.clipboard.writeText)try{await navigator.clipboard.writeText(t),Ee.nk.warning("Could not download file. Content copied to clipboard instead.")}catch(a){Ee.nk.error("Failed to save file. Please try using a modern browser.")}else Ee.nk.error("Failed to save file. Please try using a modern browser.")}},openMoveDialog(e){bl.log("[VmIde] openMoveDialog called with:",e);e.path||e.filePath;const t=(i,o)=>{if("file"===i.type&&i.name===e.name)return i;if(i.children)for(const e of i.children){const i=t(e,o);if(i)return i}return null};let i=e;if(this.ideInfo.multiRootData&&this.ideInfo.multiRootData.children.length>0)for(const o of this.ideInfo.multiRootData.children){const s=t(o,e.name);if(s){bl.log("[VmIde] Found fresh file data in tree:",s.path),i={...e,path:s.path,filePath:s.path};break}}else if(this.ideInfo.currProj&&this.ideInfo.currProj.data){const o=t(this.ideInfo.currProj.data,e.name);o&&(bl.log("[VmIde] Found fresh file data in single project:",o.path),i={...e,path:o.path,filePath:o.path})}this.fileBrowserMode="move",this.fileToMove=i,this.showFileBrowserDialog=!0,bl.log("[VmIde] Move dialog opened with fresh data, mode:",this.fileBrowserMode,"fileToMove:",this.fileToMove)},handleMoveFile(e){bl.log("[VmIde] handleMoveFile called with data:",e);const{oldPath:t,newPath:i,projectName:o}=e,s=this,n=(e,t)=>{if(!e||!t)return e;const i=t+"/";return e.startsWith(i)?e.substring(i.length):e},a=n(t,o),r=n(i,o);if(bl.log("[VmIde] Normalized paths:",{originalOldPath:t,normalizedOldPath:a,originalNewPath:i,normalizedNewPath:r,projectName:o}),a===r)return Ee.nk.warning("Source and destination paths are the same"),void(this.showFileBrowserDialog=!1);if(r.startsWith(a+"/"))return Ee.nk.error("Cannot move a file into its own subdirectory"),void(this.showFileBrowserDialog=!1);const l=!1===this.ideInfo.nodeSelected?.isLeaf,d=l?ut.mr:ut.GG;bl.log("[VmIde] Using move command:",d),this.$store.dispatch(`ide/${d}`,{wsKey:this.wsKey,projectName:o,oldPath:a,newPath:r,callback:e=>{if(bl.log("[VmIde] Move result:",e),0===e.code){if(Ee.nk.success((l?"Folder":"File")+" moved successfully"),s.ideInfo.nodeSelected&&s.ideInfo.nodeSelected.path===t){const e={...s.ideInfo.nodeSelected,path:i,filePath:i,fileName:i.substring(i.lastIndexOf("/")+1),name:i.substring(i.lastIndexOf("/")+1),label:i.substring(i.lastIndexOf("/")+1)};if(s.$store.commit("ide/setNodeSelected",e),!l&&s.ideInfo.openList.length>0){const e=s.ideInfo.openList.findIndex(e=>e.path===t);if(-1!==e){const o=[...s.ideInfo.openList];o[e]={...o[e],path:i,filePath:i,fileName:i.substring(i.lastIndexOf("/")+1),name:i.substring(i.lastIndexOf("/")+1),label:i.substring(i.lastIndexOf("/")+1)},s.$store.commit("ide/setOpenList",o),s.ideInfo.selectFilePath===t&&s.$store.commit("ide/setSelectFilePath",i)}}}s.refreshProjectTreeWithCallback(()=>{bl.log("[VmIde] Tree refresh completed after move"),s.showFileBrowserDialog=!1})}else bl.error("[VmIde] Move failed:",e),Ee.nk.error(e.msg||"Failed to move "+(l?"folder":"file")),s.showFileBrowserDialog=!1}})},deleteFileFromMenu(e){this.handleDeleteItem(e)},deleteSelectedFile(e){this.handleDeleteItem(e)},setDelDialog(e){this.dialogType="",this.dialogTitle=e.title,this.dialogText="",this.dialogTips="",this.showDeleteDialog=!0},setProjsDialog(e){this.dialogType="",this.dialogTitle="",this.dialogText="",this.dialogTips="",this.showProjsDialog=!0},onCloseTextDialog(){this.showFileDialog=!1,this.ideInfo.nodeSelected&&this.ideInfo.treeRef.setCurrentNode(this.ideInfo.nodeSelected),"create-project"===this.dialogType&&(this.showProjsDialog=!0)},onCloseProjsDialog(){this.showProjsDialog=!1,this.showFileDialog=!1,this.showDeleteDialog=!1,this.ideInfo.nodeSelected&&this.ideInfo.treeRef.setCurrentNode(this.ideInfo.nodeSelected)},onCancelDelete(){this.showDeleteDialog=!1,this.ideInfo.nodeSelected&&this.ideInfo.treeRef.setCurrentNode(this.ideInfo.nodeSelected)},deleteProject(e){const t=this;this.$store.dispatch(`ide/${ut.DO}`,{projectName:e,callback:i=>{0==i.code&&t.$store.commit("ide/handleDelProject",e)}})},deleteFile(e,t){const i=this;bl.log("[deleteFile] Deleting file:",e,"from project:",t||this.ideInfo.currProj.config.name);const o=t||this.ideInfo.currProj.config.name||this.ideInfo.currProj.data?.name;this.$store.dispatch(`ide/${ut.w7}`,{projectName:o,filePath:e,callback:t=>{if(bl.log("[deleteFile] Response:",t),0==t.code){const t=i.getParentData(e);t&&i.$store.commit("ide/handleDelFile",{parentData:t,filePath:e}),i.refreshProjectTree(),(0,Ee.nk)({type:"success",message:"File deleted successfully",duration:2e3})}else(0,Ee.nk)({type:"error",message:"Failed to delete file",duration:3e3})}})},deleteFolder(e,t){const i=this;bl.log("[deleteFolder] Deleting folder:",e,"from project:",t||this.ideInfo.currProj.config.name);const o=t||this.ideInfo.currProj.config.name||this.ideInfo.currProj.data?.name;this.$store.dispatch(`ide/${ut.Ec}`,{projectName:o,folderPath:e,callback:t=>{if(bl.log("[deleteFolder] Response:",t),0==t.code){const t=!e.includes("/")||["Local","Lecture Notes"].includes(e)||1===e.split("/").length;if(bl.log("[deleteFolder] Is root-level operation?",t,"for path:",e),t)bl.log("[deleteFolder] Root-level folder delete - refreshing project list"),i.$store.dispatch(`ide/${ut.qB}`,{callback:e=>{bl.log("[deleteFolder] Project list refresh response:",e),0===e.code&&(i.$store.commit("ide/handleProjects",e.data),i.ideInfo.multiRootData&&i.loadAllDefaultProjects(),(0,Ee.nk)({type:"success",message:"Folder deleted successfully",duration:2e3}))}});else{const t=i.getParentData(e);t&&i.$store.commit("ide/handleDelFolder",{parentData:t,folderPath:e}),i.refreshProjectTree(),(0,Ee.nk)({type:"success",message:"Folder deleted successfully",duration:2e3})}}else(0,Ee.nk)({type:"error",message:"Failed to delete folder",duration:3e3})}})},createProject(e){const t=this;this.$store.dispatch(`ide/${ut.KV}`,{projectName:e,callback:i=>{0==i.code&&t.listProjects(e)}})},createFile(e,t,i){const o=this;this.$store.dispatch(`ide/${ut.Zd}`,{projectName:void 0===i?this.ideInfo.currProj.config.name:i,parentPath:void 0===t?this.ideInfo.nodeSelected.path:t,fileName:e,callback:t=>{if(0==t.code){const t=kl.join(o.ideInfo.nodeSelected.path,e);o.$store.commit("ide/addChildrenNode",{name:e,path:t,type:"file"}),o.$store.dispatch(`ide/${ut.xv}`,{})}}})},createFolder(e,t,i){const o=this;this.$store.dispatch(`ide/${ut.p_}`,{projectName:void 0===i?this.ideInfo.currProj.config.name:i,parentPath:void 0===t?this.ideInfo.nodeSelected.path:t,folderName:e,callback:t=>{if(0==t.code){const t=kl.join(o.ideInfo.nodeSelected.path,e);o.$store.commit("ide/addChildrenNode",{name:e,path:t,type:"dir"}),o.$store.dispatch(`ide/${ut.xv}`,{})}}})},renameProject(e,t){const i=this;this.$store.dispatch(`ide/${ut.sh}`,{oldName:void 0===t?this.ideInfo.currProj.config.name:t,newName:e,callback:t=>{0==t.code&&(i.$store.commit("ide/handleRename",e),i.$store.dispatch(`ide/${ut.xv}`,{}))}})},renameFile(e,t,i){const o=this;let s=t;if(void 0===s){if(!this.ideInfo.nodeSelected||!this.ideInfo.nodeSelected.path)return bl.error("Cannot rename: no path provided and nodeSelected is null"),void Ee.nk.error("Cannot rename: no file selected");s=this.ideInfo.nodeSelected.path}bl.log("[renameFile] Starting rename:",{actualOldPath:s,newName:e,projectName:i});const n=i||this.ideInfo.currProj?.config?.name||this.ideInfo.currProj?.data?.name;bl.log("[renameFile] Using project name:",n),this.$store.dispatch(`ide/${ut.Z0}`,{projectName:n,oldPath:s,fileName:e,callback:t=>{if(bl.log("[renameFile] Backend response:",t),0==t.code){const t=s.substring(0,s.lastIndexOf("/")+1)+e;bl.log("[renameFile] New path will be:",t);for(let i=0;i<o.ideInfo.codeItems.length;i++)if(o.ideInfo.codeItems[i].path===s){bl.log("[renameFile] Updating open tab from",s,"to",t),o.ideInfo.codeItems[i].path=t,o.ideInfo.codeItems[i].name=e;break}o.$store.dispatch(`ide/${ut.QQ}`,{projectName:n,callback:e=>{0==e.code&&(o.$store.commit("ide/handleProject",e.data),o.$store.commit("ide/setPathSelected",t),o.ideInfo.multiRootData&&(bl.log("[renameFile] Refreshing all projects in multi-root mode"),o.loadAllDefaultProjects()),Ee.nk.success("File renamed successfully"))}})}else{bl.error("[renameFile] Rename failed:",t);const e=t.data?.message||t.message||"Unknown error";Ee.nk.error("Failed to rename file: "+e)}}})},renameFolder(e,t,i){const o=this;let s=t;if(void 0===s){if(!this.ideInfo.nodeSelected||!this.ideInfo.nodeSelected.path)return bl.error("Cannot rename folder: no path provided and nodeSelected is null"),void Ee.nk.error("Cannot rename folder: no folder selected");s=this.ideInfo.nodeSelected.path}bl.log("[renameFolder] Starting rename:",{actualOldPath:s,newName:e,projectName:i});const n=i||this.ideInfo.currProj?.config?.name||this.ideInfo.currProj?.data?.name;bl.log("[renameFolder] Using project name:",n),this.$store.dispatch(`ide/${ut.Zz}`,{projectName:n,oldPath:s,folderName:e,callback:t=>{if(bl.log("[renameFolder] Backend response:",t),0==t.code){const t=s.substring(0,s.lastIndexOf("/")+1)+e;bl.log("[renameFolder] New path will be:",t);for(let e=0;e<o.ideInfo.codeItems.length;e++)if(o.ideInfo.codeItems[e].path.startsWith(s+"/")){const i=o.ideInfo.codeItems[e].path.substring(s.length),n=t+i;bl.log("[renameFolder] Updating open tab from",o.ideInfo.codeItems[e].path,"to",n),o.ideInfo.codeItems[e].path=n}const i=!s.includes("/")||["Local","Lecture Notes"].includes(s)||1===s.split("/").length;bl.log("[renameFolder] Is root-level operation?",i,"for path:",s),i?(bl.log("[renameFolder] Root-level folder rename - refreshing project list"),o.$store.dispatch(`ide/${ut.qB}`,{callback:e=>{bl.log("[renameFolder] Project list refresh response:",e),0===e.code&&(o.$store.commit("ide/handleProjects",e.data),o.ideInfo.multiRootData&&o.loadAllDefaultProjects(),o.$store.commit("ide/setPathSelected",t),Ee.nk.success("Folder renamed successfully"))}})):o.$store.dispatch(`ide/${ut.QQ}`,{projectName:n,callback:e=>{0==e.code&&(o.$store.commit("ide/handleProject",e.data),o.$store.commit("ide/setPathSelected",t),o.ideInfo.multiRootData&&(bl.log("[renameFolder] Refreshing all projects in multi-root mode"),o.loadAllDefaultProjects()),Ee.nk.success("Folder renamed successfully"))}})}else{bl.error("[renameFolder] Rename failed:",t);const e=t.data?.message||t.message||"Unknown error";Ee.nk.error("Failed to rename folder: "+e)}}})},onDelete(){this.showDeleteDialog=!1,this.ideInfo.nodeSelected&&this.ideInfo.nodeSelected.type&&("dir"===this.ideInfo.nodeSelected.type||"folder"===this.ideInfo.nodeSelected.type)?this.deleteFolder(this.ideInfo.nodeSelected.path):this.deleteFile(this.ideInfo.nodeSelected.path)},onCreate(){const e=this.dialogText;if("create-file"===this.dialogType)this.createFile(e);else if("rename-file"===this.dialogType)this.renameFile(e);else if("create-folder"===this.dialogType)this.createFolder(e);else if("rename-folder"===this.dialogType)this.renameFolder(e);else if("create-project"===this.dialogType)if(this.hasRunProgram){const t=this;pi.s.confirm("Stop all running programs and create new project?","Warning",{confirmButtonText:"Stop and Create",cancelButtonText:"Cancel",type:"warning"}).then(()=>{t.stopAll(),t.$store.commit("ide/setConsoleItems",[]),t.createProject(e)}).catch(()=>{bl.log("canceled create project")})}else this.$store.commit("ide/setConsoleItems",[]),this.createProject(e);else"rename-project"===this.dialogType&&this.renameProject(e);this.showProjsDialog=!1,this.showFileDialog=!1,this.showDeleteDialog=!1},onDeleteProj(e){const t=this;pi.s.confirm("Delete this project?","Confirm",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}).then(()=>{t.deleteProject(e),(0,Ee.nk)({type:"success",message:"Deleted successfully"})}).catch(()=>{(0,Ee.nk)({type:"info",message:"Cancelled"})})},onSelectProj(e){this.hasRunProgram?pi.s.confirm("Stop all running programs and switch project?","Warning",{confirmButtonText:"Stop and Switch",cancelButtonText:"Cancel",type:"warning"}).then(()=>{this.stopAll(),this.$store.commit("ide/setConsoleItems",[]),this.getProject(e),this.showProjsDialog=!1}).catch(()=>{this.showProjsDialog=!1}):(this.getProject(e),this.showProjsDialog=!1,this.$store.commit("ide/setConsoleItems",[]))},selectFile(e){const t=this.ideInfo.codeSelected,i=t&&t.path!==e.path;if(i&&t.path&&t.path.endsWith(".py")){const e=this.ideInfo.consoleItems.find(e=>e.path===t.path);e&&(e.run||e.isReplMode||e.replActive)&&(bl.log("[FILE-SWITCH] Stopping running process for previous file:",t.path),bl.log("[FILE-SWITCH] Console state:",{run:e.run,isReplMode:e.isReplMode,replActive:e.replActive}),this.stop(e.id),this.$store.commit("ide/updateConsoleItem",{id:e.id,run:!1,isReplMode:!1,replActive:!1,waitingForInput:!1,inputPrompt:""})),this.saveFileConsoleState(t.path)}if(gl.constructor.emitIDEActivity("file-open",{filename:e.fileName}),this.$store.commit("ide/setPathSelected",e.path),this.$store.commit("ide/setCodeSelected",e),this.activeFilePath=e.path,i&&e.path&&e.path.endsWith(".py")){let t=this.ideInfo.consoleItems.find(t=>t.path===e.path);t||(t={id:this.$store.state.ide.consoleId,name:e.name,path:e.path,resultList:[],run:!1,stop:!1,waitingForInput:!1,inputPrompt:""},this.$store.commit("ide/pushConsoleItem",t)),this.$store.commit("ide/setConsoleSelected",t),this.consoleMode="collapsed",this.consoleExpanded=!1,this.consoleMaximized=!1,this.$nextTick(()=>{this.updateEditorHeight()})}this.ideInfo.currProj.pathSelected&&this.ideInfo.treeRef&&(this.ideInfo.treeRef.setCurrentKey(this.ideInfo.currProj.pathSelected),this.$store.commit("ide/setNodeSelected",this.ideInfo.treeRef.getCurrentNode())),this.$store.dispatch(`ide/${ut.xv}`,{})},closeFile(e){if(e.path&&e.path.endsWith(".py")){this.activeFilePath===e.path&&this.saveFileConsoleState(e.path);const t=this.ideInfo.consoleItems.filter(t=>t.path!==e.path);this.$store.commit("ide/setConsoleItems",t)}const t=[];for(let i=0;i<this.ideInfo.codeItems.length;i++)e.path!==this.ideInfo.codeItems[i].path?t.push(this.ideInfo.codeItems[i]):i>0?this.ideInfo.currProj.pathSelected===e.path&&(this.$store.commit("ide/setPathSelected",this.ideInfo.codeItems[i-1].path),this.$store.commit("ide/setCodeSelected",this.ideInfo.codeItems[i-1])):i<this.ideInfo.codeItems.length-1&&this.ideInfo.currProj.pathSelected===e.path&&(this.$store.commit("ide/setPathSelected",this.ideInfo.codeItems[i+1].path),this.$store.commit("ide/setCodeSelected",this.ideInfo.codeItems[i+1]));this.$store.commit("ide/setCodeItems",t),0===this.ideInfo.codeItems.length&&(this.$store.commit("ide/setPathSelected",null),this.$store.commit("ide/setCodeSelected",{})),this.$store.dispatch(`ide/${ut.xv}`,{})},updateItem(e,t){for(let i=0;i<this.ideInfo.codeItems.length;i++)if(e===this.ideInfo.codeItems[i].path){this.$store.commit("ide/setCodeItemMirror",{index:i,codemirror:t});break}},selectConsole(e){this.$store.commit("ide/setConsoleSelected",e)},closeConsoleSafe(e){!0===e.run?pi.s.confirm("Stop this program and close terminal?","Warning",{confirmButtonText:"Stop and Close",cancelButtonText:"Cancel",type:"warning"}).then(()=>{this.stop(e.id),this.closeConsole(e)}).catch(()=>{bl.log("canceled close console")}):this.closeConsole(e)},closeConsole(e){const t=[];for(let i=0;i<this.ideInfo.consoleItems.length;i++)"Terminal"===e.name&&"Terminal"===e.path?e.id!==this.ideInfo.consoleItems[i].id?t.push(this.ideInfo.consoleItems[i]):i>0?this.$store.commit("ide/setConsoleSelected",this.ideInfo.consoleItems[i-1]):i<this.ideInfo.consoleItems.length-1&&this.$store.commit("ide/setConsoleSelected",this.ideInfo.consoleItems[i+1]):e.path!==this.ideInfo.consoleItems[i].path||e.id!==this.ideInfo.consoleItems[i].id?t.push(this.ideInfo.consoleItems[i]):i>0?this.$store.commit("ide/setConsoleSelected",this.ideInfo.consoleItems[i-1]):i<this.ideInfo.consoleItems.length-1&&this.$store.commit("ide/setConsoleSelected",this.ideInfo.consoleItems[i+1]);this.$store.commit("ide/setConsoleItems",t),0===this.ideInfo.consoleItems.length&&this.$store.commit("ide/setConsoleSelected",{}),this.resize()},getCurrentConsoleHeight(){return 400},resize(){this.windowWidth=window.innerWidth,this.$forceUpdate()},runPathSelected(){gl.constructor.emitIDEActivity("code-run");const e=this.ideInfo.currProj.pathSelected;if(!e||""===e||null===e)return void(0,Ee.nk)({type:"warning",message:"No script is open to run. Please open a Python file first.",duration:3e3});this.consoleExpanded||(this.consoleExpanded=!0,this.updateEditorHeight());const t=this.getOrCreateFileConsole(e);this.$store.commit("ide/resetConsoleItem",{consoleId:t.id,run:!1,stop:!1,resultList:[]}),this.$store.commit("ide/setConsoleSelected",t),this.$store.commit("ide/assignConsoleSelected",{id:this.ideInfo.consoleId}),this.saveFileConsoleState(e),"collapsed"===this.consoleMode&&(this.consoleMode="normal",this.consoleExpanded=!0,this.consoleMaximized=!1);const i=this.ideInfo.codeSelected?.projectName||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name,o=this.ideInfo.consoleId;this.replSessionId=o,bl.log(`[VmIde] Setting replSessionId to ${o} for Python program execution`),this.$store.dispatch(`ide/${ut.j8}`,{msgId:o,projectName:i,filePath:this.ideInfo.currProj.pathSelected,callback:{limits:-1,callback:e=>{bl.log(" [VmIde] Script execution callback:",e);const t=e.id===this.replSessionId||e.cmd_id===this.replSessionId||e.data&&e.data.program_id===this.replSessionId||this.isReplMode&&this.replSessionId&&(0===e.code||2e3===e.code||5e3===e.code)&&e.data&&(e.data.stdout||e.data.stderr),i=null===e.data||void 0===e.data||2e3===e.code||4e3===e.code||5e3===e.code;bl.log(" [Script] Callback - isReplMessage:",t,"isProgramLifecycle:",i,"code:",e.code,"id:",e.id,"replSessionId:",this.replSessionId),!t||i?(bl.log(" [Script] Processing through handleRunResult"),this.$store.commit("ide/handleRunResult",e)):bl.log(" [Script] Skipping - will be handled by REPL"),5e3!==e.code||t||(bl.log(" [VmIde] Script completed, entering REPL mode"),this.isReplMode=!0)}}}),this.$store.commit("ide/setConsoleId",this.ideInfo.consoleId+1)},runConsoleSelected(){this.switchToOutputTab(),"collapsed"===this.consoleMode&&(this.consoleMode="normal",this.consoleExpanded=!0,this.consoleMaximized=!1);const e=this.ideInfo.consoleSelected?.projectName||this.ideInfo.currProj?.data?.name||this.ideInfo.currProj?.config?.name,t=this.ideInfo.consoleSelected.id;this.replSessionId=t,bl.log(`[VmIde] Setting replSessionId to ${t} for Python program re-run`),this.$store.dispatch(`ide/${ut.j8}`,{msgId:t,projectName:e,filePath:this.ideInfo.consoleSelected.path,callback:{limits:-1,callback:e=>{const t=e.id===this.replSessionId||e.cmd_id===this.replSessionId||e.data&&e.data.program_id===this.replSessionId||this.isReplMode&&this.replSessionId&&(0===e.code||2e3===e.code||5e3===e.code)&&e.data&&(e.data.stdout||e.data.stderr),i=null===e.data||void 0===e.data||2e3===e.code||4e3===e.code||5e3===e.code;bl.log(" [REPL] Callback - isReplMessage:",t,"isProgramLifecycle:",i,"code:",e.code,"id:",e.id,"replSessionId:",this.replSessionId),!t||i?(bl.log(" [REPL] Processing through handleRunResult"),this.$store.commit("ide/handleRunResult",e)):bl.log(" [REPL] Skipping - will be handled by WebSocket")}}})},stop(e){this.$store.dispatch(`ide/${ut.aQ}`,{consoleId:e,callback:{limits:-1,callback:t=>{this.$store.commit("ide/handleStopResult",{consoleId:e,dict:t})}}})},stopAll(){for(let e=0;e<this.ideInfo.consoleItems.length;e++)!0===this.ideInfo.consoleItems[e].run&&this.stop(this.ideInfo.consoleItems[e].id);this.stop(null)},startResizeLeft(e){this.isResizingLeft=!0,this.startX=e.clientX,this.startWidth=this.leftSidebarWidth,document.addEventListener("mousemove",this.throttledHandleResizeLeft),document.addEventListener("mouseup",this.stopResizeLeft),e.preventDefault()},handleResizeLeft(e){if(!this.isResizingLeft)return;const t=e.clientX-this.startX,i=window.innerWidth,o=this.rightSidebarVisible?this.rightSidebarWidth:0,s=i-o-this.minEditorWidth-10;let n=this.startWidth+t;this.resizeWarning=n<160||n>s-10,n=Math.max(150,Math.min(Math.min(500,s),n)),this.leftSidebarWidth=n},stopResizeLeft(){this.isResizingLeft=!1,this.resizeWarning=!1,document.removeEventListener("mousemove",this.throttledHandleResizeLeft),document.removeEventListener("mouseup",this.stopResizeLeft),this.validateLayout(),this.saveLayoutPreferences()},startResizeRight(e){this.isResizingRight=!0,this.startX=e.clientX,this.startWidth=this.rightSidebarWidth,document.addEventListener("mousemove",this.throttledHandleResizeRight),document.addEventListener("mouseup",this.stopResizeRight),e.preventDefault()},handleResizeRight(e){if(!this.isResizingRight)return;const t=this.startX-e.clientX,i=window.innerWidth,o=i-this.leftSidebarWidth-this.minEditorWidth-10;let s=this.startWidth+t;this.resizeWarning=s<310||s>o-10,s=Math.max(300,Math.min(o,s)),this.rightSidebarWidth=s},stopResizeRight(){this.isResizingRight=!1,this.resizeWarning=!1,document.removeEventListener("mousemove",this.throttledHandleResizeRight),document.removeEventListener("mouseup",this.stopResizeRight),this.validateLayout(),this.saveLayoutPreferences()},startResizeConsole(e){this.isResizingConsole=!0,this.startY=e.clientY,this.startHeight=this.consoleHeight,document.addEventListener("mousemove",this.throttledHandleResizeConsole),document.addEventListener("mouseup",this.stopResizeConsole),e.preventDefault()},handleResizeConsole(e){if(!this.isResizingConsole)return;const t=this.startY-e.clientY,i=window.innerHeight,o=i-200;let s=this.startHeight+t;s=Math.max(100,Math.min(o,s)),this.consoleHeight=s,this.updateEditorHeight()},stopResizeConsole(){this.isResizingConsole=!1,document.removeEventListener("mousemove",this.throttledHandleResizeConsole),document.removeEventListener("mouseup",this.stopResizeConsole),this.updateEditorHeight(),this.saveLayoutPreferences()},saveLayoutPreferences(){const e={leftSidebarWidth:this.leftSidebarWidth,rightSidebarWidth:this.rightSidebarWidth,rightSidebarVisible:this.rightSidebarVisible,consoleHeight:this.consoleHeight,consoleExpanded:this.consoleExpanded,wordWrap:this.wordWrap,rightPanelMode:this.rightPanelMode,consoleMode:this.consoleMode,consolePreviousMode:this.consolePreviousMode,wasConsoleOpenBeforeRightExpand:this.wasConsoleOpenBeforeRightExpand};localStorage.setItem("ide-layout-preferences",JSON.stringify(e))},loadLayoutPreferences(){const e=localStorage.getItem("ide-layout-preferences");if(e)try{const t=JSON.parse(e);this.leftSidebarWidth=t.leftSidebarWidth||250,this.rightSidebarWidth=t.rightSidebarWidth||400,this.rightSidebarVisible=!0===t.rightSidebarVisible,this.consoleHeight=t.consoleHeight||200,this.consoleExpanded=!1!==t.consoleExpanded,this.wordWrap=!1!==t.wordWrap,this.rightPanelMode=t.rightPanelMode||"closed",this.consoleMode=t.consoleMode||"collapsed",this.consolePreviousMode=t.consolePreviousMode||"normal",this.wasConsoleOpenBeforeRightExpand=t.wasConsoleOpenBeforeRightExpand||!1,this.rightSidebarVisible="closed"!==this.rightPanelMode,this.consoleExpanded="collapsed"!==this.consoleMode,this.consoleMaximized="maximized"===this.consoleMode}catch(t){bl.warn("Failed to load layout preferences:",t)}this.validateLayout(),this.updateEditorHeight()},validateLayout(){const e=window.innerWidth;if(e<900)return;const t=this.leftSidebarWidth+(this.rightSidebarVisible?this.rightSidebarWidth:0),i=e-t-10;if(i<this.minEditorWidth){const t=this.minEditorWidth-i;if(this.rightSidebarVisible){const i=this.leftSidebarWidth/(this.leftSidebarWidth+this.rightSidebarWidth),o=1-i,s=Math.min(this.leftSidebarWidth-150,t*i),n=Math.min(this.rightSidebarWidth-300,t*o);this.leftSidebarWidth=Math.max(150,this.leftSidebarWidth-s),this.rightSidebarWidth=Math.max(300,this.rightSidebarWidth-n);const a=this.leftSidebarWidth+this.rightSidebarWidth;e-a-10<this.minEditorWidth&&(this.rightSidebarVisible=!1)}else this.leftSidebarWidth=Math.max(150,Math.min(this.leftSidebarWidth,e-this.minEditorWidth-10))}},handleProgramInputKeydown(e){if("Enter"===e.key)if(e.shiftKey){e.preventDefault();const t=e.target.selectionStart,i=e.target.selectionEnd,o=this.programInput;this.programInput=o.substring(0,t)+"\n"+o.substring(i),this.$nextTick(()=>{e.target.selectionStart=e.target.selectionEnd=t+1,this.updateProgramInputRows()})}else e.preventDefault(),this.sendProgramInput();else if("Tab"===e.key){e.preventDefault();const t=e.target.selectionStart,i=e.target.selectionEnd,o=this.programInput;this.programInput=o.substring(0,t)+"    "+o.substring(i),this.$nextTick(()=>{e.target.selectionStart=e.target.selectionEnd=t+4,this.updateProgramInputRows()})}this.$nextTick(()=>{this.updateProgramInputRows()})},updateProgramInputRows(){const e=7,t=this.programInput.split("\n").length;this.$refs.programInputField?(this.programInputRows=1,this.$nextTick(()=>{const t=this.$refs.programInputField,i=parseInt(window.getComputedStyle(t).lineHeight)||20,o=t.scrollHeight,s=Math.ceil(o/i);this.programInputRows=Math.min(e,Math.max(1,s))})):this.programInputRows=Math.min(e,Math.max(1,t))},sendProgramInput(){if(!this.programInput.trim())return;const e=this.programInput,t=this.ideInfo.consoleSelected.id;this.$store.commit("ide/addConsoleOutput",{id:t,type:"input",text:` ${e}`}),this.programInput="",this.programInputRows=1,this.$store.commit("ide/setConsoleWaiting",{id:t,waiting:!1,prompt:""}),this.$store.dispatch(`ide/${ut.WP}`,{program_id:t,input:e,callback:{limits:-1,callback:e=>{bl.log("Input sent:",e)}}}),this.$nextTick(()=>{this.$refs.consoleOutputArea&&(this.$refs.consoleOutputArea.scrollTop=this.$refs.consoleOutputArea.scrollHeight)})},handleReplKeydown(e){if("Enter"===e.key)if(e.shiftKey){e.preventDefault();const t=e.target.selectionStart,i=e.target.selectionEnd,o=this.replInput;this.replInput=o.substring(0,t)+"\n"+o.substring(i),this.$nextTick(()=>{e.target.selectionStart=e.target.selectionEnd=t+1,this.updateReplRows()})}else{e.preventDefault();const t=e.target.selectionStart,i=this.replInput.substring(0,t),o=i.split("\n"),s=o[o.length-1],n=""===s.trim(),a=this.replInput.includes("\n");if(n&&a)this.executeReplCommand();else if(this.shouldContinueMultiline(this.replInput)){const t=e.target.selectionStart,i=e.target.selectionEnd,o=this.replInput;this.replInput=o.substring(0,t)+"\n"+o.substring(i),this.$nextTick(()=>{e.target.selectionStart=e.target.selectionEnd=t+1,this.updateReplRows()})}else this.executeReplCommand()}else if("Tab"===e.key){e.preventDefault();const t=e.target.selectionStart,i=e.target.selectionEnd,o=this.replInput;this.replInput=o.substring(0,t)+"    "+o.substring(i),this.$nextTick(()=>{e.target.selectionStart=e.target.selectionEnd=t+4,this.updateReplRows()})}else"ArrowUp"!==e.key||0!==e.target.selectionStart||this.replInput.includes("\n")?"ArrowDown"!==e.key||this.replInput.includes("\n")||(e.preventDefault(),this.navigateReplHistory("down")):(e.preventDefault(),this.navigateReplHistory("up"));this.$nextTick(()=>{this.updateReplRows()})},updateReplRows(){const e=7,t=this.replInput.split("\n").length;this.$refs.replInputField?(this.replInputRows=1,this.$nextTick(()=>{const t=this.$refs.replInputField,i=parseInt(window.getComputedStyle(t).lineHeight)||20,o=t.scrollHeight,s=Math.ceil(o/i);this.replInputRows=Math.min(e,Math.max(1,s))})):this.replInputRows=Math.min(e,Math.max(1,t))},async executeReplCommand(){let e=this.replInput;while(e.endsWith("\n\n"))e=e.slice(0,-1);if(!e||!e.trim())return this.replInput="",void(this.replInputRows=1);if(this.ideInfo.consoleSelected&&this.ideInfo.consoleSelected.waitingForReplInput){const t=this.ideInfo.consoleSelected.id;if(this.replInput="",this.replInputRows=1,this.$store.commit("ide/addConsoleOutput",{id:t,type:"user-input",text:`>>> ${e}`}),this.wsInfo&&this.wsInfo.rws&&this.wsInfo.rws.readyState===WebSocket.OPEN){const i={cmd:"send_program_input",id:t,data:{program_id:t,input:e}};this.wsInfo.rws.send(JSON.stringify(i)),this.$store.commit("ide/setConsoleWaitingForReplInput",{id:t,waiting:!1})}}else await this.executeReplCommandDualMode(e)},shouldContinueMultiline(e){if(!e||!e.trim())return!1;const t=e.split("\n"),i=t[t.length-1].trim();if(i.endsWith(":"))return!0;e.trim();let o=0,s=0;for(const n of t){if(""===n.trim())continue;const e=n.search(/\S/);if(-1===e)continue;const t=n.trim();t.match(/^(def|class|if|elif|else|for|while|with|try|except|finally)\b.*:/)?(o++,s=e):e<=s&&o>0&&!t.match(/^(elif|else|except|finally)\b/)&&(o=Math.max(0,o-1),s=e)}return o>0&&!i.match(/^(return|break|continue|pass|raise)\b/)},highlightPythonCode(e){if(!e||"string"!==typeof e)return e;if("undefined"!==typeof Prism&&Prism.languages&&Prism.languages.python)try{return Prism.highlight(e,Prism.languages.python,"python")}catch(Dr){return bl.warn("Prism.js highlighting failed:",Dr),this.simpleHighlight(e)}return this.simpleHighlight(e)},isPromptOutput(e){const t=e.text||e.content||e;return"string"===typeof t&&(t.match(/^\s*>>>\s*$/)||t.match(/^\s*\.\.\.\s*$/)||t.match(/^>>>\s*\n*$/)||t.match(/^\.\.\.\s*\n*$/)||">>>"===t.trim()||"..."===t.trim()||">>> "===t||"... "===t)},simpleHighlight(e){if(!e)return e;let t=this.escapeHtml(e);const i=["def","class","if","elif","else","try","except","finally","for","while","with","as","import","from","return","yield","lambda","pass","break","continue","raise","assert","del","and","or","not","in","is","None","True","False","async","await"],o=new RegExp(`\\b(${i.join("|")})\\b`,"g");t=t.replace(o,'<span class="python-keyword">$1</span>'),t=t.replace(/(["'])((?:\\.|(?!\1).)*?)\1/g,'<span class="python-string">$1$2$1</span>'),t=t.replace(/\b(\d+\.?\d*)\b/g,'<span class="python-number">$1</span>'),t=t.replace(/(#.*$)/gm,'<span class="python-comment">$1</span>');const s=["print","input","range","len","str","int","float","list","dict","set","tuple","type","sum","max","min","abs","round","sorted","reversed"],n=new RegExp(`\\b(${s.join("|")})\\b`,"g");return t=t.replace(n,'<span class="python-builtin">$1</span>'),t},escapeHtml(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,e=>t[e])},isMultilineCode(e){return!(!e||"string"!==typeof e)&&(e.includes("\n")&&""!==e.trim())},splitCodeLines(e){return e&&"string"===typeof e?e.split("\n"):[e||""]},ensureReplConsole(){if(bl.log(" [VmIde] ensureReplConsole called"),!this.ideInfo.consoleSelected||!this.ideInfo.consoleSelected.resultList){const e={id:"repl-console",name:"REPL",path:"REPL",resultList:[],run:!1,stop:!1,waitingForInput:!1,inputPrompt:""},t=this.ideInfo.consoleItems.find(e=>"repl-console"===e.id);t||this.$store.commit("ide/pushConsoleItem",e),this.$store.commit("ide/selectConsoleItem","repl-console")}},addReplOutput(e,t="output"){bl.log(` [VmIde] addReplOutput: [${t}] ${e}`),this.ideInfo.consoleSelected&&this.ideInfo.consoleSelected.id&&(this.$store.commit("ide/addConsoleOutput",{id:this.ideInfo.consoleSelected.id,type:t,text:e}),this.$nextTick(()=>{this.$refs.consoleOutputArea&&(this.$refs.consoleOutputArea.scrollTop=this.$refs.consoleOutputArea.scrollHeight)}))},navigateReplHistory(e){if(0!==this.replHistory.length){if("up"===e)-1===this.replHistoryIndex?this.replHistoryIndex=this.replHistory.length-1:this.replHistoryIndex>0&&this.replHistoryIndex--;else if("down"===e){if(-1===this.replHistoryIndex)return;if(!(this.replHistoryIndex<this.replHistory.length-1))return this.replHistoryIndex=-1,void(this.replInput="");this.replHistoryIndex++}this.replHistoryIndex>=0&&(this.replInput=this.replHistory[this.replHistoryIndex])}},async executeTerminalCommand(){if(!this.terminalInput.trim())return;const e=this.terminalInput.trim();if(this.terminalHistory[this.terminalHistory.length-1]!==e&&this.terminalHistory.push(e),this.terminalHistoryIndex=-1,this.addTerminalOutput("input",e),"clear"===e||"clear()"===e)return this.clearTerminal(),void(this.terminalInput="");if("help"===e||"help()"===e)return this.addTerminalOutput("output",this.getHelpText()),this.terminalInput="",void this.$nextTick(()=>{this.scrollTerminalToBottom(),this.focusTerminalInput()});const t=await this.ensurePyodideReady();if(!t)return this.addTerminalOutput("error","Python environment failed to initialize"),void(this.terminalInput="");try{bl.log("[Pyodide] Executing:",e);const t=this.pyodide.runPython(e);void 0!==t&&null!==t&&this.addTerminalOutput("output",String(t))}catch(Dr){bl.error("[Pyodide] Execution error:",Dr),this.addTerminalOutput("error",Dr.toString())}this.terminalInput="",this.$nextTick(()=>{this.scrollTerminalToBottom(),this.focusTerminalInput()})},addTerminalOutput(e,t){this.terminalOutput.push({type:e,content:t,timestamp:(new Date).toISOString()})},getHelpText(){return" Python Interactive Terminal (Powered by Pyodide)\n\nFeatures:\n Full Python 3.11 environment in your browser\n All variables and imports persist across commands\n NumPy, Pandas, Matplotlib support available\n Use Up/Down arrows for command history\n Type 'clear' to clear the terminal\n\nTry these examples:\n  >>> import math\n  >>> math.sqrt(16)\n  >>> x = [1, 2, 3, 4, 5]\n  >>> sum(x)\n\nAdvanced packages (install with micropip):\n  >>> import micropip\n  >>> await micropip.install(\"requests\")"},navigateHistory(e){if(0!==this.terminalHistory.length){if("up"===e)-1===this.terminalHistoryIndex?this.terminalHistoryIndex=this.terminalHistory.length-1:this.terminalHistoryIndex>0&&this.terminalHistoryIndex--;else if("down"===e){if(-1===this.terminalHistoryIndex)return;if(!(this.terminalHistoryIndex<this.terminalHistory.length-1))return this.terminalHistoryIndex=-1,void(this.terminalInput="");this.terminalHistoryIndex++}this.terminalHistoryIndex>=0&&(this.terminalInput=this.terminalHistory[this.terminalHistoryIndex])}},scrollTerminalToBottom(){this.$refs.terminalContent&&(this.$refs.terminalContent.scrollTop=this.$refs.terminalContent.scrollHeight)},focusTerminalInput(){this.$refs.terminalInputField&&this.$refs.terminalInputField.focus()},switchToOutputTab(){this.consoleModeTab="output"},switchToTerminalTab(){this.consoleModeTab="terminal",this.$nextTick(()=>{this.focusTerminalInput()})}}};const Pl=(0,k.A)(Il,[["render",ta],["__scopeId","data-v-a0c4663a"]]);var Sl=Pl}}]);